(()=>{var ce=(k,e)=>()=>(e||k((e={exports:{}}).exports,e),e.exports);var Gt=ce((uu,xs)=>{var zi=class k{static clone(e){let t=Array.isArray(e)?Array():{};for(let r in e){let i=e[r];typeof i.clone=="function"?t[r]=i.clone():t[r]=typeof i=="object"?k.clone(i):i}return t}static equals(e,t){if(e.length!==t.length)return!1;let r=e.slice().sort(),i=t.slice().sort();for(var s=0;s<r.length;s++)if(r[s]!==i[s])return!1;return!0}static print(e){if(e.length==0)return"";let t="(";for(let r=0;r<e.length;r++)t+=e[r].id?e[r].id+", ":e[r]+", ";return t=t.substring(0,t.length-2),t+")"}static each(e,t){for(let r=0;r<e.length;r++)t(e[r])}static get(e,t,r){for(let i=0;i<e.length;i++)if(e[i][t]==r)return e[i]}static contains(e,t){if(!t.property&&!t.func){for(let r=0;r<e.length;r++)if(e[r]==t.value)return!0}else if(t.func){for(let r=0;r<e.length;r++)if(t.func(e[r]))return!0}else for(let r=0;r<e.length;r++)if(e[r][t.property]==t.value)return!0;return!1}static intersection(e,t){let r=new Array;for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)e[i]===t[s]&&r.push(e[i]);return r}static unique(e){let t={};return e.filter(function(r){return t[r]!==void 0?!1:t[r]=!0})}static count(e,t){let r=0;for(let i=0;i<e.length;i++)e[i]===t&&r++;return r}static toggle(e,t){let r=Array(),i=!1;for(let s=0;s<e.length;s++)e[s]!==t?r.push(e[s]):i=!0;return i||r.push(t),r}static remove(e,t){let r=Array();for(let i=0;i<e.length;i++)e[i]!==t&&r.push(e[i]);return r}static removeUnique(e,t){let r=e.indexOf(t);return r>-1&&e.splice(r,1),e}static removeAll(e,t){return e.filter(function(r){return t.indexOf(r)===-1})}static merge(e,t){let r=new Array(e.length+t.length);for(let i=0;i<e.length;i++)r[i]=e[i];for(let i=0;i<t.length;i++)r[e.length+i]=t[i];return r}static containsAll(e,t){let r=0;for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)e[i]===t[s]&&r++;return r===t.length}static sortByAtomicNumberDesc(e){let t=e.map(function(r,i){return{index:i,value:r.atomicNumber.split(".").map(Number)}});return t.sort(function(r,i){let s=Math.min(i.value.length,r.value.length),l=0;for(;l<s&&i.value[l]===r.value[l];)l++;return l===s?i.value.length-r.value.length:i.value[l]-r.value[l]}),t.map(function(r){return e[r.index]})}static deepCopy(e){let t=Array();for(let r=0;r<e.length;r++){let i=e[r];i instanceof Array?t[r]=k.deepCopy(i):t[r]=i}return t}};xs.exports=zi});var lr=ce((gu,Ns)=>{var Ch=Gt(),Hi=class k{constructor(e,t="-"){this.idx=null,this.element=e.length===1?e.toUpperCase():e,this.drawExplicit=!1,this.ringbonds=Array(),this.rings=Array(),this.bondType=t,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=Array(),this.bridgedRing=null,this.anchoredRings=Array(),this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=Array(),this.isPartOfAromaticRing=e!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1,this.class=void 0}addNeighbouringElement(e){this.neighbouringElements.push(e)}attachPseudoElement(e,t,r=0,i=0){r===null&&(r=0),i===null&&(i=0);let s=r+e+i;this.attachedPseudoElements[s]?this.attachedPseudoElements[s].count+=1:this.attachedPseudoElements[s]={element:e,count:1,hydrogenCount:r,previousElement:t,charge:i},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let e={},t=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(r){e[r]=t.attachedPseudoElements[r]}),e}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return this.element!=="C"&&this.element!=="H"}addAnchoredRing(e){Ch.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}restoreRings(){this.rings=Array(this.originalRings.length);for(let e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}haveCommonRingbond(e,t){for(let r=0;r<e.ringbonds.length;r++)for(let i=0;i<t.ringbonds.length;i++)if(e.ringbonds[r].id==t.ringbonds[i].id)return!0;return!1}neighbouringElementsEqual(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(var t=0;t<this.neighbouringElements.length;t++)if(e[t]!==this.neighbouringElements[t])return!1;return!0}getAtomicNumber(){return k.atomicNumbers[this.element]}getMaxBonds(){return k.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}static get mass(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}};Ns.exports=Hi});var Zt=ce((fu,Rs)=>{var qi=class k{static round(e,t){if(t){let r=Math.pow(10,t);return Math.round(e*r)/r}else return Math.round(e)}static meanAngle(e){let t=0,r=0;for(var i=0;i<e.length;i++)t+=Math.sin(e[i]),r+=Math.cos(e[i]);return Math.atan2(t/e.length,r/e.length)}static innerAngle(e){return k.toRad((e-2)*180/e)}static polyCircumradius(e,t){return e/(2*Math.sin(Math.PI/t))}static apothem(e,t){return e*Math.cos(Math.PI/t)}static apothemFromSideLength(e,t){let r=k.polyCircumradius(e,t);return k.apothem(r,t)}static centralAngle(e){return k.toRad(360/e)}static toDeg(e){return e*k.degFactor}static toRad(e){return e*k.radFactor}static parityOfPermutation(e){let t=new Uint8Array(e.length),r=0,i=function(l,n=0){return t[l]===1?n:(n++,t[l]=1,i(e[l],n))};for(var s=0;s<e.length;s++){if(t[s]===1)continue;let l=i(s);r+=1-l%2}return r%2?-1:1}static get radFactor(){return Math.PI/180}static get degFactor(){return 180/Math.PI}static get twoPI(){return 2*Math.PI}};Rs.exports=qi});var ut=ce((cu,$s)=>{var _i=class k{constructor(e,t){arguments.length==0?(this.x=0,this.y=0):e instanceof k?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}clone(){return new k(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}divide(e){return this.x/=e,this.y/=e,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}distanceSq(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}clockwise(e){let t=this.y*e.x,r=this.x*e.y;return t>r?-1:t===r?0:1}relativeClockwise(e,t){let r=(this.y-e.y)*(t.x-e.x),i=(this.x-e.x)*(t.y-e.y);return r>i?-1:r===i?0:1}rotate(e){let t=new k(0,0),r=Math.cos(e),i=Math.sin(e);return t.x=this.x*r-this.y*i,t.y=this.x*i+this.y*r,this.x=t.x,this.y=t.y,this}rotateAround(e,t){let r=Math.sin(e),i=Math.cos(e);this.x-=t.x,this.y-=t.y;let s=this.x*i-this.y*r,l=this.x*r+this.y*i;return this.x=s+t.x,this.y=l+t.y,this}rotateTo(e,t,r=0){this.x+=.001,this.y-=.001;let i=k.subtract(this,t),s=k.subtract(e,t),l=k.angle(s,i);return this.rotateAround(l+r,t),this}rotateAwayFrom(e,t,r){this.rotateAround(r,t);let i=this.distanceSq(e);this.rotateAround(-2*r,t),this.distanceSq(e)<i&&this.rotateAround(2*r,t)}getRotateAwayFromAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let s=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)<s?r:-r}getRotateTowardsAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let s=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)>s?r:-r}getRotateToAngle(e,t){let r=k.subtract(this,t),i=k.subtract(e,t),s=k.angle(i,r);return Number.isNaN(s)?0:s}isInPolygon(e){let t=!1;for(let r=0,i=e.length-1;r<e.length;i=r++)e[r].y>this.y!=e[i].y>this.y&&this.x<(e[i].x-e[r].x)*(this.y-e[r].y)/(e[i].y-e[r].y)+e[r].x&&(t=!t);return t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return k.divideScalar(this,this.length())}whichSide(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}sameSideAs(e,t,r){let i=this.whichSide(e,t),s=r.whichSide(e,t);return i<0&&s<0||i==0&&s==0||i>0&&s>0}static add(e,t){return new k(e.x+t.x,e.y+t.y)}static subtract(e,t){return new k(e.x-t.x,e.y-t.y)}static multiply(e,t){return new k(e.x*t.x,e.y*t.y)}static multiplyScalar(e,t){return new k(e.x,e.y).multiplyScalar(t)}static midpoint(e,t){return new k((e.x+t.x)/2,(e.y+t.y)/2)}static normals(e,t){let r=k.subtract(t,e);return[new k(-r.y,r.x),new k(r.y,-r.x)]}static units(e,t){let r=k.subtract(t,e);return[new k(-r.y,r.x).normalize(),new k(r.y,-r.x).normalize()]}static divide(e,t){return new k(e.x/t.x,e.y/t.y)}static divideScalar(e,t){return new k(e.x/t,e.y/t)}static dot(e,t){return e.x*t.x+e.y*t.y}static angle(e,t){let r=k.dot(e,t);return Math.acos(r/(e.length()*t.length()))}static threePointangle(e,t,r){let i=k.subtract(t,e),s=k.subtract(r,t),l=e.distance(t),n=t.distance(r);return Math.acos(k.dot(i,s)/(l*n))}static scalarProjection(e,t){let r=t.normalized();return k.dot(e,r)}static averageDirection(e){let t=new k(0,0);for(var r=0;r<e.length;r++){let i=e[r];t.add(i)}return t.normalize()}};$s.exports=_i});var or=ce((du,Es)=>{var Kt=ut(),Wi=class k{constructor(e=new Kt(0,0),t=new Kt(0,0),r=null,i=null,s=!1,l=!1){this.from=e,this.to=t,this.elementFrom=r,this.elementTo=i,this.chiralFrom=s,this.chiralTo=l}clone(){return new k(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){return Math.sqrt(Math.pow(this.to.x-this.from.x,2)+Math.pow(this.to.y-this.from.y,2))}getAngle(){return Kt.subtract(this.getRightVector(),this.getLeftVector()).angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}setLeftVector(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}rotateToXAxis(){let e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}rotate(e){let t=this.getLeftVector(),r=this.getRightVector(),i=Math.sin(e),s=Math.cos(e),l=s*(r.x-t.x)-i*(r.y-t.y)+t.x,n=i*(r.x-t.x)-s*(r.y-t.y)+t.y;return this.setRightVector(l,n),this}shortenFrom(e){let t=Kt.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}shortenTo(e){let t=Kt.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}shortenRight(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}shortenLeft(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}shorten(e){let t=Kt.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}};Es.exports=Wi});var Jt=ce((vu,Ts)=>{var ks=Zt(),zr=Gt(),hr=ut(),pu=lr(),Xi=class k{constructor(e,t=0,r=0){this.id=null,this.value=e,this.position=new hr(t||0,r||0),this.previousPosition=new hr(0,0),this.parentVertexId=null,this.children=Array(),this.spanningTreeChildren=Array(),this.edges=Array(),this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=Array(),this.neighbouringElements=Array(),this.forcePositioned=!1}setPosition(e,t){this.position.x=e,this.position.y=t}setPositionFromVector(e){this.position.x=e.x,this.position.y=e.y}addChild(e){this.children.push(e),this.neighbours.push(e),this.neighbourCount++}addRingbondChild(e,t){if(this.children.push(e),this.value.bracket){let r=1;this.id===0&&this.value.bracket.hcount===0&&(r=0),this.value.bracket.hcount===1&&t===0&&(r=2),this.value.bracket.hcount===1&&t===1&&(this.neighbours.length<3?r=2:r=3),this.value.bracket.hcount===null&&t===0&&(r=1),this.value.bracket.hcount===null&&t===1&&(this.neighbours.length<3?r=1:r=2),this.neighbours.splice(r,0,e)}else this.neighbours.push(e);this.neighbourCount++}setParentVertexId(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e)}isTerminal(){return this.value.hasAttachedPseudoElements?!0:this.parentVertexId===null&&this.children.length<2||this.children.length===0}clone(){let e=new k(this.value,this.position.x,this.position.y);return e.id=this.id,e.previousPosition=new hr(this.previousPosition.x,this.previousPosition.y),e.parentVertexId=this.parentVertexId,e.children=zr.clone(this.children),e.spanningTreeChildren=zr.clone(this.spanningTreeChildren),e.edges=zr.clone(this.edges),e.positioned=this.positioned,e.angle=this.angle,e.forcePositioned=this.forcePositioned,e}equals(e){return this.id===e.id}getAngle(e=null,t=!1){let r=null;return e?r=hr.subtract(this.position,e):r=hr.subtract(this.position,this.previousPosition),t?ks.toDeg(r.angle()):r.angle()}getTextDirection(e,t=!1){let r=this.getDrawnNeighbours(e),i=Array();if(e.length===1)return"right";for(let l=0;l<r.length;l++)i.push(this.getAngle(e[r[l]].position));let s=ks.meanAngle(i);if(this.isTerminal()||t)Math.round(s*100)/100===1.57&&(s=s-.2),s=Math.round(Math.round(s/Math.PI)*Math.PI);else{let l=Math.PI/2;s=Math.round(Math.round(s/l)*l)}return s===2?"down":s===-2?"up":s===0?"right":s===3||s===-3?"left":"down"}getNeighbours(e=null){if(e===null)return this.neighbours.slice();let t=Array();for(let r=0;r<this.neighbours.length;r++)this.neighbours[r]!==e&&t.push(this.neighbours[r]);return t}getDrawnNeighbours(e){let t=Array();for(let r=0;r<this.neighbours.length;r++)e[this.neighbours[r]].value.isDrawn&&t.push(this.neighbours[r]);return t}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(e=null){let t=Array();for(let r=0;r<this.spanningTreeChildren.length;r++)(e===void 0||e!=this.spanningTreeChildren[r])&&t.push(this.spanningTreeChildren[r]);return this.parentVertexId!=null&&(e===void 0||e!=this.parentVertexId)&&t.push(this.parentVertexId),t}getNextInRing(e,t,r){let i=this.getNeighbours();for(let s=0;s<i.length;s++)if(zr.contains(e[i[s]].value.rings,{value:t})&&i[s]!=r)return i[s];return null}};Ts.exports=Xi});var Yi=ce((mu,Ms)=>{var Vi=class k{constructor(e,t,r=1){this.id=null,this.sourceId=e,this.targetId=t,this.weight=r,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(e){this.bondType=e,this.weight=k.bonds[e]}static get bonds(){return{".":0,"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}};Ms.exports=Vi});var Gi=ce((yu,Ls)=>{var bu=Jt(),wu=ur(),Ui=class{constructor(e,t){this.id=null,this.firstRingId=e.id,this.secondRingId=t.id,this.vertices=new Set;for(var r=0;r<e.members.length;r++){let i=e.members[r];for(let s=0;s<t.members.length;s++){let l=t.members[s];i===l&&this.addVertex(i)}}}addVertex(e){this.vertices.add(e)}updateOther(e,t){this.firstRingId===t?this.secondRingId=e:this.firstRingId=e}containsRing(e){return this.firstRingId===e||this.secondRingId===e}isBridge(e){if(this.vertices.size>2)return!0;for(let t of this.vertices)if(e[t].value.rings.length>2)return!0;return!1}static isBridge(e,t,r,i){let s=null;for(let l=0;l<e.length;l++)if(s=e[l],s.firstRingId===r&&s.secondRingId===i||s.firstRingId===i&&s.secondRingId===r)return s.isBridge(t);return!1}static getNeighbours(e,t){let r=[];for(let i=0;i<e.length;i++){let s=e[i];s.firstRingId===t?r.push(s.secondRingId):s.secondRingId===t&&r.push(s.firstRingId)}return r}static getVertices(e,t,r){for(let i=0;i<e.length;i++){let s=e[i];if(s.firstRingId===t&&s.secondRingId===r||s.firstRingId===r&&s.secondRingId===t)return[...s.vertices]}}};Ls.exports=Ui});var ur=ce((Au,Bs)=>{var Zi=Gt(),xh=ut(),Su=Jt(),Nh=Gi(),Ki=class k{constructor(e){this.id=null,this.members=e,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new xh(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let e=new k(this.members);return e.id=this.id,e.insiders=Zi.clone(this.insiders),e.neighbours=Zi.clone(this.neighbours),e.positioned=this.positioned,e.center=this.center.clone(),e.rings=Zi.clone(this.rings),e.isBridged=this.isBridged,e.isPartOfBridged=this.isPartOfBridged,e.isSpiro=this.isSpiro,e.isFused=this.isFused,e.centralAngle=this.centralAngle,e.canFlip=this.canFlip,e}getSize(){return this.members.length}getPolygon(e){let t=[];for(let r=0;r<this.members.length;r++)t.push(e[this.members[r]].position);return t}getAngle(){return Math.PI-this.centralAngle}eachMember(e,t,r,i){r=r||r===0?r:this.members[0];let s=r,l=0;for(;s!=null&&l<100;){let n=s;t(n),s=e[s].getNextInRing(e,this.id,i),i=n,s==r&&(s=null),l++}}getOrderedNeighbours(e){let t=Array(this.neighbours.length);for(let r=0;r<this.neighbours.length;r++){let i=Nh.getVertices(e,this.id,this.neighbours[r]);t[r]={n:i.length,neighbour:this.neighbours[r]}}return t.sort(function(r,i){return i.n-r.n}),t}isBenzeneLike(e){let t=this.getDoubleBondCount(e),r=this.members.length;return t===3&&r===6||t===2&&r===5}getDoubleBondCount(e){let t=0;for(let r=0;r<this.members.length;r++){let i=e[this.members[r]].value;(i.bondType==="="||i.branchBond==="=")&&t++}return t}contains(e){for(let t=0;t<this.members.length;t++)if(this.members[t]==e)return!0;return!1}};Bs.exports=Ki});var gr=ce((Cu,Ps)=>{var Ji=class{constructor(e,t){this.colors=e,this.theme=this.colors[t]}getColor(e){return e&&(e=e.toUpperCase(),e in this.theme)?this.theme[e]:this.theme.C}setTheme(e){this.colors.hasOwnProperty(e)&&(this.theme=this.colors[e])}};Ps.exports=Ji});var Ds=ce((xu,Is)=>{function Rh(k){return k===1?"+":k===2?"2+":k===-1?"-":k===-2?"2-":""}Is.exports={getChargeText:Rh}});var zs=ce((ku,Fs)=>{var Qt=Zt(),Oe=ut(),Nu=or(),Ru=Jt(),$u=ur(),Eu=gr(),{getChargeText:Os}=Ds(),Qi=class{constructor(e,t,r){let i=null;if(e instanceof String?i=document.getElementById(e.valueOf()):typeof e=="string"?i=document.getElementById(e):i=e,i instanceof HTMLCanvasElement)this.canvas=i;else throw Error("First argument was not a canvas or the ID of a canvas.");this.ctx=this.canvas.getContext("2d"),this.themeManager=t,this.opts=r,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,this.ratio!==1?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio)}setTheme(e){this.colors=e}scale(e){let t=-Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MAX_VALUE;for(var l=0;l<e.length;l++){if(!e[l].value.isDrawn)continue;let f=e[l].position;t<f.x&&(t=f.x),r<f.y&&(r=f.y),i>f.x&&(i=f.x),s>f.y&&(s=f.y)}var n=this.opts.padding;t+=n,r+=n,i-=n,s-=n,this.drawingWidth=t-i,this.drawingHeight=r-s;var u=this.canvas.offsetWidth/this.drawingWidth,h=this.canvas.offsetHeight/this.drawingHeight,d=u<h?u:h;this.ctx.scale(d,d),this.offsetX=-i,this.offsetY=-s,u<h?this.offsetY+=this.canvas.offsetHeight/(2*d)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*d)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}drawCircle(e,t,r,i,s=!0,l=!1,n=""){let u=this.ctx,h=this.offsetX,d=this.offsetY;u.save(),u.lineWidth=1.5,u.beginPath(),u.arc(e+h,t+d,r,0,Qt.twoPI,!0),u.closePath(),l?(s?(u.fillStyle="#f00",u.fill()):(u.strokeStyle="#f00",u.stroke()),this.drawDebugText(e,t,n)):s?(u.fillStyle=i,u.fill()):(u.strokeStyle=i,u.stroke()),u.restore()}drawLine(e,t=!1,r=1){let i=this.ctx,s=this.offsetX,l=this.offsetY,n=e.clone().shorten(4),u=n.getLeftVector().clone(),h=n.getRightVector().clone();u.x+=s,u.y+=l,h.x+=s,h.y+=l,t||(i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(u.x,u.y),i.lineTo(h.x,h.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness+1.2,i.strokeStyle=this.themeManager.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()),u=e.getLeftVector().clone(),h=e.getRightVector().clone(),u.x+=s,u.y+=l,h.x+=s,h.y+=l,i.save(),i.beginPath(),i.moveTo(u.x,u.y),i.lineTo(h.x,h.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness;let d=this.ctx.createLinearGradient(u.x,u.y,h.x,h.y);d.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),t&&(i.setLineDash([1,1.5]),i.lineWidth=this.opts.bondThickness/1.5),r<1&&(i.globalAlpha=r),i.strokeStyle=d,i.stroke(),i.restore()}drawWedge(e,t=1){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let r=this.ctx,i=this.offsetX,s=this.offsetY,l=e.clone().shorten(5),n=l.getLeftVector().clone(),u=l.getRightVector().clone();n.x+=i,n.y+=s,u.x+=i,u.y+=s,n=e.getLeftVector().clone(),u=e.getRightVector().clone(),n.x+=i,n.y+=s,u.x+=i,u.y+=s,r.save();let h=Oe.normals(n,u);h[0].normalize(),h[1].normalize();let d=e.getRightChiral(),f=n,c=u;d&&(f=u,c=n);let p=Oe.add(f,Oe.multiplyScalar(h[0],this.halfBondThickness)),w=Oe.add(c,Oe.multiplyScalar(h[0],1.5+this.halfBondThickness)),$=Oe.add(c,Oe.multiplyScalar(h[1],1.5+this.halfBondThickness)),P=Oe.add(f,Oe.multiplyScalar(h[1],this.halfBondThickness));r.beginPath(),r.moveTo(p.x,p.y),r.lineTo(w.x,w.y),r.lineTo($.x,$.y),r.lineTo(P.x,P.y);let M=this.ctx.createRadialGradient(u.x,u.y,this.opts.bondLength,u.x,u.y,0);M.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),M.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),r.fillStyle=M,r.fill(),r.restore()}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=this.ctx,r=this.offsetX,i=this.offsetY,s=e.getLeftVector().clone(),l=e.getRightVector().clone();s.x+=r,s.y+=i,l.x+=r,l.y+=i,t.save();let n=Oe.normals(s,l);n[0].normalize(),n[1].normalize();let u=e.getRightChiral(),h,d,f,c,p=e.clone();u?(h=l,d=s,p.shortenRight(1),f=p.getRightVector().clone(),c=p.getLeftVector().clone()):(h=s,d=l,p.shortenLeft(1),f=p.getLeftVector().clone(),c=p.getRightVector().clone()),f.x+=r,f.y+=i,c.x+=r,c.y+=i;let w=Oe.subtract(d,h).normalize();t.strokeStyle=this.themeManager.getColor("C"),t.lineCap="round",t.lineWidth=this.opts.bondThickness,t.beginPath();let $=e.getLength(),P=1.25/($/(this.opts.bondThickness*3)),M=!1;for(var B=0;B<1;B+=P){let H=Oe.multiplyScalar(w,B*$),E=Oe.add(h,H),D=1.5*B,V=Oe.multiplyScalar(n[0],D);!M&&B>.5&&(t.stroke(),t.beginPath(),t.strokeStyle=this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C"),M=!0),E.subtract(V),t.moveTo(E.x,E.y),E.add(Oe.multiplyScalar(V,2)),t.lineTo(E.x,E.y)}t.stroke(),t.restore()}drawDebugText(e,t,r){let i=this.ctx;i.save(),i.font="5px Droid Sans, sans-serif",i.textAlign="start",i.textBaseline="top",i.fillStyle="#ff0000",i.fillText(r,e+this.offsetX,t+this.offsetY),i.restore()}drawBall(e,t,r){let i=this.ctx;i.save(),i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,Qt.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawPoint(e,t,r){let i=this.ctx,s=this.offsetX,l=this.offsetY;i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(e+s,t+l,1.5,0,Qt.twoPI,!0),i.closePath(),i.fill(),i.globalCompositeOperation="source-over",i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,.75,0,Qt.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawText(e,t,r,i,s,l,n,u,h,d={}){let f=this.ctx,c=this.offsetX,p=this.offsetY;f.save(),f.textAlign="start",f.textBaseline="alphabetic";let w=!1,$="",P=0;n&&($=Os(n),f.font=this.fontSmall,P=f.measureText($).width);let M="0",B=0;u>0&&(M=u.toString(),f.font=this.fontSmall,B=f.measureText(M).width),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0),f.font=this.fontLarge,f.fillStyle=this.themeManager.getColor("BACKGROUND");let H=f.measureText(r);H.totalWidth=H.width+P,H.height=parseInt(this.fontLarge,10);let E=H.width>this.opts.fontSizeLarge?H.width:this.opts.fontSizeLarge;E/=1.5,f.globalCompositeOperation="destination-out",f.beginPath(),f.arc(e+c,t+p,E,0,Qt.twoPI,!0),f.closePath(),f.fill(),f.globalCompositeOperation="source-over";let D=-H.width/2,V=-H.width/2;f.fillStyle=this.themeManager.getColor(r),f.fillText(r,e+c+D,t+this.opts.halfFontSizeLarge+p),D+=H.width,n&&(f.font=this.fontSmall,f.fillText($,e+c+D,t-this.opts.fifthFontSizeSmall+p),D+=P),u>0&&(f.font=this.fontSmall,f.fillText(M,e+c+V-B,t-this.opts.fifthFontSizeSmall+p),V-=B),f.font=this.fontLarge;let ne=0,j=0;if(i===1){let Y=e+c,ae=t+p+this.opts.halfFontSizeLarge;ne=this.hydrogenWidth,V-=ne,s==="left"?Y+=V:s==="right"||s==="up"&&l||s==="down"&&l?Y+=D:s==="up"&&!l?(ae-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Y-=this.halfHydrogenWidth):s==="down"&&!l&&(ae+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Y-=this.halfHydrogenWidth),f.fillText("H",Y,ae),D+=ne}else if(i>1){let Y=e+c,ae=t+p+this.opts.halfFontSizeLarge;ne=this.hydrogenWidth,f.font=this.fontSmall,j=f.measureText(i.toString()).width,V-=ne+j,s==="left"?Y+=V:s==="right"||s==="up"&&l||s==="down"&&l?Y+=D:s==="up"&&!l?(ae-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Y-=this.halfHydrogenWidth):s==="down"&&!l&&(ae+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,Y-=this.halfHydrogenWidth),f.font=this.fontLarge,f.fillText("H",Y,ae),f.font=this.fontSmall,f.fillText(i.toString(),Y+this.halfHydrogenWidth+j,ae+this.opts.fifthFontSizeSmall),D+=ne+this.halfHydrogenWidth+j}if(w){f.restore();return}for(let Y in d){if(!d.hasOwnProperty(Y))continue;let ae=0,pe=0,Ke=d[Y].element,Le=d[Y].count,we=d[Y].hydrogenCount,He=d[Y].charge;f.font=this.fontLarge,Le>1&&we>0&&(ae=f.measureText("(").width,pe=f.measureText(")").width);let Xe=f.measureText(Ke).width,lt=0,ot="",bt=0;ne=0,we>0&&(ne=this.hydrogenWidth),f.font=this.fontSmall,Le>1&&(lt=f.measureText(Le).width),He!==0&&(ot=Os(He),bt=f.measureText(ot).width),j=0,we>1&&(j=f.measureText(we).width),f.font=this.fontLarge;let be=e+c,Se=t+p+this.opts.halfFontSizeLarge;f.fillStyle=this.themeManager.getColor(Ke),Le>0&&(V-=lt),Le>1&&we>0&&(s==="left"?(V-=pe,f.fillText(")",be+V,Se)):(f.fillText("(",be+D,Se),D+=ae)),s==="left"?(V-=Xe,f.fillText(Ke,be+V,Se)):(f.fillText(Ke,be+D,Se),D+=Xe),we>0&&(s==="left"?(V-=ne+j,f.fillText("H",be+V,Se),we>1&&(f.font=this.fontSmall,f.fillText(we,be+V+ne,Se+this.opts.fifthFontSizeSmall))):(f.fillText("H",be+D,Se),D+=ne,we>1&&(f.font=this.fontSmall,f.fillText(we,be+D,Se+this.opts.fifthFontSizeSmall),D+=j))),f.font=this.fontLarge,Le>1&&we>0&&(s==="left"?(V-=ae,f.fillText("(",be+V,Se)):(f.fillText(")",be+D,Se),D+=pe)),f.font=this.fontSmall,Le>1&&(s==="left"?f.fillText(Le,be+V+ae+pe+ne+j+Xe,Se+this.opts.fifthFontSizeSmall):(f.fillText(Le,be+D,Se+this.opts.fifthFontSizeSmall),D+=lt)),He!==0&&(s==="left"?f.fillText(ot,be+V+ae+pe+ne+j+Xe,t-this.opts.fifthFontSizeSmall+p):(f.fillText(ot,be+D,t-this.opts.fifthFontSizeSmall+p),D+=bt))}f.restore()}getChargeText(e){return e===1?"+":e===2?"2+":e===-1?"-":e===-2?"2-":""}drawDebugPoint(e,t,r="",i="#f00"){this.drawCircle(e,t,2,i,!0,!0,r)}drawAromaticityRing(e){let t=this.ctx,r=Qt.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.themeManager.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,r-this.opts.bondSpacing,0,Math.PI*2,!0),t.closePath(),t.stroke(),t.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}};Fs.exports=Qi});var en=ce((Lu,qs)=>{var Hs=Zt(),Tu=ut(),$h=Jt(),Eh=Yi(),Mu=ur(),kh=lr(),ji=class k{constructor(e,t=!1){this.vertices=Array(),this.edges=Array(),this.atomIdxToVertexId=Array(),this.vertexIdsToEdgeId={},this.isomeric=t,this._atomIdx=0,this._time=0,this._init(e)}_init(e,t=0,r=null,i=!1){let s=e.atom.element?e.atom.element:e.atom,l=new kh(s,e.bond);(s!=="H"||!e.hasNext&&r===null)&&(l.idx=this._atomIdx,this._atomIdx++),l.branchBond=e.branchBond,l.ringbonds=e.ringbonds,l.bracket=e.atom.element?e.atom:null,l.class=e.atom.class;let n=new $h(l),u=this.vertices[r];if(this.addVertex(n),l.idx!==null&&this.atomIdxToVertexId.push(n.id),r!==null){n.setParentVertexId(r),n.value.addNeighbouringElement(u.value.element),u.addChild(n.id),u.value.addNeighbouringElement(l.element),u.spanningTreeChildren.push(n.id);let c=new Eh(r,n.id,1);i?c.setBondType(n.value.branchBond||"-"):c.setBondType(u.value.bondType||"-"),this.addEdge(c)}let h=e.ringbondCount+1;l.bracket&&(h+=l.bracket.hcount);let d=0;if(l.bracket&&l.bracket.chirality){l.isStereoCenter=!0,d=l.bracket.hcount;for(var f=0;f<d;f++)this._init({atom:"H",isBracket:"false",branches:Array(),branchCount:0,ringbonds:Array(),ringbondCount:!1,next:null,hasNext:!1,bond:"-"},f,n.id,!0)}for(var f=0;f<e.branchCount;f++)this._init(e.branches[f],f+h,n.id,!0);e.hasNext&&this._init(e.next,e.branchCount+h,n.id)}clear(){this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={}}addVertex(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}addEdge(e){let t=this.vertices[e.sourceId],r=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=t.value.isPartOfAromaticRing&&r.value.isPartOfAromaticRing,t.value.bondCount+=e.weight,r.value.bondCount+=e.weight,t.edges.push(e.id),r.edges.push(e.id),e.id}getEdge(e,t){let r=this.vertexIdsToEdgeId[e+"_"+t];return r===void 0?null:this.edges[r]}getEdges(e){let t=Array(),r=this.vertices[e];for(var i=0;i<r.neighbours.length;i++)t.push(this.vertexIdsToEdgeId[e+"_"+r.neighbours[i]]);return t}hasEdge(e,t){return this.vertexIdsToEdgeId[e+"_"+t]!==void 0}getVertexList(){let e=[this.vertices.length];for(var t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}getEdgeList(){let e=Array(this.edges.length);for(var t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}getAdjacencyMatrix(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++)t[r]=new Array(e),t[r].fill(0);for(var r=0;r<this.edges.length;r++){let s=this.edges[r];t[s.sourceId][s.targetId]=1,t[s.targetId][s.sourceId]=1}return t}getComponentsAdjacencyMatrix(){let e=this.vertices.length,t=Array(e),r=this.getBridges();for(var i=0;i<e;i++)t[i]=new Array(e),t[i].fill(0);for(var i=0;i<this.edges.length;i++){let l=this.edges[i];t[l.sourceId][l.targetId]=1,t[l.targetId][l.sourceId]=1}for(var i=0;i<r.length;i++)t[r[i][0]][r[i][1]]=0,t[r[i][1]][r[i][0]]=0;return t}getSubgraphAdjacencyMatrix(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=new Array(t),r[i].fill(0);for(var s=0;s<t;s++)i!==s&&this.hasEdge(e[i],e[s])&&(r[i][s]=1)}return r}getDistanceMatrix(){let e=this.vertices.length,t=this.getAdjacencyMatrix(),r=Array(e);for(var i=0;i<e;i++)r[i]=Array(e),r[i].fill(1/0);for(var i=0;i<e;i++)for(var s=0;s<e;s++)t[i][s]===1&&(r[i][s]=1);for(var l=0;l<e;l++)for(var i=0;i<e;i++)for(var s=0;s<e;s++)r[i][s]>r[i][l]+r[l][s]&&(r[i][s]=r[i][l]+r[l][s]);return r}getSubgraphDistanceMatrix(e){let t=e.length,r=this.getSubgraphAdjacencyMatrix(e),i=Array(t);for(var s=0;s<t;s++)i[s]=Array(t),i[s].fill(1/0);for(var s=0;s<t;s++)for(var l=0;l<t;l++)r[s][l]===1&&(i[s][l]=1);for(var n=0;n<t;n++)for(var s=0;s<t;s++)for(var l=0;l<t;l++)i[s][l]>i[s][n]+i[n][l]&&(i[s][l]=i[s][n]+i[n][l]);return i}getAdjacencyList(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++){t[r]=[];for(var i=0;i<e;i++)r!==i&&this.hasEdge(this.vertices[r].id,this.vertices[i].id)&&t[r].push(i)}return t}getSubgraphAdjacencyList(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=Array();for(var s=0;s<t;s++)i!==s&&this.hasEdge(e[i],e[s])&&r[i].push(s)}return r}getBridges(){let e=this.vertices.length,t=new Array(e),r=new Array(e),i=new Array(e),s=new Array(e),l=this.getAdjacencyList(),n=Array();t.fill(!1),s.fill(null),this._time=0;for(var u=0;u<e;u++)t[u]||this._bridgeDfs(u,t,r,i,s,l,n);return n}traverseBF(e,t){let r=this.vertices.length,i=new Array(r);i.fill(!1);for(var s=[e];s.length>0;){let n=s.shift(),u=this.vertices[n];t(u);for(var l=0;l<u.neighbours.length;l++){let h=u.neighbours[l];i[h]||(i[h]=!0,s.push(h))}}}getTreeDepth(e,t){if(e===null||t===null)return 0;let r=this.vertices[e].getSpanningTreeNeighbours(t),i=0;for(var s=0;s<r.length;s++){let l=r[s],n=this.getTreeDepth(l,e);n>i&&(i=n)}return i+1}traverseTree(e,t,r,i=999999,s=!1,l=1,n=null){if(n===null&&(n=new Uint8Array(this.vertices.length)),l>i+1||n[e]===1)return;n[e]=1;let u=this.vertices[e],h=u.getNeighbours(t);(!s||l>1)&&r(u);for(var d=0;d<h.length;d++)this.traverseTree(h[d],e,r,i,s,l+1,n)}kkLayout(e,t,r,i,s,l=.1,n=.1,u=2e3,h=50,d=1e9){let f=s;for(var c=e.length;c--;){let U=this.vertices[e[c]]}let p=this.getSubgraphDistanceMatrix(e),w=e.length,$=Hs.polyCircumradius(500,w),P=Hs.centralAngle(w),M=0,B=new Float32Array(w),H=new Float32Array(w),E=Array(w);for(c=w;c--;){let U=this.vertices[e[c]];U.positioned?(B[c]=U.position.x,H[c]=U.position.y):(B[c]=t.x+Math.cos(M)*$,H[c]=t.y+Math.sin(M)*$),E[c]=U.positioned,M+=P}let D=Array(w);for(c=w;c--;){D[c]=new Array(w);let U=w;for(;U--;)D[c][U]=s*p[c][U]}let V=Array(w);for(c=w;c--;){V[c]=Array(w);let U=w;for(;U--;)V[c][U]=f*Math.pow(p[c][U],-2)}let ne=Array(w),j=new Float32Array(w),Y=new Float32Array(w);for(c=w;c--;)ne[c]=Array(w);c=w;let ae,pe,Ke,Le,we,He,Xe;for(;c--;){ae=B[c],pe=H[c],Ke=0,Le=0;let U=w;for(;U--;)c!==U&&(we=B[U],He=H[U],Xe=1/Math.sqrt((ae-we)*(ae-we)+(pe-He)*(pe-He)),ne[c][U]=[V[c][U]*(ae-we-D[c][U]*(ae-we)*Xe),V[c][U]*(pe-He-D[c][U]*(pe-He)*Xe)],ne[U][c]=ne[c][U],Ke+=ne[c][U][0],Le+=ne[c][U][1]);j[c]=Ke,Y[c]=Le}let lt=function(U){return[j[U]*j[U]+Y[U]*Y[U],j[U],Y[U]]},ot=function(){let U=0,Ee=0,je=0,Ve=0;for(c=w;c--;){let[et,Ye,Ie]=lt(c);et>U&&E[c]===!1&&(U=et,Ee=c,je=Ye,Ve=Ie)}return[Ee,U,je,Ve]},bt=function(U,Ee,je){let Ve=0,et=0,Ye=0,Ie=B[U],qe=H[U],Tt=D[U],Mt=V[U];for(c=w;c--;){if(c===U)continue;let St=B[c],tt=H[c],dt=Tt[c],pt=Mt[c],Lt=(Ie-St)*(Ie-St),At=1/Math.pow(Lt+(qe-tt)*(qe-tt),1.5);Ve+=pt*(1-dt*(qe-tt)*(qe-tt)*At),et+=pt*(1-dt*Lt*At),Ye+=pt*(dt*(Ie-St)*(qe-tt)*At)}Ve===0&&(Ve=.1),et===0&&(et=.1),Ye===0&&(Ye=.1);let Re=Ee/Ve+je/Ye;Re/=Ye/Ve-et/Ye;let De=-(Ye*Re+Ee)/Ve;B[U]+=De,H[U]+=Re;let ke=ne[U];Ee=0,je=0,Ie=B[U],qe=H[U];let Ae,ht,wt,yt,ct;for(c=w;c--;)U!==c&&(Ae=B[c],ht=H[c],wt=ke[c][0],yt=ke[c][1],ct=1/Math.sqrt((Ie-Ae)*(Ie-Ae)+(qe-ht)*(qe-ht)),De=Mt[c]*(Ie-Ae-Tt[c]*(Ie-Ae)*ct),Re=Mt[c]*(qe-ht-Tt[c]*(qe-ht)*ct),ke[c]=[De,Re],Ee+=De,je+=Re,j[c]+=De-wt,Y[c]+=Re-yt);j[U]=Ee,Y[U]=je},be=0,Se=0,ft=0,Et=0,Ot=0,kt=0;for(;d>l&&u>Ot;)for(Ot++,[be,d,Se,ft]=ot(),Et=d,kt=0;Et>n&&h>kt;)kt++,bt(be,Se,ft),[Et,Se,ft]=lt(be);for(c=w;c--;){let U=e[c],Ee=this.vertices[U];Ee.position.x=B[c],Ee.position.y=H[c],Ee.positioned=!0,Ee.forcePositioned=!0}}_bridgeDfs(e,t,r,i,s,l,n){t[e]=!0,r[e]=i[e]=++this._time;for(var u=0;u<l[e].length;u++){let h=l[e][u];t[h]?h!==s[e]&&(i[e]=Math.min(i[e],r[h])):(s[h]=e,this._bridgeDfs(h,t,r,i,s,l,n),i[e]=Math.min(i[e],i[h]),i[h]>r[e]&&n.push([e,h]))}}static getConnectedComponents(e){let t=e.length,r=new Array(t),i=new Array;r.fill(!1);for(var s=0;s<t;s++)if(!r[s]){let l=Array();r[s]=!0,l.push(s),k._ccGetDfs(s,r,e,l),l.length>1&&i.push(l)}return i}static getConnectedComponentCount(e){let t=e.length,r=new Array(t),i=0;r.fill(!1);for(var s=0;s<t;s++)r[s]||(r[s]=!0,i++,k._ccCountDfs(s,r,e));return i}static _ccCountDfs(e,t,r){for(var i=0;i<r[e].length;i++)!r[e][i]||t[i]||e===i||(t[i]=!0,k._ccCountDfs(i,t,r))}static _ccGetDfs(e,t,r,i){for(var s=0;s<r[e].length;s++)!r[e][s]||t[s]||e===s||(t[s]=!0,i.push(s),k._ccGetDfs(s,t,r,i))}};qs.exports=ji});var Ws=ce((Bu,_s)=>{var Th=en(),tn=class k{static getRings(e,t=!1){let r=e.getComponentsAdjacencyMatrix();if(r.length===0)return null;let i=Th.getConnectedComponents(r),s=Array();for(var l=0;l<i.length;l++){let h=i[l],d=e.getSubgraphAdjacencyMatrix([...h]),f=new Uint16Array(d.length),c=new Uint16Array(d.length);for(var n=0;n<d.length;n++){c[n]=0,f[n]=0;for(var u=0;u<d[n].length;u++)f[n]+=d[n][u]}let p=0;for(var n=0;n<d.length;n++)for(var u=n+1;u<d.length;u++)p+=d[n][u];let w=p-d.length+1,$=!0;for(var n=0;n<f.length;n++)f[n]!==3&&($=!1);if($&&(w=2+p-d.length),w===1){s.push([...h]);continue}t&&(w=999);let{d:P,pe:M,pe_prime:B}=k.getPathIncludedDistanceMatrices(d),H=k.getRingCandidates(P,M,B),E=k.getSSSR(H,P,d,M,B,f,c,w);for(var n=0;n<E.length;n++){let V=Array(E[n].size),ne=0;for(let j of E[n])V[ne++]=h[j];s.push(V)}}return s}static matrixToString(e){let t="";for(var r=0;r<e.length;r++){for(var i=0;i<e[r].length;i++)t+=e[r][i]+" ";t+=`
`}return t}static getPathIncludedDistanceMatrices(e){let t=e.length,r=Array(t),i=Array(t),s=Array(t);var l=0,n=0,u=0,h=0,d=0,f=0;for(l=t;l--;)for(r[l]=Array(t),i[l]=Array(t),s[l]=Array(t),n=t;n--;)r[l][n]=l===n||e[l][n]===1?e[l][n]:Number.POSITIVE_INFINITY,r[l][n]===1?i[l][n]=[[[l,n]]]:i[l][n]=Array(),s[l][n]=Array();for(u=t;u--;)for(l=t;l--;)for(n=t;n--;){let c=r[l][n],p=r[l][u]+r[u][n];if(c>p){if(c===p+1)for(s[l][n]=[i[l][n].length],h=i[l][n].length;h--;)for(s[l][n][h]=[i[l][n][h].length],d=i[l][n][h].length;d--;)for(s[l][n][h][d]=[i[l][n][h][d].length],f=i[l][n][h][d].length;f--;)s[l][n][h][d][f]=[i[l][n][h][d][0],i[l][n][h][d][1]];else s[l][n]=Array();for(r[l][n]=p,i[l][n]=[[]],h=i[l][u][0].length;h--;)i[l][n][0].push(i[l][u][0][h]);for(h=i[u][n][0].length;h--;)i[l][n][0].push(i[u][n][0][h])}else if(c===p){if(i[l][u].length&&i[u][n].length)if(i[l][n].length){let w=Array();for(h=i[l][u][0].length;h--;)w.push(i[l][u][0][h]);for(h=i[u][n][0].length;h--;)w.push(i[u][n][0][h]);i[l][n].push(w)}else{let w=Array();for(h=i[l][u][0].length;h--;)w.push(i[l][u][0][h]);for(h=i[u][n][0].length;h--;)w.push(i[u][n][0][h]);i[l][n][0]=w}}else if(c===p-1)if(s[l][n].length){let w=Array();for(h=i[l][u][0].length;h--;)w.push(i[l][u][0][h]);for(h=i[u][n][0].length;h--;)w.push(i[u][n][0][h]);s[l][n].push(w)}else{let w=Array();for(h=i[l][u][0].length;h--;)w.push(i[l][u][0][h]);for(h=i[u][n][0].length;h--;)w.push(i[u][n][0][h]);s[l][n][0]=w}}return{d:r,pe:i,pe_prime:s}}static getRingCandidates(e,t,r){let i=e.length,s=Array(),l=0;for(let n=0;n<i;n++)for(let u=0;u<i;u++)e[n][u]===0||t[n][u].length===1&&r[n][u]===0||(r[n][u].length!==0?l=2*(e[n][u]+.5):l=2*e[n][u],l!==1/0&&s.push([l,t[n][u],r[n][u]]));return s.sort(function(n,u){return n[0]-u[0]}),s}static getSSSR(e,t,r,i,s,l,n,u){let h=Array(),d=Array();for(let c=0;c<e.length;c++)if(e[c][0]%2!==0)for(let p=0;p<e[c][2].length;p++){let w=e[c][1][0].concat(e[c][2][p]);for(var f=0;f<w.length;f++)w[f][0].constructor===Array&&(w[f]=w[f][0]);let $=k.bondsToAtoms(w);if(k.getBondCount($,r)===$.size&&!k.pathSetsContain(h,$,w,d,l,n)&&(h.push($),d=d.concat(w)),h.length>u)return h}else for(let p=0;p<e[c][1].length-1;p++){let w=e[c][1][p].concat(e[c][1][p+1]);for(var f=0;f<w.length;f++)w[f][0].constructor===Array&&(w[f]=w[f][0]);let $=k.bondsToAtoms(w);if(k.getBondCount($,r)===$.size&&!k.pathSetsContain(h,$,w,d,l,n)&&(h.push($),d=d.concat(w)),h.length>u)return h}return h}static getEdgeCount(e){let t=0,r=e.length;for(var i=r-1;i--;)for(var s=r;s--;)e[i][s]===1&&t++;return t}static getEdgeList(e){let t=e.length,r=Array();for(var i=t-1;i--;)for(var s=t;s--;)e[i][s]===1&&r.push([i,s]);return r}static bondsToAtoms(e){let t=new Set;for(var r=e.length;r--;)t.add(e[r][0]),t.add(e[r][1]);return t}static getBondCount(e,t){let r=0;for(let i of e)for(let s of e)i!==s&&(r+=t[i][s]);return r/2}static pathSetsContain(e,t,r,i,s,l){for(var n=e.length;n--;){if(k.isSupersetOf(t,e[n]))return!0;if(e[n].size===t.size&&k.areSetsEqual(e[n],t))return!0}let u=0,h=!1;for(n=r.length;n--;)for(var d=i.length;d--;)(r[n][0]===i[d][0]&&r[n][1]===i[d][1]||r[n][1]===i[d][0]&&r[n][0]===i[d][1])&&u++,u===r.length&&(h=!0);let f=!1;if(h){for(let c of t)if(l[c]<s[c]){f=!0;break}}if(h&&!f)return!0;for(let c of t)l[c]++;return!1}static areSetsEqual(e,t){if(e.size!==t.size)return!1;for(let r of e)if(!t.has(r))return!1;return!0}static isSupersetOf(e,t){for(var r of t)if(!e.has(r))return!1;return!0}};_s.exports=tn});var Hr=ce((Pu,Xs)=>{var rn=class{static extend(){let e=this,t={},r=!1,i=0,s=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(r=arguments[0],i++);let l=function(n){for(var u in n)Object.prototype.hasOwnProperty.call(n,u)&&(r&&Object.prototype.toString.call(n[u])==="[object Object]"?t[u]=e.extend(!0,t[u],n[u]):t[u]=n[u])};for(;i<s;i++){let n=arguments[i];l(n)}return t}};Xs.exports=rn});var Gs=ce((Du,Us)=>{var xe=Zt(),gt=Gt(),Q=ut(),ye=or(),Iu=Jt(),Mh=Yi(),qr=lr(),Vs=ur(),_r=Gi(),Lh=zs(),Ys=en(),Bh=Ws(),Ph=gr(),Ih=Hr(),nn=class{constructor(e){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,scale:0,bondThickness:1,bondLength:30,shortBondLength:.8,bondSpacing:.17*30,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontFamily:"Arial, Helvetica, sans-serif",fontSizeLarge:11,fontSizeSmall:3,padding:10,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,weights:{colormap:null,additionalPadding:20,sigma:10,interval:0,opacity:1},themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#aaa",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"},oldschool:{C:"#000",O:"#000",N:"#000",F:"#000",CL:"#000",BR:"#000",I:"#000",P:"#000",S:"#000",B:"#000",SI:"#000",H:"#000",BACKGROUND:"#fff"},solarized:{C:"#586e75",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#657b83",BACKGROUND:"#eee8d5"},"solarized-dark":{C:"#93a1a1",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#839496",BACKGROUND:"#073642"},matrix:{C:"#678c61",O:"#2fc079",N:"#4f7e7e",F:"#90d762",CL:"#82d967",BR:"#23755a",I:"#409931",P:"#c1ff8a",S:"#faff00",B:"#50b45a",SI:"#409931",H:"#426644",BACKGROUND:"#fff"},github:{C:"#24292f",O:"#cf222e",N:"#0969da",F:"#2da44e",CL:"#6fdd8b",BR:"#bc4c00",I:"#8250df",P:"#bf3989",S:"#d4a72c",B:"#fb8f44",SI:"#bc4c00",H:"#57606a",BACKGROUND:"#fff"},carbon:{C:"#161616",O:"#da1e28",N:"#0f62fe",F:"#198038",CL:"#007d79",BR:"#fa4d56",I:"#8a3ffc",P:"#ff832b",S:"#f1c21b",B:"#8a3800",SI:"#e67e22",H:"#525252",BACKGROUND:"#fff"},cyberpunk:{C:"#ea00d9",O:"#ff3131",N:"#0abdc6",F:"#00ff9f",CL:"#00fe00",BR:"#fe9f20",I:"#ff00ff",P:"#fe7f00",S:"#fcee0c",B:"#ff00ff",SI:"#ffffff",H:"#913cb1",BACKGROUND:"#fff"},gruvbox:{C:"#665c54",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#79740e",BR:"#d65d0e",I:"#b16286",P:"#af3a03",S:"#d79921",B:"#689d6a",SI:"#427b58",H:"#7c6f64",BACKGROUND:"#fbf1c7"},"gruvbox-dark":{C:"#ebdbb2",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#b8bb26",BR:"#d65d0e",I:"#b16286",P:"#fe8019",S:"#d79921",B:"#8ec07c",SI:"#83a598",H:"#bdae93",BACKGROUND:"#282828"},custom:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"}}},this.opts=Ih.extend(!0,this.defaultOptions,e),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}draw(e,t,r="light",i=!1){this.initDraw(e,r,i),this.infoOnly||(this.themeManager=new Ph(this.opts.themes,r),this.canvasWrapper=new Lh(t,this.themeManager,this.opts)),i||(this.processGraph(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&(console.log(this.graph),console.log(this.rings),console.log(this.ringConnections)))}edgeRingCount(e){let t=this.graph.edges[e],r=this.graph.vertices[t.sourceId],i=this.graph.vertices[t.targetId];return Math.min(r.value.rings.length,i.value.rings.length)}getBridgedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}getFusedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}getSpiros(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}printRingInfo(){let e="";for(var t=0;t<this.rings.length;t++){let r=this.rings[t];e+=r.id+";",e+=r.members.length+";",e+=r.neighbours.length+";",e+=r.isSpiro?"true;":"false;",e+=r.isFused?"true;":"false;",e+=r.isBridged?"true;":"false;",e+=r.rings.length+";",e+=`
`}return e}rotateDrawing(){let e=0,t=0,r=0;for(var i=0;i<this.graph.vertices.length;i++){let n=this.graph.vertices[i];if(n.value.isDrawn)for(var s=i+1;s<this.graph.vertices.length;s++){let u=this.graph.vertices[s];if(!u.value.isDrawn)continue;let h=n.position.distanceSq(u.position);h>r&&(r=h,e=i,t=s)}}let l=-Q.subtract(this.graph.vertices[e].position,this.graph.vertices[t].position).angle();if(!isNaN(l)){let n=l%.523599;n<.2617995?l=l-n:l+=.523599-n;for(var i=0;i<this.graph.vertices.length;i++)i!==t&&this.graph.vertices[i].position.rotateAround(l,this.graph.vertices[t].position);for(var i=0;i<this.rings.length;i++)this.rings[i].center.rotateAround(l,this.graph.vertices[t].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let e=0;for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.element!=="H"&&e++;return e}getMolecularFormula(e=null){let t="",r=new Map,i=e===null?this.graph:new Ys(e,this.opts.isomeric);for(var s=0;s<i.vertices.length;s++){let n=i.vertices[s].value;if(r.has(n.element)?r.set(n.element,r.get(n.element)+1):r.set(n.element,1),n.bracket&&!n.bracket.chirality&&(r.has("H")?r.set("H",r.get("H")+n.bracket.hcount):r.set("H",n.bracket.hcount)),!n.bracket){let u=qr.maxBonds[n.element]-n.bondCount;n.isPartOfAromaticRing&&u--,r.has("H")?r.set("H",r.get("H")+u):r.set("H",u)}}if(r.has("C")){let n=r.get("C");t+="C"+(n>1?n:""),r.delete("C")}if(r.has("H")){let n=r.get("H");t+="H"+(n>1?n:""),r.delete("H")}return Object.keys(qr.atomicNumbers).sort().map(n=>{if(r.has(n)){let u=r.get(n);t+=n+(u>1?u:"")}}),t}getRingbondType(e,t){if(e.value.getRingbondCount()<1||t.value.getRingbondCount()<1)return null;for(var r=0;r<e.value.ringbonds.length;r++)for(var i=0;i<t.value.ringbonds.length;i++)if(e.value.ringbonds[r].id===t.value.ringbonds[i].id)return e.value.ringbonds[r].bondType==="-"?t.value.ringbonds[i].bond:e.value.ringbonds[r].bond;return null}initDraw(e,t,r,i){this.data=e,this.infoOnly=r,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new Ys(e,this.opts.isomeric),this.rings=Array(),this.ringConnections=Array(),this.originalRings=Array(),this.originalRingConnections=Array(),this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.highlight_atoms=i,this.initRings(),this.initHydrogens()}processGraph(){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var t=0;t<this.opts.overlapResolutionIterations;t++)for(var r=0;r<this.graph.edges.length;r++){let i=this.graph.edges[r];if(this.isEdgeRotatable(i)){let s=this.graph.getTreeDepth(i.sourceId,i.targetId),l=this.graph.getTreeDepth(i.targetId,i.sourceId),n=i.targetId,u=i.sourceId;if(s>l&&(n=i.sourceId,u=i.targetId),this.getSubtreeOverlapScore(u,n,e.vertexScores).value>this.opts.overlapSensitivity){let d=this.graph.vertices[n],f=this.graph.vertices[u],c=f.getNeighbours(n);if(c.length===1){let p=this.graph.vertices[c[0]],w=p.position.getRotateAwayFromAngle(d.position,f.position,xe.toRad(120));this.rotateSubtree(p.id,f.id,w,f.position);let $=this.getOverlapScore().total;$>this.totalOverlapScore?this.rotateSubtree(p.id,f.id,-w,f.position):this.totalOverlapScore=$}else if(c.length===2){if(f.value.rings.length!==0&&d.value.rings.length!==0)continue;let p=this.graph.vertices[c[0]],w=this.graph.vertices[c[1]];if(p.value.rings.length===1&&w.value.rings.length===1){if(p.value.rings[0]!==w.value.rings[0])continue}else{if(p.value.rings.length!==0||w.value.rings.length!==0)continue;{let $=p.position.getRotateAwayFromAngle(d.position,f.position,xe.toRad(120)),P=w.position.getRotateAwayFromAngle(d.position,f.position,xe.toRad(120));this.rotateSubtree(p.id,f.id,$,f.position),this.rotateSubtree(w.id,f.id,P,f.position);let M=this.getOverlapScore().total;M>this.totalOverlapScore?(this.rotateSubtree(p.id,f.id,-$,f.position),this.rotateSubtree(w.id,f.id,-P,f.position)):this.totalOverlapScore=M}}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&this.opts.atomVisualization==="default"&&this.initPseudoElements(),this.rotateDrawing()}initRings(){let e=new Map;for(var t=this.graph.vertices.length-1;t>=0;t--){let s=this.graph.vertices[t];if(s.value.ringbonds.length!==0)for(var r=0;r<s.value.ringbonds.length;r++){let l=s.value.ringbonds[r].id,n=s.value.ringbonds[r].bond;if(!e.has(l))e.set(l,[s.id,n]);else{let u=s.id,h=e.get(l)[0],d=e.get(l)[1],f=new Mh(u,h,1);f.setBondType(d||n||"-");let c=this.graph.addEdge(f),p=this.graph.vertices[h];s.addRingbondChild(h,r),s.value.addNeighbouringElement(p.value.element),p.addRingbondChild(u,r),p.value.addNeighbouringElement(s.value.element),s.edges.push(c),p.edges.push(c),e.delete(l)}}}let i=Bh.getRings(this.graph,this.opts.experimentalSSSR);if(i!==null){for(var t=0;t<i.length;t++){let l=[...i[t]],n=this.addRing(new Vs(l));for(var r=0;r<l.length;r++)this.graph.vertices[l[r]].value.rings.push(n)}for(var t=0;t<this.rings.length-1;t++)for(var r=t+1;r<this.rings.length;r++){let n=this.rings[t],u=this.rings[r],h=new _r(n,u);h.vertices.size>0&&this.addRingConnection(h)}for(var t=0;t<this.rings.length;t++){let l=this.rings[t];l.neighbours=_r.getNeighbours(this.ringConnections,l.id)}for(var t=0;t<this.rings.length;t++){let l=this.rings[t];this.graph.vertices[l.members[0]].value.addAnchoredRing(l.id)}for(this.backupRingInformation();this.rings.length>0;){let s=-1;for(var t=0;t<this.rings.length;t++){let h=this.rings[t];this.isPartOfBridgedRing(h.id)&&!h.isBridged&&(s=h.id)}if(s===-1)break;let l=this.getRing(s),n=this.getBridgedRingRings(l.id);this.bridgedRing=!0,this.createBridgedRing(n,l.members[0]),this.bridgedRing=!1;for(var t=0;t<n.length;t++)this.removeRing(n[t])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(var e=0;e<this.graph.vertices.length;e++){let t=this.graph.vertices[e];if(t.value.element!=="H")continue;let r=this.graph.vertices[t.neighbours[0]];r.value.hasHydrogen=!0,(!r.value.isStereoCenter||r.value.rings.length<2&&!r.value.bridgedRing||r.value.bridgedRing&&r.value.originalRings.length<2)&&(t.value.isDrawn=!1)}}getBridgedRingRings(e){let t=Array(),r=this,i=function(s){let l=r.getRing(s);t.push(s);for(var n=0;n<l.neighbours.length;n++){let u=l.neighbours[n];t.indexOf(u)===-1&&u!==s&&_r.isBridge(r.ringConnections,r.graph.vertices,s,u)&&i(u)}};return i(e),gt.unique(t)}isPartOfBridgedRing(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(e,t){let r=new Set,i=new Set,s=new Set;for(var l=0;l<e.length;l++){let f=this.getRing(e[l]);f.isPartOfBridged=!0;for(var n=0;n<f.members.length;n++)i.add(f.members[n]);for(var n=0;n<f.neighbours.length;n++){let p=f.neighbours[n];e.indexOf(p)===-1&&s.add(f.neighbours[n])}}let u=new Set;for(let f of i){let c=this.graph.vertices[f],p=gt.intersection(e,c.value.rings);c.value.rings.length===1||p.length===1?r.add(c.id):u.add(c.id)}let h=Array();for(let f of u){let c=this.graph.vertices[f],p=!1;for(let w=0;w<c.edges.length;w++)this.edgeRingCount(c.edges[w])===1&&(p=!0);p?(c.value.isBridgeNode=!0,r.add(c.id)):(c.value.isBridge=!0,r.add(c.id))}let d=new Vs([...r]);this.addRing(d),d.isBridged=!0,d.neighbours=[...s];for(var l=0;l<e.length;l++)d.rings.push(this.getRing(e[l]).clone());for(var l=0;l<d.members.length;l++)this.graph.vertices[d.members[l]].value.bridgedRing=d.id;for(var l=0;l<h.length;l++){let c=this.graph.vertices[h[l]];c.value.rings=Array()}for(let f of r){let c=this.graph.vertices[f];c.value.rings=gt.removeAll(c.value.rings,e),c.value.rings.push(d.id)}for(var l=0;l<e.length;l++)for(var n=l+1;n<e.length;n++)this.removeRingConnectionsBetween(e[l],e[n]);for(let f of s){let c=this.getRingConnections(f,e);for(var n=0;n<c.length;n++)this.getRingConnection(c[n]).updateOther(d.id,f);this.getRing(f).neighbours.push(d.id)}return d}areVerticesInSameRing(e,t){for(var r=0;r<e.value.rings.length;r++)for(var i=0;i<t.value.rings.length;i++)if(e.value.rings[r]===t.value.rings[i])return!0;return!1}getCommonRings(e,t){let r=Array();for(var i=0;i<e.value.rings.length;i++)for(var s=0;s<t.value.rings.length;s++)e.value.rings[i]==t.value.rings[s]&&r.push(e.value.rings[i]);return r}getLargestOrAromaticCommonRing(e,t){let r=this.getCommonRings(e,t),i=0,s=null;for(var l=0;l<r.length;l++){let n=this.getRing(r[l]),u=n.getSize();if(n.isBenzeneLike(this.graph.vertices))return n;u>i&&(i=u,s=n)}return s}getVerticesAt(e,t,r){let i=Array();for(var s=0;s<this.graph.vertices.length;s++){let l=this.graph.vertices[s];if(l.id===r||!l.positioned)continue;e.distanceSq(l.position)<=t*t&&i.push(l.id)}return i}getClosestVertex(e){let t=99999,r=null;for(var i=0;i<this.graph.vertices.length;i++){let s=this.graph.vertices[i];if(s.id===e.id)continue;let l=e.position.distanceSq(s.position);l<t&&(t=l,r=s)}return r}addRing(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}removeRing(e){this.rings=this.rings.filter(function(r){return r.id!==e}),this.ringConnections=this.ringConnections.filter(function(r){return r.firstRingId!==e&&r.secondRingId!==e});for(var t=0;t<this.rings.length;t++){let r=this.rings[t];r.neighbours=r.neighbours.filter(function(i){return i!==e})}}getRing(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}addRingConnection(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}removeRingConnection(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}removeRingConnectionsBetween(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let s=this.ringConnections[i];(s.firstRingId===e&&s.secondRingId===t||s.firstRingId===t&&s.secondRingId===e)&&r.push(s.id)}for(var i=0;i<r.length;i++)this.removeRingConnection(r[i])}getRingConnection(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}getRingConnections(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let l=this.ringConnections[i];for(var s=0;s<t.length;s++){let n=t[s];(l.firstRingId===e&&l.secondRingId===n||l.firstRingId===n&&l.secondRingId===e)&&r.push(l.id)}}return r}getOverlapScore(){let e=0,t=new Float32Array(this.graph.vertices.length);for(var r=0;r<this.graph.vertices.length;r++)t[r]=0;for(var r=0;r<this.graph.vertices.length;r++)for(var i=this.graph.vertices.length;--i>r;){let n=this.graph.vertices[r],u=this.graph.vertices[i];if(!n.value.isDrawn||!u.value.isDrawn)continue;let h=Q.subtract(n.position,u.position).lengthSq();if(h<this.opts.bondLengthSq){let d=(this.opts.bondLength-Math.sqrt(h))/this.opts.bondLength;e+=d,t[r]+=d,t[i]+=d}}let s=Array();for(var r=0;r<this.graph.vertices.length;r++)s.push({id:r,score:t[r]});return s.sort(function(l,n){return n.score-l.score}),{total:e,scores:s,vertexScores:t}}chooseSide(e,t,r){let i=e.getNeighbours(t.id),s=t.getNeighbours(e.id),l=i.length,n=s.length,u=gt.merge(i,s),h=[0,0];for(var d=0;d<u.length;d++)this.graph.vertices[u[d]].position.sameSideAs(e.position,t.position,r[0])?h[0]++:h[1]++;let f=[0,0];for(var d=0;d<this.graph.vertices.length;d++)this.graph.vertices[d].position.sameSideAs(e.position,t.position,r[0])?f[0]++:f[1]++;return{totalSideCount:f,totalPosition:f[0]>f[1]?0:1,sideCount:h,position:h[0]>h[1]?0:1,anCount:l,bnCount:n}}setRingCenter(e){let t=e.getSize(),r=new Q(0,0);for(var i=0;i<t;i++)r.add(this.graph.vertices[e.members[i]].position);e.center=r.divide(t)}getSubringCenter(e,t){let r=t.value.originalRings,i=e.center,s=Number.MAX_VALUE;for(var l=0;l<r.length;l++)for(var n=0;n<e.rings.length;n++)r[l]===e.rings[n].id&&e.rings[n].getSize()<s&&(i=e.rings[n].center,s=e.rings[n].getSize());return i}drawEdges(e){let t=this,r=Array(this.graph.edges.length);if(r.fill(!1),this.graph.traverseBF(0,function(s){let l=t.graph.getEdges(s.id);for(var n=0;n<l.length;n++){let u=l[n];r[u]||(r[u]=!0,t.drawEdge(u,e))}}),!this.bridgedRing)for(var i=0;i<this.rings.length;i++){let s=this.rings[i];this.isRingAromatic(s)&&this.canvasWrapper.drawAromaticityRing(s)}}drawEdge(e,t){let r=this,i=this.graph.edges[e],s=this.graph.vertices[i.sourceId],l=this.graph.vertices[i.targetId],n=s.value.element,u=l.value.element;if((!s.value.isDrawn||!l.value.isDrawn)&&this.opts.atomVisualization==="default")return;let h=s.position,d=l.position,f=this.getEdgeNormals(i),c=gt.clone(f);if(c[0].multiplyScalar(10).add(h),c[1].multiplyScalar(10).add(h),i.bondType==="="||this.getRingbondType(s,l)==="="||i.isPartOfAromaticRing&&this.bridgedRing){let p=this.areVerticesInSameRing(s,l),w=this.chooseSide(s,l,c);if(p){let P=this.getLargestOrAromaticCommonRing(s,l).center;f[0].multiplyScalar(r.opts.bondSpacing),f[1].multiplyScalar(r.opts.bondSpacing);let M=null;P.sameSideAs(s.position,l.position,Q.add(h,f[0]))?M=new ye(Q.add(h,f[0]),Q.add(d,f[0]),n,u):M=new ye(Q.add(h,f[1]),Q.add(d,f[1]),n,u),M.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),i.isPartOfAromaticRing?this.canvasWrapper.drawLine(M,!0):this.canvasWrapper.drawLine(M),this.canvasWrapper.drawLine(new ye(h,d,n,u))}else if(i.center||s.isTerminal()&&l.isTerminal()){f[0].multiplyScalar(r.opts.halfBondSpacing),f[1].multiplyScalar(r.opts.halfBondSpacing);let $=new ye(Q.add(h,f[0]),Q.add(d,f[0]),n,u),P=new ye(Q.add(h,f[1]),Q.add(d,f[1]),n,u);this.canvasWrapper.drawLine($),this.canvasWrapper.drawLine(P)}else if(w.anCount==0&&w.bnCount>1||w.bnCount==0&&w.anCount>1){f[0].multiplyScalar(r.opts.halfBondSpacing),f[1].multiplyScalar(r.opts.halfBondSpacing);let $=new ye(Q.add(h,f[0]),Q.add(d,f[0]),n,u),P=new ye(Q.add(h,f[1]),Q.add(d,f[1]),n,u);this.canvasWrapper.drawLine($),this.canvasWrapper.drawLine(P)}else if(w.sideCount[0]>w.sideCount[1]){f[0].multiplyScalar(r.opts.bondSpacing),f[1].multiplyScalar(r.opts.bondSpacing);let $=new ye(Q.add(h,f[0]),Q.add(d,f[0]),n,u);$.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine($),this.canvasWrapper.drawLine(new ye(h,d,n,u))}else if(w.sideCount[0]<w.sideCount[1]){f[0].multiplyScalar(r.opts.bondSpacing),f[1].multiplyScalar(r.opts.bondSpacing);let $=new ye(Q.add(h,f[1]),Q.add(d,f[1]),n,u);$.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine($),this.canvasWrapper.drawLine(new ye(h,d,n,u))}else if(w.totalSideCount[0]>w.totalSideCount[1]){f[0].multiplyScalar(r.opts.bondSpacing),f[1].multiplyScalar(r.opts.bondSpacing);let $=new ye(Q.add(h,f[0]),Q.add(d,f[0]),n,u);$.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine($),this.canvasWrapper.drawLine(new ye(h,d,n,u))}else if(w.totalSideCount[0]<=w.totalSideCount[1]){f[0].multiplyScalar(r.opts.bondSpacing),f[1].multiplyScalar(r.opts.bondSpacing);let $=new ye(Q.add(h,f[1]),Q.add(d,f[1]),n,u);$.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine($),this.canvasWrapper.drawLine(new ye(h,d,n,u))}}else if(i.bondType==="#"){f[0].multiplyScalar(r.opts.bondSpacing/1.5),f[1].multiplyScalar(r.opts.bondSpacing/1.5);let p=new ye(Q.add(h,f[0]),Q.add(d,f[0]),n,u),w=new ye(Q.add(h,f[1]),Q.add(d,f[1]),n,u);this.canvasWrapper.drawLine(p),this.canvasWrapper.drawLine(w),this.canvasWrapper.drawLine(new ye(h,d,n,u))}else if(i.bondType!=="."){let p=s.value.isStereoCenter,w=l.value.isStereoCenter;i.wedge==="up"?this.canvasWrapper.drawWedge(new ye(h,d,n,u,p,w)):i.wedge==="down"?this.canvasWrapper.drawDashedWedge(new ye(h,d,n,u,p,w)):this.canvasWrapper.drawLine(new ye(h,d,n,u,p,w))}if(t){let p=Q.midpoint(h,d);this.canvasWrapper.drawDebugText(p.x,p.y,"e: "+e)}}drawVertices(e){for(var t=this.graph.vertices.length,t=0;t<this.graph.vertices.length;t++){let i=this.graph.vertices[t],s=i.value,l=0,n=0,u=i.value.bondCount,h=s.element,d=qr.maxBonds[h]-u,f=i.getTextDirection(this.graph.vertices),c=this.opts.terminalCarbons||h!=="C"||s.hasAttachedPseudoElements?i.isTerminal():!1,p=s.element==="C";if(s.element==="N"&&s.isPartOfAromaticRing&&(d=0),s.bracket&&(d=s.bracket.hcount,l=s.bracket.charge,n=s.bracket.isotope),(l||n||graph.vertices.length<3)&&(p=!1),this.opts.atomVisualization==="allballs")this.canvasWrapper.drawBall(i.position.x,i.position.y,h);else if(s.isDrawn&&(!p||s.drawExplicit||c||s.hasAttachedPseudoElements)||this.graph.vertices.length===1)this.opts.atomVisualization==="default"?this.canvasWrapper.drawText(i.position.x,i.position.y,h,d,f,c,l,n,this.graph.vertices.length,s.getAttachedPseudoElements()):this.opts.atomVisualization==="balls"&&this.canvasWrapper.drawBall(i.position.x,i.position.y,h);else if(i.getNeighbourCount()===2&&i.forcePositioned==!0){let w=this.graph.vertices[i.neighbours[0]].position,$=this.graph.vertices[i.neighbours[1]].position,P=Q.threePointangle(i.position,w,$);Math.abs(Math.PI-P)<.1&&this.canvasWrapper.drawPoint(i.position.x,i.position.y,h)}if(e){let w="v: "+i.id+" "+gt.print(s.ringbonds);this.canvasWrapper.drawDebugText(i.position.x,i.position.y,w)}}if(this.opts.debug)for(var t=0;t<this.rings.length;t++){let i=this.rings[t].center;this.canvasWrapper.drawDebugPoint(i.x,i.y,"r: "+this.rings[t].id)}}position(){let e=null;for(var t=0;t<this.graph.vertices.length;t++)if(this.graph.vertices[t].value.bridgedRing!==null){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);this.rings.length>0&&e===null&&(e=this.graph.vertices[this.rings[0].members[0]]),e===null&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}backupRingInformation(){this.originalRings=Array(),this.originalRingConnections=Array();for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}restoreRingInformation(){let e=this.getBridgedRings();this.rings=Array(),this.ringConnections=Array();for(var t=0;t<e.length;t++){let i=e[t];for(var r=0;r<i.rings.length;r++){let s=i.rings[r];this.originalRings[s.id].center=s.center}}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}createRing(e,t=null,r=null,i=null){if(e.positioned)return;t=t||new Q(0,0);let s=e.getOrderedNeighbours(this.ringConnections),l=r?Q.subtract(r.position,t).angle():0,n=xe.polyCircumradius(this.opts.bondLength,e.getSize()),u=xe.centralAngle(e.getSize());e.centralAngle=u;let h=l,d=this,f=r?r.id:null;if(e.members.indexOf(f)===-1&&(r&&(r.positioned=!1),f=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),t,r.id,e,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var c=0;c<e.rings.length;c++)this.setRingCenter(e.rings[c])}else e.eachMember(this.graph.vertices,function(w){let $=d.graph.vertices[w];$.positioned||$.setPosition(t.x+Math.cos(h)*n,t.y+Math.sin(h)*n),h+=u,(!e.isBridged||e.rings.length<3)&&($.angle=h,$.positioned=!0)},f,i?i.id:null);e.positioned=!0,e.center=t;for(var c=0;c<s.length;c++){let $=this.getRing(s[c].neighbour);if($.positioned)continue;let P=_r.getVertices(this.ringConnections,e.id,$.id);if(P.length===2){e.isFused=!0,$.isFused=!0;let M=this.graph.vertices[P[0]],B=this.graph.vertices[P[1]],H=Q.midpoint(M.position,B.position),E=Q.normals(M.position,B.position);E[0].normalize(),E[1].normalize();let D=xe.polyCircumradius(this.opts.bondLength,$.getSize()),V=xe.apothem(D,$.getSize());E[0].multiplyScalar(V).add(H),E[1].multiplyScalar(V).add(H);let ne=E[0];Q.subtract(t,E[1]).lengthSq()>Q.subtract(t,E[0]).lengthSq()&&(ne=E[1]);let j=Q.subtract(M.position,ne),Y=Q.subtract(B.position,ne);j.clockwise(Y)===-1?$.positioned||this.createRing($,ne,M,B):$.positioned||this.createRing($,ne,B,M)}else if(P.length===1){e.isSpiro=!0,$.isSpiro=!0;let M=this.graph.vertices[P[0]],B=Q.subtract(t,M.position);B.invert(),B.normalize();let H=xe.polyCircumradius(this.opts.bondLength,$.getSize());B.multiplyScalar(H),B.add(M.position),$.positioned||this.createRing($,B,M)}}for(var c=0;c<e.members.length;c++){let $=this.graph.vertices[e.members[c]],P=$.neighbours;for(var p=0;p<P.length;p++){let M=this.graph.vertices[P[p]];M.positioned||(M.value.isConnectedToRing=!0,this.createNextBond(M,$,0))}}}rotateSubtree(e,t,r,i){let s=this;this.graph.traverseTree(e,t,function(l){l.position.rotateAround(r,i);for(var n=0;n<l.value.anchoredRings.length;n++){let u=s.rings[l.value.anchoredRings[n]];u&&u.center.rotateAround(r,i)}})}getSubtreeOverlapScore(e,t,r){let i=this,s=0,l=new Q(0,0),n=0;return this.graph.traverseTree(e,t,function(u){if(!u.value.isDrawn)return;let h=r[u.id];h>i.opts.overlapSensitivity&&(s+=h,n++);let d=i.graph.vertices[u.id].position.clone();d.multiplyScalar(h),l.add(d)}),l.divide(s),{value:s/n,center:l}}getCurrentCenterOfMass(){let e=new Q(0,0),t=0;for(var r=0;r<this.graph.vertices.length;r++){let i=this.graph.vertices[r];i.positioned&&(e.add(i.position),t++)}return e.divide(t)}getCurrentCenterOfMassInNeigbourhood(e,t=this.opts.bondLength*2){let r=new Q(0,0),i=0,s=t*t;for(var l=0;l<this.graph.vertices.length;l++){let n=this.graph.vertices[l];n.positioned&&e.distanceSq(n.position)<s&&(r.add(n.position),i++)}return r.divide(i)}resolvePrimaryOverlaps(){let e=Array(),t=Array(this.graph.vertices.length);for(var r=0;r<this.rings.length;r++){let l=this.rings[r];for(var i=0;i<l.members.length;i++){let n=this.graph.vertices[l.members[i]];if(t[n.id])continue;t[n.id]=!0;let u=this.getNonRingNeighbours(n.id);if(u.length>1){let h=Array();for(var s=0;s<n.value.rings.length;s++)h.push(n.value.rings[s]);e.push({common:n,rings:h,vertices:u})}else if(u.length===1&&n.value.rings.length===2){let h=Array();for(var s=0;s<n.value.rings.length;s++)h.push(n.value.rings[s]);e.push({common:n,rings:h,vertices:u})}}}for(var r=0;r<e.length;r++){let n=e[r];if(n.vertices.length===2){let u=n.vertices[0],h=n.vertices[1];if(!u.value.isDrawn||!h.value.isDrawn)continue;let d=(2*Math.PI-this.getRing(n.rings[0]).getAngle())/6;this.rotateSubtree(u.id,n.common.id,d,n.common.position),this.rotateSubtree(h.id,n.common.id,-d,n.common.position);let f=this.getOverlapScore(),c=this.getSubtreeOverlapScore(u.id,n.common.id,f.vertexScores),p=this.getSubtreeOverlapScore(h.id,n.common.id,f.vertexScores),w=c.value+p.value;this.rotateSubtree(u.id,n.common.id,-2*d,n.common.position),this.rotateSubtree(h.id,n.common.id,2*d,n.common.position),f=this.getOverlapScore(),c=this.getSubtreeOverlapScore(u.id,n.common.id,f.vertexScores),p=this.getSubtreeOverlapScore(h.id,n.common.id,f.vertexScores),c.value+p.value>w&&(this.rotateSubtree(u.id,n.common.id,2*d,n.common.position),this.rotateSubtree(h.id,n.common.id,-2*d,n.common.position))}else n.vertices.length===1&&n.rings.length}}resolveSecondaryOverlaps(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.overlapSensitivity){let r=this.graph.vertices[e[t].id];if(r.isTerminal()){let i=this.getClosestVertex(r);if(i){let s=null;i.isTerminal()?s=i.id===0?this.graph.vertices[1].position:i.previousPosition:s=i.id===0?this.graph.vertices[1].position:i.position;let l=r.id===0?this.graph.vertices[1].position:r.previousPosition;r.position.rotateAwayFrom(s,l,xe.toRad(20))}}}}getLastAngle(e){for(;e;){let t=this.graph.vertices[e];if(t.value.rings.length>0)return 0;if(t.angle)return t.angle;e=t.parentVertexId}return 0}createNextBond(e,t=null,r=0,i=!1,s=!1){if(e.positioned&&!s)return;let l=!1;if(t){let u=this.graph.getEdge(e.id,t.id);(u.bondType==="/"||u.bondType==="\\")&&++this.doubleBondConfigCount%2===1&&this.doubleBondConfig===null&&(this.doubleBondConfig=u.bondType,l=!0,t.parentVertexId===null&&e.value.branchBond&&(this.doubleBondConfig==="/"?this.doubleBondConfig="\\":this.doubleBondConfig==="\\"&&(this.doubleBondConfig="/")))}if(!s)if(t)if(t.value.rings.length>0){let u=t.neighbours,h=null,d=new Q(0,0);if(t.value.bridgedRing===null&&t.value.rings.length>1)for(var n=0;n<u.length;n++){let f=this.graph.vertices[u[n]];if(gt.containsAll(f.value.rings,t.value.rings)){h=f;break}}if(h===null){for(var n=0;n<u.length;n++){let c=this.graph.vertices[u[n]];c.positioned&&this.areVerticesInSameRing(c,t)&&d.add(Q.subtract(c.position,t.position))}d.invert().normalize().multiplyScalar(this.opts.bondLength).add(t.position)}else d=h.position.clone().rotateAround(Math.PI,t.position);e.previousPosition=t.position,e.setPositionFromVector(d),e.positioned=!0}else{let u=new Q(this.opts.bondLength,0);u.rotate(r),u.add(t.position),e.setPositionFromVector(u),e.previousPosition=t.position,e.positioned=!0}else{let u=new Q(this.opts.bondLength,0);u.rotate(xe.toRad(-60)),e.previousPosition=u,e.setPosition(this.opts.bondLength,0),e.angle=xe.toRad(-60),e.value.bridgedRing===null&&(e.positioned=!0)}if(e.value.bridgedRing!==null){let u=this.getRing(e.value.bridgedRing);if(!u.positioned){let h=Q.subtract(e.previousPosition,e.position);h.invert(),h.normalize();let d=xe.polyCircumradius(this.opts.bondLength,u.members.length);h.multiplyScalar(d),h.add(e.position),this.createRing(u,h,e)}}else if(e.value.rings.length>0){let u=this.getRing(e.value.rings[0]);if(!u.positioned){let h=Q.subtract(e.previousPosition,e.position);h.invert(),h.normalize();let d=xe.polyCircumradius(this.opts.bondLength,u.getSize());h.multiplyScalar(d),h.add(e.position),this.createRing(u,h,e)}}else{let u=e.getNeighbours(),h=Array();for(var n=0;n<u.length;n++)this.graph.vertices[u[n]].value.isDrawn&&h.push(u[n]);t&&(h=gt.remove(h,t.id));let d=e.getAngle();if(h.length===1){let f=this.graph.vertices[h[0]],c=t?this.graph.getEdge(e.id,t.id):null,p=this.graph.getEdge(e.id,f.id);if(c&&p&&c.weight+p.weight>=4)c.center=!0,p.center=!0,e.value.drawExplicit=!1,f.drawExplicit=!0,f.angle=0,this.createNextBond(f,e,d+f.angle);else if(t&&t.value.rings.length>0){let w=xe.toRad(60),$=-w,P=new Q(this.opts.bondLength,0),M=new Q(this.opts.bondLength,0);P.rotate(w).add(e.position),M.rotate($).add(e.position);let B=this.getCurrentCenterOfMass(),H=P.distanceSq(B),E=M.distanceSq(B);f.angle=H<E?$:w,this.createNextBond(f,e,d+f.angle)}else{let w=this.getLastAngle(e.id);if(w=w>=0?1.0472:-1.0472,t&&!l){let $=this.graph.getEdge(e.id,f.id).bondType;$==="/"?(this.doubleBondConfig==="/"||this.doubleBondConfig==="\\"&&(w=-w),this.doubleBondConfig=null):$==="\\"&&(this.doubleBondConfig==="/"?w=-w:this.doubleBondConfig,this.doubleBondConfig=null)}i?f.angle=w:f.angle=-w,this.createNextBond(f,e,d+f.angle)}}else if(h.length===2){let f=e.angle;f||(f=1.0472);let c=this.graph.getTreeDepth(h[0],e.id),p=this.graph.getTreeDepth(h[1],e.id),w=this.graph.vertices[h[0]],$=this.graph.vertices[h[1]];w.value.subtreeDepth=c,$.value.subtreeDepth=p;let P=this.graph.getTreeDepth(t?t.id:null,e.id);t&&(t.value.subtreeDepth=P);let M=0,B=1;$.value.element==="C"&&w.value.element!=="C"&&p>1&&c<5?(M=1,B=0):$.value.element!=="C"&&w.value.element==="C"&&c>1&&p<5?(M=0,B=1):p>c&&(M=1,B=0);let H=this.graph.vertices[h[M]],E=this.graph.vertices[h[B]],D=!1;P<c&&P<p&&(D=!0),E.angle=f,H.angle=-f,this.doubleBondConfig==="\\"?E.value.branchBond==="\\"&&(E.angle=-f,H.angle=f):this.doubleBondConfig==="/"&&E.value.branchBond==="/"&&(E.angle=-f,H.angle=f),this.createNextBond(E,e,d+E.angle,D),this.createNextBond(H,e,d+H.angle,D)}else if(h.length>0){let f=h.map(c=>{let p=this.graph.vertices[c],w=this.graph.getTreeDepth(c,e.id);return p.value.subtreeDepth=w,p});if(f.sort((c,p)=>c.value.subtreeDepth<p.value.subtreeDepth),h.length===3&&t&&t.value.rings.length<1&&f[2].value.rings.length<1&&f[1].value.rings.length<1&&f[0].value.rings.length<1&&f[2].value.subtreeDepth===1&&f[1].value.subtreeDepth===1&&f[0].value.subtreeDepth>1)e.angle>=0?(f[0].angle=-1.0472,f[1].angle=xe.toRad(30),f[2].angle=xe.toRad(90)):(f[0].angle=1.0472,f[1].angle=-xe.toRad(30),f[2].angle=-xe.toRad(90)),this.createNextBond(f[0],e,d+f[0].angle),this.createNextBond(f[1],e,d+f[1].angle),this.createNextBond(f[2],e,d+f[2].angle);else{let c=h.length+(t?1:0),p=2*Math.PI/c,w=p,$=0;for(h.length%2!==0?(this.createNextBond(f[0],e,d),$=1):w/=2;$<h.length;)this.createNextBond(f[$+0],e,d+w),this.createNextBond(f[$+1],e,d-w),w+=p,$+=2}}}}getCommonRingbondNeighbour(e){let t=e.neighbours;for(var r=0;r<t.length;r++){let i=this.graph.vertices[t[r]];if(gt.containsAll(i.value.rings,e.value.rings))return i}return null}isPointInRing(e){for(var t=0;t<this.rings.length;t++){let r=this.rings[t];if(!r.positioned)continue;let i=xe.polyCircumradius(this.opts.bondLength,r.getSize()),s=i*i;if(e.distanceSq(r.center)<s)return!0}return!1}isEdgeInRing(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,r)}isEdgeRotatable(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return!(e.bondType!=="-"||t.isTerminal()||r.isTerminal()||t.value.rings.length>0&&r.value.rings.length>0&&this.areVerticesInSameRing(t,r))}isRingAromatic(e){for(var t=0;t<e.members.length;t++)if(!this.graph.vertices[e.members[t]].value.isPartOfAromaticRing)return!1;return!0}getEdgeNormals(e){let t=this.graph.vertices[e.sourceId].position,r=this.graph.vertices[e.targetId].position;return Q.units(t,r)}getNonRingNeighbours(e){let t=Array(),r=this.graph.vertices[e],i=r.neighbours;for(var s=0;s<i.length;s++){let l=this.graph.vertices[i[s]];gt.intersection(r.value.rings,l.value.rings).length===0&&l.value.isBridge==!1&&t.push(l)}return t}annotateStereochemistry(){let e=10;for(var t=0;t<this.graph.vertices.length;t++){let l=this.graph.vertices[t];if(!l.value.isStereoCenter)continue;let n=l.getNeighbours(),u=n.length,h=Array(u);for(var r=0;r<u;r++){let j=new Uint8Array(this.graph.vertices.length),Y=Array(Array());j[l.id]=1,this.visitStereochemistry(n[r],l.id,j,Y,e,0);for(var i=0;i<Y.length;i++)Y[i].sort(function(ae,pe){return pe-ae});h[r]=[r,Y]}let d=0,f=0;for(var r=0;r<h.length;r++){h[r][1].length>d&&(d=h[r][1].length);for(var i=0;i<h[r][1].length;i++)h[r][1][i].length>f&&(f=h[r][1][i].length)}for(var r=0;r<h.length;r++){let Y=d-h[r][1].length;for(var i=0;i<Y;i++)h[r][1].push([]);h[r][1].push([n[r]]);for(var i=0;i<h[r][1].length;i++){let pe=f-h[r][1][i].length;for(var s=0;s<pe;s++)h[r][1][i].push(0)}}h.sort(function(j,Y){for(var ae=0;ae<j[1].length;ae++)for(var pe=0;pe<j[1][ae].length;pe++){if(j[1][ae][pe]>Y[1][ae][pe])return-1;if(j[1][ae][pe]<Y[1][ae][pe])return 1}return 0});let c=new Uint8Array(u);for(var r=0;r<u;r++)c[r]=h[r][0],l.value.priority=r;let p=this.graph.vertices[n[c[0]]].position,w=this.graph.vertices[n[c[1]]].position,P=p.relativeClockwise(w,l.position)===-1,M=l.value.bracket.chirality==="@"?-1:1,B=xe.parityOfPermutation(c)*M===1?"R":"S",H="down",E="up";(P&&B!=="R"||!P&&B!=="S")&&(l.value.hydrogenDirection="up",H="up",E="down"),l.value.hasHydrogen&&(this.graph.getEdge(l.id,n[c[c.length-1]]).wedge=H);let D=new Array(n.length-1),V=l.value.rings.length>1&&l.value.hasHydrogen,ne=l.value.hasHydrogen?1:0;for(var r=0;r<c.length-ne;r++){D[r]=new Uint32Array(2);let Y=this.graph.vertices[n[c[r]]];D[r][0]+=Y.value.isStereoCenter?0:1e5,D[r][0]+=this.areVerticesInSameRing(Y,l)?0:1e4,D[r][0]+=Y.value.isHeteroAtom()?1e3:0,D[r][0]-=Y.value.subtreeDepth===0?1e3:0,D[r][0]+=1e3-Y.value.subtreeDepth,D[r][1]=n[c[r]]}if(D.sort(function(j,Y){return j[0]>Y[0]?-1:j[0]<Y[0]?1:0}),!V){let j=D[0][1];if(l.value.hasHydrogen)this.graph.getEdge(l.id,j).wedge=E;else{let Y=E;for(var r=c.length-1;r>=0&&(Y===H?Y=E:Y=H,n[c[r]]!==j);r--);this.graph.getEdge(l.id,j).wedge=Y}}l.value.chirality=B}}visitStereochemistry(e,t,r,i,s,l,n=0){r[e]=1;let u=this.graph.vertices[e],h=u.value.getAtomicNumber();i.length<=l&&i.push(Array());for(var d=0;d<this.graph.getEdge(e,t).weight;d++)i[l].push(n*1e3+h);let f=this.graph.vertices[e].neighbours;for(var d=0;d<f.length;d++)r[f[d]]!==1&&l<s-1&&this.visitStereochemistry(f[d],e,r.slice(),i,s,l+1,h);if(l<s-1){let c=0;for(var d=0;d<f.length;d++)c+=this.graph.getEdge(e,f[d]).weight;for(var d=0;d<u.value.getMaxBonds()-c;d++)i.length<=l+1&&i.push(Array()),i[l+1].push(h*1e3+1)}}initPseudoElements(){for(var e=0;e<this.graph.vertices.length;e++){let r=this.graph.vertices[e],i=r.neighbours,s=Array(i.length);for(var t=0;t<i.length;t++)s[t]=this.graph.vertices[i[t]];if(r.getNeighbourCount()<3||r.value.rings.length>0||r.value.element==="P"||r.value.element==="C"&&s.length===3&&s[0].value.element==="N"&&s[1].value.element==="N"&&s[2].value.element==="N")continue;let l=0,n=0;for(var t=0;t<s.length;t++){let d=s[t],f=d.value.element,c=d.getNeighbourCount();f!=="C"&&f!=="H"&&c===1&&l++,c>1&&n++}if(n>1||l<2)continue;let u=null;for(var t=0;t<s.length;t++){let d=s[t];d.getNeighbourCount()>1&&(u=d)}for(var t=0;t<s.length;t++){let d=s[t];if(d.getNeighbourCount()>1)continue;d.value.isDrawn=!1;let f=qr.maxBonds[d.value.element]-d.value.bondCount,c="";d.value.bracket&&(f=d.value.bracket.hcount,c=d.value.bracket.charge||0),r.value.attachPseudoElement(d.value.element,u?u.value.element:null,f,c)}}}};Us.exports=nn});var Wr=ce((Ou,Zs)=>{var Dh=or(),Fe=ut(),Oh=Zt();function Fh(k){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t.length,i=0;i<k;i++)e+=t.charAt(Math.floor(Math.random()*r));return e}var sn=class k{constructor(e,t,r,i=!0){if(typeof t=="string"||t instanceof String?this.svg=document.getElementById(t):this.svg=t,this.container=null,this.opts=r,this.uid=Fh(5),this.gradientId=0,this.backgroundItems=[],this.paths=[],this.vertices=[],this.gradients=[],this.highlights=[],this.drawingWidth=0,this.drawingHeight=0,this.halfBondThickness=this.opts.bondThickness/2,this.themeManager=e,this.maskElements=[],this.maxX=-Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE,this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,i)for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.style=document.createElementNS("http://www.w3.org/2000/svg","style"),this.style.appendChild(document.createTextNode(`
                .element {
                    font: ${this.opts.fontSizeLarge}pt ${this.opts.fontFamily};
                }
                .sub {
                    font: ${this.opts.fontSizeSmall}pt ${this.opts.fontFamily};
                }
            `)),this.svg?this.svg.appendChild(this.style):(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.appendChild(this.style))}constructSvg(){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask"),r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","g"),n=this.paths,u=document.createElementNS("http://www.w3.org/2000/svg","rect");u.setAttributeNS(null,"x",this.minX),u.setAttributeNS(null,"y",this.minY),u.setAttributeNS(null,"width",this.maxX-this.minX),u.setAttributeNS(null,"height",this.maxY-this.minY),u.setAttributeNS(null,"fill","white"),t.appendChild(u),t.setAttributeNS(null,"id",this.uid+"-text-mask");for(let h of n)s.appendChild(h);for(let h of this.backgroundItems)r.appendChild(h);for(let h of this.highlights)i.appendChild(h);for(let h of this.vertices)l.appendChild(h);for(let h of this.maskElements)t.appendChild(h);for(let h of this.gradients)e.appendChild(h);if(s.setAttributeNS(null,"mask","url(#"+this.uid+"-text-mask)"),this.updateViewbox(this.opts.scale),r.setAttributeNS(null,"style",`transform: translateX(${this.minX}px) translateY(${this.minY}px)`),this.svg)this.svg.appendChild(e),this.svg.appendChild(t),this.svg.appendChild(r),this.svg.appendChild(i),this.svg.appendChild(s),this.svg.appendChild(l);else return this.container.appendChild(e),this.container.appendChild(t),this.container.appendChild(r),this.container.appendChild(s),this.container.appendChild(l),this.container}addLayer(e){this.backgroundItems.push(e.firstChild)}createGradient(e){let t=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),r=this.uid+`-line-${this.gradientId++}`,i=e.getLeftVector(),s=e.getRightVector(),l=i.x,n=i.y,u=s.x,h=s.y;t.setAttributeNS(null,"id",r),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"x1",l),t.setAttributeNS(null,"y1",n),t.setAttributeNS(null,"x2",u),t.setAttributeNS(null,"y2",h);let d=document.createElementNS("http://www.w3.org/2000/svg","stop");d.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.setAttributeNS(null,"offset","20%");let f=document.createElementNS("http://www.w3.org/2000/svg","stop");return f.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getRightElement()||this.themeManager.getColor("C"))),f.setAttributeNS(null,"offset","100%"),t.appendChild(d),t.appendChild(f),this.gradients.push(t),r}createSubSuperScripts(e,t){let r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttributeNS(null,"baseline-shift",t),r.appendChild(document.createTextNode(e)),r.setAttributeNS(null,"class","sub"),r}static createUnicodeCharge(e){return e===1?"\u207A":e===-1?"\u207B":e>1?k.createUnicodeSuperscript(e)+"\u207A":e<-1?k.createUnicodeSuperscript(e)+"\u207B":""}determineDimensions(e){for(var t=0;t<e.length;t++){if(!e[t].value.isDrawn)continue;let i=e[t].position;this.maxX<i.x&&(this.maxX=i.x),this.maxY<i.y&&(this.maxY=i.y),this.minX>i.x&&(this.minX=i.x),this.minY>i.y&&(this.minY=i.y)}let r=this.opts.padding;this.maxX+=r,this.maxY+=r,this.minX-=r,this.minY-=r,this.drawingWidth=this.maxX-this.minX,this.drawingHeight=this.maxY-this.minY}updateViewbox(e){let t=this.minX,r=this.minY,i=this.maxX-this.minX,s=this.maxY-this.minY;if(e<=0)if(i>s){let l=i-s;s=i,r-=l/2}else{let l=s-i;i=s,t-=l/2}else this.svg&&(this.svg.style.width=e*i+"px",this.svg.style.height=e*s+"px");this.svg.setAttributeNS(null,"viewBox",`${t} ${r} ${i} ${s}`)}drawBall(e,t,r){let i=this.opts.bondLength/4.5;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r",i),s.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(s)}drawWedge(e){let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=Fe.normals(t,r);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),l=t,n=r;s&&(l=r,n=t);let u=Fe.add(l,Fe.multiplyScalar(i[0],this.halfBondThickness)),h=Fe.add(n,Fe.multiplyScalar(i[0],3+this.opts.fontSizeLarge/4)),d=Fe.add(n,Fe.multiplyScalar(i[1],3+this.opts.fontSizeLarge/4)),f=Fe.add(l,Fe.multiplyScalar(i[1],this.halfBondThickness)),c=document.createElementNS("http://www.w3.org/2000/svg","polygon"),p=this.createGradient(e,t.x,t.y,r.x,r.y);c.setAttributeNS(null,"points",`${u.x},${u.y} ${h.x},${h.y} ${d.x},${d.y} ${f.x},${f.y}`),c.setAttributeNS(null,"fill",`url('#${p}')`),this.paths.push(c)}drawAtomHighlight(e,t,r="#03fc9d"){let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",this.opts.bondLength/3),i.setAttributeNS(null,"fill",r),this.highlights.push(i)}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=Fe.normals(t,r);i[0].normalize(),i[1].normalize();let s=e.getRightChiral(),l,n;s?(l=r,n=t):(l=t,n=r);let u=Fe.subtract(n,l).normalize(),h=e.getLength(),d=1.25/(h/(this.opts.bondLength/10)),f=this.createGradient(e);for(let c=0;c<1;c+=d){let p=Fe.multiplyScalar(u,c*h),w=Fe.add(l,p),$=this.opts.fontSizeLarge/2*c,P=Fe.multiplyScalar(i[0],$);w.subtract(P);let M=w.clone();M.add(Fe.multiplyScalar(P,2)),this.drawLine(new Dh(w,M),null,f)}}drawDebugPoint(e,t,r="",i="#f00"){let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r","2"),s.setAttributeNS(null,"fill",i),this.vertices.push(s),this.drawDebugText(e,t,r)}drawDebugText(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttributeNS(null,"x",e),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"class","debug"),i.setAttributeNS(null,"fill","#ff0000"),i.setAttributeNS(null,"style",`
                font: 5px Droid Sans, sans-serif;
            `),i.appendChild(document.createTextNode(r)),this.vertices.push(i)}drawRing(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","circle"),s=Oh.apothemFromSideLength(this.opts.bondLength,r);i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",s-this.opts.bondSpacing),i.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),i.setAttributeNS(null,"stroke-width",this.opts.bondThickness),i.setAttributeNS(null,"fill","none"),this.paths.push(i)}drawLine(e,t=!1,r=null,i="round"){let s=[["stroke-width",this.opts.bondThickness],["stroke-linecap",i],["stroke-dasharray",t?"5, 5":"none"]],l=e.getLeftVector(),n=e.getRightVector(),u=l.x,h=l.y,d=n.x,f=n.y,c=s.map(w=>w.join(":")).join(";"),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttributeNS(null,"x1",u),p.setAttributeNS(null,"y1",h),p.setAttributeNS(null,"x2",d),p.setAttributeNS(null,"y2",f),p.setAttributeNS(null,"style",c),this.paths.push(p),r==null&&(r=this.createGradient(e,u,h,d,f)),p.setAttributeNS(null,"stroke",`url('#${r}')`)}drawPoint(e,t,r){let i=.75;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let s=document.createElementNS("http://www.w3.org/2000/svg","circle");s.setAttributeNS(null,"cx",e),s.setAttributeNS(null,"cy",t),s.setAttributeNS(null,"r","1.5"),s.setAttributeNS(null,"fill","black"),this.maskElements.push(s);let l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttributeNS(null,"cx",e),l.setAttributeNS(null,"cy",t),l.setAttributeNS(null,"r",i),l.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(l)}drawText(e,t,r,i,s,l,n,u,h,d={}){let f=[],c=r;n!==0&&n!==null&&(c+=k.createUnicodeCharge(n)),u!==0&&u!==null&&(c=k.createUnicodeSuperscript(u)+c),f.push([c,r]),i===1?f.push(["H","H"]):i>1&&f.push(["H"+k.createUnicodeSubscript(i),"H"]),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0);for(let p in d){if(!d.hasOwnProperty(p))continue;let w=d[p],$=w.element;w.count>1&&($+=k.createUnicodeSubscript(w.count)),w.charge!==""&&($+=k.createUnicodeCharge(n)),f.push([$,w.element]),w.hydrogenCount===1?f.push(["H","H"]):w.hydrogenCount>1&&f.push(["H"+k.createUnicodeSubscript(w.hydrogenCount),"H"])}this.write(f,s,e,t,h===1)}write(e,t,r,i,s){let l=k.measureText(e[0][1],this.opts.fontSizeLarge,this.opts.fontFamily);t==="left"&&e[0][0]!==e[0][1]&&(l.width*=2),s?(r+l.width*e.length>this.maxX&&(this.maxX=r+l.width*e.length),r-l.width/2<this.minX&&(this.minX=r-l.width/2),i-l.height<this.minY&&(this.minY=i-l.height),i+l.height>this.maxY&&(this.maxY=i+l.height)):(t!=="right"?(r+l.width*e.length>this.maxX&&(this.maxX=r+l.width*e.length),r-l.width*e.length<this.minX&&(this.minX=r-l.width*e.length)):t!=="left"&&(r+l.width*e.length>this.maxX&&(this.maxX=r+l.width*e.length),r-l.width/2<this.minX&&(this.minX=r-l.width/2)),i-l.height<this.minY&&(this.minY=i-l.height),i+l.height>this.maxY&&(this.maxY=i+l.height),t==="down"&&i+.8*l.height*e.length>this.maxY&&(this.maxY=i+.8*l.height*e.length),t==="up"&&i-.8*l.height*e.length<this.minY&&(this.minY=i-.8*l.height*e.length));let n=r,u=i,h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttributeNS(null,"class","element");let d=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill","#ffffff"),t==="left"&&(e=e.reverse()),(t==="right"||t==="down"||t==="up")&&(r-=l.width/2),t==="left"&&(r+=l.width/2),e.forEach((p,w)=>{let $=p[0],P=p[1],M=document.createElementNS("http://www.w3.org/2000/svg","tspan");M.setAttributeNS(null,"fill",this.themeManager.getColor(P)),M.textContent=$,(t==="up"||t==="down")&&(M.setAttributeNS(null,"x","0px"),t==="up"?M.setAttributeNS(null,"y",`-${.9*w}em`):M.setAttributeNS(null,"y",`${.9*w}em`)),h.appendChild(M)}),h.setAttributeNS(null,"data-direction",t),t==="left"||t==="right"?(h.setAttributeNS(null,"dominant-baseline","alphabetic"),h.setAttributeNS(null,"y","0.36em")):h.setAttributeNS(null,"dominant-baseline","central"),t==="left"&&h.setAttributeNS(null,"text-anchor","end"),d.appendChild(h),d.setAttributeNS(null,"style",`transform: translateX(${r}px) translateY(${i}px)`);let f=this.opts.fontSizeLarge*.75;e[0][1].length>1&&(f=this.opts.fontSizeLarge*1.1);let c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttributeNS(null,"cx",n),c.setAttributeNS(null,"cy",u),c.setAttributeNS(null,"r",f),c.setAttributeNS(null,"fill","black"),this.maskElements.push(c),this.vertices.push(d)}toCanvas(e,t,r){(typeof e=="string"||e instanceof String)&&(e=document.getElementById(e));let i=new Image;i.onload=function(){e.width=t,e.height=r,e.getContext("2d").drawImage(i,0,0,t,r)},i.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(this.svg.outerHTML)}static createUnicodeSubscript(e){let t="";return e.toString().split("").forEach(r=>{t+=["\u2080","\u2081","\u2082","\u2083","\u2084","\u2085","\u2086","\u2087","\u2088","\u2089"][parseInt(r)]}),t}static createUnicodeSuperscript(e){let t="";return e.toString().split("").forEach(r=>{let i=parseInt(r);Number.isFinite(i)&&(t+=["\u2070","\xB9","\xB2","\xB3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"][i])}),t}static replaceNumbersWithSubscript(e){let t={0:"\u2080",1:"\u2081",2:"\u2082",3:"\u2083",4:"\u2084",5:"\u2085",6:"\u2086",7:"\u2087",8:"\u2088",9:"\u2089"};for(let[r,i]of Object.entries(t))e=e.replaceAll(r,i);return e}static measureText(e,t,r,i=.9){let l=document.createElement("canvas").getContext("2d");l.font=`${t}pt ${r}`;let n=l.measureText(e),u=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight);return{width:n.width>u?n.width:u,height:(Math.abs(n.actualBoundingBoxAscent)+Math.abs(n.actualBoundingBoxAscent))*i}}static svgToCanvas(e,t,r,i,s=null){e.setAttributeNS(null,"width",r),e.setAttributeNS(null,"height",i);let l=new Image;return l.onload=function(){t.width=r,t.height=i;let n=t.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(l,0,0,r,i),s&&s(t)},l.onerror=function(n){console.log(n)},l.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(e.outerHTML),t}static svgToImg(e,t,r,i){let s=document.createElement("canvas");this.svgToCanvas(e,s,r,i,()=>{t.src=s.toDataURL("image/png")})}static writeText(e,t,r,i,s=Number.MAX_SAFE_INTEGER){let l=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","style");n.appendChild(document.createTextNode(`
        .text {
            font: ${r}pt ${i};
            dominant-baseline: ideographic;
        }
    `)),l.appendChild(n);let u=document.createElementNS("http://www.w3.org/2000/svg","text");u.setAttributeNS(null,"class","text");let h=0,d=0,f=[];return e.split(`
`).forEach(c=>{let p=k.measureText(c,r,i,1);if(p.width>=s){let w=0,$=0,P=c.split(" "),M=0;for(let B=0;B<P.length;B++){let H=k.measureText(P[B],r,i,1);w+H.width>s&&(f.push({text:P.slice(M,B).join(" "),width:w,height:$}),w=0,$=0,M=B),H.height>$&&($=H.height),w+=H.width}M<P.length&&f.push({text:P.slice(M,P.length).join(" "),width:w,height:$})}else f.push({text:c,width:p.width,height:p.height})}),f.forEach(c=>{d+=c.height;let p=document.createElementNS("http://www.w3.org/2000/svg","tspan");p.setAttributeNS(null,"fill",t.getColor("C")),p.textContent=c.text,p.setAttributeNS(null,"x","0px"),p.setAttributeNS(null,"y",`${d}px`),u.appendChild(p),c.width>h&&(h=c.width)}),l.appendChild(u),{svg:l,width:h,height:d}}};Zs.exports=sn});var Js=ce((Fu,Ks)=>{function zh(k){"use strict";function e(c,p){var w=c.length,$=w===0||w>0&&w-1 in c;if($)for(let P=0;P<w&&p.call(c[P],P,c[P])!==!1;P++);else for(let P in c)if(p.call(c[P],P,c[P])===!1)break}function t(c){var p=parseInt(c).toString(16);return p.length==1?"0"+p:p}function r(c,p,w,$){return $=parseInt($),$===void 0||$===255?"#"+t(c)+t(p)+t(w):$===0?!1:"rgba("+c+","+p+","+w+","+$/255+")"}function i(c,p,w){return"M"+c+" "+p+"h"+w}function s(c,p){return'<path stroke="'+c+'" d="'+p+`" />
`}function l(c){var p="";return e(c,function(P,$){var P=r.apply(null,P.split(","));if(P!==!1){var M=[],B,H=1;e($,function(){B&&this[1]===B[1]&&this[0]===B[0]+H?H++:(B&&(M.push(i(B[0],B[1],H)),H=1),B=this)}),M.push(i(B[0],B[1],H)),p+=s(P,M.join(""))}}),p}var n=function(c){for(var p={},w=c.data,$=w.length,P=c.width,M=c.height,B=0,H=0,E=0,D;E<$;E+=4)w[E+3]>0&&(D=w[E]+","+w[E+1]+","+w[E+2]+","+w[E+3],p[D]=p[D]||[],B=E/4%P,H=Math.floor(E/4/P),p[D].push([B,H]));return p};let u=n(k),h=l(u),d='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -0.5 '+k.width+" "+k.height+'" shape-rendering="crispEdges"><g shape-rendering="crispEdges">'+h+"</g></svg>";var f=document.createElement("div");return f.innerHTML=d,f.firstChild}Ks.exports=zh});var Qs=ce((an,ln)=>{(function(k,e){typeof an=="object"&&typeof ln<"u"?ln.exports=e():typeof define=="function"&&define.amd?define(e):(k=typeof globalThis<"u"?globalThis:k||self,k.chroma=e())})(an,function(){"use strict";for(var k=function(a,o,g){return o===void 0&&(o=0),g===void 0&&(g=1),a<o?o:a>g?g:a},e=k,t=function(a){a._clipped=!1,a._unclipped=a.slice(0);for(var o=0;o<=3;o++)o<3?((a[o]<0||a[o]>255)&&(a._clipped=!0),a[o]=e(a[o],0,255)):o===3&&(a[o]=e(a[o],0,1));return a},r={},i=0,s=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];i<s.length;i+=1){var l=s[i];r["[object "+l+"]"]=l.toLowerCase()}var n=function(a){return r[Object.prototype.toString.call(a)]||"object"},u=n,h=function(a,o){return o===void 0&&(o=null),a.length>=3?Array.prototype.slice.call(a):u(a[0])=="object"&&o?o.split("").filter(function(g){return a[0][g]!==void 0}).map(function(g){return a[0][g]}):a[0]},d=n,f=function(a){if(a.length<2)return null;var o=a.length-1;return d(a[o])=="string"?a[o].toLowerCase():null},c=Math.PI,p={clip_rgb:t,limit:k,type:n,unpack:h,last:f,PI:c,TWOPI:c*2,PITHIRD:c/3,DEG2RAD:c/180,RAD2DEG:180/c},w={format:{},autodetect:[]},$=p.last,P=p.clip_rgb,M=p.type,B=w,H=function(){for(var o=[],g=arguments.length;g--;)o[g]=arguments[g];var v=this;if(M(o[0])==="object"&&o[0].constructor&&o[0].constructor===this.constructor)return o[0];var S=$(o),A=!1;if(!S){A=!0,B.sorted||(B.autodetect=B.autodetect.sort(function(I,q){return q.p-I.p}),B.sorted=!0);for(var y=0,x=B.autodetect;y<x.length;y+=1){var R=x[y];if(S=R.test.apply(R,o),S)break}}if(B.format[S]){var T=B.format[S].apply(null,A?o:o.slice(0,-1));v._rgb=P(T)}else throw new Error("unknown format: "+o);v._rgb.length===3&&v._rgb.push(1)};H.prototype.toString=function(){return M(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var E=H,D=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(D.Color,[null].concat(a)))};D.Color=E,D.version="2.4.2";var V=D,ne=p.unpack,j=Math.max,Y=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=ne(a,"rgb"),v=g[0],S=g[1],A=g[2];v=v/255,S=S/255,A=A/255;var y=1-j(v,j(S,A)),x=y<1?1/(1-y):0,R=(1-v-y)*x,T=(1-S-y)*x,I=(1-A-y)*x;return[R,T,I,y]},ae=Y,pe=p.unpack,Ke=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=pe(a,"cmyk");var g=a[0],v=a[1],S=a[2],A=a[3],y=a.length>4?a[4]:1;return A===1?[0,0,0,y]:[g>=1?0:255*(1-g)*(1-A),v>=1?0:255*(1-v)*(1-A),S>=1?0:255*(1-S)*(1-A),y]},Le=Ke,we=V,He=E,Xe=w,lt=p.unpack,ot=p.type,bt=ae;He.prototype.cmyk=function(){return bt(this._rgb)},we.cmyk=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(He,[null].concat(a,["cmyk"])))},Xe.format.cmyk=Le,Xe.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=lt(a,"cmyk"),ot(a)==="array"&&a.length===4)return"cmyk"}});var be=p.unpack,Se=p.last,ft=function(a){return Math.round(a*100)/100},Et=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=be(a,"hsla"),v=Se(a)||"lsa";return g[0]=ft(g[0]||0),g[1]=ft(g[1]*100)+"%",g[2]=ft(g[2]*100)+"%",v==="hsla"||g.length>3&&g[3]<1?(g[3]=g.length>3?g[3]:1,v="hsla"):g.length=3,v+"("+g.join(",")+")"},Ot=Et,kt=p.unpack,U=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=kt(a,"rgba");var g=a[0],v=a[1],S=a[2];g/=255,v/=255,S/=255;var A=Math.min(g,v,S),y=Math.max(g,v,S),x=(y+A)/2,R,T;return y===A?(R=0,T=Number.NaN):R=x<.5?(y-A)/(y+A):(y-A)/(2-y-A),g==y?T=(v-S)/(y-A):v==y?T=2+(S-g)/(y-A):S==y&&(T=4+(g-v)/(y-A)),T*=60,T<0&&(T+=360),a.length>3&&a[3]!==void 0?[T,R,x,a[3]]:[T,R,x]},Ee=U,je=p.unpack,Ve=p.last,et=Ot,Ye=Ee,Ie=Math.round,qe=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=je(a,"rgba"),v=Ve(a)||"rgb";return v.substr(0,3)=="hsl"?et(Ye(g),v):(g[0]=Ie(g[0]),g[1]=Ie(g[1]),g[2]=Ie(g[2]),(v==="rgba"||g.length>3&&g[3]<1)&&(g[3]=g.length>3?g[3]:1,v="rgba"),v+"("+g.slice(0,v==="rgb"?3:4).join(",")+")")},Tt=qe,Mt=p.unpack,Re=Math.round,De=function(){for(var a,o=[],g=arguments.length;g--;)o[g]=arguments[g];o=Mt(o,"hsl");var v=o[0],S=o[1],A=o[2],y,x,R;if(S===0)y=x=R=A*255;else{var T=[0,0,0],I=[0,0,0],q=A<.5?A*(1+S):A+S-A*S,O=2*A-q,X=v/360;T[0]=X+1/3,T[1]=X,T[2]=X-1/3;for(var W=0;W<3;W++)T[W]<0&&(T[W]+=1),T[W]>1&&(T[W]-=1),6*T[W]<1?I[W]=O+(q-O)*6*T[W]:2*T[W]<1?I[W]=q:3*T[W]<2?I[W]=O+(q-O)*(2/3-T[W])*6:I[W]=O;a=[Re(I[0]*255),Re(I[1]*255),Re(I[2]*255)],y=a[0],x=a[1],R=a[2]}return o.length>3?[y,x,R,o[3]]:[y,x,R,1]},ke=De,Ae=ke,ht=w,wt=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,yt=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,ct=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,St=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,tt=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,dt=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,pt=Math.round,Lt=function(a){a=a.toLowerCase().trim();var o;if(ht.format.named)try{return ht.format.named(a)}catch(W){}if(o=a.match(wt)){for(var g=o.slice(1,4),v=0;v<3;v++)g[v]=+g[v];return g[3]=1,g}if(o=a.match(yt)){for(var S=o.slice(1,5),A=0;A<4;A++)S[A]=+S[A];return S}if(o=a.match(ct)){for(var y=o.slice(1,4),x=0;x<3;x++)y[x]=pt(y[x]*2.55);return y[3]=1,y}if(o=a.match(St)){for(var R=o.slice(1,5),T=0;T<3;T++)R[T]=pt(R[T]*2.55);return R[3]=+R[3],R}if(o=a.match(tt)){var I=o.slice(1,4);I[1]*=.01,I[2]*=.01;var q=Ae(I);return q[3]=1,q}if(o=a.match(dt)){var O=o.slice(1,4);O[1]*=.01,O[2]*=.01;var X=Ae(O);return X[3]=+o[4],X}};Lt.test=function(a){return wt.test(a)||yt.test(a)||ct.test(a)||St.test(a)||tt.test(a)||dt.test(a)};var At=Lt,Vr=V,cr=E,dr=w,pr=p.type,Yr=Tt,jt=At;cr.prototype.css=function(a){return Yr(this._rgb,a)},Vr.css=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(cr,[null].concat(a,["css"])))},dr.format.css=jt,dr.autodetect.push({p:5,test:function(a){for(var o=[],g=arguments.length-1;g-- >0;)o[g]=arguments[g+1];if(!o.length&&pr(a)==="string"&&jt.test(a))return"css"}});var vr=E,Ur=V,Gr=w,mr=p.unpack;Gr.format.gl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=mr(a,"rgba");return g[0]*=255,g[1]*=255,g[2]*=255,g},Ur.gl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(vr,[null].concat(a,["gl"])))},vr.prototype.gl=function(){var a=this._rgb;return[a[0]/255,a[1]/255,a[2]/255,a[3]]};var br=p.unpack,Zr=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=br(a,"rgb"),v=g[0],S=g[1],A=g[2],y=Math.min(v,S,A),x=Math.max(v,S,A),R=x-y,T=R*100/255,I=y/(255-R)*100,q;return R===0?q=Number.NaN:(v===x&&(q=(S-A)/R),S===x&&(q=2+(A-v)/R),A===x&&(q=4+(v-S)/R),q*=60,q<0&&(q+=360)),[q,T,I]},wr=Zr,yr=p.unpack,Kr=Math.floor,Jr=function(){for(var a,o,g,v,S,A,y=[],x=arguments.length;x--;)y[x]=arguments[x];y=yr(y,"hcg");var R=y[0],T=y[1],I=y[2],q,O,X;I=I*255;var W=T*255;if(T===0)q=O=X=I;else{R===360&&(R=0),R>360&&(R-=360),R<0&&(R+=360),R/=60;var ee=Kr(R),ie=R-ee,le=I*(1-T),he=le+W*(1-ie),Be=le+W*ie,Me=le+W;switch(ee){case 0:a=[Me,Be,le],q=a[0],O=a[1],X=a[2];break;case 1:o=[he,Me,le],q=o[0],O=o[1],X=o[2];break;case 2:g=[le,Me,Be],q=g[0],O=g[1],X=g[2];break;case 3:v=[le,he,Me],q=v[0],O=v[1],X=v[2];break;case 4:S=[Be,le,Me],q=S[0],O=S[1],X=S[2];break;case 5:A=[Me,le,he],q=A[0],O=A[1],X=A[2];break}}return[q,O,X,y.length>3?y[3]:1]},Qr=Jr,jr=p.unpack,ei=p.type,ti=V,Sr=E,Ar=w,ri=wr;Sr.prototype.hcg=function(){return ri(this._rgb)},ti.hcg=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Sr,[null].concat(a,["hcg"])))},Ar.format.hcg=Qr,Ar.autodetect.push({p:1,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=jr(a,"hcg"),ei(a)==="array"&&a.length===3)return"hcg"}});var ii=p.unpack,b=p.last,de=Math.round,Ft=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=ii(a,"rgba"),v=g[0],S=g[1],A=g[2],y=g[3],x=b(a)||"auto";y===void 0&&(y=1),x==="auto"&&(x=y<1?"rgba":"rgb"),v=de(v),S=de(S),A=de(A);var R=v<<16|S<<8|A,T="000000"+R.toString(16);T=T.substr(T.length-6);var I="0"+de(y*255).toString(16);switch(I=I.substr(I.length-2),x.toLowerCase()){case"rgba":return"#"+T+I;case"argb":return"#"+I+T;default:return"#"+T}},Ue=Ft,er=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,G=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,zt=function(a){if(a.match(er)){(a.length===4||a.length===7)&&(a=a.substr(1)),a.length===3&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);var o=parseInt(a,16),g=o>>16,v=o>>8&255,S=o&255;return[g,v,S,1]}if(a.match(G)){(a.length===5||a.length===9)&&(a=a.substr(1)),a.length===4&&(a=a.split(""),a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]);var A=parseInt(a,16),y=A>>24&255,x=A>>16&255,R=A>>8&255,T=Math.round((A&255)/255*100)/100;return[y,x,R,T]}throw new Error("unknown hex color: "+a)},ni=zt,yn=V,si=E,Sn=p.type,me=w,Je=Ue;si.prototype.hex=function(a){return Je(this._rgb,a)},yn.hex=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(si,[null].concat(a,["hex"])))},me.format.hex=ni,me.autodetect.push({p:4,test:function(a){for(var o=[],g=arguments.length-1;g-- >0;)o[g]=arguments[g+1];if(!o.length&&Sn(a)==="string"&&[3,4,5,6,7,8,9].indexOf(a.length)>=0)return"hex"}});var An=p.unpack,Cr=p.TWOPI,ai=Math.min,xr=Math.sqrt,Bt=Math.acos,Z=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=An(a,"rgb"),v=g[0],S=g[1],A=g[2];v/=255,S/=255,A/=255;var y,x=ai(v,S,A),R=(v+S+A)/3,T=R>0?1-x/R:0;return T===0?y=NaN:(y=(v-S+(v-A))/2,y/=xr((v-S)*(v-S)+(v-A)*(S-A)),y=Bt(y),A>S&&(y=Cr-y),y/=Cr),[y*360,T,R]},tr=Z,Nr=p.unpack,Ct=p.limit,Ge=p.TWOPI,rr=p.PITHIRD,rt=Math.cos,li=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=Nr(a,"hsi");var g=a[0],v=a[1],S=a[2],A,y,x;return isNaN(g)&&(g=0),isNaN(v)&&(v=0),g>360&&(g-=360),g<0&&(g+=360),g/=360,g<1/3?(x=(1-v)/3,A=(1+v*rt(Ge*g)/rt(rr-Ge*g))/3,y=1-(x+A)):g<2/3?(g-=1/3,A=(1-v)/3,y=(1+v*rt(Ge*g)/rt(rr-Ge*g))/3,x=1-(A+y)):(g-=2/3,y=(1-v)/3,x=(1+v*rt(Ge*g)/rt(rr-Ge*g))/3,A=1-(y+x)),A=Ct(S*A*3),y=Ct(S*y*3),x=Ct(S*x*3),[A*255,y*255,x*255,a.length>3?a[3]:1]},oi=li,Rr=p.unpack,$r=p.type,hi=V,ir=E,Er=w,ui=tr;ir.prototype.hsi=function(){return ui(this._rgb)},hi.hsi=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(ir,[null].concat(a,["hsi"])))},Er.format.hsi=oi,Er.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=Rr(a,"hsi"),$r(a)==="array"&&a.length===3)return"hsi"}});var gi=p.unpack,fi=p.type,ci=V,kr=E,Tr=w,C=Ee;kr.prototype.hsl=function(){return C(this._rgb)},ci.hsl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(kr,[null].concat(a,["hsl"])))},Tr.format.hsl=ke,Tr.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=gi(a,"hsl"),fi(a)==="array"&&a.length===3)return"hsl"}});var m=p.unpack,L=Math.min,N=Math.max,F=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=m(a,"rgb");var g=a[0],v=a[1],S=a[2],A=L(g,v,S),y=N(g,v,S),x=y-A,R,T,I;return I=y/255,y===0?(R=Number.NaN,T=0):(T=x/y,g===y&&(R=(v-S)/x),v===y&&(R=2+(S-g)/x),S===y&&(R=4+(g-v)/x),R*=60,R<0&&(R+=360)),[R,T,I]},_=F,K=p.unpack,$e=Math.floor,Qe=function(){for(var a,o,g,v,S,A,y=[],x=arguments.length;x--;)y[x]=arguments[x];y=K(y,"hsv");var R=y[0],T=y[1],I=y[2],q,O,X;if(I*=255,T===0)q=O=X=I;else{R===360&&(R=0),R>360&&(R-=360),R<0&&(R+=360),R/=60;var W=$e(R),ee=R-W,ie=I*(1-T),le=I*(1-T*ee),he=I*(1-T*(1-ee));switch(W){case 0:a=[I,he,ie],q=a[0],O=a[1],X=a[2];break;case 1:o=[le,I,ie],q=o[0],O=o[1],X=o[2];break;case 2:g=[ie,I,he],q=g[0],O=g[1],X=g[2];break;case 3:v=[ie,le,I],q=v[0],O=v[1],X=v[2];break;case 4:S=[he,ie,I],q=S[0],O=S[1],X=S[2];break;case 5:A=[I,ie,le],q=A[0],O=A[1],X=A[2];break}}return[q,O,X,y.length>3?y[3]:1]},it=Qe,Sa=p.unpack,Aa=p.type,Ca=V,Cn=E,xn=w,xa=_;Cn.prototype.hsv=function(){return xa(this._rgb)},Ca.hsv=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Cn,[null].concat(a,["hsv"])))},xn.format.hsv=it,xn.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=Sa(a,"hsv"),Aa(a)==="array"&&a.length===3)return"hsv"}});var Mr={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Ht=Mr,Na=p.unpack,Nn=Math.pow,Ra=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=Na(a,"rgb"),v=g[0],S=g[1],A=g[2],y=$a(v,S,A),x=y[0],R=y[1],T=y[2],I=116*R-16;return[I<0?0:I,500*(x-R),200*(R-T)]},di=function(a){return(a/=255)<=.04045?a/12.92:Nn((a+.055)/1.055,2.4)},pi=function(a){return a>Ht.t3?Nn(a,1/3):a/Ht.t2+Ht.t0},$a=function(a,o,g){a=di(a),o=di(o),g=di(g);var v=pi((.4124564*a+.3575761*o+.1804375*g)/Ht.Xn),S=pi((.2126729*a+.7151522*o+.072175*g)/Ht.Yn),A=pi((.0193339*a+.119192*o+.9503041*g)/Ht.Zn);return[v,S,A]},Rn=Ra,qt=Mr,Ea=p.unpack,ka=Math.pow,Ta=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=Ea(a,"lab");var g=a[0],v=a[1],S=a[2],A,y,x,R,T,I;return y=(g+16)/116,A=isNaN(v)?y:y+v/500,x=isNaN(S)?y:y-S/200,y=qt.Yn*mi(y),A=qt.Xn*mi(A),x=qt.Zn*mi(x),R=vi(3.2404542*A-1.5371385*y-.4985314*x),T=vi(-.969266*A+1.8760108*y+.041556*x),I=vi(.0556434*A-.2040259*y+1.0572252*x),[R,T,I,a.length>3?a[3]:1]},vi=function(a){return 255*(a<=.00304?12.92*a:1.055*ka(a,1/2.4)-.055)},mi=function(a){return a>qt.t1?a*a*a:qt.t2*(a-qt.t0)},$n=Ta,Ma=p.unpack,La=p.type,Ba=V,En=E,kn=w,Pa=Rn;En.prototype.lab=function(){return Pa(this._rgb)},Ba.lab=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(En,[null].concat(a,["lab"])))},kn.format.lab=$n,kn.autodetect.push({p:2,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=Ma(a,"lab"),La(a)==="array"&&a.length===3)return"lab"}});var Ia=p.unpack,Da=p.RAD2DEG,Oa=Math.sqrt,Fa=Math.atan2,za=Math.round,Ha=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=Ia(a,"lab"),v=g[0],S=g[1],A=g[2],y=Oa(S*S+A*A),x=(Fa(A,S)*Da+360)%360;return za(y*1e4)===0&&(x=Number.NaN),[v,y,x]},Tn=Ha,qa=p.unpack,_a=Rn,Wa=Tn,Xa=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=qa(a,"rgb"),v=g[0],S=g[1],A=g[2],y=_a(v,S,A),x=y[0],R=y[1],T=y[2];return Wa(x,R,T)},Va=Xa,Ya=p.unpack,Ua=p.DEG2RAD,Ga=Math.sin,Za=Math.cos,Ka=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=Ya(a,"lch"),v=g[0],S=g[1],A=g[2];return isNaN(A)&&(A=0),A=A*Ua,[v,Za(A)*S,Ga(A)*S]},Mn=Ka,Ja=p.unpack,Qa=Mn,ja=$n,el=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=Ja(a,"lch");var g=a[0],v=a[1],S=a[2],A=Qa(g,v,S),y=A[0],x=A[1],R=A[2],T=ja(y,x,R),I=T[0],q=T[1],O=T[2];return[I,q,O,a.length>3?a[3]:1]},Ln=el,tl=p.unpack,rl=Ln,il=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=tl(a,"hcl").reverse();return rl.apply(void 0,g)},nl=il,sl=p.unpack,al=p.type,Bn=V,Lr=E,bi=w,Pn=Va;Lr.prototype.lch=function(){return Pn(this._rgb)},Lr.prototype.hcl=function(){return Pn(this._rgb).reverse()},Bn.lch=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Lr,[null].concat(a,["lch"])))},Bn.hcl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Lr,[null].concat(a,["hcl"])))},bi.format.lch=Ln,bi.format.hcl=nl,["lch","hcl"].forEach(function(a){return bi.autodetect.push({p:2,test:function(){for(var o=[],g=arguments.length;g--;)o[g]=arguments[g];if(o=sl(o,a),al(o)==="array"&&o.length===3)return a}})});var ll={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},In=ll,ol=E,Dn=w,hl=p.type,nr=In,ul=ni,gl=Ue;ol.prototype.name=function(){for(var a=gl(this._rgb,"rgb"),o=0,g=Object.keys(nr);o<g.length;o+=1){var v=g[o];if(nr[v]===a)return v.toLowerCase()}return a},Dn.format.named=function(a){if(a=a.toLowerCase(),nr[a])return ul(nr[a]);throw new Error("unknown color name: "+a)},Dn.autodetect.push({p:5,test:function(a){for(var o=[],g=arguments.length-1;g-- >0;)o[g]=arguments[g+1];if(!o.length&&hl(a)==="string"&&nr[a.toLowerCase()])return"named"}});var fl=p.unpack,cl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=fl(a,"rgb"),v=g[0],S=g[1],A=g[2];return(v<<16)+(S<<8)+A},dl=cl,pl=p.type,vl=function(a){if(pl(a)=="number"&&a>=0&&a<=16777215){var o=a>>16,g=a>>8&255,v=a&255;return[o,g,v,1]}throw new Error("unknown num color: "+a)},ml=vl,bl=V,On=E,Fn=w,wl=p.type,yl=dl;On.prototype.num=function(){return yl(this._rgb)},bl.num=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(On,[null].concat(a,["num"])))},Fn.format.num=ml,Fn.autodetect.push({p:5,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a.length===1&&wl(a[0])==="number"&&a[0]>=0&&a[0]<=16777215)return"num"}});var Sl=V,wi=E,zn=w,Hn=p.unpack,qn=p.type,_n=Math.round;wi.prototype.rgb=function(a){return a===void 0&&(a=!0),a===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(_n)},wi.prototype.rgba=function(a){return a===void 0&&(a=!0),this._rgb.slice(0,4).map(function(o,g){return g<3?a===!1?o:_n(o):o})},Sl.rgb=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(wi,[null].concat(a,["rgb"])))},zn.format.rgb=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=Hn(a,"rgba");return g[3]===void 0&&(g[3]=1),g},zn.autodetect.push({p:3,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=Hn(a,"rgba"),qn(a)==="array"&&(a.length===3||a.length===4&&qn(a[3])=="number"&&a[3]>=0&&a[3]<=1))return"rgb"}});var Br=Math.log,Al=function(a){var o=a/100,g,v,S;return o<66?(g=255,v=o<6?0:-155.25485562709179-.44596950469579133*(v=o-2)+104.49216199393888*Br(v),S=o<20?0:-254.76935184120902+.8274096064007395*(S=o-10)+115.67994401066147*Br(S)):(g=351.97690566805693+.114206453784165*(g=o-55)-40.25366309332127*Br(g),v=325.4494125711974+.07943456536662342*(v=o-50)-28.0852963507957*Br(v),S=255),[g,v,S,1]},Wn=Al,Cl=Wn,xl=p.unpack,Nl=Math.round,Rl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];for(var g=xl(a,"rgb"),v=g[0],S=g[2],A=1e3,y=4e4,x=.4,R;y-A>x;){R=(y+A)*.5;var T=Cl(R);T[2]/T[0]>=S/v?y=R:A=R}return Nl(R)},$l=Rl,yi=V,Pr=E,Si=w,El=$l;Pr.prototype.temp=Pr.prototype.kelvin=Pr.prototype.temperature=function(){return El(this._rgb)},yi.temp=yi.kelvin=yi.temperature=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Pr,[null].concat(a,["temp"])))},Si.format.temp=Si.format.kelvin=Si.format.temperature=Wn;var kl=p.unpack,Ai=Math.cbrt,Tl=Math.pow,Ml=Math.sign,Ll=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=kl(a,"rgb"),v=g[0],S=g[1],A=g[2],y=[Ci(v/255),Ci(S/255),Ci(A/255)],x=y[0],R=y[1],T=y[2],I=Ai(.4122214708*x+.5363325363*R+.0514459929*T),q=Ai(.2119034982*x+.6806995451*R+.1073969566*T),O=Ai(.0883024619*x+.2817188376*R+.6299787005*T);return[.2104542553*I+.793617785*q-.0040720468*O,1.9779984951*I-2.428592205*q+.4505937099*O,.0259040371*I+.7827717662*q-.808675766*O]},Xn=Ll;function Ci(a){var o=Math.abs(a);return o<.04045?a/12.92:(Ml(a)||1)*Tl((o+.055)/1.055,2.4)}var Bl=p.unpack,Ir=Math.pow,Pl=Math.sign,Il=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=Bl(a,"lab");var g=a[0],v=a[1],S=a[2],A=Ir(g+.3963377774*v+.2158037573*S,3),y=Ir(g-.1055613458*v-.0638541728*S,3),x=Ir(g-.0894841775*v-1.291485548*S,3);return[255*xi(4.0767416621*A-3.3077115913*y+.2309699292*x),255*xi(-1.2684380046*A+2.6097574011*y-.3413193965*x),255*xi(-.0041960863*A-.7034186147*y+1.707614701*x),a.length>3?a[3]:1]},Vn=Il;function xi(a){var o=Math.abs(a);return o>.0031308?(Pl(a)||1)*(1.055*Ir(o,1/2.4)-.055):a*12.92}var Dl=p.unpack,Ol=p.type,Fl=V,Yn=E,Un=w,zl=Xn;Yn.prototype.oklab=function(){return zl(this._rgb)},Fl.oklab=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Yn,[null].concat(a,["oklab"])))},Un.format.oklab=Vn,Un.autodetect.push({p:3,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=Dl(a,"oklab"),Ol(a)==="array"&&a.length===3)return"oklab"}});var Hl=p.unpack,ql=Xn,_l=Tn,Wl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];var g=Hl(a,"rgb"),v=g[0],S=g[1],A=g[2],y=ql(v,S,A),x=y[0],R=y[1],T=y[2];return _l(x,R,T)},Xl=Wl,Vl=p.unpack,Yl=Mn,Ul=Vn,Gl=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];a=Vl(a,"lch");var g=a[0],v=a[1],S=a[2],A=Yl(g,v,S),y=A[0],x=A[1],R=A[2],T=Ul(y,x,R),I=T[0],q=T[1],O=T[2];return[I,q,O,a.length>3?a[3]:1]},Zl=Gl,Kl=p.unpack,Jl=p.type,Ql=V,Gn=E,Zn=w,jl=Xl;Gn.prototype.oklch=function(){return jl(this._rgb)},Ql.oklch=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];return new(Function.prototype.bind.apply(Gn,[null].concat(a,["oklch"])))},Zn.format.oklch=Zl,Zn.autodetect.push({p:3,test:function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(a=Kl(a,"oklch"),Jl(a)==="array"&&a.length===3)return"oklch"}});var Kn=E,eo=p.type;Kn.prototype.alpha=function(a,o){return o===void 0&&(o=!1),a!==void 0&&eo(a)==="number"?o?(this._rgb[3]=a,this):new Kn([this._rgb[0],this._rgb[1],this._rgb[2],a],"rgb"):this._rgb[3]};var to=E;to.prototype.clipped=function(){return this._rgb._clipped||!1};var Pt=E,ro=Mr;Pt.prototype.darken=function(a){a===void 0&&(a=1);var o=this,g=o.lab();return g[0]-=ro.Kn*a,new Pt(g,"lab").alpha(o.alpha(),!0)},Pt.prototype.brighten=function(a){return a===void 0&&(a=1),this.darken(-a)},Pt.prototype.darker=Pt.prototype.darken,Pt.prototype.brighter=Pt.prototype.brighten;var io=E;io.prototype.get=function(a){var o=a.split("."),g=o[0],v=o[1],S=this[g]();if(v){var A=g.indexOf(v)-(g.substr(0,2)==="ok"?2:0);if(A>-1)return S[A];throw new Error("unknown channel "+v+" in mode "+g)}else return S};var _t=E,no=p.type,so=Math.pow,ao=1e-7,lo=20;_t.prototype.luminance=function(a){if(a!==void 0&&no(a)==="number"){if(a===0)return new _t([0,0,0,this._rgb[3]],"rgb");if(a===1)return new _t([255,255,255,this._rgb[3]],"rgb");var o=this.luminance(),g="rgb",v=lo,S=function(y,x){var R=y.interpolate(x,.5,g),T=R.luminance();return Math.abs(a-T)<ao||!v--?R:T>a?S(y,R):S(R,x)},A=(o>a?S(new _t([0,0,0]),this):S(this,new _t([255,255,255]))).rgb();return new _t(A.concat([this._rgb[3]]))}return oo.apply(void 0,this._rgb.slice(0,3))};var oo=function(a,o,g){return a=Ni(a),o=Ni(o),g=Ni(g),.2126*a+.7152*o+.0722*g},Ni=function(a){return a/=255,a<=.03928?a/12.92:so((a+.055)/1.055,2.4)},Ze={},Jn=E,Qn=p.type,Dr=Ze,jn=function(a,o,g){g===void 0&&(g=.5);for(var v=[],S=arguments.length-3;S-- >0;)v[S]=arguments[S+3];var A=v[0]||"lrgb";if(!Dr[A]&&!v.length&&(A=Object.keys(Dr)[0]),!Dr[A])throw new Error("interpolation mode "+A+" is not defined");return Qn(a)!=="object"&&(a=new Jn(a)),Qn(o)!=="object"&&(o=new Jn(o)),Dr[A](a,o,g).alpha(a.alpha()+g*(o.alpha()-a.alpha()))},es=E,ho=jn;es.prototype.mix=es.prototype.interpolate=function(a,o){o===void 0&&(o=.5);for(var g=[],v=arguments.length-2;v-- >0;)g[v]=arguments[v+2];return ho.apply(void 0,[this,a,o].concat(g))};var ts=E;ts.prototype.premultiply=function(a){a===void 0&&(a=!1);var o=this._rgb,g=o[3];return a?(this._rgb=[o[0]*g,o[1]*g,o[2]*g,g],this):new ts([o[0]*g,o[1]*g,o[2]*g,g],"rgb")};var Ri=E,uo=Mr;Ri.prototype.saturate=function(a){a===void 0&&(a=1);var o=this,g=o.lch();return g[1]+=uo.Kn*a,g[1]<0&&(g[1]=0),new Ri(g,"lch").alpha(o.alpha(),!0)},Ri.prototype.desaturate=function(a){return a===void 0&&(a=1),this.saturate(-a)};var rs=E,is=p.type;rs.prototype.set=function(a,o,g){g===void 0&&(g=!1);var v=a.split("."),S=v[0],A=v[1],y=this[S]();if(A){var x=S.indexOf(A)-(S.substr(0,2)==="ok"?2:0);if(x>-1){if(is(o)=="string")switch(o.charAt(0)){case"+":y[x]+=+o;break;case"-":y[x]+=+o;break;case"*":y[x]*=+o.substr(1);break;case"/":y[x]/=+o.substr(1);break;default:y[x]=+o}else if(is(o)==="number")y[x]=o;else throw new Error("unsupported value for Color.set");var R=new rs(y,S);return g?(this._rgb=R._rgb,this):R}throw new Error("unknown channel "+A+" in mode "+S)}else return y};var go=E,fo=function(a,o,g){var v=a._rgb,S=o._rgb;return new go(v[0]+g*(S[0]-v[0]),v[1]+g*(S[1]-v[1]),v[2]+g*(S[2]-v[2]),"rgb")};Ze.rgb=fo;var co=E,$i=Math.sqrt,Wt=Math.pow,po=function(a,o,g){var v=a._rgb,S=v[0],A=v[1],y=v[2],x=o._rgb,R=x[0],T=x[1],I=x[2];return new co($i(Wt(S,2)*(1-g)+Wt(R,2)*g),$i(Wt(A,2)*(1-g)+Wt(T,2)*g),$i(Wt(y,2)*(1-g)+Wt(I,2)*g),"rgb")};Ze.lrgb=po;var vo=E,mo=function(a,o,g){var v=a.lab(),S=o.lab();return new vo(v[0]+g*(S[0]-v[0]),v[1]+g*(S[1]-v[1]),v[2]+g*(S[2]-v[2]),"lab")};Ze.lab=mo;var ns=E,Xt=function(a,o,g,v){var S,A,y,x;v==="hsl"?(y=a.hsl(),x=o.hsl()):v==="hsv"?(y=a.hsv(),x=o.hsv()):v==="hcg"?(y=a.hcg(),x=o.hcg()):v==="hsi"?(y=a.hsi(),x=o.hsi()):v==="lch"||v==="hcl"?(v="hcl",y=a.hcl(),x=o.hcl()):v==="oklch"&&(y=a.oklch().reverse(),x=o.oklch().reverse());var R,T,I,q,O,X;(v.substr(0,1)==="h"||v==="oklch")&&(S=y,R=S[0],I=S[1],O=S[2],A=x,T=A[0],q=A[1],X=A[2]);var W,ee,ie,le;return!isNaN(R)&&!isNaN(T)?(T>R&&T-R>180?le=T-(R+360):T<R&&R-T>180?le=T+360-R:le=T-R,ee=R+g*le):isNaN(R)?isNaN(T)?ee=Number.NaN:(ee=T,(O==1||O==0)&&v!="hsv"&&(W=q)):(ee=R,(X==1||X==0)&&v!="hsv"&&(W=I)),W===void 0&&(W=I+g*(q-I)),ie=O+g*(X-O),v==="oklch"?new ns([ie,W,ee],v):new ns([ee,W,ie],v)},bo=Xt,ss=function(a,o,g){return bo(a,o,g,"lch")};Ze.lch=ss,Ze.hcl=ss;var wo=E,yo=function(a,o,g){var v=a.num(),S=o.num();return new wo(v+g*(S-v),"num")};Ze.num=yo;var So=Xt,Ao=function(a,o,g){return So(a,o,g,"hcg")};Ze.hcg=Ao;var Co=Xt,xo=function(a,o,g){return Co(a,o,g,"hsi")};Ze.hsi=xo;var No=Xt,Ro=function(a,o,g){return No(a,o,g,"hsl")};Ze.hsl=Ro;var $o=Xt,Eo=function(a,o,g){return $o(a,o,g,"hsv")};Ze.hsv=Eo;var ko=E,To=function(a,o,g){var v=a.oklab(),S=o.oklab();return new ko(v[0]+g*(S[0]-v[0]),v[1]+g*(S[1]-v[1]),v[2]+g*(S[2]-v[2]),"oklab")};Ze.oklab=To;var Mo=Xt,Lo=function(a,o,g){return Mo(a,o,g,"oklch")};Ze.oklch=Lo;var Ei=E,Bo=p.clip_rgb,ki=Math.pow,Ti=Math.sqrt,Mi=Math.PI,as=Math.cos,ls=Math.sin,Po=Math.atan2,Io=function(a,o,g){o===void 0&&(o="lrgb"),g===void 0&&(g=null);var v=a.length;g||(g=Array.from(new Array(v)).map(function(){return 1}));var S=v/g.reduce(function(ee,ie){return ee+ie});if(g.forEach(function(ee,ie){g[ie]*=S}),a=a.map(function(ee){return new Ei(ee)}),o==="lrgb")return Do(a,g);for(var A=a.shift(),y=A.get(o),x=[],R=0,T=0,I=0;I<y.length;I++)if(y[I]=(y[I]||0)*g[0],x.push(isNaN(y[I])?0:g[0]),o.charAt(I)==="h"&&!isNaN(y[I])){var q=y[I]/180*Mi;R+=as(q)*g[0],T+=ls(q)*g[0]}var O=A.alpha()*g[0];a.forEach(function(ee,ie){var le=ee.get(o);O+=ee.alpha()*g[ie+1];for(var he=0;he<y.length;he++)if(!isNaN(le[he]))if(x[he]+=g[ie+1],o.charAt(he)==="h"){var Be=le[he]/180*Mi;R+=as(Be)*g[ie+1],T+=ls(Be)*g[ie+1]}else y[he]+=le[he]*g[ie+1]});for(var X=0;X<y.length;X++)if(o.charAt(X)==="h"){for(var W=Po(T/x[X],R/x[X])/Mi*180;W<0;)W+=360;for(;W>=360;)W-=360;y[X]=W}else y[X]=y[X]/x[X];return O/=v,new Ei(y,o).alpha(O>.99999?1:O,!0)},Do=function(a,o){for(var g=a.length,v=[0,0,0,0],S=0;S<a.length;S++){var A=a[S],y=o[S]/g,x=A._rgb;v[0]+=ki(x[0],2)*y,v[1]+=ki(x[1],2)*y,v[2]+=ki(x[2],2)*y,v[3]+=x[3]*y}return v[0]=Ti(v[0]),v[1]=Ti(v[1]),v[2]=Ti(v[2]),v[3]>.9999999&&(v[3]=1),new Ei(Bo(v))},nt=V,Vt=p.type,Oo=Math.pow,Li=function(a){var o="rgb",g=nt("#ccc"),v=0,S=[0,1],A=[],y=[0,0],x=!1,R=[],T=!1,I=0,q=1,O=!1,X={},W=!0,ee=1,ie=function(z){if(z=z||["#fff","#000"],z&&Vt(z)==="string"&&nt.brewer&&nt.brewer[z.toLowerCase()]&&(z=nt.brewer[z.toLowerCase()]),Vt(z)==="array"){z.length===1&&(z=[z[0],z[0]]),z=z.slice(0);for(var J=0;J<z.length;J++)z[J]=nt(z[J]);A.length=0;for(var re=0;re<z.length;re++)A.push(re/(z.length-1))}return _e(),R=z},le=function(z){if(x!=null){for(var J=x.length-1,re=0;re<J&&z>=x[re];)re++;return re-1}return 0},he=function(z){return z},Be=function(z){return z},Me=function(z,J){var re,te;if(J==null&&(J=!1),isNaN(z)||z===null)return g;if(J)te=z;else if(x&&x.length>2){var Pe=le(z);te=Pe/(x.length-2)}else q!==I?te=(z-I)/(q-I):te=1;te=Be(te),J||(te=he(te)),ee!==1&&(te=Oo(te,ee)),te=y[0]+te*(1-y[0]-y[1]),te=Math.min(1,Math.max(0,te));var ve=Math.floor(te*1e4);if(W&&X[ve])re=X[ve];else{if(Vt(R)==="array")for(var oe=0;oe<A.length;oe++){var ue=A[oe];if(te<=ue){re=R[oe];break}if(te>=ue&&oe===A.length-1){re=R[oe];break}if(te>ue&&te<A[oe+1]){te=(te-ue)/(A[oe+1]-ue),re=nt.interpolate(R[oe],R[oe+1],te,o);break}}else Vt(R)==="function"&&(re=R(te));W&&(X[ve]=re)}return re},_e=function(){return X={}};ie(a);var se=function(z){var J=nt(Me(z));return T&&J[T]?J[T]():J};return se.classes=function(z){if(z!=null){if(Vt(z)==="array")x=z,S=[z[0],z[z.length-1]];else{var J=nt.analyze(S);z===0?x=[J.min,J.max]:x=nt.limits(J,"e",z)}return se}return x},se.domain=function(z){if(!arguments.length)return S;I=z[0],q=z[z.length-1],A=[];var J=R.length;if(z.length===J&&I!==q)for(var re=0,te=Array.from(z);re<te.length;re+=1){var Pe=te[re];A.push((Pe-I)/(q-I))}else{for(var ve=0;ve<J;ve++)A.push(ve/(J-1));if(z.length>2){var oe=z.map(function(ge,fe){return fe/(z.length-1)}),ue=z.map(function(ge){return(ge-I)/(q-I)});ue.every(function(ge,fe){return oe[fe]===ge})||(Be=function(ge){if(ge<=0||ge>=1)return ge;for(var fe=0;ge>=ue[fe+1];)fe++;var at=(ge-ue[fe])/(ue[fe+1]-ue[fe]),Rt=oe[fe]+at*(oe[fe+1]-oe[fe]);return Rt})}}return S=[I,q],se},se.mode=function(z){return arguments.length?(o=z,_e(),se):o},se.range=function(z,J){return ie(z),se},se.out=function(z){return T=z,se},se.spread=function(z){return arguments.length?(v=z,se):v},se.correctLightness=function(z){return z==null&&(z=!0),O=z,_e(),O?he=function(J){for(var re=Me(0,!0).lab()[0],te=Me(1,!0).lab()[0],Pe=re>te,ve=Me(J,!0).lab()[0],oe=re+(te-re)*J,ue=ve-oe,ge=0,fe=1,at=20;Math.abs(ue)>.01&&at-- >0;)(function(){return Pe&&(ue*=-1),ue<0?(ge=J,J+=(fe-J)*.5):(fe=J,J+=(ge-J)*.5),ve=Me(J,!0).lab()[0],ue=ve-oe})();return J}:he=function(J){return J},se},se.padding=function(z){return z!=null?(Vt(z)==="number"&&(z=[z,z]),y=z,se):y},se.colors=function(z,J){arguments.length<2&&(J="hex");var re=[];if(arguments.length===0)re=R.slice(0);else if(z===1)re=[se(.5)];else if(z>1){var te=S[0],Pe=S[1]-te;re=Fo(0,z,!1).map(function(fe){return se(te+fe/(z-1)*Pe)})}else{a=[];var ve=[];if(x&&x.length>2)for(var oe=1,ue=x.length,ge=1<=ue;ge?oe<ue:oe>ue;ge?oe++:oe--)ve.push((x[oe-1]+x[oe])*.5);else ve=S;re=ve.map(function(fe){return se(fe)})}return nt[J]&&(re=re.map(function(fe){return fe[J]()})),re},se.cache=function(z){return z!=null?(W=z,se):W},se.gamma=function(z){return z!=null?(ee=z,se):ee},se.nodata=function(z){return z!=null?(g=nt(z),se):g},se};function Fo(a,o,g){for(var v=[],S=a<o,A=g?S?o+1:o-1:o,y=a;S?y<A:y>A;S?y++:y--)v.push(y);return v}var sr=E,zo=Li,Ho=function(a){for(var o=[1,1],g=1;g<a;g++){for(var v=[1],S=1;S<=o.length;S++)v[S]=(o[S]||0)+o[S-1];o=v}return o},qo=function(a){var o,g,v,S,A,y,x;if(a=a.map(function(O){return new sr(O)}),a.length===2)o=a.map(function(O){return O.lab()}),A=o[0],y=o[1],S=function(O){var X=[0,1,2].map(function(W){return A[W]+O*(y[W]-A[W])});return new sr(X,"lab")};else if(a.length===3)g=a.map(function(O){return O.lab()}),A=g[0],y=g[1],x=g[2],S=function(O){var X=[0,1,2].map(function(W){return(1-O)*(1-O)*A[W]+2*(1-O)*O*y[W]+O*O*x[W]});return new sr(X,"lab")};else if(a.length===4){var R;v=a.map(function(O){return O.lab()}),A=v[0],y=v[1],x=v[2],R=v[3],S=function(O){var X=[0,1,2].map(function(W){return(1-O)*(1-O)*(1-O)*A[W]+3*(1-O)*(1-O)*O*y[W]+3*(1-O)*O*O*x[W]+O*O*O*R[W]});return new sr(X,"lab")}}else if(a.length>=5){var T,I,q;T=a.map(function(O){return O.lab()}),q=a.length-1,I=Ho(q),S=function(O){var X=1-O,W=[0,1,2].map(function(ee){return T.reduce(function(ie,le,he){return ie+I[he]*Math.pow(X,q-he)*Math.pow(O,he)*le[ee]},0)});return new sr(W,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return S},_o=function(a){var o=qo(a);return o.scale=function(){return zo(o)},o},Bi=V,st=function(a,o,g){if(!st[g])throw new Error("unknown blend mode "+g);return st[g](a,o)},xt=function(a){return function(o,g){var v=Bi(g).rgb(),S=Bi(o).rgb();return Bi.rgb(a(v,S))}},Nt=function(a){return function(o,g){var v=[];return v[0]=a(o[0],g[0]),v[1]=a(o[1],g[1]),v[2]=a(o[2],g[2]),v}},Wo=function(a){return a},Xo=function(a,o){return a*o/255},Vo=function(a,o){return a>o?o:a},Yo=function(a,o){return a>o?a:o},Uo=function(a,o){return 255*(1-(1-a/255)*(1-o/255))},Go=function(a,o){return o<128?2*a*o/255:255*(1-2*(1-a/255)*(1-o/255))},Zo=function(a,o){return 255*(1-(1-o/255)/(a/255))},Ko=function(a,o){return a===255?255:(a=255*(o/255)/(1-a/255),a>255?255:a)};st.normal=xt(Nt(Wo)),st.multiply=xt(Nt(Xo)),st.screen=xt(Nt(Uo)),st.overlay=xt(Nt(Go)),st.darken=xt(Nt(Vo)),st.lighten=xt(Nt(Yo)),st.dodge=xt(Nt(Ko)),st.burn=xt(Nt(Zo));for(var Jo=st,Pi=p.type,Qo=p.clip_rgb,jo=p.TWOPI,eh=Math.pow,th=Math.sin,rh=Math.cos,os=V,ih=function(a,o,g,v,S){a===void 0&&(a=300),o===void 0&&(o=-1.5),g===void 0&&(g=1),v===void 0&&(v=1),S===void 0&&(S=[0,1]);var A=0,y;Pi(S)==="array"?y=S[1]-S[0]:(y=0,S=[S,S]);var x=function(R){var T=jo*((a+120)/360+o*R),I=eh(S[0]+y*R,v),q=A!==0?g[0]+R*A:g,O=q*I*(1-I)/2,X=rh(T),W=th(T),ee=I+O*(-.14861*X+1.78277*W),ie=I+O*(-.29227*X-.90649*W),le=I+O*(1.97294*X);return os(Qo([ee*255,ie*255,le*255,1]))};return x.start=function(R){return R==null?a:(a=R,x)},x.rotations=function(R){return R==null?o:(o=R,x)},x.gamma=function(R){return R==null?v:(v=R,x)},x.hue=function(R){return R==null?g:(g=R,Pi(g)==="array"?(A=g[1]-g[0],A===0&&(g=g[1])):A=0,x)},x.lightness=function(R){return R==null?S:(Pi(R)==="array"?(S=R,y=R[1]-R[0]):(S=[R,R],y=0),x)},x.scale=function(){return os.scale(x)},x.hue(g),x},nh=E,sh="0123456789abcdef",ah=Math.floor,lh=Math.random,oh=function(){for(var a="#",o=0;o<6;o++)a+=sh.charAt(ah(lh()*16));return new nh(a,"hex")},Ii=n,hs=Math.log,hh=Math.pow,uh=Math.floor,gh=Math.abs,us=function(a,o){o===void 0&&(o=null);var g={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return Ii(a)==="object"&&(a=Object.values(a)),a.forEach(function(v){o&&Ii(v)==="object"&&(v=v[o]),v!=null&&!isNaN(v)&&(g.values.push(v),g.sum+=v,v<g.min&&(g.min=v),v>g.max&&(g.max=v),g.count+=1)}),g.domain=[g.min,g.max],g.limits=function(v,S){return gs(g,v,S)},g},gs=function(a,o,g){o===void 0&&(o="equal"),g===void 0&&(g=7),Ii(a)=="array"&&(a=us(a));var v=a.min,S=a.max,A=a.values.sort(function(Oi,Fi){return Oi-Fi});if(g===1)return[v,S];var y=[];if(o.substr(0,1)==="c"&&(y.push(v),y.push(S)),o.substr(0,1)==="e"){y.push(v);for(var x=1;x<g;x++)y.push(v+x/g*(S-v));y.push(S)}else if(o.substr(0,1)==="l"){if(v<=0)throw new Error("Logarithmic scales are only possible for values > 0");var R=Math.LOG10E*hs(v),T=Math.LOG10E*hs(S);y.push(v);for(var I=1;I<g;I++)y.push(hh(10,R+I/g*(T-R)));y.push(S)}else if(o.substr(0,1)==="q"){y.push(v);for(var q=1;q<g;q++){var O=(A.length-1)*q/g,X=uh(O);if(X===O)y.push(A[X]);else{var W=O-X;y.push(A[X]*(1-W)+A[X+1]*W)}}y.push(S)}else if(o.substr(0,1)==="k"){var ee,ie=A.length,le=new Array(ie),he=new Array(g),Be=!0,Me=0,_e=null;_e=[],_e.push(v);for(var se=1;se<g;se++)_e.push(v+se/g*(S-v));for(_e.push(S);Be;){for(var z=0;z<g;z++)he[z]=0;for(var J=0;J<ie;J++)for(var re=A[J],te=Number.MAX_VALUE,Pe=void 0,ve=0;ve<g;ve++){var oe=gh(_e[ve]-re);oe<te&&(te=oe,Pe=ve),he[Pe]++,le[J]=Pe}for(var ue=new Array(g),ge=0;ge<g;ge++)ue[ge]=null;for(var fe=0;fe<ie;fe++)ee=le[fe],ue[ee]===null?ue[ee]=A[fe]:ue[ee]+=A[fe];for(var at=0;at<g;at++)ue[at]*=1/he[at];Be=!1;for(var Rt=0;Rt<g;Rt++)if(ue[Rt]!==_e[Rt]){Be=!0;break}_e=ue,Me++,Me>200&&(Be=!1)}for(var $t={},Yt=0;Yt<g;Yt++)$t[Yt]=[];for(var Ut=0;Ut<ie;Ut++)ee=le[Ut],$t[ee].push(A[Ut]);for(var mt=[],It=0;It<g;It++)mt.push($t[It][0]),mt.push($t[It][$t[It].length-1]);mt=mt.sort(function(Oi,Fi){return Oi-Fi}),y.push(mt[0]);for(var ar=1;ar<mt.length;ar+=2){var Dt=mt[ar];!isNaN(Dt)&&y.indexOf(Dt)===-1&&y.push(Dt)}}return y},fs={analyze:us,limits:gs},cs=E,fh=function(a,o){a=new cs(a),o=new cs(o);var g=a.luminance(),v=o.luminance();return g>v?(g+.05)/(v+.05):(v+.05)/(g+.05)},ds=E,vt=Math.sqrt,Ce=Math.pow,ch=Math.min,dh=Math.max,ps=Math.atan2,vs=Math.abs,Or=Math.cos,ms=Math.sin,ph=Math.exp,bs=Math.PI,vh=function(a,o,g,v,S){g===void 0&&(g=1),v===void 0&&(v=1),S===void 0&&(S=1);var A=function(Dt){return 360*Dt/(2*bs)},y=function(Dt){return 2*bs*Dt/360};a=new ds(a),o=new ds(o);var x=Array.from(a.lab()),R=x[0],T=x[1],I=x[2],q=Array.from(o.lab()),O=q[0],X=q[1],W=q[2],ee=(R+O)/2,ie=vt(Ce(T,2)+Ce(I,2)),le=vt(Ce(X,2)+Ce(W,2)),he=(ie+le)/2,Be=.5*(1-vt(Ce(he,7)/(Ce(he,7)+Ce(25,7)))),Me=T*(1+Be),_e=X*(1+Be),se=vt(Ce(Me,2)+Ce(I,2)),z=vt(Ce(_e,2)+Ce(W,2)),J=(se+z)/2,re=A(ps(I,Me)),te=A(ps(W,_e)),Pe=re>=0?re:re+360,ve=te>=0?te:te+360,oe=vs(Pe-ve)>180?(Pe+ve+360)/2:(Pe+ve)/2,ue=1-.17*Or(y(oe-30))+.24*Or(y(2*oe))+.32*Or(y(3*oe+6))-.2*Or(y(4*oe-63)),ge=ve-Pe;ge=vs(ge)<=180?ge:ve<=Pe?ge+360:ge-360,ge=2*vt(se*z)*ms(y(ge)/2);var fe=O-R,at=z-se,Rt=1+.015*Ce(ee-50,2)/vt(20+Ce(ee-50,2)),$t=1+.045*J,Yt=1+.015*J*ue,Ut=30*ph(-Ce((oe-275)/25,2)),mt=2*vt(Ce(J,7)/(Ce(J,7)+Ce(25,7))),It=-mt*ms(2*y(Ut)),ar=vt(Ce(fe/(g*Rt),2)+Ce(at/(v*$t),2)+Ce(ge/(S*Yt),2)+It*(at/(v*$t))*(ge/(S*Yt)));return dh(0,ch(100,ar))},ws=E,mh=function(a,o,g){g===void 0&&(g="lab"),a=new ws(a),o=new ws(o);var v=a.get(g),S=o.get(g),A=0;for(var y in v){var x=(v[y]||0)-(S[y]||0);A+=x*x}return Math.sqrt(A)},bh=E,wh=function(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];try{return new(Function.prototype.bind.apply(bh,[null].concat(a))),!0}catch(g){return!1}},ys=V,Ss=Li,yh={cool:function(){return Ss([ys.hsl(180,1,.9),ys.hsl(250,.7,.4)])},hot:function(){return Ss(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Fr={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Di=0,As=Object.keys(Fr);Di<As.length;Di+=1){var Cs=As[Di];Fr[Cs.toLowerCase()]=Fr[Cs]}var Sh=Fr,Te=V;Te.average=Io,Te.bezier=_o,Te.blend=Jo,Te.cubehelix=ih,Te.mix=Te.interpolate=jn,Te.random=oh,Te.scale=Li,Te.analyze=fs.analyze,Te.contrast=fh,Te.deltaE=vh,Te.distance=mh,Te.limits=fs.limits,Te.valid=wh,Te.scales=yh,Te.colors=In,Te.brewer=Sh;var Ah=Te;return Ah})});var hn=ce((zu,ea)=>{var js=ut(),Hh=Js(),qh=Qs(),on=class{constructor(e,t,r,i,s=.3,l=0,n=null,u=1,h=!1){this.points=e,this.weights=t,this.width=r,this.height=i,this.sigma=s,this.interval=l,this.opacity=u,this.normalized=h,n===null&&(n=["#c51b7d","#de77ae","#f1b6da","#fde0ef","#ffffff","#e6f5d0","#b8e186","#7fbc41","#4d9221"]),this.colormap=n,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height}setFromArray(e,t){this.points=[],e.forEach(r=>{this.points.push(new js(r[0],r[1]))}),this.weights=[],t.forEach(r=>{this.weights.push(r)})}draw(){let e=[];for(let s=0;s<this.width;s++){let l=[];for(let n=0;n<this.height;n++)l.push(0);e.push(l)}let t=1/(2*this.sigma*this.sigma);for(let s=0;s<this.points.length;s++){let l=this.points[s],n=this.weights[s];for(let u=0;u<this.width;u++)for(let h=0;h<this.height;h++){let d=u-l.x,f=h-l.y,c=(d*d+f*f)*t,p=n*Math.exp(-c);e[u][h]+=p}}let r=1;if(!this.normalized){let s=-Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;for(let n=0;n<this.width;n++)for(let u=0;u<this.height;u++)e[n][u]<l&&(l=e[n][u]),e[n][u]>s&&(s=e[n][u]);r=Math.max(Math.abs(l),Math.abs(s))}let i=qh.scale(this.colormap).domain([-1,1]);for(let s=0;s<this.width;s++)for(let l=0;l<this.height;l++){this.normalized||(e[s][l]=e[s][l]/r),this.interval!==0&&(e[s][l]=Math.round(e[s][l]/this.interval)*this.interval);let[n,u,h]=i(e[s][l]).rgb();this.setPixel(new js(s,l),n,u,h)}}getImage(e){let t=new Image;t.onload=()=>{this.context.imageSmoothingEnabled=!1,this.context.drawImage(t,0,0,this.width,this.height),e&&e(t)},t.onerror=function(r){console.log(r)},t.src=this.canvas.toDataURL()}getSVG(){return Hh(this.context.getImageData(0,0,this.width,this.height))}setPixel(e,t,r,i){this.context.fillStyle="rgba("+t+","+r+","+i+","+this.opacity+")",this.context.fillRect(e.x,e.y,1,1)}};ea.exports=on});var fr=ce((Hu,ra)=>{var ta=Gt(),_h=lr(),Wh=Gs(),ze=or(),Xh=Wr(),Vh=gr(),Ne=ut(),Yh=hn(),un=class{constructor(e,t=!0){this.preprocessor=new Wh(e),this.opts=this.preprocessor.opts,this.clear=t,this.svgWrapper=null}draw(e,t,r="light",i=null,s=!1,l=[],n=!1){t===null||t==="svg"?(t=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.setAttributeNS(null,"width",this.opts.width),t.setAttributeNS(null,"height",this.opts.height)):t instanceof String&&(t=document.getElementById(t));let u={padding:this.opts.padding,compactDrawing:this.opts.compactDrawing};i!==null&&(this.opts.padding+=this.opts.weights.additionalPadding,this.opts.compactDrawing=!1);let h=this.preprocessor;return h.initDraw(e,r,s,l),s||(this.themeManager=new Vh(this.opts.themes,r),(this.svgWrapper===null||this.clear)&&(this.svgWrapper=new Xh(this.themeManager,t,this.opts,this.clear))),h.processGraph(),this.svgWrapper.determineDimensions(h.graph.vertices),this.drawAtomHighlights(h.opts.debug),this.drawEdges(h.opts.debug),this.drawVertices(h.opts.debug),i!==null&&this.drawWeights(i,n),h.opts.debug&&(console.log(h.graph),console.log(h.rings),console.log(h.ringConnections)),this.svgWrapper.constructSvg(),i!==null&&(this.opts.padding=u.padding,this.opts.compactDrawing=u.padding),t}drawCanvas(e,t,r="light",i=!1){let s=null;typeof t=="string"||t instanceof String?s=document.getElementById(t):s=t;let l=document.createElementNS("http://www.w3.org/2000/svg","svg");return l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttributeNS(null,"viewBox","0 0 500 500"),l.setAttributeNS(null,"width","500"),l.setAttributeNS(null,"height","500"),l.setAttributeNS(null,"style","visibility: hidden: position: absolute; left: -1000px"),document.body.appendChild(l),this.svgDrawer.draw(e,l,r,i),this.svgDrawer.svgWrapper.toCanvas(s,this.svgDrawer.opts.width,this.svgDrawer.opts.height),document.body.removeChild(l),t}drawAromaticityRing(e){this.svgWrapper.drawRing(e.center.x,e.center.y,e.getSize())}drawEdges(e){let t=this.preprocessor,r=t.graph,i=t.rings,s=Array(this.preprocessor.graph.edges.length);if(s.fill(!1),r.traverseBF(0,n=>{let u=r.getEdges(n.id);for(var h=0;h<u.length;h++){let d=u[h];s[d]||(s[d]=!0,this.drawEdge(d,e))}}),!this.bridgedRing)for(var l=0;l<i.length;l++){let n=i[l];t.isRingAromatic(n)&&this.drawAromaticityRing(n)}}drawEdge(e,t){let r=this.preprocessor,i=r.opts,s=this.svgWrapper,l=r.graph.edges[e],n=r.graph.vertices[l.sourceId],u=r.graph.vertices[l.targetId],h=n.value.element,d=u.value.element;if((!n.value.isDrawn||!u.value.isDrawn)&&r.opts.atomVisualization==="default")return;let f=n.position,c=u.position,p=r.getEdgeNormals(l),w=ta.clone(p);if(w[0].multiplyScalar(10).add(f),w[1].multiplyScalar(10).add(f),l.bondType==="="||r.getRingbondType(n,u)==="="||l.isPartOfAromaticRing&&r.bridgedRing){let $=r.areVerticesInSameRing(n,u),P=r.chooseSide(n,u,w);if($){let B=r.getLargestOrAromaticCommonRing(n,u).center;p[0].multiplyScalar(i.bondSpacing),p[1].multiplyScalar(i.bondSpacing);let H=null;B.sameSideAs(n.position,u.position,Ne.add(f,p[0]))?H=new ze(Ne.add(f,p[0]),Ne.add(c,p[0]),h,d):H=new ze(Ne.add(f,p[1]),Ne.add(c,p[1]),h,d),H.shorten(i.bondLength-i.shortBondLength*i.bondLength),l.isPartOfAromaticRing?s.drawLine(H,!0):s.drawLine(H),s.drawLine(new ze(f,c,h,d))}else if(l.center||n.isTerminal()&&u.isTerminal()||P.anCount==0&&P.bnCount>1||P.bnCount==0&&P.anCount>1){this.multiplyNormals(p,i.halfBondSpacing);let M=new ze(Ne.add(f,p[0]),Ne.add(c,p[0]),h,d),B=new ze(Ne.add(f,p[1]),Ne.add(c,p[1]),h,d);s.drawLine(M),s.drawLine(B)}else if(P.sideCount[0]>P.sideCount[1]||P.totalSideCount[0]>P.totalSideCount[1]){this.multiplyNormals(p,i.bondSpacing);let M=new ze(Ne.add(f,p[0]),Ne.add(c,p[0]),h,d);M.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(M),s.drawLine(new ze(f,c,h,d))}else if(P.sideCount[0]<P.sideCount[1]||P.totalSideCount[0]<=P.totalSideCount[1]){this.multiplyNormals(p,i.bondSpacing);let M=new ze(Ne.add(f,p[1]),Ne.add(c,p[1]),h,d);M.shorten(i.bondLength-i.shortBondLength*i.bondLength),s.drawLine(M),s.drawLine(new ze(f,c,h,d))}}else if(l.bondType==="#"){p[0].multiplyScalar(i.bondSpacing/1.5),p[1].multiplyScalar(i.bondSpacing/1.5);let $=new ze(Ne.add(f,p[0]),Ne.add(c,p[0]),h,d),P=new ze(Ne.add(f,p[1]),Ne.add(c,p[1]),h,d);s.drawLine($),s.drawLine(P),s.drawLine(new ze(f,c,h,d))}else if(l.bondType!=="."){let $=n.value.isStereoCenter,P=u.value.isStereoCenter;l.wedge==="up"?s.drawWedge(new ze(f,c,h,d,$,P)):l.wedge==="down"?s.drawDashedWedge(new ze(f,c,h,d,$,P)):s.drawLine(new ze(f,c,h,d,$,P))}if(t){let $=Ne.midpoint(f,c);s.drawDebugText($.x,$.y,"e: "+e)}}drawAtomHighlights(e){let t=this.preprocessor,r=t.graph,i=this.svgWrapper;for(var s=0;s<r.vertices.length;s++){let n=r.vertices[s],u=n.value;for(var l=0;l<t.highlight_atoms.length;l++){let h=t.highlight_atoms[l];u.class===h[0]&&i.drawAtomHighlight(n.position.x,n.position.y,h[1])}}}drawVertices(e){let t=this.preprocessor,r=t.opts,i=t.graph,s=t.rings,l=this.svgWrapper;for(var n=i.vertices.length,n=0;n<i.vertices.length;n++){let h=i.vertices[n],d=h.value,f=0,c=0,p=h.value.bondCount,w=d.element,$=_h.maxBonds[w]-p,P=h.getTextDirection(i.vertices,d.hasAttachedPseudoElements),M=r.terminalCarbons||w!=="C"||d.hasAttachedPseudoElements?h.isTerminal():!1,B=d.element==="C";if(d.element==="N"&&d.isPartOfAromaticRing&&($=0),d.bracket&&($=d.bracket.hcount,f=d.bracket.charge,c=d.bracket.isotope),(f||c||i.vertices.length<3)&&(B=!1),r.atomVisualization==="allballs")l.drawBall(h.position.x,h.position.y,w);else if(d.isDrawn&&(!B||d.drawExplicit||M||d.hasAttachedPseudoElements)||i.vertices.length===1)if(r.atomVisualization==="default"){let H=d.getAttachedPseudoElements();d.hasAttachedPseudoElements&&i.vertices.length===Object.keys(H).length+1&&(P="right"),l.drawText(h.position.x,h.position.y,w,$,P,M,f,c,i.vertices.length,H)}else r.atomVisualization==="balls"&&l.drawBall(h.position.x,h.position.y,w);else if(h.getNeighbourCount()===2&&h.forcePositioned==!0){let H=i.vertices[h.neighbours[0]].position,E=i.vertices[h.neighbours[1]].position,D=Ne.threePointangle(h.position,H,E);Math.abs(Math.PI-D)<.1&&l.drawPoint(h.position.x,h.position.y,w)}if(e){let H="v: "+h.id+" "+ta.print(d.ringbonds);l.drawDebugText(h.position.x,h.position.y,H)}}if(r.debug)for(var n=0;n<s.length;n++){let h=s[n].center;l.drawDebugPoint(h.x,h.y,"r: "+s[n].id)}}drawWeights(e,t){if(!e||e.every(s=>s===0))return;if(e.length!==this.preprocessor.graph.atomIdxToVertexId.length)throw new Error("The number of weights supplied must be equal to the number of (heavy) atoms in the molecule.");let r=[];for(let s of this.preprocessor.graph.atomIdxToVertexId){let l=this.preprocessor.graph.vertices[s];r.push(new Ne(l.position.x-this.svgWrapper.minX,l.position.y-this.svgWrapper.minY))}let i=new Yh(r,e,this.svgWrapper.drawingWidth,this.svgWrapper.drawingHeight,this.opts.weights.sigma,this.opts.weights.interval,this.opts.weights.colormap,this.opts.weights.opacity,t);i.draw(),this.svgWrapper.addLayer(i.getSVG())}getTotalOverlapScore(){return this.preprocessor.getTotalOverlapScore()}getMolecularFormula(e=null){return this.preprocessor.getMolecularFormula(e)}multiplyNormals(e,t){e[0].multiplyScalar(t),e[1].multiplyScalar(t)}};ra.exports=un});var na=ce((qu,ia)=>{var Uh=fr(),gn=class{constructor(e){this.svgDrawer=new Uh(e)}draw(e,t,r="light",i=!1,s=[]){let l=null,n=null;if(t instanceof String?l=document.getElementById(t.valueOf()):typeof t=="string"?l=document.getElementById(t):l=t,l instanceof HTMLCanvasElement)n=l;else throw Error("First argument was not a canvas or the ID of a canvas.");let u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("xmlns","http://www.w3.org/2000/svg"),u.setAttributeNS(null,"viewBox","0 0 "+this.svgDrawer.opts.width+" "+this.svgDrawer.opts.height),u.setAttributeNS(null,"width",this.svgDrawer.opts.width+""),u.setAttributeNS(null,"height",this.svgDrawer.opts.height+""),this.svgDrawer.draw(e,u,r,null,i,s),this.svgDrawer.svgWrapper.toCanvas(n,this.svgDrawer.opts.width,this.svgDrawer.opts.height)}getTotalOverlapScore(){return this.svgDrawer.getTotalOverlapScore()}getMolecularFormula(){return this.svgDrawer.getMolecularFormula()}};ia.exports=gn});var Xr=ce((_u,sa)=>{sa.exports=function(){"use strict";function k(r,i){function s(){this.constructor=r}s.prototype=i.prototype,r.prototype=new s}function e(r,i,s,l){this.message=r,this.expected=i,this.found=s,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}k(e,Error),e.buildMessage=function(r,i){var s={literal:function(c){return'"'+n(c.text)+'"'},class:function(c){var p="",w;for(w=0;w<c.parts.length;w++)p+=c.parts[w]instanceof Array?u(c.parts[w][0])+"-"+u(c.parts[w][1]):u(c.parts[w]);return"["+(c.inverted?"^":"")+p+"]"},any:function(c){return"any character"},end:function(c){return"end of input"},other:function(c){return c.description}};function l(c){return c.charCodeAt(0).toString(16).toUpperCase()}function n(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+l(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+l(p)})}function u(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(p){return"\\x0"+l(p)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(p){return"\\x"+l(p)})}function h(c){return s[c.type](c)}function d(c){var p=new Array(c.length),w,$;for(w=0;w<c.length;w++)p[w]=h(c[w]);if(p.sort(),p.length>0){for(w=1,$=1;w<p.length;w++)p[w-1]!==p[w]&&(p[$]=p[w],$++);p.length=$}switch(p.length){case 1:return p[0];case 2:return p[0]+" or "+p[1];default:return p.slice(0,-1).join(", ")+", or "+p[p.length-1]}}function f(c){return c?'"'+n(c)+'"':"end of input"}return"Expected "+d(r)+" but "+f(i)+" found."};function t(r,i){i=i!==void 0?i:{};var s=r.split("(").length-1,l=r.split(")").length-1;if(s!==l)throw tr("The number of opening parentheses does not match the number of closing parentheses.",0);var n={},u={chain:Ct},h=Ct,d=function(C){for(var m=[],L=[],N=0;N<C[1].length;N++)m.push(C[1][N]);for(var N=0;N<C[2].length;N++){var F=C[2][N][0]?C[2][N][0]:"-";L.push({bond:F,id:C[2][N][1]})}for(var N=0;N<C[3].length;N++)m.push(C[3][N]);for(var N=0;N<C[6].length;N++)m.push(C[6][N]);return{atom:C[0],isBracket:!!C[0].element,branches:m,branchCount:m.length,ringbonds:L,ringbondCount:L.length,bond:C[4]?C[4]:"-",next:C[5],hasNext:!!C[5]}},f="(",c=me("(",!1),p=")",w=me(")",!1),$=function(C){var m=C[1]?C[1]:"-";return C[2].branchBond=m,C[2]},P=function(C){return C},M=/^[\-=#$:\/\\.]/,B=Je(["-","=","#","$",":","/","\\","."],!1,!1),H=function(C){return C},E="[",D=me("[",!1),V="se",ne=me("se",!1),j="as",Y=me("as",!1),ae="]",pe=me("]",!1),Ke=function(C){return{isotope:C[1],element:C[2],chirality:C[3],hcount:C[4],charge:C[5],class:C[6]}},Le="B",we=me("B",!1),He="r",Xe=me("r",!1),lt="C",ot=me("C",!1),bt="l",be=me("l",!1),Se=/^[NOPSFI]/,ft=Je(["N","O","P","S","F","I"],!1,!1),Et=function(C){return C.length>1?C.join(""):C},Ot=/^[bcnops]/,kt=Je(["b","c","n","o","p","s"],!1,!1),U="*",Ee=me("*",!1),je=function(C){return C},Ve=/^[A-Z]/,et=Je([["A","Z"]],!1,!1),Ye=/^[a-z]/,Ie=Je([["a","z"]],!1,!1),qe=function(C){return C.join("")},Tt="%",Mt=me("%",!1),Re=/^[1-9]/,De=Je([["1","9"]],!1,!1),ke=/^[0-9]/,Ae=Je([["0","9"]],!1,!1),ht=function(C){return C.length==1?Number(C):Number(C.join("").replace("%",""))},wt="@",yt=me("@",!1),ct="TH",St=me("TH",!1),tt=/^[12]/,dt=Je(["1","2"],!1,!1),pt="AL",Lt=me("AL",!1),At="SP",Vr=me("SP",!1),cr=/^[1-3]/,dr=Je([["1","3"]],!1,!1),pr="TB",Yr=me("TB",!1),jt="OH",vr=me("OH",!1),Ur=function(C){return C[1]?C[1]=="@"?"@@":C[1].join("").replace(",",""):"@"},Gr=function(C){return C},mr="+",br=me("+",!1),Zr=function(C){return C[1]?C[1]!="+"?Number(C[1].join("")):2:1},wr="-",yr=me("-",!1),Kr=function(C){return C[1]?C[1]!="-"?-Number(C[1].join("")):-2:-1},Jr="H",Qr=me("H",!1),jr=function(C){return C[1]?Number(C[1]):1},ei=":",ti=me(":",!1),Sr=/^[0]/,Ar=Je(["0"],!1,!1),ri=function(C){return Number(C[1][0]+C[1][1].join(""))},ii=function(C){return Number(C.join(""))},b=0,de=0,Ft=[{line:1,column:1}],Ue=0,er=[],G=0,zt;if("startRule"in i){if(!(i.startRule in u))throw new Error(`Can't start parsing from rule "`+i.startRule+'".');h=u[i.startRule]}function ni(){return r.substring(de,b)}function yn(){return Bt(de,b)}function si(C,m){throw m=m!==void 0?m:Bt(de,b),Nr([ai(C)],r.substring(de,b),m)}function Sn(C,m){throw m=m!==void 0?m:Bt(de,b),tr(C,m)}function me(C,m){return{type:"literal",text:C,ignoreCase:m}}function Je(C,m,L){return{type:"class",parts:C,inverted:m,ignoreCase:L}}function An(){return{type:"any"}}function Cr(){return{type:"end"}}function ai(C){return{type:"other",description:C}}function xr(C){var m=Ft[C],L;if(m)return m;for(L=C-1;!Ft[L];)L--;for(m=Ft[L],m={line:m.line,column:m.column};L<C;)r.charCodeAt(L)===10?(m.line++,m.column=1):m.column++,L++;return Ft[C]=m,m}function Bt(C,m){var L=xr(C),N=xr(m);return{start:{offset:C,line:L.line,column:L.column},end:{offset:m,line:N.line,column:N.column}}}function Z(C){b<Ue||(b>Ue&&(Ue=b,er=[]),er.push(C))}function tr(C,m){return new e(C,null,null,m)}function Nr(C,m,L){return new e(e.buildMessage(C,m),C,m,L)}function Ct(){var C,m,L,N,F,_,K,$e,Qe,it;if(C=b,m=b,L=rr(),L!==n){for(N=[],F=Ge();F!==n;)N.push(F),F=Ge();if(N!==n){for(F=[],_=b,K=rt(),K===n&&(K=null),K!==n?($e=ir(),$e!==n?(K=[K,$e],_=K):(b=_,_=n)):(b=_,_=n);_!==n;)F.push(_),_=b,K=rt(),K===n&&(K=null),K!==n?($e=ir(),$e!==n?(K=[K,$e],_=K):(b=_,_=n)):(b=_,_=n);if(F!==n){for(_=[],K=Ge();K!==n;)_.push(K),K=Ge();if(_!==n)if(K=rt(),K===n&&(K=null),K!==n)if($e=Ct(),$e===n&&($e=null),$e!==n){for(Qe=[],it=Ge();it!==n;)Qe.push(it),it=Ge();Qe!==n?(L=[L,N,F,_,K,$e,Qe],m=L):(b=m,m=n)}else b=m,m=n;else b=m,m=n;else b=m,m=n}else b=m,m=n}else b=m,m=n}else b=m,m=n;return m!==n&&(de=C,m=d(m)),C=m,C}function Ge(){var C,m,L,N,F,_;return C=b,m=b,r.charCodeAt(b)===40?(L=f,b++):(L=n,G===0&&Z(c)),L!==n?(N=rt(),N===n&&(N=null),N!==n?(F=Ct(),F!==n?(r.charCodeAt(b)===41?(_=p,b++):(_=n,G===0&&Z(w)),_!==n?(L=[L,N,F,_],m=L):(b=m,m=n)):(b=m,m=n)):(b=m,m=n)):(b=m,m=n),m!==n&&(de=C,m=$(m)),C=m,C}function rr(){var C,m;return C=b,m=oi(),m===n&&(m=Rr(),m===n&&(m=li(),m===n&&(m=$r()))),m!==n&&(de=C,m=P(m)),C=m,C}function rt(){var C,m;if(C=b,M.test(r.charAt(b))){if(m=r.charAt(b),m===r.charAt(b+1)&&(m=n,G===0))throw tr("The parser encountered a bond repetition.",b+1);b++}else m=n,G===0&&Z(B);return m!==n&&(de=C,m=H(m)),C=m,C}function li(){var C,m,L,N,F,_,K,$e,Qe,it;return C=b,m=b,r.charCodeAt(b)===91?(L=E,b++):(L=n,G===0&&Z(D)),L!==n?(N=Tr(),N===n&&(N=null),N!==n?(r.substr(b,2)===V?(F=V,b+=2):(F=n,G===0&&Z(ne)),F===n&&(r.substr(b,2)===j?(F=j,b+=2):(F=n,G===0&&Z(Y)),F===n&&(F=Rr(),F===n&&(F=hi(),F===n&&(F=$r())))),F!==n?(_=Er(),_===n&&(_=null),_!==n?(K=ci(),K===n&&(K=null),K!==n?($e=ui(),$e===n&&($e=null),$e!==n?(Qe=kr(),Qe===n&&(Qe=null),Qe!==n?(r.charCodeAt(b)===93?(it=ae,b++):(it=n,G===0&&Z(pe)),it!==n?(L=[L,N,F,_,K,$e,Qe,it],m=L):(b=m,m=n)):(b=m,m=n)):(b=m,m=n)):(b=m,m=n)):(b=m,m=n)):(b=m,m=n)):(b=m,m=n)):(b=m,m=n),m!==n&&(de=C,m=Ke(m)),C=m,C}function oi(){var C,m,L,N;return C=b,m=b,r.charCodeAt(b)===66?(L=Le,b++):(L=n,G===0&&Z(we)),L!==n?(r.charCodeAt(b)===114?(N=He,b++):(N=n,G===0&&Z(Xe)),N===n&&(N=null),N!==n?(L=[L,N],m=L):(b=m,m=n)):(b=m,m=n),m===n&&(m=b,r.charCodeAt(b)===67?(L=lt,b++):(L=n,G===0&&Z(ot)),L!==n?(r.charCodeAt(b)===108?(N=bt,b++):(N=n,G===0&&Z(be)),N===n&&(N=null),N!==n?(L=[L,N],m=L):(b=m,m=n)):(b=m,m=n),m===n&&(Se.test(r.charAt(b))?(m=r.charAt(b),b++):(m=n,G===0&&Z(ft)))),m!==n&&(de=C,m=Et(m)),C=m,C}function Rr(){var C,m;return C=b,Ot.test(r.charAt(b))?(m=r.charAt(b),b++):(m=n,G===0&&Z(kt)),m!==n&&(de=C,m=P(m)),C=m,C}function $r(){var C,m;return C=b,r.charCodeAt(b)===42?(m=U,b++):(m=n,G===0&&Z(Ee)),m!==n&&(de=C,m=je(m)),C=m,C}function hi(){var C,m,L,N;return C=b,m=b,Ve.test(r.charAt(b))?(L=r.charAt(b),b++):(L=n,G===0&&Z(et)),L!==n?(Ye.test(r.charAt(b))?(N=r.charAt(b),b++):(N=n,G===0&&Z(Ie)),N===n&&(N=null),N!==n?(L=[L,N],m=L):(b=m,m=n)):(b=m,m=n),m!==n&&(de=C,m=qe(m)),C=m,C}function ir(){var C,m,L,N,F;return C=b,m=b,r.charCodeAt(b)===37?(L=Tt,b++):(L=n,G===0&&Z(Mt)),L!==n?(Re.test(r.charAt(b))?(N=r.charAt(b),b++):(N=n,G===0&&Z(De)),N!==n?(ke.test(r.charAt(b))?(F=r.charAt(b),b++):(F=n,G===0&&Z(Ae)),F!==n?(L=[L,N,F],m=L):(b=m,m=n)):(b=m,m=n)):(b=m,m=n),m===n&&(ke.test(r.charAt(b))?(m=r.charAt(b),b++):(m=n,G===0&&Z(Ae))),m!==n&&(de=C,m=ht(m)),C=m,C}function Er(){var C,m,L,N,F,_,K;return C=b,m=b,r.charCodeAt(b)===64?(L=wt,b++):(L=n,G===0&&Z(yt)),L!==n?(r.charCodeAt(b)===64?(N=wt,b++):(N=n,G===0&&Z(yt)),N===n&&(N=b,r.substr(b,2)===ct?(F=ct,b+=2):(F=n,G===0&&Z(St)),F!==n?(tt.test(r.charAt(b))?(_=r.charAt(b),b++):(_=n,G===0&&Z(dt)),_!==n?(F=[F,_],N=F):(b=N,N=n)):(b=N,N=n),N===n&&(N=b,r.substr(b,2)===pt?(F=pt,b+=2):(F=n,G===0&&Z(Lt)),F!==n?(tt.test(r.charAt(b))?(_=r.charAt(b),b++):(_=n,G===0&&Z(dt)),_!==n?(F=[F,_],N=F):(b=N,N=n)):(b=N,N=n),N===n&&(N=b,r.substr(b,2)===At?(F=At,b+=2):(F=n,G===0&&Z(Vr)),F!==n?(cr.test(r.charAt(b))?(_=r.charAt(b),b++):(_=n,G===0&&Z(dr)),_!==n?(F=[F,_],N=F):(b=N,N=n)):(b=N,N=n),N===n&&(N=b,r.substr(b,2)===pr?(F=pr,b+=2):(F=n,G===0&&Z(Yr)),F!==n?(Re.test(r.charAt(b))?(_=r.charAt(b),b++):(_=n,G===0&&Z(De)),_!==n?(ke.test(r.charAt(b))?(K=r.charAt(b),b++):(K=n,G===0&&Z(Ae)),K===n&&(K=null),K!==n?(F=[F,_,K],N=F):(b=N,N=n)):(b=N,N=n)):(b=N,N=n),N===n&&(N=b,r.substr(b,2)===jt?(F=jt,b+=2):(F=n,G===0&&Z(vr)),F!==n?(Re.test(r.charAt(b))?(_=r.charAt(b),b++):(_=n,G===0&&Z(De)),_!==n?(ke.test(r.charAt(b))?(K=r.charAt(b),b++):(K=n,G===0&&Z(Ae)),K===n&&(K=null),K!==n?(F=[F,_,K],N=F):(b=N,N=n)):(b=N,N=n)):(b=N,N=n)))))),N===n&&(N=null),N!==n?(L=[L,N],m=L):(b=m,m=n)):(b=m,m=n),m!==n&&(de=C,m=Ur(m)),C=m,C}function ui(){var C,m;return C=b,m=gi(),m===n&&(m=fi()),m!==n&&(de=C,m=Gr(m)),C=m,C}function gi(){var C,m,L,N,F,_;return C=b,m=b,r.charCodeAt(b)===43?(L=mr,b++):(L=n,G===0&&Z(br)),L!==n?(r.charCodeAt(b)===43?(N=mr,b++):(N=n,G===0&&Z(br)),N===n&&(N=b,Re.test(r.charAt(b))?(F=r.charAt(b),b++):(F=n,G===0&&Z(De)),F!==n?(ke.test(r.charAt(b))?(_=r.charAt(b),b++):(_=n,G===0&&Z(Ae)),_===n&&(_=null),_!==n?(F=[F,_],N=F):(b=N,N=n)):(b=N,N=n)),N===n&&(N=null),N!==n?(L=[L,N],m=L):(b=m,m=n)):(b=m,m=n),m!==n&&(de=C,m=Zr(m)),C=m,C}function fi(){var C,m,L,N,F,_;return C=b,m=b,r.charCodeAt(b)===45?(L=wr,b++):(L=n,G===0&&Z(yr)),L!==n?(r.charCodeAt(b)===45?(N=wr,b++):(N=n,G===0&&Z(yr)),N===n&&(N=b,Re.test(r.charAt(b))?(F=r.charAt(b),b++):(F=n,G===0&&Z(De)),F!==n?(ke.test(r.charAt(b))?(_=r.charAt(b),b++):(_=n,G===0&&Z(Ae)),_===n&&(_=null),_!==n?(F=[F,_],N=F):(b=N,N=n)):(b=N,N=n)),N===n&&(N=null),N!==n?(L=[L,N],m=L):(b=m,m=n)):(b=m,m=n),m!==n&&(de=C,m=Kr(m)),C=m,C}function ci(){var C,m,L,N;return C=b,m=b,r.charCodeAt(b)===72?(L=Jr,b++):(L=n,G===0&&Z(Qr)),L!==n?(ke.test(r.charAt(b))?(N=r.charAt(b),b++):(N=n,G===0&&Z(Ae)),N===n&&(N=null),N!==n?(L=[L,N],m=L):(b=m,m=n)):(b=m,m=n),m!==n&&(de=C,m=jr(m)),C=m,C}function kr(){var C,m,L,N,F,_,K;if(C=b,m=b,r.charCodeAt(b)===58?(L=ei,b++):(L=n,G===0&&Z(ti)),L!==n){if(N=b,Re.test(r.charAt(b))?(F=r.charAt(b),b++):(F=n,G===0&&Z(De)),F!==n){for(_=[],ke.test(r.charAt(b))?(K=r.charAt(b),b++):(K=n,G===0&&Z(Ae));K!==n;)_.push(K),ke.test(r.charAt(b))?(K=r.charAt(b),b++):(K=n,G===0&&Z(Ae));_!==n?(F=[F,_],N=F):(b=N,N=n)}else b=N,N=n;N===n&&(Sr.test(r.charAt(b))?(N=r.charAt(b),b++):(N=n,G===0&&Z(Ar))),N!==n?(L=[L,N],m=L):(b=m,m=n)}else b=m,m=n;return m!==n&&(de=C,m=ri(m)),C=m,C}function Tr(){var C,m,L,N,F;return C=b,m=b,Re.test(r.charAt(b))?(L=r.charAt(b),b++):(L=n,G===0&&Z(De)),L!==n?(ke.test(r.charAt(b))?(N=r.charAt(b),b++):(N=n,G===0&&Z(Ae)),N===n&&(N=null),N!==n?(ke.test(r.charAt(b))?(F=r.charAt(b),b++):(F=n,G===0&&Z(Ae)),F===n&&(F=null),F!==n?(L=[L,N,F],m=L):(b=m,m=n)):(b=m,m=n)):(b=m,m=n),m!==n&&(de=C,m=ii(m)),C=m,C}if(zt=h(),zt!==n&&b===r.length)return zt;throw zt!==n&&b<r.length&&Z(Cr()),Nr(er,Ue<r.length?r.charAt(Ue):null,Ue<r.length?Bt(Ue,Ue+1):Bt(Ue,Ue))}return{SyntaxError:e,parse:t}}()});var la=ce((Wu,aa)=>{var fn=Xr(),cn=class{constructor(e){this.reactantsSmiles=[],this.reagentsSmiles=[],this.productsSmiles=[],this.reactantsWeights=[],this.reagentsWeights=[],this.productsWeights=[],this.reactants=[],this.reagents=[],this.products=[];let t=e.split(">");if(t.length!==3)throw new Error("Invalid reaction SMILES. Did you add fewer than or more than two '>'?");t[0]!==""&&(this.reactantsSmiles=t[0].split(".")),t[1]!==""&&(this.reagentsSmiles=t[1].split(".")),t[2]!==""&&(this.productsSmiles=t[2].split("."));for(var r=0;r<this.reactantsSmiles.length;r++)this.reactants.push(fn.parse(this.reactantsSmiles[r]));for(var r=0;r<this.reagentsSmiles.length;r++)this.reagents.push(fn.parse(this.reagentsSmiles[r]));for(var r=0;r<this.productsSmiles.length;r++)this.products.push(fn.parse(this.productsSmiles[r]))}};aa.exports=cn});var pn=ce((Xu,oa)=>{var Gh=la(),dn=class{static parse(e){return new Gh(e)}};oa.exports=dn});var ua=ce((Vu,ha)=>{var Zh={C2H4O2:"acetic acid",C3H6O:"acetone",C2H3N:"acetonitrile",C6H6:"benzene",CCl4:"carbon tetrachloride",C6H5Cl:"chlorobenzene",CHCl3:"chloroform",C6H12:"cyclohexane",C2H4Cl2:"1,2-dichloroethane",C4H10O3:"diethylene glycol",C6H14O3:"diglyme",C4H10O2:"DME",C3H7NO:"DMF",C2H6OS:"DMSO",C2H6O:"ethanol",C2H6O2:"ethylene glycol",C3H8O3:"glycerin",C7H16:"heptane",C6H18N3OP:"HMPA",C6H18N3P:"HMPT",C6H14:"hexane",CH4O:"methanol",C5H12O:"MTBE",CH2Cl2:"methylene chloride",CH5H9NO:"NMP",CH3NO2:"nitromethane",C5H12:"pentane",C5H5N:"pyridine",C7H8:"toluene",C6H15N:"triethyl amine",H2O:"water"};ha.exports=Zh});var bn=ce((Yu,fa)=>{var Kh=fr(),vn=Wr(),Jh=Hr(),Qh=gr(),ga=ua(),mn=class{constructor(e,t){this.defaultOptions={scale:t.scale>0?t.scale:1,fontSize:t.fontSizeLarge*.8,fontFamily:"Arial, Helvetica, sans-serif",spacing:10,plus:{size:9,thickness:1},arrow:{length:t.bondLength*4,headSize:6,thickness:1,margin:3},weights:{normalize:!1}},this.opts=Jh.extend(!0,this.defaultOptions,e),this.drawer=new Kh(t),this.molOpts=this.drawer.opts}draw(e,t,r="light",i=null,s="{reagents}",l="",n=!1){if(this.themeManager=new Qh(this.molOpts.themes,r),this.opts.weights.normalize){let M=-Number.MAX_SAFE_INTEGER,B=Number.MAX_SAFE_INTEGER;if(i.hasOwnProperty("reactants"))for(let E=0;E<i.reactants.length;E++)for(let D=0;D<i.reactants[E].length;D++)i.reactants[E][D]<B&&(B=i.reactants[E][D]),i.reactants[E][D]>M&&(M=i.reactants[E][D]);if(i.hasOwnProperty("reagents"))for(let E=0;E<i.reagents.length;E++)for(let D=0;D<i.reagents[E].length;D++)i.reagents[E][D]<B&&(B=i.reagents[E][D]),i.reagents[E][D]>M&&(M=i.reagents[E][D]);if(i.hasOwnProperty("products"))for(let E=0;E<i.products.length;E++)for(let D=0;D<i.products[E].length;D++)i.products[E][D]<B&&(B=i.products[E][D]),i.products[E][D]>M&&(M=i.products[E][D]);let H=Math.max(Math.abs(B),Math.abs(M));if(H===0&&(H=1),i.hasOwnProperty("reactants"))for(let E=0;E<i.reactants.length;E++)for(let D=0;D<i.reactants[E].length;D++)i.reactants[E][D]/=H;if(i.hasOwnProperty("reagents"))for(let E=0;E<i.reagents.length;E++)for(let D=0;D<i.reagents[E].length;D++)i.reagents[E][D]/=H;if(i.hasOwnProperty("products"))for(let E=0;E<i.products.length;E++)for(let D=0;D<i.products[E].length;D++)i.products[E][D]/=H}let u=null;for(t===null||t==="svg"?(u=document.createElementNS("http://www.w3.org/2000/svg","svg"),u.setAttribute("xmlns","http://www.w3.org/2000/svg"),u.setAttributeNS(null,"width","500"),u.setAttributeNS(null,"height","500")):typeof t=="string"||t instanceof String?u=document.getElementById(t):u=t;u.firstChild;)u.removeChild(u.firstChild);let h=[],d=0;for(var f=0;f<e.reactants.length;f++){f>0&&h.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let M=null;i&&i.hasOwnProperty("reactants")&&i.reactants.length>f&&(M=i.reactants[f]);let B=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.reactants[f],B,r,M,n,[],this.opts.weights.normalize);let H={width:B.viewBox.baseVal.width*this.opts.scale,height:B.viewBox.baseVal.height*this.opts.scale,svg:B};h.push(H),H.height>d&&(d=H.height)}h.push({width:this.opts.arrow.length*this.opts.scale,height:this.opts.arrow.headSize*2*this.opts.scale,svg:this.getArrow()});let c="";for(var f=0;f<e.reagents.length;f++){f>0&&(c+=", ");let B=this.drawer.getMolecularFormula(e.reagents[f]);B in ga&&(B=ga[B]),c+=vn.replaceNumbersWithSubscript(B)}s=s.replace("{reagents}",c);let p=vn.writeText(s,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale),w=(this.opts.arrow.length*this.opts.scale-p.width)/2;h.push({svg:p.svg,height:p.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+w,offsetY:-(p.height/2)-this.opts.arrow.margin,position:"relative"});let $=vn.writeText(l,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale);w=(this.opts.arrow.length*this.opts.scale-$.width)/2,h.push({svg:$.svg,height:$.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+w,offsetY:$.height/2+this.opts.arrow.margin,position:"relative"});for(var f=0;f<e.products.length;f++){f>0&&h.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let B=null;i&&i.hasOwnProperty("products")&&i.products.length>f&&(B=i.products[f]);let H=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.products[f],H,r,B,n,[],this.opts.weights.normalize);let E={width:H.viewBox.baseVal.width*this.opts.scale,height:H.viewBox.baseVal.height*this.opts.scale,svg:H};h.push(E),E.height>d&&(d=E.height)}let P=0;return h.forEach(M=>{let B=M.offsetX||0,H=M.offsetY||0;M.svg.setAttributeNS(null,"x",Math.round(P+B)),M.svg.setAttributeNS(null,"y",Math.round((d-M.height)/2+H)),M.svg.setAttributeNS(null,"width",Math.round(M.width)),M.svg.setAttributeNS(null,"height",Math.round(M.height)),u.appendChild(M.svg),M.position!=="relative"&&(P+=Math.round(M.width+this.opts.spacing+B))}),u.setAttributeNS(null,"viewBox",`0 0 ${P} ${d}`),u.style.width=P+"px",u.style.height=d+"px",u}getPlus(){let e=this.opts.plus.size,t=this.opts.plus.thickness,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","rect"),s=document.createElementNS("http://www.w3.org/2000/svg","rect");return r.setAttributeNS(null,"id","plus"),i.setAttributeNS(null,"x",0),i.setAttributeNS(null,"y",e/2-t/2),i.setAttributeNS(null,"width",e),i.setAttributeNS(null,"height",t),i.setAttributeNS(null,"fill",this.themeManager.getColor("C")),s.setAttributeNS(null,"x",e/2-t/2),s.setAttributeNS(null,"y",0),s.setAttributeNS(null,"width",t),s.setAttributeNS(null,"height",e),s.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.appendChild(i),r.appendChild(s),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),r}getArrowhead(){let e=this.opts.arrow.headSize,t=document.createElementNS("http://www.w3.org/2000/svg","marker"),r=document.createElementNS("http://www.w3.org/2000/svg","polygon");return t.setAttributeNS(null,"id","arrowhead"),t.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),t.setAttributeNS(null,"markerUnits","userSpaceOnUse"),t.setAttributeNS(null,"markerWidth",e),t.setAttributeNS(null,"markerHeight",e),t.setAttributeNS(null,"refX",0),t.setAttributeNS(null,"refY",e/2),t.setAttributeNS(null,"orient","auto"),t.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.setAttributeNS(null,"points",`0 0, ${e} ${e/2}, 0 ${e}`),t.appendChild(r),t}getCDArrowhead(){let e=this.opts.arrow.headSize,t=e*(7/4.5),r=document.createElementNS("http://www.w3.org/2000/svg","marker"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttributeNS(null,"id","arrowhead"),r.setAttributeNS(null,"viewBox",`0 0 ${t} ${e}`),r.setAttributeNS(null,"markerUnits","userSpaceOnUse"),r.setAttributeNS(null,"markerWidth",t*2),r.setAttributeNS(null,"markerHeight",e*2),r.setAttributeNS(null,"refX",2.2),r.setAttributeNS(null,"refY",2.2),r.setAttributeNS(null,"orient","auto"),r.setAttributeNS(null,"fill",this.themeManager.getColor("C")),i.setAttributeNS(null,"style","fill-rule:nonzero;"),i.setAttributeNS(null,"d","m 0 0 l 7 2.25 l -7 2.25 c 0 0 0.735 -1.084 0.735 -2.28 c 0 -1.196 -0.735 -2.22 -0.735 -2.22 z"),r.appendChild(i),r}getArrow(){let e=this.opts.arrow.headSize,t=this.opts.arrow.length,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","defs"),s=document.createElementNS("http://www.w3.org/2000/svg","line");return i.appendChild(this.getCDArrowhead()),r.appendChild(i),r.setAttributeNS(null,"id","arrow"),s.setAttributeNS(null,"x1",0),s.setAttributeNS(null,"y1",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"x2",t),s.setAttributeNS(null,"y2",-this.opts.arrow.thickness/2),s.setAttributeNS(null,"stroke-width",this.opts.arrow.thickness),s.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),s.setAttributeNS(null,"marker-end","url(#arrowhead)"),r.appendChild(s),r.setAttributeNS(null,"viewBox",`0 ${-e/2} ${t+e*(7/4.5)} ${e}`),r}};fa.exports=mn});var pa=ce((Uu,da)=>{var jh=Xr(),eu=pn(),tu=fr(),ru=bn(),ca=Wr(),iu=Hr(),wn=class k{constructor(e={},t={}){this.drawer=new tu(e),this.reactionDrawer=new ru(t,JSON.parse(JSON.stringify(this.drawer.opts)))}static apply(e={},t={},r="data-smiles",i="light",s=null,l=null){new k(e,t).apply(r,i,s,l)}apply(e="data-smiles",t="light",r=null,i=null){document.querySelectorAll(`[${e}]`).forEach(l=>{let n=l.getAttribute(e);if(n===null)throw Error("No SMILES provided.");let u=t,h=null;if(l.hasAttribute("data-smiles-theme")&&(u=l.getAttribute("data-smiles-theme")),l.hasAttribute("data-smiles-weights")&&(h=l.getAttribute("data-smiles-weights").split(",").map(parseFloat)),(l.hasAttribute("data-smiles-reactant-weights")||l.hasAttribute("data-smiles-reagent-weights")||l.hasAttribute("data-smiles-product-weights"))&&(h={reactants:[],reagents:[],products:[]},l.hasAttribute("data-smiles-reactant-weights")&&(h.reactants=l.getAttribute("data-smiles-reactant-weights").split(";").map(d=>d.split(",").map(parseFloat))),l.hasAttribute("data-smiles-reagent-weights")&&(h.reagents=l.getAttribute("data-smiles-reagent-weights").split(";").map(d=>d.split(",").map(parseFloat))),l.hasAttribute("data-smiles-product-weights")&&(h.products=l.getAttribute("data-smiles-product-weights").split(";").map(d=>d.split(",").map(parseFloat)))),l.hasAttribute("data-smiles-options")||l.hasAttribute("data-smiles-reaction-options")){let d={};l.hasAttribute("data-smiles-options")&&(d=JSON.parse(l.getAttribute("data-smiles-options").replace(/'/g,'"')));let f={};l.hasAttribute("data-smiles-reaction-options")&&(f=JSON.parse(l.getAttribute("data-smiles-reaction-options").replace(/'/g,'"'))),new k(d,f).draw(n,l,u,r,i,h)}else this.draw(n,l,u,r,i,h)})}draw(e,t,r="light",i=null,s=null,l=null){let n=[];[e,...n]=e.split(" ");let u=n.join(" "),h={};if(u.includes("__")){let f=u.substring(u.indexOf("__")+2,u.lastIndexOf("__"));h=JSON.parse(f.replace(/'/g,'"'))}let d={textAboveArrow:"{reagents}",textBelowArrow:""};if(h=iu.extend(!0,d,h),e.includes(">"))try{this.drawReaction(e,t,r,h,l,i)}catch(f){s?s(f):console.error(f)}else try{this.drawMolecule(e,t,r,l,i)}catch(f){s?s(f):console.error(f)}}drawMolecule(e,t,r,i,s){let l=jh.parse(e);if(t===null||t==="svg"){let n=this.drawer.draw(l,null,r,i),u=this.getDimensions(n);n.setAttributeNS(null,"width",""+u.w),n.setAttributeNS(null,"height",""+u.h),s&&s(n)}else if(t==="canvas"){let n=this.svgToCanvas(this.drawer.draw(l,null,r,i));s&&s(n)}else if(t==="img"){let n=this.svgToImg(this.drawer.draw(l,null,r,i));s&&s(n)}else t instanceof HTMLImageElement?(this.svgToImg(this.drawer.draw(l,null,r,i),t),s&&s(t)):t instanceof SVGElement?(this.drawer.draw(l,t,r,i),s&&s(t)):document.querySelectorAll(t).forEach(u=>{let h=u.nodeName.toLowerCase();h==="svg"?(this.drawer.draw(l,u,r,i),s&&s(u)):h==="canvas"?(this.svgToCanvas(this.drawer.draw(l,null,r,i),u),s&&s(u)):h==="img"&&(this.svgToImg(this.drawer.draw(l,null,r,i),u),s&&s(u))})}drawReaction(e,t,r,i,s,l){let n=eu.parse(e);if(t===null||t==="svg"){let u=this.reactionDrawer.draw(n,null,r),h=this.getDimensions(u);u.setAttributeNS(null,"width",""+h.w),u.setAttributeNS(null,"height",""+h.h),l&&l(u)}else if(t==="canvas"){let u=this.svgToCanvas(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow));l&&l(u)}else if(t==="img"){let u=this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow));l&&l(u)}else t instanceof HTMLImageElement?(this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),t),l&&l(t)):t instanceof SVGElement?(this.reactionDrawer.draw(n,t,r,s,i.textAboveArrow,i.textBelowArrow),l&&l(t)):document.querySelectorAll(t).forEach(h=>{let d=h.nodeName.toLowerCase();d==="svg"?(this.reactionDrawer.draw(n,h,r,s,i.textAboveArrow,i.textBelowArrow),this.reactionDrawer.opts.scale<=0&&(h.style.width=null,h.style.height=null),l&&l(h)):d==="canvas"?(this.svgToCanvas(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),h),l&&l(h)):d==="img"&&(this.svgToImg(this.reactionDrawer.draw(n,null,r,s,i.textAboveArrow,i.textBelowArrow),h),l&&l(h))})}svgToCanvas(e,t=null){t===null&&(t=document.createElement("canvas"));let r=this.getDimensions(t,e);return ca.svgToCanvas(e,t,r.w,r.h),t}svgToImg(e,t=null){t===null&&(t=document.createElement("img"));let r=this.getDimensions(t,e);return ca.svgToImg(e,t,r.w,r.h),t}getDimensions(e,t=null){let r=this.drawer.opts.width,i=this.drawer.opts.height;return this.drawer.opts.scale<=0?(r===null&&(r=e.width),i===null&&(i=e.height),e.style.width!==""&&(r=parseInt(e.style.width)),e.style.height!==""&&(i=parseInt(e.style.height))):t&&(r=parseFloat(t.style.width),i=parseFloat(t.style.height)),{w:r,h:i}}};da.exports=wn});var ou=ce((Gu,ya)=>{var va=na(),ma=Xr(),ba=pn(),nu=fr(),su=bn(),wa=pa(),au=hn(),lu=!!(typeof window<"u"&&window.document&&window.document.createElement),We={Version:"2.2.0"};We.Drawer=va;We.Parser=ma;We.SvgDrawer=nu;We.ReactionDrawer=su;We.ReactionParser=ba;We.GaussDrawer=au;We.clean=function(k){return k.replace(/[^A-Za-z0-9@\.\+\-\?!\(\)\[\]\{\}/\\=#\$:\*]/g,"")};We.apply=function(k,e="canvas[data-smiles]",t="light",r=null){let i=new va(k),s=document.querySelectorAll(e);for(var l=0;l<s.length;l++){let n=s[l];We.parse(n.getAttribute("data-smiles"),function(u){i.draw(u,n,t,!1)},function(u){r&&r(u)})}};We.parse=function(k,e,t){try{e&&e(ma.parse(k))}catch(r){t&&t(r)}};We.parseReaction=function(k,e,t){try{e&&e(ba.parse(k))}catch(r){t&&t(r)}};lu&&(window.SmilesDrawer=We,window.SmiDrawer=wa);We.SmiDrawer=wa;Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(k){if(this==null)throw new TypeError("this is null or not defined");for(var e=Object(this),t=e.length>>>0,r=arguments[1],i=r>>0,s=i<0?Math.max(t+i,0):Math.min(i,t),l=arguments[2],n=l===void 0?t:l>>0,u=n<0?Math.max(t+n,0):Math.min(n,t);s<u;)e[s]=k,s++;return e}});ya.exports=We});ou();})();
/*! Bundled license information:

chroma-js/chroma.js:
  (**
   * chroma.js - JavaScript library for color conversions
   *
   * Copyright (c) 2011-2019, Gregor Aisch
   * All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   *
   * 1. Redistributions of source code must retain the above copyright notice, this
   * list of conditions and the following disclaimer.
   *
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   * this list of conditions and the following disclaimer in the documentation
   * and/or other materials provided with the distribution.
   *
   * 3. The name Gregor Aisch may not be used to endorse or promote products
   * derived from this software without specific prior written permission.
   *
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
   * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
   * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   *
   * -------------------------------------------------------
   *
   * chroma.js includes colors from colorbrewer2.org, which are released under
   * the following license:
   *
   * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
   * and The Pennsylvania State University.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing,
   * software distributed under the License is distributed on an
   * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
   * either express or implied. See the License for the specific
   * language governing permissions and limitations under the License.
   *
   * ------------------------------------------------------
   *
   * Named colors are taken from X11 Color Names.
   * http://www.w3.org/TR/css3-color/#svg-color
   *
   * @preserve
   *)
*/
//# sourceMappingURL=smiles-drawer.min.js.map
