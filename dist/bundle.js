(()=>{var ss=Object.create;var Ji=Object.defineProperty;var as=Object.getOwnPropertyDescriptor;var ls=Object.getOwnPropertyNames;var os=Object.getPrototypeOf,hs=Object.prototype.hasOwnProperty;var me=(M,e)=>()=>(e||M((e={exports:{}}).exports,e),e.exports);var gs=(M,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ls(e))!hs.call(M,i)&&i!==t&&Ji(M,i,{get:()=>e[i],enumerable:!(r=as(e,i))||r.enumerable});return M};var I=(M,e,t)=>(t=M!=null?ss(os(M)):{},gs(e||!M||!M.__esModule?Ji(t,"default",{value:M,enumerable:!0}):t,M));var lt=me((Us,Qi)=>{var gi=class M{static clone(e){let t=Array.isArray(e)?Array():{};for(let r in e){let i=e[r];typeof i.clone=="function"?t[r]=i.clone():t[r]=typeof i=="object"?M.clone(i):i}return t}static equals(e,t){if(e.length!==t.length)return!1;let r=e.slice().sort(),i=t.slice().sort();for(var a=0;a<r.length;a++)if(r[a]!==i[a])return!1;return!0}static print(e){if(e.length==0)return"";let t="(";for(let r=0;r<e.length;r++)t+=e[r].id?e[r].id+", ":e[r]+", ";return t=t.substring(0,t.length-2),t+")"}static each(e,t){for(let r=0;r<e.length;r++)t(e[r])}static get(e,t,r){for(let i=0;i<e.length;i++)if(e[i][t]==r)return e[i]}static contains(e,t){if(!t.property&&!t.func){for(let r=0;r<e.length;r++)if(e[r]==t.value)return!0}else if(t.func){for(let r=0;r<e.length;r++)if(t.func(e[r]))return!0}else for(let r=0;r<e.length;r++)if(e[r][t.property]==t.value)return!0;return!1}static intersection(e,t){let r=new Array;for(let i=0;i<e.length;i++)for(let a=0;a<t.length;a++)e[i]===t[a]&&r.push(e[i]);return r}static unique(e){let t={};return e.filter(function(r){return t[r]!==void 0?!1:t[r]=!0})}static count(e,t){let r=0;for(let i=0;i<e.length;i++)e[i]===t&&r++;return r}static toggle(e,t){let r=Array(),i=!1;for(let a=0;a<e.length;a++)e[a]!==t?r.push(e[a]):i=!0;return i||r.push(t),r}static remove(e,t){let r=Array();for(let i=0;i<e.length;i++)e[i]!==t&&r.push(e[i]);return r}static removeUnique(e,t){let r=e.indexOf(t);return r>-1&&e.splice(r,1),e}static removeAll(e,t){return e.filter(function(r){return t.indexOf(r)===-1})}static merge(e,t){let r=new Array(e.length+t.length);for(let i=0;i<e.length;i++)r[i]=e[i];for(let i=0;i<t.length;i++)r[e.length+i]=t[i];return r}static containsAll(e,t){let r=0;for(let i=0;i<e.length;i++)for(let a=0;a<t.length;a++)e[i]===t[a]&&r++;return r===t.length}static sortByAtomicNumberDesc(e){let t=e.map(function(r,i){return{index:i,value:r.atomicNumber.split(".").map(Number)}});return t.sort(function(r,i){let a=Math.min(i.value.length,r.value.length),l=0;for(;l<a&&i.value[l]===r.value[l];)l++;return l===a?i.value.length-r.value.length:i.value[l]-r.value[l]}),t.map(function(r){return e[r.index]})}static deepCopy(e){let t=Array();for(let r=0;r<e.length;r++){let i=e[r];i instanceof Array?t[r]=M.deepCopy(i):t[r]=i}return t}};Qi.exports=gi});var ot=me((Gs,ji)=>{var ui=class M{static round(e,t){return t=t||1,+(Math.round(e+"e"+t)+"e-"+t)}static meanAngle(e){let t=0,r=0;for(var i=0;i<e.length;i++)t+=Math.sin(e[i]),r+=Math.cos(e[i]);return Math.atan2(t/e.length,r/e.length)}static innerAngle(e){return M.toRad((e-2)*180/e)}static polyCircumradius(e,t){return e/(2*Math.sin(Math.PI/t))}static apothem(e,t){return e*Math.cos(Math.PI/t)}static apothemFromSideLength(e,t){let r=M.polyCircumradius(e,t);return M.apothem(r,t)}static centralAngle(e){return M.toRad(360/e)}static toDeg(e){return e*M.degFactor}static toRad(e){return e*M.radFactor}static parityOfPermutation(e){let t=new Uint8Array(e.length),r=0,i=function(l,n=0){return t[l]===1?n:(n++,t[l]=1,i(e[l],n))};for(var a=0;a<e.length;a++){if(t[a]===1)continue;let l=i(a);r+=1-l%2}return r%2?-1:1}static get radFactor(){return Math.PI/180}static get degFactor(){return 180/Math.PI}static get twoPI(){return 2*Math.PI}};ji.exports=ui});var Ge=me((Zs,en)=>{var fi=class M{constructor(e,t){arguments.length==0?(this.x=0,this.y=0):arguments.length==1?(this.x=e.x,this.y=e.y):(this.x=e,this.y=t)}clone(){return new M(this.x,this.y)}toString(){return"("+this.x+","+this.y+")"}add(e){return this.x+=e.x,this.y+=e.y,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}divide(e){return this.x/=e,this.y/=e,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}invert(){return this.x=-this.x,this.y=-this.y,this}angle(){return Math.atan2(this.y,this.x)}distance(e){return Math.sqrt((e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y))}distanceSq(e){return(e.x-this.x)*(e.x-this.x)+(e.y-this.y)*(e.y-this.y)}clockwise(e){let t=this.y*e.x,r=this.x*e.y;return t>r?-1:t===r?0:1}relativeClockwise(e,t){let r=(this.y-e.y)*(t.x-e.x),i=(this.x-e.x)*(t.y-e.y);return r>i?-1:r===i?0:1}rotate(e){let t=new M(0,0),r=Math.cos(e),i=Math.sin(e);return t.x=this.x*r-this.y*i,t.y=this.x*i+this.y*r,this.x=t.x,this.y=t.y,this}rotateAround(e,t){let r=Math.sin(e),i=Math.cos(e);this.x-=t.x,this.y-=t.y;let a=this.x*i-this.y*r,l=this.x*r+this.y*i;return this.x=a+t.x,this.y=l+t.y,this}rotateTo(e,t,r=0){this.x+=.001,this.y-=.001;let i=M.subtract(this,t),a=M.subtract(e,t),l=M.angle(a,i);return this.rotateAround(l+r,t),this}rotateAwayFrom(e,t,r){this.rotateAround(r,t);let i=this.distanceSq(e);this.rotateAround(-2*r,t),this.distanceSq(e)<i&&this.rotateAround(2*r,t)}getRotateAwayFromAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let a=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)<a?r:-r}getRotateTowardsAngle(e,t,r){let i=this.clone();i.rotateAround(r,t);let a=i.distanceSq(e);return i.rotateAround(-2*r,t),i.distanceSq(e)>a?r:-r}getRotateToAngle(e,t){let r=M.subtract(this,t),i=M.subtract(e,t),a=M.angle(i,r);return Number.isNaN(a)?0:a}isInPolygon(e){let t=!1;for(let r=0,i=e.length-1;r<e.length;i=r++)e[r].y>this.y!=e[i].y>this.y&&this.x<(e[i].x-e[r].x)*(this.y-e[r].y)/(e[i].y-e[r].y)+e[r].x&&(t=!t);return t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSq(){return this.x*this.x+this.y*this.y}normalize(){return this.divide(this.length()),this}normalized(){return M.divideScalar(this,this.length())}whichSide(e,t){return(this.x-e.x)*(t.y-e.y)-(this.y-e.y)*(t.x-e.x)}sameSideAs(e,t,r){let i=this.whichSide(e,t),a=r.whichSide(e,t);return i<0&&a<0||i==0&&a==0||i>0&&a>0}static add(e,t){return new M(e.x+t.x,e.y+t.y)}static subtract(e,t){return new M(e.x-t.x,e.y-t.y)}static multiply(e,t){return new M(e.x*t.x,e.y*t.y)}static multiplyScalar(e,t){return new M(e.x,e.y).multiplyScalar(t)}static midpoint(e,t){return new M((e.x+t.x)/2,(e.y+t.y)/2)}static normals(e,t){let r=M.subtract(t,e);return[new M(-r.y,r.x),new M(r.y,-r.x)]}static units(e,t){let r=M.subtract(t,e);return[new M(-r.y,r.x).normalize(),new M(r.y,-r.x).normalize()]}static divide(e,t){return new M(e.x/t.x,e.y/t.y)}static divideScalar(e,t){return new M(e.x/t,e.y/t)}static dot(e,t){return e.x*t.x+e.y*t.y}static angle(e,t){let r=M.dot(e,t);return Math.acos(r/(e.length()*t.length()))}static threePointangle(e,t,r){let i=M.subtract(t,e),a=M.subtract(r,t),l=e.distance(t),n=t.distance(r);return Math.acos(M.dot(i,a)/(l*n))}static scalarProjection(e,t){let r=t.normalized();return M.dot(e,r)}static averageDirection(e){let t=new M(0,0);for(var r=0;r<e.length;r++){let i=e[r];t.add(i)}return t.normalize()}};en.exports=fi});var st=me((Js,rn)=>{var tn=ot(),Wr=lt(),Er=Ge(),Ks=wt(),ci=class M{constructor(e,t=0,r=0){this.id=null,this.value=e,this.position=new Er(t||0,r||0),this.previousPosition=new Er(0,0),this.parentVertexId=null,this.children=Array(),this.spanningTreeChildren=Array(),this.edges=Array(),this.positioned=!1,this.angle=null,this.dir=1,this.neighbourCount=0,this.neighbours=Array(),this.neighbouringElements=Array(),this.forcePositioned=!1}setPosition(e,t){this.position.x=e,this.position.y=t}setPositionFromVector(e){this.position.x=e.x,this.position.y=e.y}addChild(e){this.children.push(e),this.neighbours.push(e),this.neighbourCount++}addRingbondChild(e,t){if(this.children.push(e),this.value.bracket){let r=1;this.id===0&&this.value.bracket.hcount===0&&(r=0),this.value.bracket.hcount===1&&t===0&&(r=2),this.value.bracket.hcount===1&&t===1&&(this.neighbours.length<3?r=2:r=3),this.value.bracket.hcount===null&&t===0&&(r=1),this.value.bracket.hcount===null&&t===1&&(this.neighbours.length<3?r=1:r=2),this.neighbours.splice(r,0,e)}else this.neighbours.push(e);this.neighbourCount++}setParentVertexId(e){this.neighbourCount++,this.parentVertexId=e,this.neighbours.push(e)}isTerminal(){return this.value.hasAttachedPseudoElements?!0:this.parentVertexId===null&&this.children.length<2||this.children.length===0}clone(){let e=new M(this.value,this.position.x,this.position.y);return e.id=this.id,e.previousPosition=new Er(this.previousPosition.x,this.previousPosition.y),e.parentVertexId=this.parentVertexId,e.children=Wr.clone(this.children),e.spanningTreeChildren=Wr.clone(this.spanningTreeChildren),e.edges=Wr.clone(this.edges),e.positioned=this.positioned,e.angle=this.angle,e.forcePositioned=this.forcePositioned,e}equals(e){return this.id===e.id}getAngle(e=null,t=!1){let r=null;return e?r=Er.subtract(this.position,e):r=Er.subtract(this.position,this.previousPosition),t?tn.toDeg(r.angle()):r.angle()}getTextDirection(e,t=!1){let r=this.getDrawnNeighbours(e),i=Array();if(e.length===1)return"right";for(let l=0;l<r.length;l++)i.push(this.getAngle(e[r[l]].position));let a=tn.meanAngle(i);if(this.isTerminal()||t)Math.round(a*100)/100===1.57&&(a=a-.2),a=Math.round(Math.round(a/Math.PI)*Math.PI);else{let l=Math.PI/2;a=Math.round(Math.round(a/l)*l)}return a===2?"down":a===-2?"up":a===0||a===-0?"right":a===3||a===-3?"left":"down"}getNeighbours(e=null){if(e===null)return this.neighbours.slice();let t=Array();for(let r=0;r<this.neighbours.length;r++)this.neighbours[r]!==e&&t.push(this.neighbours[r]);return t}getDrawnNeighbours(e){let t=Array();for(let r=0;r<this.neighbours.length;r++)e[this.neighbours[r]].value.isDrawn&&t.push(this.neighbours[r]);return t}getNeighbourCount(){return this.neighbourCount}getSpanningTreeNeighbours(e=null){let t=Array();for(let r=0;r<this.spanningTreeChildren.length;r++)(e===void 0||e!=this.spanningTreeChildren[r])&&t.push(this.spanningTreeChildren[r]);return this.parentVertexId!=null&&(e===void 0||e!=this.parentVertexId)&&t.push(this.parentVertexId),t}getNextInRing(e,t,r){let i=this.getNeighbours();for(let a=0;a<i.length;a++)if(Wr.contains(e[i[a]].value.rings,{value:t})&&i[a]!=r)return i[a];return null}};rn.exports=ci});var Xt=me((ea,nn)=>{var Qs=st(),js=ht(),di=class{constructor(e,t){this.id=null,this.firstRingId=e.id,this.secondRingId=t.id,this.vertices=new Set;for(var r=0;r<e.members.length;r++){let i=e.members[r];for(let a=0;a<t.members.length;a++){let l=t.members[a];i===l&&this.addVertex(i)}}}addVertex(e){this.vertices.add(e)}updateOther(e,t){this.firstRingId===t?this.secondRingId=e:this.firstRingId=e}containsRing(e){return this.firstRingId===e||this.secondRingId===e}isBridge(e){if(this.vertices.size>2)return!0;for(let t of this.vertices)if(e[t].value.rings.length>2)return!0;return!1}static isBridge(e,t,r,i){let a=null;for(let l=0;l<e.length;l++)if(a=e[l],a.firstRingId===r&&a.secondRingId===i||a.firstRingId===i&&a.secondRingId===r)return a.isBridge(t);return!1}static getNeighbours(e,t){let r=[];for(let i=0;i<e.length;i++){let a=e[i];a.firstRingId===t?r.push(a.secondRingId):a.secondRingId===t&&r.push(a.firstRingId)}return r}static getVertices(e,t,r){for(let i=0;i<e.length;i++){let a=e[i];if(a.firstRingId===t&&a.secondRingId===r||a.firstRingId===r&&a.secondRingId===t)return[...a.vertices]}}};nn.exports=di});var ht=me((ra,sn)=>{var pi=lt(),us=Ge(),ta=st(),fs=Xt(),vi=class M{constructor(e){this.id=null,this.members=e,this.edges=[],this.insiders=[],this.neighbours=[],this.positioned=!1,this.center=new us(0,0),this.rings=[],this.isBridged=!1,this.isPartOfBridged=!1,this.isSpiro=!1,this.isFused=!1,this.centralAngle=0,this.canFlip=!0}clone(){let e=new M(this.members);return e.id=this.id,e.insiders=pi.clone(this.insiders),e.neighbours=pi.clone(this.neighbours),e.positioned=this.positioned,e.center=this.center.clone(),e.rings=pi.clone(this.rings),e.isBridged=this.isBridged,e.isPartOfBridged=this.isPartOfBridged,e.isSpiro=this.isSpiro,e.isFused=this.isFused,e.centralAngle=this.centralAngle,e.canFlip=this.canFlip,e}getSize(){return this.members.length}getPolygon(e){let t=[];for(let r=0;r<this.members.length;r++)t.push(e[this.members[r]].position);return t}getAngle(){return Math.PI-this.centralAngle}eachMember(e,t,r,i){r=r||r===0?r:this.members[0];let a=r,l=0;for(;a!=null&&l<100;){let n=a;t(n),a=e[a].getNextInRing(e,this.id,i),i=n,a==r&&(a=null),l++}}getOrderedNeighbours(e){let t=Array(this.neighbours.length);for(let r=0;r<this.neighbours.length;r++){let i=fs.getVertices(e,this.id,this.neighbours[r]);t[r]={n:i.length,neighbour:this.neighbours[r]}}return t.sort(function(r,i){return i.n-r.n}),t}isBenzeneLike(e){let t=this.getDoubleBondCount(e),r=this.members.length;return t===3&&r===6||t===2&&r===5}getDoubleBondCount(e){let t=0;for(let r=0;r<this.members.length;r++){let i=e[this.members[r]].value;(i.bondType==="="||i.branchBond==="=")&&t++}return t}contains(e){for(let t=0;t<this.members.length;t++)if(this.members[t]==e)return!0;return!1}};sn.exports=vi});var wt=me((sa,an)=>{var cs=lt(),ia=st(),na=ht(),mi=class M{constructor(e,t="-"){this.idx=null,this.element=e.length===1?e.toUpperCase():e,this.drawExplicit=!1,this.ringbonds=Array(),this.rings=Array(),this.bondType=t,this.branchBond=null,this.isBridge=!1,this.isBridgeNode=!1,this.originalRings=Array(),this.bridgedRing=null,this.anchoredRings=Array(),this.bracket=null,this.plane=0,this.attachedPseudoElements={},this.hasAttachedPseudoElements=!1,this.isDrawn=!0,this.isConnectedToRing=!1,this.neighbouringElements=Array(),this.isPartOfAromaticRing=e!==this.element,this.bondCount=0,this.chirality="",this.isStereoCenter=!1,this.priority=0,this.mainChain=!1,this.hydrogenDirection="down",this.subtreeDepth=1,this.hasHydrogen=!1,this.class=void 0}addNeighbouringElement(e){this.neighbouringElements.push(e)}attachPseudoElement(e,t,r=0,i=0){r===null&&(r=0),i===null&&(i=0);let a=r+e+i;this.attachedPseudoElements[a]?this.attachedPseudoElements[a].count+=1:this.attachedPseudoElements[a]={element:e,count:1,hydrogenCount:r,previousElement:t,charge:i},this.hasAttachedPseudoElements=!0}getAttachedPseudoElements(){let e={},t=this;return Object.keys(this.attachedPseudoElements).sort().forEach(function(r){e[r]=t.attachedPseudoElements[r]}),e}getAttachedPseudoElementsCount(){return Object.keys(this.attachedPseudoElements).length}isHeteroAtom(){return this.element!=="C"&&this.element!=="H"}addAnchoredRing(e){cs.contains(this.anchoredRings,{value:e})||this.anchoredRings.push(e)}getRingbondCount(){return this.ringbonds.length}backupRings(){this.originalRings=Array(this.rings.length);for(let e=0;e<this.rings.length;e++)this.originalRings[e]=this.rings[e]}restoreRings(){this.rings=Array(this.originalRings.length);for(let e=0;e<this.originalRings.length;e++)this.rings[e]=this.originalRings[e]}haveCommonRingbond(e,t){for(let r=0;r<e.ringbonds.length;r++)for(let i=0;i<t.ringbonds.length;i++)if(e.ringbonds[r].id==t.ringbonds[i].id)return!0;return!1}neighbouringElementsEqual(e){if(e.length!==this.neighbouringElements.length)return!1;e.sort(),this.neighbouringElements.sort();for(var t=0;t<this.neighbouringElements.length;t++)if(e[t]!==this.neighbouringElements[t])return!1;return!0}getAtomicNumber(){return M.atomicNumbers[this.element]}getMaxBonds(){return M.maxBonds[this.element]}static get maxBonds(){return{H:1,C:4,N:3,O:2,P:3,S:2,B:3,F:1,I:1,Cl:1,Br:1}}static get atomicNumbers(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}static get mass(){return{H:1,He:2,Li:3,Be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,p:15,S:16,s:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103,Rf:104,Db:105,Sg:106,Bh:107,Hs:108,Mt:109,Ds:110,Rg:111,Cn:112,Uut:113,Uuq:114,Uup:115,Uuh:116,Uus:117,Uuo:118}}};an.exports=mi});var yt=me((aa,ln)=>{var sr=Ge(),bi=class M{constructor(e=new sr(0,0),t=new sr(0,0),r=null,i=null,a=!1,l=!1){this.from=e,this.to=t,this.elementFrom=r,this.elementTo=i,this.chiralFrom=a,this.chiralTo=l}clone(){return new M(this.from.clone(),this.to.clone(),this.elementFrom,this.elementTo)}getLength(){return Math.sqrt(Math.pow(this.to.x-this.from.x,2)+Math.pow(this.to.y-this.from.y,2))}getAngle(){return sr.subtract(this.getRightVector(),this.getLeftVector()).angle()}getRightVector(){return this.from.x<this.to.x?this.to:this.from}getLeftVector(){return this.from.x<this.to.x?this.from:this.to}getRightElement(){return this.from.x<this.to.x?this.elementTo:this.elementFrom}getLeftElement(){return this.from.x<this.to.x?this.elementFrom:this.elementTo}getRightChiral(){return this.from.x<this.to.x?this.chiralTo:this.chiralFrom}getLeftChiral(){return this.from.x<this.to.x?this.chiralFrom:this.chiralTo}setRightVector(e,t){return this.from.x<this.to.x?(this.to.x=e,this.to.y=t):(this.from.x=e,this.from.y=t),this}setLeftVector(e,t){return this.from.x<this.to.x?(this.from.x=e,this.from.y=t):(this.to.x=e,this.to.y=t),this}rotateToXAxis(){let e=this.getLeftVector();return this.setRightVector(e.x+this.getLength(),e.y),this}rotate(e){let t=this.getLeftVector(),r=this.getRightVector(),i=Math.sin(e),a=Math.cos(e),l=a*(r.x-t.x)-i*(r.y-t.y)+t.x,n=i*(r.x-t.x)-a*(r.y-t.y)+t.y;return this.setRightVector(l,n),this}shortenFrom(e){let t=sr.subtract(this.to,this.from);return t.normalize(),t.multiplyScalar(e),this.from.add(t),this}shortenTo(e){let t=sr.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e),this.to.add(t),this}shortenRight(e){return this.from.x<this.to.x?this.shortenTo(e):this.shortenFrom(e),this}shortenLeft(e){return this.from.x<this.to.x?this.shortenFrom(e):this.shortenTo(e),this}shorten(e){let t=sr.subtract(this.from,this.to);return t.normalize(),t.multiplyScalar(e/2),this.to.add(t),this.from.subtract(t),this}};ln.exports=bi});var _t=me((la,on)=>{function ds(M){return M===1?"+":M===2?"2+":M===-1?"-":M===-2?"2-":""}on.exports={getChargeText:ds}});var lr=me((ua,gn)=>{var ar=ot(),Fe=Ge(),oa=yt(),ha=st(),ga=ht(),{getChargeText:hn}=_t(),wi=class{constructor(e,t,r){typeof e=="string"||e instanceof String?this.canvas=document.getElementById(e):this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.themeManager=t,this.opts=r,this.drawingWidth=0,this.drawingHeight=0,this.offsetX=0,this.offsetY=0,this.fontLarge=this.opts.fontSizeLarge+"pt Helvetica, Arial, sans-serif",this.fontSmall=this.opts.fontSizeSmall+"pt Helvetica, Arial, sans-serif",this.updateSize(this.opts.width,this.opts.height),this.ctx.font=this.fontLarge,this.hydrogenWidth=this.ctx.measureText("H").width,this.halfHydrogenWidth=this.hydrogenWidth/2,this.halfBondThickness=this.opts.bondThickness/2}updateSize(e,t){this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,this.ratio=this.devicePixelRatio/this.backingStoreRatio,this.ratio!==1?(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.ctx.setTransform(this.ratio,0,0,this.ratio,0,0)):(this.canvas.width=e*this.ratio,this.canvas.height=t*this.ratio)}setTheme(e){this.colors=e}scale(e){let t=-Number.MAX_VALUE,r=-Number.MAX_VALUE,i=Number.MAX_VALUE,a=Number.MAX_VALUE;for(var l=0;l<e.length;l++){if(!e[l].value.isDrawn)continue;let u=e[l].position;t<u.x&&(t=u.x),r<u.y&&(r=u.y),i>u.x&&(i=u.x),a>u.y&&(a=u.y)}var n=this.opts.padding;t+=n,r+=n,i-=n,a-=n,this.drawingWidth=t-i,this.drawingHeight=r-a;var f=this.canvas.offsetWidth/this.drawingWidth,h=this.canvas.offsetHeight/this.drawingHeight,d=f<h?f:h;this.ctx.scale(d,d),this.offsetX=-i,this.offsetY=-a,f<h?this.offsetY+=this.canvas.offsetHeight/(2*d)-this.drawingHeight/2:this.offsetX+=this.canvas.offsetWidth/(2*d)-this.drawingWidth/2}reset(){this.ctx.setTransform(1,0,0,1,0,0)}getColor(e){return e=e.toUpperCase(),e in this.colors?this.colors[e]:this.colors.C}drawCircle(e,t,r,i,a=!0,l=!1,n=""){let f=this.ctx,h=this.offsetX,d=this.offsetY;f.save(),f.lineWidth=1.5,f.beginPath(),f.arc(e+h,t+d,r,0,ar.twoPI,!0),f.closePath(),l?(a?(f.fillStyle="#f00",f.fill()):(f.strokeStyle="#f00",f.stroke()),this.drawDebugText(e,t,n)):a?(f.fillStyle=i,f.fill()):(f.strokeStyle=i,f.stroke()),f.restore()}drawLine(e,t=!1,r=1){let i=this.ctx,a=this.offsetX,l=this.offsetY,n=e.clone().shorten(4),f=n.getLeftVector().clone(),h=n.getRightVector().clone();f.x+=a,f.y+=l,h.x+=a,h.y+=l,t||(i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.moveTo(f.x,f.y),i.lineTo(h.x,h.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness+1.2,i.strokeStyle=this.themeManager.getColor("BACKGROUND"),i.stroke(),i.globalCompositeOperation="source-over",i.restore()),f=e.getLeftVector().clone(),h=e.getRightVector().clone(),f.x+=a,f.y+=l,h.x+=a,h.y+=l,i.save(),i.beginPath(),i.moveTo(f.x,f.y),i.lineTo(h.x,h.y),i.lineCap="round",i.lineWidth=this.opts.bondThickness;let d=this.ctx.createLinearGradient(f.x,f.y,h.x,h.y);d.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),t&&(i.setLineDash([1,1.5]),i.lineWidth=this.opts.bondThickness/1.5),r<1&&(i.globalAlpha=r),i.strokeStyle=d,i.stroke(),i.restore()}drawWedge(e,t=1){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let r=this.ctx,i=this.offsetX,a=this.offsetY,l=e.clone().shorten(5),n=l.getLeftVector().clone(),f=l.getRightVector().clone();n.x+=i,n.y+=a,f.x+=i,f.y+=a,n=e.getLeftVector().clone(),f=e.getRightVector().clone(),n.x+=i,n.y+=a,f.x+=i,f.y+=a,r.save();let h=Fe.normals(n,f);h[0].normalize(),h[1].normalize();let d=e.getRightChiral(),u=n,c=f;d&&(u=f,c=n);let b=Fe.add(u,Fe.multiplyScalar(h[0],this.halfBondThickness)),x=Fe.add(c,Fe.multiplyScalar(h[0],1.5+this.halfBondThickness)),y=Fe.add(c,Fe.multiplyScalar(h[1],1.5+this.halfBondThickness)),L=Fe.add(u,Fe.multiplyScalar(h[1],this.halfBondThickness));r.beginPath(),r.moveTo(b.x,b.y),r.lineTo(x.x,x.y),r.lineTo(y.x,y.y),r.lineTo(L.x,L.y);let A=this.ctx.createRadialGradient(f.x,f.y,this.opts.bondLength,f.x,f.y,0);A.addColorStop(.4,this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),A.addColorStop(.6,this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C")),r.fillStyle=A,r.fill(),r.restore()}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=this.ctx,r=this.offsetX,i=this.offsetY,a=e.getLeftVector().clone(),l=e.getRightVector().clone();a.x+=r,a.y+=i,l.x+=r,l.y+=i,t.save();let n=Fe.normals(a,l);n[0].normalize(),n[1].normalize();let f=e.getRightChiral(),h,d,u,c,b=e.clone();f?(h=l,d=a,b.shortenRight(1),u=b.getRightVector().clone(),c=b.getLeftVector().clone()):(h=a,d=l,b.shortenLeft(1),u=b.getLeftVector().clone(),c=b.getRightVector().clone()),u.x+=r,u.y+=i,c.x+=r,c.y+=i;let x=Fe.subtract(d,h).normalize();t.strokeStyle=this.themeManager.getColor("C"),t.lineCap="round",t.lineWidth=this.opts.bondThickness,t.beginPath();let y=e.getLength(),L=1.25/(y/(this.opts.bondThickness*3)),A=!1;for(var $=0;$<1;$+=L){let B=Fe.multiplyScalar(x,$*y),O=Fe.add(h,B),F=1.5*$,Q=Fe.multiplyScalar(n[0],F);!A&&$>.5&&(t.stroke(),t.beginPath(),t.strokeStyle=this.themeManager.getColor(e.getRightElement())||this.themeManager.getColor("C"),A=!0),O.subtract(Q),t.moveTo(O.x,O.y),O.add(Fe.multiplyScalar(Q,2)),t.lineTo(O.x,O.y)}t.stroke(),t.restore()}drawDebugText(e,t,r){let i=this.ctx;i.save(),i.font="5px Droid Sans, sans-serif",i.textAlign="start",i.textBaseline="top",i.fillStyle="#ff0000",i.fillText(r,e+this.offsetX,t+this.offsetY),i.restore()}drawBall(e,t,r){let i=this.ctx;i.save(),i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,this.opts.bondLength/4.5,0,ar.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawPoint(e,t,r){let i=this.ctx,a=this.offsetX,l=this.offsetY;i.save(),i.globalCompositeOperation="destination-out",i.beginPath(),i.arc(e+a,t+l,1.5,0,ar.twoPI,!0),i.closePath(),i.fill(),i.globalCompositeOperation="source-over",i.beginPath(),i.arc(e+this.offsetX,t+this.offsetY,.75,0,ar.twoPI,!1),i.fillStyle=this.themeManager.getColor(r),i.fill(),i.restore()}drawText(e,t,r,i,a,l,n,f,h,d={}){let u=this.ctx,c=this.offsetX,b=this.offsetY;u.save(),u.textAlign="start",u.textBaseline="alphabetic";let x=!1,y="",L=0;n&&(y=hn(n),u.font=this.fontSmall,L=u.measureText(y).width);let A="0",$=0;f>0&&(A=f.toString(),u.font=this.fontSmall,$=u.measureText(A).width),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0),u.font=this.fontLarge,u.fillStyle=this.themeManager.getColor("BACKGROUND");let B=u.measureText(r);B.totalWidth=B.width+L,B.height=parseInt(this.fontLarge,10);let O=B.width>this.opts.fontSizeLarge?B.width:this.opts.fontSizeLarge;O/=1.5,u.globalCompositeOperation="destination-out",u.beginPath(),u.arc(e+c,t+b,O,0,ar.twoPI,!0),u.closePath(),u.fill(),u.globalCompositeOperation="source-over";let F=-B.width/2,Q=-B.width/2;u.fillStyle=this.themeManager.getColor(r),u.fillText(r,e+c+F,t+this.opts.halfFontSizeLarge+b),F+=B.width,n&&(u.font=this.fontSmall,u.fillText(y,e+c+F,t-this.opts.fifthFontSizeSmall+b),F+=L),f>0&&(u.font=this.fontSmall,u.fillText(A,e+c+Q-$,t-this.opts.fifthFontSizeSmall+b),Q-=$),u.font=this.fontLarge;let j=0,ue=0;if(i===1){let se=e+c,ee=t+b+this.opts.halfFontSizeLarge;j=this.hydrogenWidth,Q-=j,a==="left"?se+=Q:a==="right"||a==="up"&&l||a==="down"&&l?se+=F:a==="up"&&!l?(ee-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,se-=this.halfHydrogenWidth):a==="down"&&!l&&(ee+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,se-=this.halfHydrogenWidth),u.fillText("H",se,ee),F+=j}else if(i>1){let se=e+c,ee=t+b+this.opts.halfFontSizeLarge;j=this.hydrogenWidth,u.font=this.fontSmall,ue=u.measureText(i).width,Q-=j+ue,a==="left"?se+=Q:a==="right"||a==="up"&&l||a==="down"&&l?se+=F:a==="up"&&!l?(ee-=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,se-=this.halfHydrogenWidth):a==="down"&&!l&&(ee+=this.opts.fontSizeLarge+this.opts.quarterFontSizeLarge,se-=this.halfHydrogenWidth),u.font=this.fontLarge,u.fillText("H",se,ee),u.font=this.fontSmall,u.fillText(i,se+this.halfHydrogenWidth+ue,ee+this.opts.fifthFontSizeSmall),F+=j+this.halfHydrogenWidth+ue}if(x){u.restore();return}for(let se in d){if(!d.hasOwnProperty(se))continue;let ee=0,te=0,be=d[se].element,ce=d[se].count,Ne=d[se].hydrogenCount,Xe=d[se].charge;u.font=this.fontLarge,ce>1&&Ne>0&&(ee=u.measureText("(").width,te=u.measureText(")").width);let ze=u.measureText(be).width,Je=0,Qe="",ut=0;j=0,Ne>0&&(j=this.hydrogenWidth),u.font=this.fontSmall,ce>1&&(Je=u.measureText(ce).width),Xe!==0&&(Qe=hn(Xe),ut=u.measureText(Qe).width),ue=0,Ne>1&&(ue=u.measureText(Ne).width),u.font=this.fontLarge;let Ce=e+c,Ae=t+b+this.opts.halfFontSizeLarge;u.fillStyle=this.themeManager.getColor(be),ce>0&&(Q-=Je),ce>1&&Ne>0&&(a==="left"?(Q-=te,u.fillText(")",Ce+Q,Ae)):(u.fillText("(",Ce+F,Ae),F+=ee)),a==="left"?(Q-=ze,u.fillText(be,Ce+Q,Ae)):(u.fillText(be,Ce+F,Ae),F+=ze),Ne>0&&(a==="left"?(Q-=j+ue,u.fillText("H",Ce+Q,Ae),Ne>1&&(u.font=this.fontSmall,u.fillText(Ne,Ce+Q+j,Ae+this.opts.fifthFontSizeSmall))):(u.fillText("H",Ce+F,Ae),F+=j,Ne>1&&(u.font=this.fontSmall,u.fillText(Ne,Ce+F,Ae+this.opts.fifthFontSizeSmall),F+=ue))),u.font=this.fontLarge,ce>1&&Ne>0&&(a==="left"?(Q-=ee,u.fillText("(",Ce+Q,Ae)):(u.fillText(")",Ce+F,Ae),F+=te)),u.font=this.fontSmall,ce>1&&(a==="left"?u.fillText(ce,Ce+Q+ee+te+j+ue+ze,Ae+this.opts.fifthFontSizeSmall):(u.fillText(ce,Ce+F,Ae+this.opts.fifthFontSizeSmall),F+=Je)),Xe!==0&&(a==="left"?u.fillText(Qe,Ce+Q+ee+te+j+ue+ze,t-this.opts.fifthFontSizeSmall+b):(u.fillText(Qe,Ce+F,t-this.opts.fifthFontSizeSmall+b),F+=ut))}u.restore()}getChargeText(e){return e===1?"+":e===2?"2+":e===-1?"-":e===-2?"2-":""}drawDebugPoint(e,t,r="",i="#f00"){this.drawCircle(e,t,2,i,!0,!0,r)}drawAromaticityRing(e){let t=this.ctx,r=ar.apothemFromSideLength(this.opts.bondLength,e.getSize());t.save(),t.strokeStyle=this.themeManager.getColor("C"),t.lineWidth=this.opts.bondThickness,t.beginPath(),t.arc(e.center.x+this.offsetX,e.center.y+this.offsetY,r-this.opts.bondSpacing,0,Math.PI*2,!0),t.closePath(),t.stroke(),t.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}};gn.exports=wi});var Yt=me((fa,un)=>{var yi=class M{constructor(e,t,r=1){this.id=null,this.sourceId=e,this.targetId=t,this.weight=r,this.bondType="-",this.isPartOfAromaticRing=!1,this.center=!1,this.wedge=""}setBondType(e){this.bondType=e,this.weight=M.bonds[e]}static get bonds(){return{".":0,"-":1,"/":1,"\\":1,"=":2,"#":3,$:4}}};un.exports=yi});var Et=me((pa,cn)=>{var fn=ot(),ca=Ge(),ps=st(),vs=Yt(),da=ht(),ms=wt(),Si=class M{constructor(e,t=!1){this.vertices=Array(),this.edges=Array(),this.atomIdxToVertexId=Array(),this.vertexIdsToEdgeId={},this.isomeric=t,this._atomIdx=0,this._time=0,this._init(e)}_init(e,t=0,r=null,i=!1){let a=e.atom.element?e.atom.element:e.atom,l=new ms(a,e.bond);(a!=="H"||!e.hasNext&&r===null)&&(l.idx=this._atomIdx,this._atomIdx++),l.branchBond=e.branchBond,l.ringbonds=e.ringbonds,l.bracket=e.atom.element?e.atom:null,l.class=e.atom.class;let n=new ps(l),f=this.vertices[r];if(this.addVertex(n),l.idx!==null&&this.atomIdxToVertexId.push(n.id),r!==null){n.setParentVertexId(r),n.value.addNeighbouringElement(f.value.element),f.addChild(n.id),f.value.addNeighbouringElement(l.element),f.spanningTreeChildren.push(n.id);let c=new vs(r,n.id,1),b=null;i?(c.setBondType(n.value.branchBond||"-"),b=n.id,c.setBondType(n.value.branchBond||"-"),b=n.id):(c.setBondType(f.value.bondType||"-"),b=f.id);let x=this.addEdge(c)}let h=e.ringbondCount+1;l.bracket&&(h+=l.bracket.hcount);let d=0;if(l.bracket&&l.bracket.chirality){l.isStereoCenter=!0,d=l.bracket.hcount;for(var u=0;u<d;u++)this._init({atom:"H",isBracket:"false",branches:Array(),branchCount:0,ringbonds:Array(),ringbondCount:!1,next:null,hasNext:!1,bond:"-"},u,n.id,!0)}for(var u=0;u<e.branchCount;u++)this._init(e.branches[u],u+h,n.id,!0);e.hasNext&&this._init(e.next,e.branchCount+h,n.id)}clear(){this.vertices=Array(),this.edges=Array(),this.vertexIdsToEdgeId={}}addVertex(e){return e.id=this.vertices.length,this.vertices.push(e),e.id}addEdge(e){let t=this.vertices[e.sourceId],r=this.vertices[e.targetId];return e.id=this.edges.length,this.edges.push(e),this.vertexIdsToEdgeId[e.sourceId+"_"+e.targetId]=e.id,this.vertexIdsToEdgeId[e.targetId+"_"+e.sourceId]=e.id,e.isPartOfAromaticRing=t.value.isPartOfAromaticRing&&r.value.isPartOfAromaticRing,t.value.bondCount+=e.weight,r.value.bondCount+=e.weight,t.edges.push(e.id),r.edges.push(e.id),e.id}getEdge(e,t){let r=this.vertexIdsToEdgeId[e+"_"+t];return r===void 0?null:this.edges[r]}getEdges(e){let t=Array(),r=this.vertices[e];for(var i=0;i<r.neighbours.length;i++)t.push(this.vertexIdsToEdgeId[e+"_"+r.neighbours[i]]);return t}hasEdge(e,t){return this.vertexIdsToEdgeId[e+"_"+t]!==void 0}getVertexList(){let e=[this.vertices.length];for(var t=0;t<this.vertices.length;t++)e[t]=this.vertices[t].id;return e}getEdgeList(){let e=Array(this.edges.length);for(var t=0;t<this.edges.length;t++)e[t]=[this.edges[t].sourceId,this.edges[t].targetId];return e}getAdjacencyMatrix(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++)t[r]=new Array(e),t[r].fill(0);for(var r=0;r<this.edges.length;r++){let a=this.edges[r];t[a.sourceId][a.targetId]=1,t[a.targetId][a.sourceId]=1}return t}getComponentsAdjacencyMatrix(){let e=this.vertices.length,t=Array(e),r=this.getBridges();for(var i=0;i<e;i++)t[i]=new Array(e),t[i].fill(0);for(var i=0;i<this.edges.length;i++){let l=this.edges[i];t[l.sourceId][l.targetId]=1,t[l.targetId][l.sourceId]=1}for(var i=0;i<r.length;i++)t[r[i][0]][r[i][1]]=0,t[r[i][1]][r[i][0]]=0;return t}getSubgraphAdjacencyMatrix(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=new Array(t),r[i].fill(0);for(var a=0;a<t;a++)i!==a&&this.hasEdge(e[i],e[a])&&(r[i][a]=1)}return r}getDistanceMatrix(){let e=this.vertices.length,t=this.getAdjacencyMatrix(),r=Array(e);for(var i=0;i<e;i++)r[i]=Array(e),r[i].fill(1/0);for(var i=0;i<e;i++)for(var a=0;a<e;a++)t[i][a]===1&&(r[i][a]=1);for(var l=0;l<e;l++)for(var i=0;i<e;i++)for(var a=0;a<e;a++)r[i][a]>r[i][l]+r[l][a]&&(r[i][a]=r[i][l]+r[l][a]);return r}getSubgraphDistanceMatrix(e){let t=e.length,r=this.getSubgraphAdjacencyMatrix(e),i=Array(t);for(var a=0;a<t;a++)i[a]=Array(t),i[a].fill(1/0);for(var a=0;a<t;a++)for(var l=0;l<t;l++)r[a][l]===1&&(i[a][l]=1);for(var n=0;n<t;n++)for(var a=0;a<t;a++)for(var l=0;l<t;l++)i[a][l]>i[a][n]+i[n][l]&&(i[a][l]=i[a][n]+i[n][l]);return i}getAdjacencyList(){let e=this.vertices.length,t=Array(e);for(var r=0;r<e;r++){t[r]=[];for(var i=0;i<e;i++)r!==i&&this.hasEdge(this.vertices[r].id,this.vertices[i].id)&&t[r].push(i)}return t}getSubgraphAdjacencyList(e){let t=e.length,r=Array(t);for(var i=0;i<t;i++){r[i]=Array();for(var a=0;a<t;a++)i!==a&&this.hasEdge(e[i],e[a])&&r[i].push(a)}return r}getBridges(){let e=this.vertices.length,t=new Array(e),r=new Array(e),i=new Array(e),a=new Array(e),l=this.getAdjacencyList(),n=Array();t.fill(!1),a.fill(null),this._time=0;for(var f=0;f<e;f++)t[f]||this._bridgeDfs(f,t,r,i,a,l,n);return n}traverseBF(e,t){let r=this.vertices.length,i=new Array(r);i.fill(!1);for(var a=[e];a.length>0;){let n=a.shift(),f=this.vertices[n];t(f);for(var l=0;l<f.neighbours.length;l++){let h=f.neighbours[l];i[h]||(i[h]=!0,a.push(h))}}}getTreeDepth(e,t){if(e===null||t===null)return 0;let r=this.vertices[e].getSpanningTreeNeighbours(t),i=0;for(var a=0;a<r.length;a++){let l=r[a],n=this.getTreeDepth(l,e);n>i&&(i=n)}return i+1}traverseTree(e,t,r,i=999999,a=!1,l=1,n=null){if(n===null&&(n=new Uint8Array(this.vertices.length)),l>i+1||n[e]===1)return;n[e]=1;let f=this.vertices[e],h=f.getNeighbours(t);(!a||l>1)&&r(f);for(var d=0;d<h.length;d++)this.traverseTree(h[d],e,r,i,a,l+1,n)}kkLayout(e,t,r,i,a,l=.1,n=.1,f=2e3,h=50,d=1e9){let u=a;for(var c=e.length;c--;)var b=this.vertices[e[c]].neighbours.length;let x=this.getSubgraphDistanceMatrix(e),y=e.length,L=fn.polyCircumradius(500,y),A=fn.centralAngle(y),$=0,B=new Float32Array(y),O=new Float32Array(y),F=Array(y);for(c=y;c--;){let G=this.vertices[e[c]];G.positioned?(B[c]=G.position.x,O[c]=G.position.y):(B[c]=t.x+Math.cos($)*L,O[c]=t.y+Math.sin($)*L),F[c]=G.positioned,$+=A}let Q=Array(y);for(c=y;c--;){Q[c]=new Array(y);for(var b=y;b--;)Q[c][b]=a*x[c][b]}let j=Array(y);for(c=y;c--;){j[c]=Array(y);for(var b=y;b--;)j[c][b]=u*Math.pow(x[c][b],-2)}let ue=Array(y),se=new Float32Array(y),ee=new Float32Array(y);for(c=y;c--;)ue[c]=Array(y);c=y;let te,be,ce,Ne,Xe,ze,Je;for(;c--;){te=B[c],be=O[c],ce=0,Ne=0;let G=y;for(;G--;)c!==G&&(Xe=B[G],ze=O[G],Je=1/Math.sqrt((te-Xe)*(te-Xe)+(be-ze)*(be-ze)),ue[c][G]=[j[c][G]*(te-Xe-Q[c][G]*(te-Xe)*Je),j[c][G]*(be-ze-Q[c][G]*(be-ze)*Je)],ue[G][c]=ue[c][G],ce+=ue[c][G][0],Ne+=ue[c][G][1]);se[c]=ce,ee[c]=Ne}let Qe=function(G){return[se[G]*se[G]+ee[G]*ee[G],se[G],ee[G]]},ut=function(){let G=0,Re=0,je=0,Pe=0;for(c=y;c--;){let[tt,Ze,_e]=Qe(c);tt>G&&F[c]===!1&&(G=tt,Re=c,je=Ze,Pe=_e)}return[Re,G,je,Pe]},Ce=function(G,Re,je){let Pe=0,tt=0,Ze=0,_e=B[G],Ye=O[G],Dt=Q[G],Ke=j[G];for(c=y;c--;){if(c===G)continue;let at=B[c],rt=O[c],dt=Dt[c],pt=Ke[c],vt=(_e-at)*(_e-at),$t=1/Math.pow(vt+(Ye-rt)*(Ye-rt),1.5);Pe+=pt*(1-dt*(Ye-rt)*(Ye-rt)*$t),tt+=pt*(1-dt*vt*$t),Ze+=pt*(dt*(_e-at)*(Ye-rt)*$t)}Pe===0&&(Pe=.1),tt===0&&(tt=.1),Ze===0&&(Ze=.1);let Ie=Re/Pe+je/Ze;Ie/=Ze/Pe-tt/Ze;let Me=-(Ze*Ie+Re)/Pe;B[G]+=Me,O[G]+=Ie;let Oe=ue[G];Re=0,je=0,_e=B[G],Ye=O[G];let ft,Se,Ht,St,ct;for(c=y;c--;)G!==c&&(ft=B[c],Se=O[c],Ht=Oe[c][0],St=Oe[c][1],ct=1/Math.sqrt((_e-ft)*(_e-ft)+(Ye-Se)*(Ye-Se)),Me=Ke[c]*(_e-ft-Dt[c]*(_e-ft)*ct),Ie=Ke[c]*(Ye-Se-Dt[c]*(Ye-Se)*ct),Oe[c]=[Me,Ie],Re+=Me,je+=Ie,se[c]+=Me-Ht,ee[c]+=Ie-St);se[G]=Re,ee[G]=je},Ae=0,Pt=0,kt=0,It=0,Ut=0,Ot=0;for(;d>l&&f>Ut;)for(Ut++,[Ae,d,Pt,kt]=ut(),It=d,Ot=0;It>n&&h>Ot;)Ot++,Ce(Ae,Pt,kt),[It,Pt,kt]=Qe(Ae);for(c=y;c--;){let G=e[c],Re=this.vertices[G];Re.position.x=B[c],Re.position.y=O[c],Re.positioned=!0,Re.forcePositioned=!0}}_bridgeDfs(e,t,r,i,a,l,n){t[e]=!0,r[e]=i[e]=++this._time;for(var f=0;f<l[e].length;f++){let h=l[e][f];t[h]?h!==a[e]&&(i[e]=Math.min(i[e],r[h])):(a[h]=e,this._bridgeDfs(h,t,r,i,a,l,n),i[e]=Math.min(i[e],i[h]),i[h]>r[e]&&n.push([e,h]))}}static getConnectedComponents(e){let t=e.length,r=new Array(t),i=new Array,a=0;r.fill(!1);for(var l=0;l<t;l++)if(!r[l]){let n=Array();r[l]=!0,n.push(l),a++,M._ccGetDfs(l,r,e,n),n.length>1&&i.push(n)}return i}static getConnectedComponentCount(e){let t=e.length,r=new Array(t),i=0;r.fill(!1);for(var a=0;a<t;a++)r[a]||(r[a]=!0,i++,M._ccCountDfs(a,r,e));return i}static _ccCountDfs(e,t,r){for(var i=0;i<r[e].length;i++)!r[e][i]||t[i]||e===i||(t[i]=!0,M._ccCountDfs(i,t,r))}static _ccGetDfs(e,t,r,i){for(var a=0;a<r[e].length;a++)!r[e][a]||t[a]||e===a||(t[a]=!0,i.push(a),M._ccGetDfs(a,t,r,i))}};cn.exports=Si});var or=me((va,dn)=>{var bs=Et(),Ai=class M{static getRings(e,t=!1){let r=e.getComponentsAdjacencyMatrix();if(r.length===0)return null;let i=bs.getConnectedComponents(r),a=Array();for(var l=0;l<i.length;l++){let h=i[l],d=e.getSubgraphAdjacencyMatrix([...h]),u=new Uint16Array(d.length),c=new Uint16Array(d.length);for(var n=0;n<d.length;n++){c[n]=0,u[n]=0;for(var f=0;f<d[n].length;f++)u[n]+=d[n][f]}let b=0;for(var n=0;n<d.length;n++)for(var f=n+1;f<d.length;f++)b+=d[n][f];let x=b-d.length+1,y=!0;for(var n=0;n<u.length;n++)u[n]!==3&&(y=!1);if(y&&(x=2+b-d.length),x===1){a.push([...h]);continue}t&&(x=999);let{d:L,pe:A,pe_prime:$}=M.getPathIncludedDistanceMatrices(d),B=M.getRingCandidates(L,A,$),O=M.getSSSR(B,L,d,A,$,u,c,x);for(var n=0;n<O.length;n++){let Q=Array(O[n].size),j=0;for(let ue of O[n])Q[j++]=h[ue];a.push(Q)}}return a}static matrixToString(e){let t="";for(var r=0;r<e.length;r++){for(var i=0;i<e[r].length;i++)t+=e[r][i]+" ";t+=`
`}return t}static getPathIncludedDistanceMatrices(e){let t=e.length,r=Array(t),i=Array(t),a=Array(t);for(var l=0,n=0,f=0,h=t;h--;){r[h]=Array(t),i[h]=Array(t),a[h]=Array(t);for(var u=t;u--;)r[h][u]=h===u||e[h][u]===1?e[h][u]:Number.POSITIVE_INFINITY,r[h][u]===1?i[h][u]=[[[h,u]]]:i[h][u]=Array(),a[h][u]=Array()}for(var d=t,u;d--;)for(h=t;h--;)for(u=t;u--;){let c=r[h][u],b=r[h][d]+r[d][u];if(c>b){var l,n,f;if(c===b+1)for(a[h][u]=[i[h][u].length],l=i[h][u].length;l--;)for(a[h][u][l]=[i[h][u][l].length],n=i[h][u][l].length;n--;)for(a[h][u][l][n]=[i[h][u][l][n].length],f=i[h][u][l][n].length;f--;)a[h][u][l][n][f]=[i[h][u][l][n][0],i[h][u][l][n][1]];else a[h][u]=Array();for(r[h][u]=b,i[h][u]=[[]],l=i[h][d][0].length;l--;)i[h][u][0].push(i[h][d][0][l]);for(l=i[d][u][0].length;l--;)i[h][u][0].push(i[d][u][0][l])}else if(c===b){if(i[h][d].length&&i[d][u].length){var l;if(i[h][u].length){let y=Array();for(l=i[h][d][0].length;l--;)y.push(i[h][d][0][l]);for(l=i[d][u][0].length;l--;)y.push(i[d][u][0][l]);i[h][u].push(y)}else{let y=Array();for(l=i[h][d][0].length;l--;)y.push(i[h][d][0][l]);for(l=i[d][u][0].length;l--;)y.push(i[d][u][0][l]);i[h][u][0]=y}}}else if(c===b-1){var l;if(a[h][u].length){let y=Array();for(l=i[h][d][0].length;l--;)y.push(i[h][d][0][l]);for(l=i[d][u][0].length;l--;)y.push(i[d][u][0][l]);a[h][u].push(y)}else{let y=Array();for(l=i[h][d][0].length;l--;)y.push(i[h][d][0][l]);for(l=i[d][u][0].length;l--;)y.push(i[d][u][0][l]);a[h][u][0]=y}}}return{d:r,pe:i,pe_prime:a}}static getRingCandidates(e,t,r){let i=e.length,a=Array(),l=0;for(let n=0;n<i;n++)for(let f=0;f<i;f++)e[n][f]===0||t[n][f].length===1&&r[n][f]===0||(r[n][f].length!==0?l=2*(e[n][f]+.5):l=2*e[n][f],l!==1/0&&a.push([l,t[n][f],r[n][f]]));return a.sort(function(n,f){return n[0]-f[0]}),a}static getSSSR(e,t,r,i,a,l,n,f){let h=Array(),d=Array();for(let c=0;c<e.length;c++)if(e[c][0]%2!==0)for(let b=0;b<e[c][2].length;b++){let x=e[c][1][0].concat(e[c][2][b]);for(var u=0;u<x.length;u++)x[u][0].constructor===Array&&(x[u]=x[u][0]);let y=M.bondsToAtoms(x);if(M.getBondCount(y,r)===y.size&&!M.pathSetsContain(h,y,x,d,l,n)&&(h.push(y),d=d.concat(x)),h.length>f)return h}else for(let b=0;b<e[c][1].length-1;b++){let x=e[c][1][b].concat(e[c][1][b+1]);for(var u=0;u<x.length;u++)x[u][0].constructor===Array&&(x[u]=x[u][0]);let y=M.bondsToAtoms(x);if(M.getBondCount(y,r)===y.size&&!M.pathSetsContain(h,y,x,d,l,n)&&(h.push(y),d=d.concat(x)),h.length>f)return h}return h}static getEdgeCount(e){let t=0,r=e.length;for(var i=r-1;i--;)for(var a=r;a--;)e[i][a]===1&&t++;return t}static getEdgeList(e){let t=e.length,r=Array();for(var i=t-1;i--;)for(var a=t;a--;)e[i][a]===1&&r.push([i,a]);return r}static bondsToAtoms(e){let t=new Set;for(var r=e.length;r--;)t.add(e[r][0]),t.add(e[r][1]);return t}static getBondCount(e,t){let r=0;for(let i of e)for(let a of e)i!==a&&(r+=t[i][a]);return r/2}static pathSetsContain(e,t,r,i,a,l){for(var n=e.length;n--;){if(M.isSupersetOf(t,e[n]))return!0;if(e[n].size===t.size&&M.areSetsEqual(e[n],t))return!0}let f=0,h=!1;for(n=r.length;n--;)for(var d=i.length;d--;)(r[n][0]===i[d][0]&&r[n][1]===i[d][1]||r[n][1]===i[d][0]&&r[n][0]===i[d][1])&&f++,f===r.length&&(h=!0);let u=!1;if(h){for(let c of t)if(l[c]<a[c]){u=!0;break}}if(h&&!u)return!0;for(let c of t)l[c]++;return!1}static areSetsEqual(e,t){if(e.size!==t.size)return!1;for(let r of e)if(!t.has(r))return!1;return!0}static isSupersetOf(e,t){for(var r of t)if(!e.has(r))return!1;return!0}};dn.exports=Ai});var Tt=me((ma,pn)=>{var Ci=class{constructor(e,t){this.colors=e,this.theme=this.colors[t]}getColor(e){return e&&(e=e.toUpperCase(),e in this.theme)?this.theme[e]:this.theme.C}setTheme(e){this.colors.hasOwnProperty(e)&&(this.theme=this.colors[e])}};pn.exports=Ci});var Lt=me((ba,vn)=>{var xi=class{static extend(){let e=this,t={},r=!1,i=0,a=arguments.length;Object.prototype.toString.call(arguments[0])==="[object Boolean]"&&(r=arguments[0],i++);let l=function(n){for(var f in n)Object.prototype.hasOwnProperty.call(n,f)&&(r&&Object.prototype.toString.call(n[f])==="[object Object]"?t[f]=e.extend(!0,t[f],n[f]):t[f]=n[f])};for(;i<a;i++){let n=arguments[i];l(n)}return t}};vn.exports=xi});var hr=me((ya,wn)=>{var Te=ot(),gt=lt(),J=Ge(),xe=yt(),wa=st(),ws=Yt(),Xr=wt(),mn=ht(),_r=Xt(),ys=lr(),bn=Et(),Ss=or(),As=Tt(),Cs=Lt(),Ni=class{constructor(e){this.graph=null,this.doubleBondConfigCount=0,this.doubleBondConfig=null,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.canvasWrapper=null,this.totalOverlapScore=0,this.defaultOptions={width:500,height:500,scale:0,bondThickness:1,bondLength:30,shortBondLength:.8,bondSpacing:.17*30,atomVisualization:"default",isomeric:!0,debug:!1,terminalCarbons:!1,explicitHydrogens:!0,overlapSensitivity:.42,overlapResolutionIterations:1,compactDrawing:!0,fontFamily:"Arial, Helvetica, sans-serif",fontSizeLarge:11,fontSizeSmall:3,padding:10,experimentalSSSR:!1,kkThreshold:.1,kkInnerThreshold:.1,kkMaxIteration:2e4,kkMaxInnerIteration:50,kkMaxEnergy:1e9,weights:{colormap:null,additionalPadding:20,sigma:10,interval:0,opacity:1},themes:{dark:{C:"#fff",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#aaa",BACKGROUND:"#141414"},light:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"},oldschool:{C:"#000",O:"#000",N:"#000",F:"#000",CL:"#000",BR:"#000",I:"#000",P:"#000",S:"#000",B:"#000",SI:"#000",H:"#000",BACKGROUND:"#fff"},solarized:{C:"#586e75",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#657b83",BACKGROUND:"#fff"},"solarized-dark":{C:"#93a1a1",O:"#dc322f",N:"#268bd2",F:"#859900",CL:"#16a085",BR:"#cb4b16",I:"#6c71c4",P:"#d33682",S:"#b58900",B:"#2aa198",SI:"#2aa198",H:"#839496",BACKGROUND:"#fff"},matrix:{C:"#678c61",O:"#2fc079",N:"#4f7e7e",F:"#90d762",CL:"#82d967",BR:"#23755a",I:"#409931",P:"#c1ff8a",S:"#faff00",B:"#50b45a",SI:"#409931",H:"#426644",BACKGROUND:"#fff"},github:{C:"#24292f",O:"#cf222e",N:"#0969da",F:"#2da44e",CL:"#6fdd8b",BR:"#bc4c00",I:"#8250df",P:"#bf3989",S:"#d4a72c",B:"#fb8f44",SI:"#bc4c00",H:"#57606a",BACKGROUND:"#fff"},carbon:{C:"#161616",O:"#da1e28",N:"#0f62fe",F:"#198038",CL:"#007d79",BR:"#fa4d56",I:"#8a3ffc",P:"#ff832b",S:"#f1c21b",B:"#8a3800",SI:"#e67e22",H:"#525252",BACKGROUND:"#fff"},cyberpunk:{C:"#ea00d9",O:"#ff3131",N:"#0abdc6",F:"#00ff9f",CL:"#00fe00",BR:"#fe9f20",I:"#ff00ff",P:"#fe7f00",S:"#fcee0c",B:"#ff00ff",SI:"#ffffff",H:"#913cb1",BACKGROUND:"#fff"},gruvbox:{C:"#665c54",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#79740e",BR:"#d65d0e",I:"#b16286",P:"#af3a03",S:"#d79921",B:"#689d6a",SI:"#427b58",H:"#7c6f64",BACKGROUND:"#fbf1c7"},"gruvbox-dark":{C:"#ebdbb2",O:"#cc241d",N:"#458588",F:"#98971a",CL:"#b8bb26",BR:"#d65d0e",I:"#b16286",P:"#fe8019",S:"#d79921",B:"#8ec07c",SI:"#83a598",H:"#bdae93",BACKGROUND:"#282828"},custom:{C:"#222",O:"#e74c3c",N:"#3498db",F:"#27ae60",CL:"#16a085",BR:"#d35400",I:"#8e44ad",P:"#d35400",S:"#f1c40f",B:"#e67e22",SI:"#e67e22",H:"#666",BACKGROUND:"#fff"}}},this.opts=Cs.extend(!0,this.defaultOptions,e),this.opts.halfBondSpacing=this.opts.bondSpacing/2,this.opts.bondLengthSq=this.opts.bondLength*this.opts.bondLength,this.opts.halfFontSizeLarge=this.opts.fontSizeLarge/2,this.opts.quarterFontSizeLarge=this.opts.fontSizeLarge/4,this.opts.fifthFontSizeSmall=this.opts.fontSizeSmall/5,this.theme=this.opts.themes.dark}draw(e,t,r="light",i=!1){this.initDraw(e,r,i),this.infoOnly||(this.themeManager=new As(this.opts.themes,r),this.canvasWrapper=new ys(t,this.themeManager,this.opts)),i||(this.processGraph(),this.canvasWrapper.scale(this.graph.vertices),this.drawEdges(this.opts.debug),this.drawVertices(this.opts.debug),this.canvasWrapper.reset(),this.opts.debug&&(console.log(this.graph),console.log(this.rings),console.log(this.ringConnections)))}edgeRingCount(e){let t=this.graph.edges[e],r=this.graph.vertices[t.sourceId],i=this.graph.vertices[t.targetId];return Math.min(r.value.rings.length,i.value.rings.length)}getBridgedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&e.push(this.rings[t]);return e}getFusedRings(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isFused&&e.push(this.rings[t]);return e}getSpiros(){let e=Array();for(var t=0;t<this.rings.length;t++)this.rings[t].isSpiro&&e.push(this.rings[t]);return e}printRingInfo(){let e="";for(var t=0;t<this.rings.length;t++){let r=this.rings[t];e+=r.id+";",e+=r.members.length+";",e+=r.neighbours.length+";",e+=r.isSpiro?"true;":"false;",e+=r.isFused?"true;":"false;",e+=r.isBridged?"true;":"false;",e+=r.rings.length+";",e+=`
`}return e}rotateDrawing(){let e=0,t=0,r=0;for(var i=0;i<this.graph.vertices.length;i++){let n=this.graph.vertices[i];if(n.value.isDrawn)for(var a=i+1;a<this.graph.vertices.length;a++){let f=this.graph.vertices[a];if(!f.value.isDrawn)continue;let h=n.position.distanceSq(f.position);h>r&&(r=h,e=i,t=a)}}let l=-J.subtract(this.graph.vertices[e].position,this.graph.vertices[t].position).angle();if(!isNaN(l)){let n=l%.523599;n<.2617995?l=l-n:l+=.523599-n;for(var i=0;i<this.graph.vertices.length;i++)i!==t&&this.graph.vertices[i].position.rotateAround(l,this.graph.vertices[t].position);for(var i=0;i<this.rings.length;i++)this.rings[i].center.rotateAround(l,this.graph.vertices[t].position)}}getTotalOverlapScore(){return this.totalOverlapScore}getRingCount(){return this.rings.length}hasBridgedRing(){return this.bridgedRing}getHeavyAtomCount(){let e=0;for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.element!=="H"&&e++;return e}getMolecularFormula(e=null){let t="",r=new Map,i=e===null?this.graph:new bn(e,this.opts.isomeric);for(var a=0;a<i.vertices.length;a++){let n=i.vertices[a].value;if(r.has(n.element)?r.set(n.element,r.get(n.element)+1):r.set(n.element,1),n.bracket&&!n.bracket.chirality&&(r.has("H")?r.set("H",r.get("H")+n.bracket.hcount):r.set("H",n.bracket.hcount)),!n.bracket){let f=Xr.maxBonds[n.element]-n.bondCount;n.isPartOfAromaticRing&&f--,r.has("H")?r.set("H",r.get("H")+f):r.set("H",f)}}if(r.has("C")){let n=r.get("C");t+="C"+(n>1?n:""),r.delete("C")}if(r.has("H")){let n=r.get("H");t+="H"+(n>1?n:""),r.delete("H")}return Object.keys(Xr.atomicNumbers).sort().map(n=>{if(r.has(n)){let f=r.get(n);t+=n+(f>1?f:"")}}),t}getRingbondType(e,t){if(e.value.getRingbondCount()<1||t.value.getRingbondCount()<1)return null;for(var r=0;r<e.value.ringbonds.length;r++)for(var i=0;i<t.value.ringbonds.length;i++)if(e.value.ringbonds[r].id===t.value.ringbonds[i].id)return e.value.ringbonds[r].bondType==="-"?t.value.ringbonds[i].bond:e.value.ringbonds[r].bond;return null}initDraw(e,t,r,i){this.data=e,this.infoOnly=r,this.ringIdCounter=0,this.ringConnectionIdCounter=0,this.graph=new bn(e,this.opts.isomeric),this.rings=Array(),this.ringConnections=Array(),this.originalRings=Array(),this.originalRingConnections=Array(),this.bridgedRing=!1,this.doubleBondConfigCount=null,this.doubleBondConfig=null,this.highlight_atoms=i,this.initRings(),this.initHydrogens()}processGraph(){this.position(),this.restoreRingInformation(),this.resolvePrimaryOverlaps();let e=this.getOverlapScore();this.totalOverlapScore=this.getOverlapScore().total;for(var t=0;t<this.opts.overlapResolutionIterations;t++)for(var r=0;r<this.graph.edges.length;r++){let i=this.graph.edges[r];if(this.isEdgeRotatable(i)){let a=this.graph.getTreeDepth(i.sourceId,i.targetId),l=this.graph.getTreeDepth(i.targetId,i.sourceId),n=i.targetId,f=i.sourceId;if(a>l&&(n=i.sourceId,f=i.targetId),this.getSubtreeOverlapScore(f,n,e.vertexScores).value>this.opts.overlapSensitivity){let d=this.graph.vertices[n],u=this.graph.vertices[f],c=u.getNeighbours(n);if(c.length===1){let b=this.graph.vertices[c[0]],x=b.position.getRotateAwayFromAngle(d.position,u.position,Te.toRad(120));this.rotateSubtree(b.id,u.id,x,u.position);let y=this.getOverlapScore().total;y>this.totalOverlapScore?this.rotateSubtree(b.id,u.id,-x,u.position):this.totalOverlapScore=y}else if(c.length===2){if(u.value.rings.length!==0&&d.value.rings.length!==0)continue;let b=this.graph.vertices[c[0]],x=this.graph.vertices[c[1]];if(b.value.rings.length===1&&x.value.rings.length===1){if(b.value.rings[0]!==x.value.rings[0])continue}else{if(b.value.rings.length!==0||x.value.rings.length!==0)continue;{let y=b.position.getRotateAwayFromAngle(d.position,u.position,Te.toRad(120)),L=x.position.getRotateAwayFromAngle(d.position,u.position,Te.toRad(120));this.rotateSubtree(b.id,u.id,y,u.position),this.rotateSubtree(x.id,u.id,L,u.position);let A=this.getOverlapScore().total;A>this.totalOverlapScore?(this.rotateSubtree(b.id,u.id,-y,u.position),this.rotateSubtree(x.id,u.id,-L,u.position)):this.totalOverlapScore=A}}}e=this.getOverlapScore()}}}this.resolveSecondaryOverlaps(e.scores),this.opts.isomeric&&this.annotateStereochemistry(),this.opts.compactDrawing&&this.opts.atomVisualization==="default"&&this.initPseudoElements(),this.rotateDrawing()}initRings(){let e=new Map;for(var t=this.graph.vertices.length-1;t>=0;t--){let a=this.graph.vertices[t];if(a.value.ringbonds.length!==0)for(var r=0;r<a.value.ringbonds.length;r++){let l=a.value.ringbonds[r].id,n=a.value.ringbonds[r].bond;if(!e.has(l))e.set(l,[a.id,n]);else{let f=a.id,h=e.get(l)[0],d=e.get(l)[1],u=new ws(f,h,1);u.setBondType(d||n||"-");let c=this.graph.addEdge(u),b=this.graph.vertices[h];a.addRingbondChild(h,r),a.value.addNeighbouringElement(b.value.element),b.addRingbondChild(f,r),b.value.addNeighbouringElement(a.value.element),a.edges.push(c),b.edges.push(c),e.delete(l)}}}let i=Ss.getRings(this.graph,this.opts.experimentalSSSR);if(i!==null){for(var t=0;t<i.length;t++){let l=[...i[t]],n=this.addRing(new mn(l));for(var r=0;r<l.length;r++)this.graph.vertices[l[r]].value.rings.push(n)}for(var t=0;t<this.rings.length-1;t++)for(var r=t+1;r<this.rings.length;r++){let n=this.rings[t],f=this.rings[r],h=new _r(n,f);h.vertices.size>0&&this.addRingConnection(h)}for(var t=0;t<this.rings.length;t++){let l=this.rings[t];l.neighbours=_r.getNeighbours(this.ringConnections,l.id)}for(var t=0;t<this.rings.length;t++){let l=this.rings[t];this.graph.vertices[l.members[0]].value.addAnchoredRing(l.id)}for(this.backupRingInformation();this.rings.length>0;){let a=-1;for(var t=0;t<this.rings.length;t++){let h=this.rings[t];this.isPartOfBridgedRing(h.id)&&!h.isBridged&&(a=h.id)}if(a===-1)break;let l=this.getRing(a),n=this.getBridgedRingRings(l.id);this.bridgedRing=!0,this.createBridgedRing(n,l.members[0]),this.bridgedRing=!1;for(var t=0;t<n.length;t++)this.removeRing(n[t])}}}initHydrogens(){if(!this.opts.explicitHydrogens)for(var e=0;e<this.graph.vertices.length;e++){let t=this.graph.vertices[e];if(t.value.element!=="H")continue;let r=this.graph.vertices[t.neighbours[0]];r.value.hasHydrogen=!0,(!r.value.isStereoCenter||r.value.rings.length<2&&!r.value.bridgedRing||r.value.bridgedRing&&r.value.originalRings.length<2)&&(t.value.isDrawn=!1)}}getBridgedRingRings(e){let t=Array(),r=this,i=function(a){let l=r.getRing(a);t.push(a);for(var n=0;n<l.neighbours.length;n++){let f=l.neighbours[n];t.indexOf(f)===-1&&f!==a&&_r.isBridge(r.ringConnections,r.graph.vertices,a,f)&&i(f)}};return i(e),gt.unique(t)}isPartOfBridgedRing(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].containsRing(e)&&this.ringConnections[t].isBridge(this.graph.vertices))return!0;return!1}createBridgedRing(e,t){let r=new Set,i=new Set,a=new Set;for(var l=0;l<e.length;l++){let c=this.getRing(e[l]);c.isPartOfBridged=!0;for(var n=0;n<c.members.length;n++)i.add(c.members[n]);for(var n=0;n<c.neighbours.length;n++){let x=c.neighbours[n];e.indexOf(x)===-1&&a.add(c.neighbours[n])}}let f=new Set;for(let c of i){let b=this.graph.vertices[c],x=gt.intersection(e,b.value.rings);b.value.rings.length===1||x.length===1?r.add(b.id):f.add(b.id)}let h=Array(),d=Array();for(let c of f){let b=this.graph.vertices[c],x=!1;for(let y=0;y<b.edges.length;y++)this.edgeRingCount(b.edges[y])===1&&(x=!0);x?(b.value.isBridgeNode=!0,r.add(b.id)):(b.value.isBridge=!0,r.add(b.id))}let u=new mn([...r]);this.addRing(u),u.isBridged=!0,u.neighbours=[...a];for(var l=0;l<e.length;l++)u.rings.push(this.getRing(e[l]).clone());for(var l=0;l<u.members.length;l++)this.graph.vertices[u.members[l]].value.bridgedRing=u.id;for(var l=0;l<d.length;l++){let b=this.graph.vertices[d[l]];b.value.rings=Array()}for(let c of r){let b=this.graph.vertices[c];b.value.rings=gt.removeAll(b.value.rings,e),b.value.rings.push(u.id)}for(var l=0;l<e.length;l++)for(var n=l+1;n<e.length;n++)this.removeRingConnectionsBetween(e[l],e[n]);for(let c of a){let b=this.getRingConnections(c,e);for(var n=0;n<b.length;n++)this.getRingConnection(b[n]).updateOther(u.id,c);this.getRing(c).neighbours.push(u.id)}return u}areVerticesInSameRing(e,t){for(var r=0;r<e.value.rings.length;r++)for(var i=0;i<t.value.rings.length;i++)if(e.value.rings[r]===t.value.rings[i])return!0;return!1}getCommonRings(e,t){let r=Array();for(var i=0;i<e.value.rings.length;i++)for(var a=0;a<t.value.rings.length;a++)e.value.rings[i]==t.value.rings[a]&&r.push(e.value.rings[i]);return r}getLargestOrAromaticCommonRing(e,t){let r=this.getCommonRings(e,t),i=0,a=null;for(var l=0;l<r.length;l++){let n=this.getRing(r[l]),f=n.getSize();if(n.isBenzeneLike(this.graph.vertices))return n;f>i&&(i=f,a=n)}return a}getVerticesAt(e,t,r){let i=Array();for(var a=0;a<this.graph.vertices.length;a++){let l=this.graph.vertices[a];if(l.id===r||!l.positioned)continue;e.distanceSq(l.position)<=t*t&&i.push(l.id)}return i}getClosestVertex(e){let t=99999,r=null;for(var i=0;i<this.graph.vertices.length;i++){let a=this.graph.vertices[i];if(a.id===e.id)continue;let l=e.position.distanceSq(a.position);l<t&&(t=l,r=a)}return r}addRing(e){return e.id=this.ringIdCounter++,this.rings.push(e),e.id}removeRing(e){this.rings=this.rings.filter(function(r){return r.id!==e}),this.ringConnections=this.ringConnections.filter(function(r){return r.firstRingId!==e&&r.secondRingId!==e});for(var t=0;t<this.rings.length;t++){let r=this.rings[t];r.neighbours=r.neighbours.filter(function(i){return i!==e})}}getRing(e){for(var t=0;t<this.rings.length;t++)if(this.rings[t].id==e)return this.rings[t]}addRingConnection(e){return e.id=this.ringConnectionIdCounter++,this.ringConnections.push(e),e.id}removeRingConnection(e){this.ringConnections=this.ringConnections.filter(function(t){return t.id!==e})}removeRingConnectionsBetween(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let a=this.ringConnections[i];(a.firstRingId===e&&a.secondRingId===t||a.firstRingId===t&&a.secondRingId===e)&&r.push(a.id)}for(var i=0;i<r.length;i++)this.removeRingConnection(r[i])}getRingConnection(e){for(var t=0;t<this.ringConnections.length;t++)if(this.ringConnections[t].id==e)return this.ringConnections[t]}getRingConnections(e,t){let r=Array();for(var i=0;i<this.ringConnections.length;i++){let l=this.ringConnections[i];for(var a=0;a<t.length;a++){let n=t[a];(l.firstRingId===e&&l.secondRingId===n||l.firstRingId===n&&l.secondRingId===e)&&r.push(l.id)}}return r}getOverlapScore(){let e=0,t=new Float32Array(this.graph.vertices.length);for(var r=0;r<this.graph.vertices.length;r++)t[r]=0;for(var r=0;r<this.graph.vertices.length;r++)for(var i=this.graph.vertices.length;--i>r;){let n=this.graph.vertices[r],f=this.graph.vertices[i];if(!n.value.isDrawn||!f.value.isDrawn)continue;let h=J.subtract(n.position,f.position).lengthSq();if(h<this.opts.bondLengthSq){let d=(this.opts.bondLength-Math.sqrt(h))/this.opts.bondLength;e+=d,t[r]+=d,t[i]+=d}}let a=Array();for(var r=0;r<this.graph.vertices.length;r++)a.push({id:r,score:t[r]});return a.sort(function(l,n){return n.score-l.score}),{total:e,scores:a,vertexScores:t}}chooseSide(e,t,r){let i=e.getNeighbours(t.id),a=t.getNeighbours(e.id),l=i.length,n=a.length,f=gt.merge(i,a),h=[0,0];for(var d=0;d<f.length;d++)this.graph.vertices[f[d]].position.sameSideAs(e.position,t.position,r[0])?h[0]++:h[1]++;let u=[0,0];for(var d=0;d<this.graph.vertices.length;d++)this.graph.vertices[d].position.sameSideAs(e.position,t.position,r[0])?u[0]++:u[1]++;return{totalSideCount:u,totalPosition:u[0]>u[1]?0:1,sideCount:h,position:h[0]>h[1]?0:1,anCount:l,bnCount:n}}setRingCenter(e){let t=e.getSize(),r=new J(0,0);for(var i=0;i<t;i++)r.add(this.graph.vertices[e.members[i]].position);e.center=r.divide(t)}getSubringCenter(e,t){let r=t.value.originalRings,i=e.center,a=Number.MAX_VALUE;for(var l=0;l<r.length;l++)for(var n=0;n<e.rings.length;n++)r[l]===e.rings[n].id&&e.rings[n].getSize()<a&&(i=e.rings[n].center,a=e.rings[n].getSize());return i}drawEdges(e){let t=this,r=Array(this.graph.edges.length);if(r.fill(!1),this.graph.traverseBF(0,function(a){let l=t.graph.getEdges(a.id);for(var n=0;n<l.length;n++){let f=l[n];r[f]||(r[f]=!0,t.drawEdge(f,e))}}),!this.bridgedRing)for(var i=0;i<this.rings.length;i++){let a=this.rings[i];this.isRingAromatic(a)&&this.canvasWrapper.drawAromaticityRing(a)}}drawEdge(e,t){let r=this,i=this.graph.edges[e],a=this.graph.vertices[i.sourceId],l=this.graph.vertices[i.targetId],n=a.value.element,f=l.value.element;if((!a.value.isDrawn||!l.value.isDrawn)&&this.opts.atomVisualization==="default")return;let h=a.position,d=l.position,u=this.getEdgeNormals(i),c=gt.clone(u);if(c[0].multiplyScalar(10).add(h),c[1].multiplyScalar(10).add(h),i.bondType==="="||this.getRingbondType(a,l)==="="||i.isPartOfAromaticRing&&this.bridgedRing){let b=this.areVerticesInSameRing(a,l),x=this.chooseSide(a,l,c);if(b){let L=this.getLargestOrAromaticCommonRing(a,l).center;u[0].multiplyScalar(r.opts.bondSpacing),u[1].multiplyScalar(r.opts.bondSpacing);let A=null;L.sameSideAs(a.position,l.position,J.add(h,u[0]))?A=new xe(J.add(h,u[0]),J.add(d,u[0]),n,f):A=new xe(J.add(h,u[1]),J.add(d,u[1]),n,f),A.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),i.isPartOfAromaticRing?this.canvasWrapper.drawLine(A,!0):this.canvasWrapper.drawLine(A),this.canvasWrapper.drawLine(new xe(h,d,n,f))}else if(i.center||a.isTerminal()&&l.isTerminal()){u[0].multiplyScalar(r.opts.halfBondSpacing),u[1].multiplyScalar(r.opts.halfBondSpacing);let y=new xe(J.add(h,u[0]),J.add(d,u[0]),n,f),L=new xe(J.add(h,u[1]),J.add(d,u[1]),n,f);this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(L)}else if(x.anCount==0&&x.bnCount>1||x.bnCount==0&&x.anCount>1){u[0].multiplyScalar(r.opts.halfBondSpacing),u[1].multiplyScalar(r.opts.halfBondSpacing);let y=new xe(J.add(h,u[0]),J.add(d,u[0]),n,f),L=new xe(J.add(h,u[1]),J.add(d,u[1]),n,f);this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(L)}else if(x.sideCount[0]>x.sideCount[1]){u[0].multiplyScalar(r.opts.bondSpacing),u[1].multiplyScalar(r.opts.bondSpacing);let y=new xe(J.add(h,u[0]),J.add(d,u[0]),n,f);y.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new xe(h,d,n,f))}else if(x.sideCount[0]<x.sideCount[1]){u[0].multiplyScalar(r.opts.bondSpacing),u[1].multiplyScalar(r.opts.bondSpacing);let y=new xe(J.add(h,u[1]),J.add(d,u[1]),n,f);y.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new xe(h,d,n,f))}else if(x.totalSideCount[0]>x.totalSideCount[1]){u[0].multiplyScalar(r.opts.bondSpacing),u[1].multiplyScalar(r.opts.bondSpacing);let y=new xe(J.add(h,u[0]),J.add(d,u[0]),n,f);y.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new xe(h,d,n,f))}else if(x.totalSideCount[0]<=x.totalSideCount[1]){u[0].multiplyScalar(r.opts.bondSpacing),u[1].multiplyScalar(r.opts.bondSpacing);let y=new xe(J.add(h,u[1]),J.add(d,u[1]),n,f);y.shorten(this.opts.bondLength-this.opts.shortBondLength*this.opts.bondLength),this.canvasWrapper.drawLine(y),this.canvasWrapper.drawLine(new xe(h,d,n,f))}}else if(i.bondType==="#"){u[0].multiplyScalar(r.opts.bondSpacing/1.5),u[1].multiplyScalar(r.opts.bondSpacing/1.5);let b=new xe(J.add(h,u[0]),J.add(d,u[0]),n,f),x=new xe(J.add(h,u[1]),J.add(d,u[1]),n,f);this.canvasWrapper.drawLine(b),this.canvasWrapper.drawLine(x),this.canvasWrapper.drawLine(new xe(h,d,n,f))}else if(i.bondType!=="."){let b=a.value.isStereoCenter,x=l.value.isStereoCenter;i.wedge==="up"?this.canvasWrapper.drawWedge(new xe(h,d,n,f,b,x)):i.wedge==="down"?this.canvasWrapper.drawDashedWedge(new xe(h,d,n,f,b,x)):this.canvasWrapper.drawLine(new xe(h,d,n,f,b,x))}if(t){let b=J.midpoint(h,d);this.canvasWrapper.drawDebugText(b.x,b.y,"e: "+e)}}drawVertices(e){for(var t=this.graph.vertices.length,t=0;t<this.graph.vertices.length;t++){let i=this.graph.vertices[t],a=i.value,l=0,n=0,f=i.value.bondCount,h=a.element,d=Xr.maxBonds[h]-f,u=i.getTextDirection(this.graph.vertices),c=this.opts.terminalCarbons||h!=="C"||a.hasAttachedPseudoElements?i.isTerminal():!1,b=a.element==="C";if(a.element==="N"&&a.isPartOfAromaticRing&&(d=0),a.bracket&&(d=a.bracket.hcount,l=a.bracket.charge,n=a.bracket.isotope),(l||n||graph.vertices.length<3)&&(b=!1),this.opts.atomVisualization==="allballs")this.canvasWrapper.drawBall(i.position.x,i.position.y,h);else if(a.isDrawn&&(!b||a.drawExplicit||c||a.hasAttachedPseudoElements)||this.graph.vertices.length===1)this.opts.atomVisualization==="default"?this.canvasWrapper.drawText(i.position.x,i.position.y,h,d,u,c,l,n,this.graph.vertices.length,a.getAttachedPseudoElements()):this.opts.atomVisualization==="balls"&&this.canvasWrapper.drawBall(i.position.x,i.position.y,h);else if(i.getNeighbourCount()===2&&i.forcePositioned==!0){let x=this.graph.vertices[i.neighbours[0]].position,y=this.graph.vertices[i.neighbours[1]].position,L=J.threePointangle(i.position,x,y);Math.abs(Math.PI-L)<.1&&this.canvasWrapper.drawPoint(i.position.x,i.position.y,h)}if(e){let x="v: "+i.id+" "+gt.print(a.ringbonds);this.canvasWrapper.drawDebugText(i.position.x,i.position.y,x)}}if(this.opts.debug)for(var t=0;t<this.rings.length;t++){let i=this.rings[t].center;this.canvasWrapper.drawDebugPoint(i.x,i.y,"r: "+this.rings[t].id)}}position(){let e=null;for(var t=0;t<this.graph.vertices.length;t++)if(this.graph.vertices[t].value.bridgedRing!==null){e=this.graph.vertices[t];break}for(var t=0;t<this.rings.length;t++)this.rings[t].isBridged&&(e=this.graph.vertices[this.rings[t].members[0]]);this.rings.length>0&&e===null&&(e=this.graph.vertices[this.rings[0].members[0]]),e===null&&(e=this.graph.vertices[0]),this.createNextBond(e,null,0)}backupRingInformation(){this.originalRings=Array(),this.originalRingConnections=Array();for(var e=0;e<this.rings.length;e++)this.originalRings.push(this.rings[e]);for(var e=0;e<this.ringConnections.length;e++)this.originalRingConnections.push(this.ringConnections[e]);for(var e=0;e<this.graph.vertices.length;e++)this.graph.vertices[e].value.backupRings()}restoreRingInformation(){let e=this.getBridgedRings();this.rings=Array(),this.ringConnections=Array();for(var t=0;t<e.length;t++){let i=e[t];for(var r=0;r<i.rings.length;r++){let a=i.rings[r];this.originalRings[a.id].center=a.center}}for(var t=0;t<this.originalRings.length;t++)this.rings.push(this.originalRings[t]);for(var t=0;t<this.originalRingConnections.length;t++)this.ringConnections.push(this.originalRingConnections[t]);for(var t=0;t<this.graph.vertices.length;t++)this.graph.vertices[t].value.restoreRings()}createRing(e,t=null,r=null,i=null){if(e.positioned)return;t=t||new J(0,0);let a=e.getOrderedNeighbours(this.ringConnections),l=r?J.subtract(r.position,t).angle():0,n=Te.polyCircumradius(this.opts.bondLength,e.getSize()),f=Te.centralAngle(e.getSize());e.centralAngle=f;let h=l,d=this,u=r?r.id:null;if(e.members.indexOf(u)===-1&&(r&&(r.positioned=!1),u=e.members[0]),e.isBridged){this.graph.kkLayout(e.members.slice(),t,r.id,e,this.opts.bondLength,this.opts.kkThreshold,this.opts.kkInnerThreshold,this.opts.kkMaxIteration,this.opts.kkMaxInnerIteration,this.opts.kkMaxEnergy),e.positioned=!0,this.setRingCenter(e),t=e.center;for(var c=0;c<e.rings.length;c++)this.setRingCenter(e.rings[c])}else e.eachMember(this.graph.vertices,function(x){let y=d.graph.vertices[x];y.positioned||y.setPosition(t.x+Math.cos(h)*n,t.y+Math.sin(h)*n),h+=f,(!e.isBridged||e.rings.length<3)&&(y.angle=h,y.positioned=!0)},u,i?i.id:null);e.positioned=!0,e.center=t;for(var c=0;c<a.length;c++){let y=this.getRing(a[c].neighbour);if(y.positioned)continue;let L=_r.getVertices(this.ringConnections,e.id,y.id);if(L.length===2){e.isFused=!0,y.isFused=!0;let A=this.graph.vertices[L[0]],$=this.graph.vertices[L[1]],B=J.midpoint(A.position,$.position),O=J.normals(A.position,$.position);O[0].normalize(),O[1].normalize();let F=Te.polyCircumradius(this.opts.bondLength,y.getSize()),Q=Te.apothem(F,y.getSize());O[0].multiplyScalar(Q).add(B),O[1].multiplyScalar(Q).add(B);let j=O[0];J.subtract(t,O[1]).lengthSq()>J.subtract(t,O[0]).lengthSq()&&(j=O[1]);let ue=J.subtract(A.position,j),se=J.subtract($.position,j);ue.clockwise(se)===-1?y.positioned||this.createRing(y,j,A,$):y.positioned||this.createRing(y,j,$,A)}else if(L.length===1){e.isSpiro=!0,y.isSpiro=!0;let A=this.graph.vertices[L[0]],$=J.subtract(t,A.position);$.invert(),$.normalize();let B=Te.polyCircumradius(this.opts.bondLength,y.getSize());$.multiplyScalar(B),$.add(A.position),y.positioned||this.createRing(y,$,A)}}for(var c=0;c<e.members.length;c++){let y=this.graph.vertices[e.members[c]],L=y.neighbours;for(var b=0;b<L.length;b++){let A=this.graph.vertices[L[b]];A.positioned||(A.value.isConnectedToRing=!0,this.createNextBond(A,y,0))}}}rotateSubtree(e,t,r,i){let a=this;this.graph.traverseTree(e,t,function(l){l.position.rotateAround(r,i);for(var n=0;n<l.value.anchoredRings.length;n++){let f=a.rings[l.value.anchoredRings[n]];f&&f.center.rotateAround(r,i)}})}getSubtreeOverlapScore(e,t,r){let i=this,a=0,l=new J(0,0),n=0;return this.graph.traverseTree(e,t,function(f){if(!f.value.isDrawn)return;let h=r[f.id];h>i.opts.overlapSensitivity&&(a+=h,n++);let d=i.graph.vertices[f.id].position.clone();d.multiplyScalar(h),l.add(d)}),l.divide(a),{value:a/n,center:l}}getCurrentCenterOfMass(){let e=new J(0,0),t=0;for(var r=0;r<this.graph.vertices.length;r++){let i=this.graph.vertices[r];i.positioned&&(e.add(i.position),t++)}return e.divide(t)}getCurrentCenterOfMassInNeigbourhood(e,t=this.opts.bondLength*2){let r=new J(0,0),i=0,a=t*t;for(var l=0;l<this.graph.vertices.length;l++){let n=this.graph.vertices[l];n.positioned&&e.distanceSq(n.position)<a&&(r.add(n.position),i++)}return r.divide(i)}resolvePrimaryOverlaps(){let e=Array(),t=Array(this.graph.vertices.length);for(var r=0;r<this.rings.length;r++){let l=this.rings[r];for(var i=0;i<l.members.length;i++){let n=this.graph.vertices[l.members[i]];if(t[n.id])continue;t[n.id]=!0;let f=this.getNonRingNeighbours(n.id);if(f.length>1){let h=Array();for(var a=0;a<n.value.rings.length;a++)h.push(n.value.rings[a]);e.push({common:n,rings:h,vertices:f})}else if(f.length===1&&n.value.rings.length===2){let h=Array();for(var a=0;a<n.value.rings.length;a++)h.push(n.value.rings[a]);e.push({common:n,rings:h,vertices:f})}}}for(var r=0;r<e.length;r++){let n=e[r];if(n.vertices.length===2){let f=n.vertices[0],h=n.vertices[1];if(!f.value.isDrawn||!h.value.isDrawn)continue;let d=(2*Math.PI-this.getRing(n.rings[0]).getAngle())/6;this.rotateSubtree(f.id,n.common.id,d,n.common.position),this.rotateSubtree(h.id,n.common.id,-d,n.common.position);let u=this.getOverlapScore(),c=this.getSubtreeOverlapScore(f.id,n.common.id,u.vertexScores),b=this.getSubtreeOverlapScore(h.id,n.common.id,u.vertexScores),x=c.value+b.value;this.rotateSubtree(f.id,n.common.id,-2*d,n.common.position),this.rotateSubtree(h.id,n.common.id,2*d,n.common.position),u=this.getOverlapScore(),c=this.getSubtreeOverlapScore(f.id,n.common.id,u.vertexScores),b=this.getSubtreeOverlapScore(h.id,n.common.id,u.vertexScores),c.value+b.value>x&&(this.rotateSubtree(f.id,n.common.id,2*d,n.common.position),this.rotateSubtree(h.id,n.common.id,-2*d,n.common.position))}else n.vertices.length===1&&n.rings.length}}resolveSecondaryOverlaps(e){for(var t=0;t<e.length;t++)if(e[t].score>this.opts.overlapSensitivity){let r=this.graph.vertices[e[t].id];if(r.isTerminal()){let i=this.getClosestVertex(r);if(i){let a=null;i.isTerminal()?a=i.id===0?this.graph.vertices[1].position:i.previousPosition:a=i.id===0?this.graph.vertices[1].position:i.position;let l=r.id===0?this.graph.vertices[1].position:r.previousPosition;r.position.rotateAwayFrom(a,l,Te.toRad(20))}}}}getLastAngle(e){for(;e;){let t=this.graph.vertices[e];if(t.value.rings.length>0)return 0;if(t.angle)return t.angle;e=t.parentVertexId}return 0}createNextBond(e,t=null,r=0,i=!1,a=!1){if(e.positioned&&!a)return;let l=!1;if(t){let f=this.graph.getEdge(e.id,t.id);(f.bondType==="/"||f.bondType==="\\")&&++this.doubleBondConfigCount%2===1&&this.doubleBondConfig===null&&(this.doubleBondConfig=f.bondType,l=!0,t.parentVertexId===null&&e.value.branchBond&&(this.doubleBondConfig==="/"?this.doubleBondConfig="\\":this.doubleBondConfig==="\\"&&(this.doubleBondConfig="/")))}if(!a)if(t)if(t.value.rings.length>0){let f=t.neighbours,h=null,d=new J(0,0);if(t.value.bridgedRing===null&&t.value.rings.length>1)for(var n=0;n<f.length;n++){let u=this.graph.vertices[f[n]];if(gt.containsAll(u.value.rings,t.value.rings)){h=u;break}}if(h===null){for(var n=0;n<f.length;n++){let c=this.graph.vertices[f[n]];c.positioned&&this.areVerticesInSameRing(c,t)&&d.add(J.subtract(c.position,t.position))}d.invert().normalize().multiplyScalar(this.opts.bondLength).add(t.position)}else d=h.position.clone().rotateAround(Math.PI,t.position);e.previousPosition=t.position,e.setPositionFromVector(d),e.positioned=!0}else{let f=new J(this.opts.bondLength,0);f.rotate(r),f.add(t.position),e.setPositionFromVector(f),e.previousPosition=t.position,e.positioned=!0}else{let f=new J(this.opts.bondLength,0);f.rotate(Te.toRad(-60)),e.previousPosition=f,e.setPosition(this.opts.bondLength,0),e.angle=Te.toRad(-60),e.value.bridgedRing===null&&(e.positioned=!0)}if(e.value.bridgedRing!==null){let f=this.getRing(e.value.bridgedRing);if(!f.positioned){let h=J.subtract(e.previousPosition,e.position);h.invert(),h.normalize();let d=Te.polyCircumradius(this.opts.bondLength,f.members.length);h.multiplyScalar(d),h.add(e.position),this.createRing(f,h,e)}}else if(e.value.rings.length>0){let f=this.getRing(e.value.rings[0]);if(!f.positioned){let h=J.subtract(e.previousPosition,e.position);h.invert(),h.normalize();let d=Te.polyCircumradius(this.opts.bondLength,f.getSize());h.multiplyScalar(d),h.add(e.position),this.createRing(f,h,e)}}else{let f=e.value.isStereoCenter,h=e.getNeighbours(),d=Array();for(var n=0;n<h.length;n++)this.graph.vertices[h[n]].value.isDrawn&&d.push(h[n]);t&&(d=gt.remove(d,t.id));let u=e.getAngle();if(d.length===1){let c=this.graph.vertices[d[0]],b=t?this.graph.getEdge(e.id,t.id):null,x=this.graph.getEdge(e.id,c.id);if(b&&x&&b.weight+x.weight>=4)b.center=!0,x.center=!0,e.value.drawExplicit=!1,c.drawExplicit=!0,c.angle=0,this.createNextBond(c,e,u+c.angle);else if(t&&t.value.rings.length>0){let y=Te.toRad(60),L=-y,A=new J(this.opts.bondLength,0),$=new J(this.opts.bondLength,0);A.rotate(y).add(e.position),$.rotate(L).add(e.position);let B=this.getCurrentCenterOfMass(),O=A.distanceSq(B),F=$.distanceSq(B);c.angle=O<F?L:y,this.createNextBond(c,e,u+c.angle)}else{let y=e.angle;if(t&&t.neighbours.length>3?y>0?y=Math.min(1.0472,y):y<0?y=Math.max(-1.0472,y):y=1.0472:y||(y=this.getLastAngle(e.id),y||(y=1.0472)),t&&!l){let L=this.graph.getEdge(e.id,c.id).bondType;L==="/"?(this.doubleBondConfig==="/"||this.doubleBondConfig==="\\"&&(y=-y),this.doubleBondConfig=null):L==="\\"&&(this.doubleBondConfig==="/"?y=-y:this.doubleBondConfig,this.doubleBondConfig=null)}i?c.angle=y:c.angle=-y,this.createNextBond(c,e,u+c.angle)}}else if(d.length===2){let c=e.angle;c||(c=1.0472);let b=this.graph.getTreeDepth(d[0],e.id),x=this.graph.getTreeDepth(d[1],e.id),y=this.graph.vertices[d[0]],L=this.graph.vertices[d[1]];y.value.subtreeDepth=b,L.value.subtreeDepth=x;let A=this.graph.getTreeDepth(t?t.id:null,e.id);t&&(t.value.subtreeDepth=A);let $=0,B=1;L.value.element==="C"&&y.value.element!=="C"&&x>1&&b<5?($=1,B=0):L.value.element!=="C"&&y.value.element==="C"&&b>1&&x<5?($=0,B=1):x>b&&($=1,B=0);let O=this.graph.vertices[d[$]],F=this.graph.vertices[d[B]],Q=this.graph.getEdge(e.id,O.id),j=this.graph.getEdge(e.id,F.id),ue=!1;A<b&&A<x&&(ue=!0),F.angle=c,O.angle=-c,this.doubleBondConfig==="\\"?F.value.branchBond==="\\"&&(F.angle=-c,O.angle=c):this.doubleBondConfig==="/"&&F.value.branchBond==="/"&&(F.angle=-c,O.angle=c),this.createNextBond(F,e,u+F.angle,ue),this.createNextBond(O,e,u+O.angle,ue)}else if(d.length>0){let c=d.map(b=>{let x=this.graph.vertices[b],y=this.graph.getTreeDepth(b,e.id);return x.value.subtreeDepth=y,x});if(c.sort((b,x)=>b.value.subtreeDepth<x.value.subtreeDepth),d.length===3&&t&&t.value.rings.length<1&&c[2].value.rings.length<1&&c[1].value.rings.length<1&&c[0].value.rings.length<1&&c[2].value.subtreeDepth===1&&c[1].value.subtreeDepth===1&&c[0].value.subtreeDepth>1)c[0].angle=-e.angle,e.angle>=0?(c[1].angle=Te.toRad(30),c[2].angle=Te.toRad(90)):(c[1].angle=-Te.toRad(30),c[2].angle=-Te.toRad(90)),this.createNextBond(c[0],e,u+c[0].angle),this.createNextBond(c[1],e,u+c[1].angle),this.createNextBond(c[2],e,u+c[2].angle);else{let b=d.length+(t?1:0),x=2*Math.PI/b,y=x,L=0;for(d.length%2!==0?(c[0].angle=0,this.createNextBond(c[0],e,u),L=1):y/=2;L<d.length;)c[L+0].angle=y,c[L+1].angle=-y,this.createNextBond(c[L+0],e,u+y),this.createNextBond(c[L+1],e,u-y),y+=x,L+=2}}}}getCommonRingbondNeighbour(e){let t=e.neighbours;for(var r=0;r<t.length;r++){let i=this.graph.vertices[t[r]];if(gt.containsAll(i.value.rings,e.value.rings))return i}return null}isPointInRing(e){for(var t=0;t<this.rings.length;t++){let r=this.rings[t];if(!r.positioned)continue;let i=Te.polyCircumradius(this.opts.bondLength,r.getSize()),a=i*i;if(e.distanceSq(r.center)<a)return!0}return!1}isEdgeInRing(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return this.areVerticesInSameRing(t,r)}isEdgeRotatable(e){let t=this.graph.vertices[e.sourceId],r=this.graph.vertices[e.targetId];return!(e.bondType!=="-"||t.isTerminal()||r.isTerminal()||t.value.rings.length>0&&r.value.rings.length>0&&this.areVerticesInSameRing(t,r))}isRingAromatic(e){for(var t=0;t<e.members.length;t++)if(!this.graph.vertices[e.members[t]].value.isPartOfAromaticRing)return!1;return!0}getEdgeNormals(e){let t=this.graph.vertices[e.sourceId].position,r=this.graph.vertices[e.targetId].position;return J.units(t,r)}getNonRingNeighbours(e){let t=Array(),r=this.graph.vertices[e],i=r.neighbours;for(var a=0;a<i.length;a++){let l=this.graph.vertices[i[a]];gt.intersection(r.value.rings,l.value.rings).length===0&&l.value.isBridge==!1&&t.push(l)}return t}annotateStereochemistry(){let e=10;for(var t=0;t<this.graph.vertices.length;t++){let l=this.graph.vertices[t];if(!l.value.isStereoCenter)continue;let n=l.getNeighbours(),f=n.length,h=Array(f);for(var r=0;r<f;r++){let ee=new Uint8Array(this.graph.vertices.length),te=Array(Array());ee[l.id]=1,this.visitStereochemistry(n[r],l.id,ee,te,e,0);for(var i=0;i<te.length;i++)te[i].sort(function(be,ce){return ce-be});h[r]=[r,te]}let d=0,u=0;for(var r=0;r<h.length;r++){h[r][1].length>d&&(d=h[r][1].length);for(var i=0;i<h[r][1].length;i++)h[r][1][i].length>u&&(u=h[r][1][i].length)}for(var r=0;r<h.length;r++){let te=d-h[r][1].length;for(var i=0;i<te;i++)h[r][1].push([]);h[r][1].push([n[r]]);for(var i=0;i<h[r][1].length;i++){let ce=u-h[r][1][i].length;for(var a=0;a<ce;a++)h[r][1][i].push(0)}}h.sort(function(ee,te){for(var be=0;be<ee[1].length;be++)for(var ce=0;ce<ee[1][be].length;ce++){if(ee[1][be][ce]>te[1][be][ce])return-1;if(ee[1][be][ce]<te[1][be][ce])return 1}return 0});let c=new Uint8Array(f);for(var r=0;r<f;r++)c[r]=h[r][0],l.value.priority=r;let b=this.graph.vertices[n[c[0]]].position,x=this.graph.vertices[n[c[1]]].position,y=this.graph.vertices[n[c[2]]].position,L=b.relativeClockwise(x,l.position),A=b.relativeClockwise(y,l.position),$=L===-1,B=l.value.bracket.chirality==="@"?-1:1,O=Te.parityOfPermutation(c)*B===1?"R":"S",F="down",Q="up";($&&O!=="R"||!$&&O!=="S")&&(l.value.hydrogenDirection="up",F="up",Q="down"),l.value.hasHydrogen&&(this.graph.getEdge(l.id,n[c[c.length-1]]).wedge=F);let j=new Array(n.length-1),ue=l.value.rings.length>1&&l.value.hasHydrogen,se=l.value.hasHydrogen?1:0;for(var r=0;r<c.length-se;r++){j[r]=new Uint32Array(2);let te=this.graph.vertices[n[c[r]]];j[r][0]+=te.value.isStereoCenter?0:1e5,j[r][0]+=this.areVerticesInSameRing(te,l)?0:1e4,j[r][0]+=te.value.isHeteroAtom()?1e3:0,j[r][0]-=te.value.subtreeDepth===0?1e3:0,j[r][0]+=1e3-te.value.subtreeDepth,j[r][1]=n[c[r]]}if(j.sort(function(ee,te){return ee[0]>te[0]?-1:ee[0]<te[0]?1:0}),!ue){let ee=j[0][1];if(l.value.hasHydrogen)this.graph.getEdge(l.id,ee).wedge=Q;else{let te=Q;for(var r=c.length-1;r>=0&&(te===F?te=Q:te=F,n[c[r]]!==ee);r--);this.graph.getEdge(l.id,ee).wedge=te}}l.value.chirality=O}}visitStereochemistry(e,t,r,i,a,l,n=0){r[e]=1;let f=this.graph.vertices[e],h=f.value.getAtomicNumber();i.length<=l&&i.push(Array());for(var d=0;d<this.graph.getEdge(e,t).weight;d++)i[l].push(n*1e3+h);let u=this.graph.vertices[e].neighbours;for(var d=0;d<u.length;d++)r[u[d]]!==1&&l<a-1&&this.visitStereochemistry(u[d],e,r.slice(),i,a,l+1,h);if(l<a-1){let c=0;for(var d=0;d<u.length;d++)c+=this.graph.getEdge(e,u[d]).weight;for(var d=0;d<f.value.getMaxBonds()-c;d++)i.length<=l+1&&i.push(Array()),i[l+1].push(h*1e3+1)}}initPseudoElements(){for(var e=0;e<this.graph.vertices.length;e++){let r=this.graph.vertices[e],i=r.neighbours,a=Array(i.length);for(var t=0;t<i.length;t++)a[t]=this.graph.vertices[i[t]];if(r.getNeighbourCount()<3||r.value.rings.length>0||r.value.element==="P"||r.value.element==="C"&&a.length===3&&a[0].value.element==="N"&&a[1].value.element==="N"&&a[2].value.element==="N")continue;let l=0,n=0;for(var t=0;t<a.length;t++){let d=a[t],u=d.value.element,c=d.getNeighbourCount();u!=="C"&&u!=="H"&&c===1&&l++,c>1&&n++}if(n>1||l<2)continue;let f=null;for(var t=0;t<a.length;t++){let d=a[t];d.getNeighbourCount()>1&&(f=d)}for(var t=0;t<a.length;t++){let d=a[t];if(d.getNeighbourCount()>1)continue;d.value.isDrawn=!1;let u=Xr.maxBonds[d.value.element]-d.value.bondCount,c="";d.value.bracket&&(u=d.value.bracket.hcount,c=d.value.bracket.charge||0),r.value.attachPseudoElement(d.value.element,f?f.value.element:null,u,c)}}for(var e=0;e<this.graph.vertices.length;e++){let i=this.graph.vertices[e],a=i.value,l=a.element;if(l==="C"||l==="H"||!a.isDrawn)continue;let n=i.neighbours,f=Array(n.length);for(var t=0;t<n.length;t++)f[t]=this.graph.vertices[n[t]];for(var t=0;t<f.length;t++){let d=f[t].value;if(!d.hasAttachedPseudoElements||d.getAttachedPseudoElementsCount()!==2)continue;let u=d.getAttachedPseudoElements();u.hasOwnProperty("0O")&&u.hasOwnProperty("3C")&&(d.isDrawn=!1,i.value.attachPseudoElement("Ac","",0))}}}};wn.exports=Ni});var Mt=me((Aa,yn)=>{var{getChargeText:Sa}=_t(),xs=yt(),qe=Ge(),Ns=ot();function Rs(M){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t.length,i=0;i<M;i++)e+=t.charAt(Math.floor(Math.random()*r));return e}var Ri=class M{constructor(e,t,r,i=!0){if(typeof t=="string"||t instanceof String?this.svg=document.getElementById(t):this.svg=t,this.container=null,this.opts=r,this.uid=Rs(5),this.gradientId=0,this.backgroundItems=[],this.paths=[],this.vertices=[],this.gradients=[],this.highlights=[],this.drawingWidth=0,this.drawingHeight=0,this.halfBondThickness=this.opts.bondThickness/2,this.themeManager=e,this.maskElements=[],this.maxX=-Number.MAX_VALUE,this.maxY=-Number.MAX_VALUE,this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,i)for(;this.svg.firstChild;)this.svg.removeChild(this.svg.firstChild);this.style=document.createElementNS("http://www.w3.org/2000/svg","style"),this.style.appendChild(document.createTextNode(`
                .element {
                    font: ${this.opts.fontSizeLarge}pt ${this.opts.fontFamily};
                }
                .sub {
                    font: ${this.opts.fontSizeSmall}pt ${this.opts.fontFamily};
                }
            `)),this.svg?this.svg.appendChild(this.style):(this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),container.appendChild(this.style))}constructSvg(){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask"),r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","g"),a=document.createElementNS("http://www.w3.org/2000/svg","g"),l=document.createElementNS("http://www.w3.org/2000/svg","g"),n=this.paths,f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttributeNS(null,"x",this.minX),f.setAttributeNS(null,"y",this.minY),f.setAttributeNS(null,"width",this.maxX-this.minX),f.setAttributeNS(null,"height",this.maxY-this.minY),f.setAttributeNS(null,"fill","white"),t.appendChild(f),t.setAttributeNS(null,"id",this.uid+"-text-mask");for(let h of n)a.appendChild(h);for(let h of this.backgroundItems)r.appendChild(h);for(let h of this.highlights)i.appendChild(h);for(let h of this.vertices)l.appendChild(h);for(let h of this.maskElements)t.appendChild(h);for(let h of this.gradients)e.appendChild(h);if(a.setAttributeNS(null,"mask","url(#"+this.uid+"-text-mask)"),this.updateViewbox(this.opts.scale),r.setAttributeNS(null,"style",`transform: translateX(${this.minX}px) translateY(${this.minY}px)`),this.svg)this.svg.appendChild(e),this.svg.appendChild(t),this.svg.appendChild(r),this.svg.appendChild(i),this.svg.appendChild(a),this.svg.appendChild(l);else return this.container.appendChild(e),this.container.appendChild(t),this.container.appendChild(r),this.container.appendChild(a),this.container.appendChild(l),this.container}addLayer(e){this.backgroundItems.push(e.firstChild)}createGradient(e){let t=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),r=this.uid+`-line-${this.gradientId++}`,i=e.getLeftVector(),a=e.getRightVector(),l=i.x,n=i.y,f=a.x,h=a.y;t.setAttributeNS(null,"id",r),t.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),t.setAttributeNS(null,"x1",l),t.setAttributeNS(null,"y1",n),t.setAttributeNS(null,"x2",f),t.setAttributeNS(null,"y2",h);let d=document.createElementNS("http://www.w3.org/2000/svg","stop");d.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getLeftElement())||this.themeManager.getColor("C")),d.setAttributeNS(null,"offset","20%");let u=document.createElementNS("http://www.w3.org/2000/svg","stop");return u.setAttributeNS(null,"stop-color",this.themeManager.getColor(e.getRightElement()||this.themeManager.getColor("C"))),u.setAttributeNS(null,"offset","100%"),t.appendChild(d),t.appendChild(u),this.gradients.push(t),r}createSubSuperScripts(e,t){let r=document.createElementNS("http://www.w3.org/2000/svg","tspan");return r.setAttributeNS(null,"baseline-shift",t),r.appendChild(document.createTextNode(e)),r.setAttributeNS(null,"class","sub"),r}static createUnicodeCharge(e){return e===1?"\u207A":e===-1?"\u207B":e>1?M.createUnicodeSuperscript(e)+"\u207A":e<-1?M.createUnicodeSuperscript(e)+"\u207B":""}determineDimensions(e){for(var t=0;t<e.length;t++){if(!e[t].value.isDrawn)continue;let i=e[t].position;this.maxX<i.x&&(this.maxX=i.x),this.maxY<i.y&&(this.maxY=i.y),this.minX>i.x&&(this.minX=i.x),this.minY>i.y&&(this.minY=i.y)}let r=this.opts.padding;this.maxX+=r,this.maxY+=r,this.minX-=r,this.minY-=r,this.drawingWidth=this.maxX-this.minX,this.drawingHeight=this.maxY-this.minY}updateViewbox(e){let t=this.minX,r=this.minY,i=this.maxX-this.minX,a=this.maxY-this.minY;if(e<=0)if(i>a){let l=i-a;a=i,r-=l/2}else{let l=a-i;i=a,t-=l/2}else this.svg&&(this.svg.style.width=e*i+"px",this.svg.style.height=e*a+"px");this.svg.setAttributeNS(null,"viewBox",`${t} ${r} ${i} ${a}`)}drawBall(e,t,r){let i=this.opts.bondLength/4.5;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",t),a.setAttributeNS(null,"r",i),a.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(a)}drawWedge(e){let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=qe.normals(t,r);i[0].normalize(),i[1].normalize();let a=e.getRightChiral(),l=t,n=r;a&&(l=r,n=t);let f=qe.add(l,qe.multiplyScalar(i[0],this.halfBondThickness)),h=qe.add(n,qe.multiplyScalar(i[0],3+this.opts.fontSizeLarge/4)),d=qe.add(n,qe.multiplyScalar(i[1],3+this.opts.fontSizeLarge/4)),u=qe.add(l,qe.multiplyScalar(i[1],this.halfBondThickness)),c=document.createElementNS("http://www.w3.org/2000/svg","polygon"),b=this.createGradient(e,t.x,t.y,r.x,r.y);c.setAttributeNS(null,"points",`${f.x},${f.y} ${h.x},${h.y} ${d.x},${d.y} ${u.x},${u.y}`),c.setAttributeNS(null,"fill",`url('#${b}')`),this.paths.push(c)}drawAtomHighlight(e,t,r="#03fc9d"){let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",this.opts.bondLength/3),i.setAttributeNS(null,"fill",r),this.highlights.push(i)}drawDashedWedge(e){if(isNaN(e.from.x)||isNaN(e.from.y)||isNaN(e.to.x)||isNaN(e.to.y))return;let t=e.getLeftVector().clone(),r=e.getRightVector().clone(),i=qe.normals(t,r);i[0].normalize(),i[1].normalize();let a=e.getRightChiral(),l,n;a?(l=r,n=t):(l=t,n=r);let f=qe.subtract(n,l).normalize(),h=e.getLength(),d=1.25/(h/(this.opts.bondLength/10)),u=!1,c=this.createGradient(e);for(let b=0;b<1;b+=d){let x=qe.multiplyScalar(f,b*h),y=qe.add(l,x),L=this.opts.fontSizeLarge/2*b,A=qe.multiplyScalar(i[0],L);y.subtract(A);let $=y.clone();$.add(qe.multiplyScalar(A,2)),this.drawLine(new xs(y,$),null,c)}}drawDebugPoint(e,t,r="",i="#f00"){let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",t),a.setAttributeNS(null,"r","2"),a.setAttributeNS(null,"fill","#f00"),this.vertices.push(a),this.drawDebugText(e,t,r)}drawDebugText(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","text");i.setAttributeNS(null,"x",e),i.setAttributeNS(null,"y",t),i.setAttributeNS(null,"class","debug"),i.setAttributeNS(null,"fill","#ff0000"),i.setAttributeNS(null,"style",`
                font: 5px Droid Sans, sans-serif;
            `),i.appendChild(document.createTextNode(r)),this.vertices.push(i)}drawRing(e,t,r){let i=document.createElementNS("http://www.w3.org/2000/svg","circle"),a=Ns.apothemFromSideLength(this.opts.bondLength,r);i.setAttributeNS(null,"cx",e),i.setAttributeNS(null,"cy",t),i.setAttributeNS(null,"r",a-this.opts.bondSpacing),i.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),i.setAttributeNS(null,"stroke-width",this.opts.bondThickness),i.setAttributeNS(null,"fill","none"),this.paths.push(i)}drawLine(e,t=!1,r=null,i="round"){let a=this.opts,l=[["stroke-width",this.opts.bondThickness],["stroke-linecap",i],["stroke-dasharray",t?"5, 5":"none"]],n=e.getLeftVector(),f=e.getRightVector(),h=n.x,d=n.y,u=f.x,c=f.y,b=l.map(y=>y.join(":")).join(";"),x=document.createElementNS("http://www.w3.org/2000/svg","line");x.setAttributeNS(null,"x1",h),x.setAttributeNS(null,"y1",d),x.setAttributeNS(null,"x2",u),x.setAttributeNS(null,"y2",c),x.setAttributeNS(null,"style",b),this.paths.push(x),r==null&&(r=this.createGradient(e,h,d,u,c)),x.setAttributeNS(null,"stroke",`url('#${r}')`)}drawPoint(e,t,r){let i=.75;e-i<this.minX&&(this.minX=e-i),e+i>this.maxX&&(this.maxX=e+i),t-i<this.minY&&(this.minY=t-i),t+i>this.maxY&&(this.maxY=t+i);let a=document.createElementNS("http://www.w3.org/2000/svg","circle");a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",t),a.setAttributeNS(null,"r","1.5"),a.setAttributeNS(null,"fill","black"),this.maskElements.push(a);let l=document.createElementNS("http://www.w3.org/2000/svg","circle");l.setAttributeNS(null,"cx",e),l.setAttributeNS(null,"cy",t),l.setAttributeNS(null,"r",i),l.setAttributeNS(null,"fill",this.themeManager.getColor(r)),this.vertices.push(l)}drawText(e,t,r,i,a,l,n,f,h,d={}){let u=[],c=r;n!==0&&n!==null&&(c+=M.createUnicodeCharge(n)),f!==0&&f!==null&&(c=M.createUnicodeSuperscript(f)+c),u.push([c,r]),i===1?u.push(["H","H"]):i>1&&u.push(["H"+M.createUnicodeSubscript(i),"H"]),n===1&&r==="N"&&d.hasOwnProperty("0O")&&d.hasOwnProperty("0O-1")&&(d={"0O":{element:"O",count:2,hydrogenCount:0,previousElement:"C",charge:""}},n=0);for(let b in d){if(!d.hasOwnProperty(b))continue;let x=d[b],y=x.element;x.count>1&&(y+=M.createUnicodeSubscript(x.count)),x.charge!==""&&(y+=M.createUnicodeCharge(n)),u.push([y,x.element]),x.hydrogenCount===1?u.push(["H","H"]):x.hydrogenCount>1&&u.push(["H"+M.createUnicodeSubscript(x.hydrogenCount),"H"])}this.write(u,a,e,t,h===1)}write(e,t,r,i,a){let l=M.measureText(e[0][1],this.opts.fontSizeLarge,this.opts.fontFamily);t==="left"&&e[0][0]!==e[0][1]&&(l.width*=2),a?(r+l.width*e.length>this.maxX&&(this.maxX=r+l.width*e.length),r-l.width/2<this.minX&&(this.minX=r-l.width/2),i-l.height<this.minY&&(this.minY=i-l.height),i+l.height>this.maxY&&(this.maxY=i+l.height)):(t!=="right"?(r+l.width*e.length>this.maxX&&(this.maxX=r+l.width*e.length),r-l.width*e.length<this.minX&&(this.minX=r-l.width*e.length)):t!=="left"&&(r+l.width*e.length>this.maxX&&(this.maxX=r+l.width*e.length),r-l.width/2<this.minX&&(this.minX=r-l.width/2)),i-l.height<this.minY&&(this.minY=i-l.height),i+l.height>this.maxY&&(this.maxY=i+l.height),t==="down"&&i+.8*l.height*e.length>this.maxY&&(this.maxY=i+.8*l.height*e.length),t==="up"&&i-.8*l.height*e.length<this.minY&&(this.minY=i-.8*l.height*e.length));let n=r,f=i,h=document.createElementNS("http://www.w3.org/2000/svg","text");h.setAttributeNS(null,"class","element");let d=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"fill","#ffffff"),t==="left"&&(e=e.reverse()),(t==="right"||t==="down"||t==="up")&&(r-=l.width/2),t==="left"&&(r+=l.width/2),e.forEach((b,x)=>{let y=b[0],L=b[1],A=document.createElementNS("http://www.w3.org/2000/svg","tspan");A.setAttributeNS(null,"fill",this.themeManager.getColor(L)),A.textContent=y,(t==="up"||t==="down")&&(A.setAttributeNS(null,"x","0px"),t==="up"?A.setAttributeNS(null,"y",`-${.9*x}em`):A.setAttributeNS(null,"y",`${.9*x}em`)),h.appendChild(A)}),h.setAttributeNS(null,"data-direction",t),t==="left"||t==="right"?(h.setAttributeNS(null,"dominant-baseline","alphabetic"),h.setAttributeNS(null,"y","0.36em")):h.setAttributeNS(null,"dominant-baseline","central"),t==="left"&&h.setAttributeNS(null,"text-anchor","end"),d.appendChild(h),d.setAttributeNS(null,"style",`transform: translateX(${r}px) translateY(${i}px)`);let u=this.opts.fontSizeLarge*.75;e[0][1].length>1&&(u=this.opts.fontSizeLarge*1.1);let c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttributeNS(null,"cx",n),c.setAttributeNS(null,"cy",f),c.setAttributeNS(null,"r",u),c.setAttributeNS(null,"fill","black"),this.maskElements.push(c),this.vertices.push(d)}toCanvas(e,t,r){(typeof e=="string"||e instanceof String)&&(e=document.getElementById(e));let i=new Image;i.onload=function(){e.width=t,e.height=r,e.getContext("2d").drawImage(i,0,0,t,r)},i.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(this.svg.outerHTML)}static createUnicodeSubscript(e){let t="";return e.toString().split("").forEach(r=>{t+=["\u2080","\u2081","\u2082","\u2083","\u2084","\u2085","\u2086","\u2087","\u2088","\u2089"][parseInt(r)]}),t}static createUnicodeSuperscript(e){let t="";return e.toString().split("").forEach(r=>{let i=parseInt(r);Number.isFinite(i)&&(t+=["\u2070","\xB9","\xB2","\xB3","\u2074","\u2075","\u2076","\u2077","\u2078","\u2079"][i])}),t}static replaceNumbersWithSubscript(e){let t={0:"\u2080",1:"\u2081",2:"\u2082",3:"\u2083",4:"\u2084",5:"\u2085",6:"\u2086",7:"\u2087",8:"\u2088",9:"\u2089"};for(let[r,i]of Object.entries(t))e=e.replaceAll(r,i);return e}static measureText(e,t,r,i=.9){let l=document.createElement("canvas").getContext("2d");l.font=`${t}pt ${r}`;let n=l.measureText(e),f=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight);return{width:n.width>f?n.width:f,height:(Math.abs(n.actualBoundingBoxAscent)+Math.abs(n.actualBoundingBoxAscent))*i}}static svgToCanvas(e,t,r,i,a=null){e.setAttributeNS(null,"width",r),e.setAttributeNS(null,"height",i);let l=new Image;return l.onload=function(){t.width=r,t.height=i;let n=t.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(l,0,0,r,i),a&&a(t)},l.onerror=function(n){console.log(n)},l.src="data:image/svg+xml;charset-utf-8,"+encodeURIComponent(e.outerHTML),t}static svgToImg(e,t,r,i){let a=document.createElement("canvas");this.svgToCanvas(e,a,r,i,l=>{t.src=a.toDataURL("image/png")})}static writeText(e,t,r,i,a=Number.MAX_SAFE_INTEGER){let l=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","style");n.appendChild(document.createTextNode(`
        .text {
            font: ${r}pt ${i};
            dominant-baseline: ideographic;
        }
    `)),l.appendChild(n);let f=document.createElementNS("http://www.w3.org/2000/svg","text");f.setAttributeNS(null,"class","text");let h=0,d=0,u=[];return e.split(`
`).forEach(c=>{let b=M.measureText(c,r,i,1);if(b.width>=a){let x=0,y=0,L=c.split(" "),A=0;for(let $=0;$<L.length;$++){let B=M.measureText(L[$],r,i,1);x+B.width>a&&(u.push({text:L.slice(A,$).join(" "),width:x,height:y}),x=0,y=0,A=$),B.height>y&&(y=B.height),x+=B.width}A<L.length&&u.push({text:L.slice(A,L.length).join(" "),width:x,height:y})}else u.push({text:c,width:b.width,height:b.height})}),u.forEach((c,b)=>{d+=c.height;let x=document.createElementNS("http://www.w3.org/2000/svg","tspan");x.setAttributeNS(null,"fill",t.getColor("C")),x.textContent=c.text,x.setAttributeNS(null,"x","0px"),x.setAttributeNS(null,"y",`${d}px`),f.appendChild(x),c.width>h&&(h=c.width)}),l.appendChild(f),{svg:l,width:h,height:d}}};yn.exports=Ri});var gr=me((Ca,Sn)=>{function Es(M){"use strict";function e(c,b){var x=c.length,y=x===0||x>0&&x-1 in c,L=0;if(y)for(;L<x&&b.call(c[L],L,c[L])!==!1;L++);else for(L in c)if(b.call(c[L],L,c[L])===!1)break}function t(c){var b=parseInt(c).toString(16);return b.length==1?"0"+b:b}function r(c,b,x,y){return y=parseInt(y),y===void 0||y===255?"#"+t(c)+t(b)+t(x):y===0?!1:"rgba("+c+","+b+","+x+","+y/255+")"}function i(c,b,x){return"M"+c+" "+b+"h"+x}function a(c,b){return'<path stroke="'+c+'" d="'+b+`" />
`}function l(c){var b="";return e(c,function(x,y){var L=x;if(x=r.apply(null,x.split(",")),x!==!1){var A=[],$,B=1;e(y,function(){$&&this[1]===$[1]&&this[0]===$[0]+B?B++:($&&(A.push(i($[0],$[1],B)),B=1),$=this)}),A.push(i($[0],$[1],B)),b+=a(x,A.join(""))}}),b}var n=function(c){for(var b={},x=c.data,y=x.length,L=c.width,A=c.height,$=0,B=0,O=0,F;O<y;O+=4)x[O+3]>0&&(F=x[O]+","+x[O+1]+","+x[O+2]+","+x[O+3],b[F]=b[F]||[],$=O/4%L,B=Math.floor(O/4/L),b[F].push([$,B]));return b};let f=n(M),h=l(f),d='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -0.5 '+M.width+" "+M.height+'" shape-rendering="crispEdges"><g shape-rendering="crispEdges">'+h+"</g></svg>";var u=document.createElement("div");return u.innerHTML=d,u.firstChild}Sn.exports=Es});var ur=me((xa,An)=>{var Ts={C2H4O2:"acetic acid",C3H6O:"acetone",C2H3N:"acetonitrile",C6H6:"benzene",CCl4:"carbon tetrachloride",C6H5Cl:"chlorobenzene",CHCl3:"chloroform",C6H12:"cyclohexane",C2H4Cl2:"1,2-dichloroethane",C4H10O3:"diethylene glycol",C6H14O3:"diglyme",C4H10O2:"DME",C3H7NO:"DMF",C2H6OS:"DMSO",C2H6O:"ethanol",C2H6O2:"ethylene glycol",C3H8O3:"glycerin",C7H16:"heptane",C6H18N3OP:"HMPA",C6H18N3P:"HMPT",C6H14:"hexane",CH4O:"methanol",C5H12O:"MTBE",CH2Cl2:"methylene chloride",CH5H9NO:"NMP",CH3NO2:"nitromethane",C5H12:"pentane",C5H5N:"pyridine",C7H8:"toluene",C6H15N:"triethyl amine",H2O:"water"};An.exports=Ts});var Vt=me((Na,Cn)=>{Cn.exports=function(){"use strict";function M(r,i){function a(){this.constructor=r}a.prototype=i.prototype,r.prototype=new a}function e(r,i,a,l){this.message=r,this.expected=i,this.found=a,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}M(e,Error),e.buildMessage=function(r,i){var a={literal:function(c){return'"'+n(c.text)+'"'},class:function(c){var b="",x;for(x=0;x<c.parts.length;x++)b+=c.parts[x]instanceof Array?f(c.parts[x][0])+"-"+f(c.parts[x][1]):f(c.parts[x]);return"["+(c.inverted?"^":"")+b+"]"},any:function(c){return"any character"},end:function(c){return"end of input"},other:function(c){return c.description}};function l(c){return c.charCodeAt(0).toString(16).toUpperCase()}function n(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+l(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+l(b)})}function f(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+l(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+l(b)})}function h(c){return a[c.type](c)}function d(c){var b=new Array(c.length),x,y;for(x=0;x<c.length;x++)b[x]=h(c[x]);if(b.sort(),b.length>0){for(x=1,y=1;x<b.length;x++)b[x-1]!==b[x]&&(b[y]=b[x],y++);b.length=y}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}function u(c){return c?'"'+n(c)+'"':"end of input"}return"Expected "+d(r)+" but "+u(i)+" found."};function t(r,i){i=i!==void 0?i:{};var a=r.split("(").length-1,l=r.split(")").length-1;if(a!==l)throw Jt("The number of opening parentheses does not match the number of closing parentheses.",0);var n={},f={chain:Qt},h=Qt,d=function(N){for(var v=[],k=[],R=0;R<N[1].length;R++)v.push(N[1][R]);for(var R=0;R<N[2].length;R++){var D=N[2][R][0]?N[2][R][0]:"-";k.push({bond:D,id:N[2][R][1]})}for(var R=0;R<N[3].length;R++)v.push(N[3][R]);for(var R=0;R<N[6].length;R++)v.push(N[6][R]);return{atom:N[0],isBracket:!!N[0].element,branches:v,branchCount:v.length,ringbonds:k,ringbondCount:k.length,bond:N[4]?N[4]:"-",next:N[5],hasNext:!!N[5]}},u="(",c=re("(",!1),b=")",x=re(")",!1),y=function(N){var v=N[1]?N[1]:"-";return N[2].branchBond=v,N[2]},L=function(N){return N},A=/^[\-=#$:\/\\.]/,$=$e(["-","=","#","$",":","/","\\","."],!1,!1),B=function(N){return N},O="[",F=re("[",!1),Q="se",j=re("se",!1),ue="as",se=re("as",!1),ee="]",te=re("]",!1),be=function(N){return{isotope:N[1],element:N[2],chirality:N[3],hcount:N[4],charge:N[5],class:N[6]}},ce="B",Ne=re("B",!1),Xe="r",ze=re("r",!1),Je="C",Qe=re("C",!1),ut="l",Ce=re("l",!1),Ae=/^[NOPSFI]/,Pt=$e(["N","O","P","S","F","I"],!1,!1),kt=function(N){return N.length>1?N.join(""):N},It=/^[bcnops]/,Ut=$e(["b","c","n","o","p","s"],!1,!1),Ot="*",G=re("*",!1),Re=function(N){return N},je=/^[A-Z]/,Pe=$e([["A","Z"]],!1,!1),tt=/^[a-z]/,Ze=$e([["a","z"]],!1,!1),_e=function(N){return N.join("")},Ye="%",Dt=re("%",!1),Ke=/^[1-9]/,Ie=$e([["1","9"]],!1,!1),Me=/^[0-9]/,Oe=$e([["0","9"]],!1,!1),ft=function(N){return N.length==1?Number(N):Number(N.join("").replace("%",""))},Se="@",Ht=re("@",!1),St="TH",ct=re("TH",!1),at=/^[12]/,rt=$e(["1","2"],!1,!1),dt="AL",pt=re("AL",!1),vt="SP",$t=re("SP",!1),Yr=/^[1-3]/,Vr=$e([["1","3"]],!1,!1),mr="TB",Lr=re("TB",!1),Mr="OH",Ur=re("OH",!1),Gr=function(N){return N[1]?N[1]=="@"?"@@":N[1].join("").replace(",",""):"@"},Zr=function(N){return N},br="+",wr=re("+",!1),At=function(N){return N[1]?N[1]!="+"?Number(N[1].join("")):2:1},Br="-",Pr=re("-",!1),kr=function(N){return N[1]?N[1]!="-"?-Number(N[1].join("")):-2:-1},Gt="H",Ir=re("H",!1),Kr=function(N){return N[1]?Number(N[1]):1},Jr=":",Zt=re(":",!1),Qr=/^[0]/,Or=$e(["0"],!1,!1),yr=function(N){return Number(N[1][0]+N[1][1].join(""))},Sr=function(N){return Number(N.join(""))},m=0,ye=0,zt=[{line:1,column:1}],Ve=0,Ar=[],U=0,Kt;if("startRule"in i){if(!(i.startRule in f))throw new Error(`Can't start parsing from rule "`+i.startRule+'".');h=f[i.startRule]}function $i(){return r.substring(ye,m)}function zi(){return Ft(ye,m)}function Fi(N,v){throw v=v!==void 0?v:Ft(ye,m),$r([Ct(N)],r.substring(ye,m),v)}function Dr(N,v){throw v=v!==void 0?v:Ft(ye,m),Jt(N,v)}function re(N,v){return{type:"literal",text:N,ignoreCase:v}}function $e(N,v,k){return{type:"class",parts:N,inverted:v,ignoreCase:k}}function qi(){return{type:"any"}}function Cr(){return{type:"end"}}function Ct(N){return{type:"other",description:N}}function Hr(N){var v=zt[N],k;if(v)return v;for(k=N-1;!zt[k];)k--;for(v=zt[k],v={line:v.line,column:v.column};k<N;)r.charCodeAt(k)===10?(v.line++,v.column=1):v.column++,k++;return zt[N]=v,v}function Ft(N,v){var k=Hr(N),R=Hr(v);return{start:{offset:N,line:k.line,column:k.column},end:{offset:v,line:R.line,column:R.column}}}function V(N){m<Ve||(m>Ve&&(Ve=m,Ar=[]),Ar.push(N))}function Jt(N,v){return new e(N,null,null,v)}function $r(N,v,k){return new e(e.buildMessage(N,v),N,v,k)}function Qt(){var N,v,k,R,D,W,Z,Be,et,it;if(N=m,v=m,k=jr(),k!==n){for(R=[],D=xt();D!==n;)R.push(D),D=xt();if(R!==n){for(D=[],W=m,Z=jt(),Z===n&&(Z=null),Z!==n?(Be=Nr(),Be!==n?(Z=[Z,Be],W=Z):(m=W,W=n)):(m=W,W=n);W!==n;)D.push(W),W=m,Z=jt(),Z===n&&(Z=null),Z!==n?(Be=Nr(),Be!==n?(Z=[Z,Be],W=Z):(m=W,W=n)):(m=W,W=n);if(D!==n){for(W=[],Z=xt();Z!==n;)W.push(Z),Z=xt();if(W!==n)if(Z=jt(),Z===n&&(Z=null),Z!==n)if(Be=Qt(),Be===n&&(Be=null),Be!==n){for(et=[],it=xt();it!==n;)et.push(it),it=xt();et!==n?(k=[k,R,D,W,Z,Be,et],v=k):(m=v,v=n)}else m=v,v=n;else m=v,v=n;else m=v,v=n}else m=v,v=n}else m=v,v=n}else m=v,v=n;return v!==n&&(ye=N,v=d(v)),N=v,N}function xt(){var N,v,k,R,D,W;return N=m,v=m,r.charCodeAt(m)===40?(k=u,m++):(k=n,U===0&&V(c)),k!==n?(R=jt(),R===n&&(R=null),R!==n?(D=Qt(),D!==n?(r.charCodeAt(m)===41?(W=b,m++):(W=n,U===0&&V(x)),W!==n?(k=[k,R,D,W],v=k):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(ye=N,v=y(v)),N=v,N}function jr(){var N,v;return N=m,v=ti(),v===n&&(v=er(),v===n&&(v=ei(),v===n&&(v=tr()))),v!==n&&(ye=N,v=L(v)),N=v,N}function jt(){var N,v;if(N=m,A.test(r.charAt(m))){if(v=r.charAt(m),v===r.charAt(m+1)&&(v=n,U===0))throw Jt("The parser encountered a bond repetition.",m+1);m++}else v=n,U===0&&V($);return v!==n&&(ye=N,v=B(v)),N=v,N}function ei(){var N,v,k,R,D,W,Z,Be,et,it;return N=m,v=m,r.charCodeAt(m)===91?(k=O,m++):(k=n,U===0&&V(F)),k!==n?(R=ai(),R===n&&(R=null),R!==n?(r.substr(m,2)===Q?(D=Q,m+=2):(D=n,U===0&&V(j)),D===n&&(r.substr(m,2)===ue?(D=ue,m+=2):(D=n,U===0&&V(se)),D===n&&(D=er(),D===n&&(D=xr(),D===n&&(D=tr())))),D!==n?(W=zr(),W===n&&(W=null),W!==n?(Z=si(),Z===n&&(Z=null),Z!==n?(Be=ri(),Be===n&&(Be=null),Be!==n?(et=rr(),et===n&&(et=null),et!==n?(r.charCodeAt(m)===93?(it=ee,m++):(it=n,U===0&&V(te)),it!==n?(k=[k,R,D,W,Z,Be,et,it],v=k):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(ye=N,v=be(v)),N=v,N}function ti(){var N,v,k,R;return N=m,v=m,r.charCodeAt(m)===66?(k=ce,m++):(k=n,U===0&&V(Ne)),k!==n?(r.charCodeAt(m)===114?(R=Xe,m++):(R=n,U===0&&V(ze)),R===n&&(R=null),R!==n?(k=[k,R],v=k):(m=v,v=n)):(m=v,v=n),v===n&&(v=m,r.charCodeAt(m)===67?(k=Je,m++):(k=n,U===0&&V(Qe)),k!==n?(r.charCodeAt(m)===108?(R=ut,m++):(R=n,U===0&&V(Ce)),R===n&&(R=null),R!==n?(k=[k,R],v=k):(m=v,v=n)):(m=v,v=n),v===n&&(Ae.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,U===0&&V(Pt)))),v!==n&&(ye=N,v=kt(v)),N=v,N}function er(){var N,v;return N=m,It.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,U===0&&V(Ut)),v!==n&&(ye=N,v=L(v)),N=v,N}function tr(){var N,v;return N=m,r.charCodeAt(m)===42?(v=Ot,m++):(v=n,U===0&&V(G)),v!==n&&(ye=N,v=Re(v)),N=v,N}function xr(){var N,v,k,R;return N=m,v=m,je.test(r.charAt(m))?(k=r.charAt(m),m++):(k=n,U===0&&V(Pe)),k!==n?(tt.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,U===0&&V(Ze)),R===n&&(R=null),R!==n?(k=[k,R],v=k):(m=v,v=n)):(m=v,v=n),v!==n&&(ye=N,v=_e(v)),N=v,N}function Nr(){var N,v,k,R,D;return N=m,v=m,r.charCodeAt(m)===37?(k=Ye,m++):(k=n,U===0&&V(Dt)),k!==n?(Ke.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,U===0&&V(Ie)),R!==n?(Me.test(r.charAt(m))?(D=r.charAt(m),m++):(D=n,U===0&&V(Oe)),D!==n?(k=[k,R,D],v=k):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v===n&&(Me.test(r.charAt(m))?(v=r.charAt(m),m++):(v=n,U===0&&V(Oe))),v!==n&&(ye=N,v=ft(v)),N=v,N}function zr(){var N,v,k,R,D,W,Z;return N=m,v=m,r.charCodeAt(m)===64?(k=Se,m++):(k=n,U===0&&V(Ht)),k!==n?(r.charCodeAt(m)===64?(R=Se,m++):(R=n,U===0&&V(Ht)),R===n&&(R=m,r.substr(m,2)===St?(D=St,m+=2):(D=n,U===0&&V(ct)),D!==n?(at.test(r.charAt(m))?(W=r.charAt(m),m++):(W=n,U===0&&V(rt)),W!==n?(D=[D,W],R=D):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===dt?(D=dt,m+=2):(D=n,U===0&&V(pt)),D!==n?(at.test(r.charAt(m))?(W=r.charAt(m),m++):(W=n,U===0&&V(rt)),W!==n?(D=[D,W],R=D):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===vt?(D=vt,m+=2):(D=n,U===0&&V($t)),D!==n?(Yr.test(r.charAt(m))?(W=r.charAt(m),m++):(W=n,U===0&&V(Vr)),W!==n?(D=[D,W],R=D):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===mr?(D=mr,m+=2):(D=n,U===0&&V(Lr)),D!==n?(Ke.test(r.charAt(m))?(W=r.charAt(m),m++):(W=n,U===0&&V(Ie)),W!==n?(Me.test(r.charAt(m))?(Z=r.charAt(m),m++):(Z=n,U===0&&V(Oe)),Z===n&&(Z=null),Z!==n?(D=[D,W,Z],R=D):(m=R,R=n)):(m=R,R=n)):(m=R,R=n),R===n&&(R=m,r.substr(m,2)===Mr?(D=Mr,m+=2):(D=n,U===0&&V(Ur)),D!==n?(Ke.test(r.charAt(m))?(W=r.charAt(m),m++):(W=n,U===0&&V(Ie)),W!==n?(Me.test(r.charAt(m))?(Z=r.charAt(m),m++):(Z=n,U===0&&V(Oe)),Z===n&&(Z=null),Z!==n?(D=[D,W,Z],R=D):(m=R,R=n)):(m=R,R=n)):(m=R,R=n)))))),R===n&&(R=null),R!==n?(k=[k,R],v=k):(m=v,v=n)):(m=v,v=n),v!==n&&(ye=N,v=Gr(v)),N=v,N}function ri(){var N,v;return N=m,v=ii(),v===n&&(v=ni()),v!==n&&(ye=N,v=Zr(v)),N=v,N}function ii(){var N,v,k,R,D,W;return N=m,v=m,r.charCodeAt(m)===43?(k=br,m++):(k=n,U===0&&V(wr)),k!==n?(r.charCodeAt(m)===43?(R=br,m++):(R=n,U===0&&V(wr)),R===n&&(R=m,Ke.test(r.charAt(m))?(D=r.charAt(m),m++):(D=n,U===0&&V(Ie)),D!==n?(Me.test(r.charAt(m))?(W=r.charAt(m),m++):(W=n,U===0&&V(Oe)),W===n&&(W=null),W!==n?(D=[D,W],R=D):(m=R,R=n)):(m=R,R=n)),R===n&&(R=null),R!==n?(k=[k,R],v=k):(m=v,v=n)):(m=v,v=n),v!==n&&(ye=N,v=At(v)),N=v,N}function ni(){var N,v,k,R,D,W;return N=m,v=m,r.charCodeAt(m)===45?(k=Br,m++):(k=n,U===0&&V(Pr)),k!==n?(r.charCodeAt(m)===45?(R=Br,m++):(R=n,U===0&&V(Pr)),R===n&&(R=m,Ke.test(r.charAt(m))?(D=r.charAt(m),m++):(D=n,U===0&&V(Ie)),D!==n?(Me.test(r.charAt(m))?(W=r.charAt(m),m++):(W=n,U===0&&V(Oe)),W===n&&(W=null),W!==n?(D=[D,W],R=D):(m=R,R=n)):(m=R,R=n)),R===n&&(R=null),R!==n?(k=[k,R],v=k):(m=v,v=n)):(m=v,v=n),v!==n&&(ye=N,v=kr(v)),N=v,N}function si(){var N,v,k,R;return N=m,v=m,r.charCodeAt(m)===72?(k=Gt,m++):(k=n,U===0&&V(Ir)),k!==n?(Me.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,U===0&&V(Oe)),R===n&&(R=null),R!==n?(k=[k,R],v=k):(m=v,v=n)):(m=v,v=n),v!==n&&(ye=N,v=Kr(v)),N=v,N}function rr(){var N,v,k,R,D,W,Z;if(N=m,v=m,r.charCodeAt(m)===58?(k=Jr,m++):(k=n,U===0&&V(Zt)),k!==n){if(R=m,Ke.test(r.charAt(m))?(D=r.charAt(m),m++):(D=n,U===0&&V(Ie)),D!==n){for(W=[],Me.test(r.charAt(m))?(Z=r.charAt(m),m++):(Z=n,U===0&&V(Oe));Z!==n;)W.push(Z),Me.test(r.charAt(m))?(Z=r.charAt(m),m++):(Z=n,U===0&&V(Oe));W!==n?(D=[D,W],R=D):(m=R,R=n)}else m=R,R=n;R===n&&(Qr.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,U===0&&V(Or))),R!==n?(k=[k,R],v=k):(m=v,v=n)}else m=v,v=n;return v!==n&&(ye=N,v=yr(v)),N=v,N}function ai(){var N,v,k,R,D;return N=m,v=m,Ke.test(r.charAt(m))?(k=r.charAt(m),m++):(k=n,U===0&&V(Ie)),k!==n?(Me.test(r.charAt(m))?(R=r.charAt(m),m++):(R=n,U===0&&V(Oe)),R===n&&(R=null),R!==n?(Me.test(r.charAt(m))?(D=r.charAt(m),m++):(D=n,U===0&&V(Oe)),D===n&&(D=null),D!==n?(k=[k,R,D],v=k):(m=v,v=n)):(m=v,v=n)):(m=v,v=n),v!==n&&(ye=N,v=Sr(v)),N=v,N}if(Kt=h(),Kt!==n&&m===r.length)return Kt;throw Kt!==n&&m<r.length&&V(Cr()),$r(Ar,Ve<r.length?r.charAt(Ve):null,Ve<r.length?Ft(Ve,Ve+1):Ft(Ve,Ve))}return{SyntaxError:e,parse:t}}()});var fr=me((Ra,xn)=>{var Ei=Vt(),Ti=class{constructor(e){this.reactantsSmiles=[],this.reagentsSmiles=[],this.productsSmiles=[],this.reactantsWeights=[],this.reagentsWeights=[],this.productsWeights=[],this.reactants=[],this.reagents=[],this.products=[];let t=e.split(">");if(t.length!==3)throw new Error("Invalid reaction SMILES. Did you add fewer than or more than two '>'?");t[0]!==""&&(this.reactantsSmiles=t[0].split(".")),t[1]!==""&&(this.reagentsSmiles=t[1].split(".")),t[2]!==""&&(this.productsSmiles=t[2].split("."));for(var r=0;r<this.reactantsSmiles.length;r++)this.reactants.push(Ei.parse(this.reactantsSmiles[r]));for(var r=0;r<this.reagentsSmiles.length;r++)this.reagents.push(Ei.parse(this.reagentsSmiles[r]));for(var r=0;r<this.productsSmiles.length;r++)this.products.push(Ei.parse(this.productsSmiles[r]))}};xn.exports=Ti});var cr=me((Ea,Rn)=>{var Ls=Bt(),Li=Mt(),Ms=Lt(),Bs=Tt(),Nn=ur(),Mi=class{constructor(e,t){this.defaultOptions={scale:t.scale>0?t.scale:1,fontSize:t.fontSizeLarge*.8,fontFamily:"Arial, Helvetica, sans-serif",spacing:10,plus:{size:9,thickness:1},arrow:{length:t.bondLength*4,headSize:6,thickness:1,margin:3},weights:{normalize:!1}},this.opts=Ms.extend(!0,this.defaultOptions,e),this.drawer=new Ls(t),this.molOpts=this.drawer.opts}draw(e,t,r="light",i=null,a="{reagents}",l="",n=!1){if(this.themeManager=new Bs(this.molOpts.themes,r),this.opts.weights.normalize){let A=-Number.MAX_SAFE_INTEGER,$=Number.MAX_SAFE_INTEGER;if(i.hasOwnProperty("reactants"))for(let O=0;O<i.reactants.length;O++)for(let F=0;F<i.reactants[O].length;F++)i.reactants[O][F]<$&&($=i.reactants[O][F]),i.reactants[O][F]>A&&(A=i.reactants[O][F]);if(i.hasOwnProperty("reagents"))for(let O=0;O<i.reagents.length;O++)for(let F=0;F<i.reagents[O].length;F++)i.reagents[O][F]<$&&($=i.reagents[O][F]),i.reagents[O][F]>A&&(A=i.reagents[O][F]);if(i.hasOwnProperty("products"))for(let O=0;O<i.products.length;O++)for(let F=0;F<i.products[O].length;F++)i.products[O][F]<$&&($=i.products[O][F]),i.products[O][F]>A&&(A=i.products[O][F]);let B=Math.max(Math.abs($),Math.abs(A));if(B===0&&(B=1),i.hasOwnProperty("reactants"))for(let O=0;O<i.reactants.length;O++)for(let F=0;F<i.reactants[O].length;F++)i.reactants[O][F]/=B;if(i.hasOwnProperty("reagents"))for(let O=0;O<i.reagents.length;O++)for(let F=0;F<i.reagents[O].length;F++)i.reagents[O][F]/=B;if(i.hasOwnProperty("products"))for(let O=0;O<i.products.length;O++)for(let F=0;F<i.products[O].length;F++)i.products[O][F]/=B}let f=null;for(t===null||t==="svg"?(f=document.createElementNS("http://www.w3.org/2000/svg","svg"),f.setAttribute("xmlns","http://www.w3.org/2000/svg"),f.setAttributeNS(null,"width","500"),f.setAttributeNS(null,"height","500")):typeof t=="string"||t instanceof String?f=document.getElementById(t):f=t;f.firstChild;)f.removeChild(f.firstChild);let h=[],d=0;for(var u=0;u<e.reactants.length;u++){u>0&&h.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let A=null;i&&i.hasOwnProperty("reactants")&&i.reactants.length>u&&(A=i.reactants[u]);let $=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.reactants[u],$,r,A,n,[],this.opts.weights.normalize);let B={width:$.viewBox.baseVal.width*this.opts.scale,height:$.viewBox.baseVal.height*this.opts.scale,svg:$};h.push(B),B.height>d&&(d=B.height)}h.push({width:this.opts.arrow.length*this.opts.scale,height:this.opts.arrow.headSize*2*this.opts.scale,svg:this.getArrow()});let c="";for(var u=0;u<e.reagents.length;u++){u>0&&(c+=", ");let $=this.drawer.getMolecularFormula(e.reagents[u]);$ in Nn&&($=Nn[$]),c+=Li.replaceNumbersWithSubscript($)}a=a.replace("{reagents}",c);let b=Li.writeText(a,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale),x=(this.opts.arrow.length*this.opts.scale-b.width)/2;h.push({svg:b.svg,height:b.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+x,offsetY:-(b.height/2)-this.opts.arrow.margin,position:"relative"});let y=Li.writeText(l,this.themeManager,this.opts.fontSize*this.opts.scale,this.opts.fontFamily,this.opts.arrow.length*this.opts.scale);x=(this.opts.arrow.length*this.opts.scale-y.width)/2,h.push({svg:y.svg,height:y.height,width:this.opts.arrow.length*this.opts.scale,offsetX:-(this.opts.arrow.length*this.opts.scale+this.opts.spacing)+x,offsetY:y.height/2+this.opts.arrow.margin,position:"relative"});for(var u=0;u<e.products.length;u++){u>0&&h.push({width:this.opts.plus.size*this.opts.scale,height:this.opts.plus.size*this.opts.scale,svg:this.getPlus()});let $=null;i&&i.hasOwnProperty("products")&&i.products.length>u&&($=i.products[u]);let B=document.createElementNS("http://www.w3.org/2000/svg","svg");this.drawer.draw(e.products[u],B,r,$,n,[],this.opts.weights.normalize);let O={width:B.viewBox.baseVal.width*this.opts.scale,height:B.viewBox.baseVal.height*this.opts.scale,svg:B};h.push(O),O.height>d&&(d=O.height)}let L=0;return h.forEach(A=>{let $=A.offsetX??0,B=A.offsetY??0;A.svg.setAttributeNS(null,"x",Math.round(L+$)),A.svg.setAttributeNS(null,"y",Math.round((d-A.height)/2+B)),A.svg.setAttributeNS(null,"width",Math.round(A.width)),A.svg.setAttributeNS(null,"height",Math.round(A.height)),f.appendChild(A.svg),A.position!=="relative"&&(L+=Math.round(A.width+this.opts.spacing+$))}),f.setAttributeNS(null,"viewBox",`0 0 ${L} ${d}`),f.style.width=L+"px",f.style.height=d+"px",f}getPlus(){let e=this.opts.plus.size,t=this.opts.plus.thickness,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","rect"),a=document.createElementNS("http://www.w3.org/2000/svg","rect");return r.setAttributeNS(null,"id","plus"),i.setAttributeNS(null,"x",0),i.setAttributeNS(null,"y",e/2-t/2),i.setAttributeNS(null,"width",e),i.setAttributeNS(null,"height",t),i.setAttributeNS(null,"fill",this.themeManager.getColor("C")),a.setAttributeNS(null,"x",e/2-t/2),a.setAttributeNS(null,"y",0),a.setAttributeNS(null,"width",t),a.setAttributeNS(null,"height",e),a.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.appendChild(i),r.appendChild(a),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),r}getArrowhead(){let e=this.opts.arrow.headSize,t=document.createElementNS("http://www.w3.org/2000/svg","marker"),r=document.createElementNS("http://www.w3.org/2000/svg","polygon");return t.setAttributeNS(null,"id","arrowhead"),t.setAttributeNS(null,"viewBox",`0 0 ${e} ${e}`),t.setAttributeNS(null,"markerUnits","userSpaceOnUse"),t.setAttributeNS(null,"markerWidth",e),t.setAttributeNS(null,"markerHeight",e),t.setAttributeNS(null,"refX",0),t.setAttributeNS(null,"refY",e/2),t.setAttributeNS(null,"orient","auto"),t.setAttributeNS(null,"fill",this.themeManager.getColor("C")),r.setAttributeNS(null,"points",`0 0, ${e} ${e/2}, 0 ${e}`),t.appendChild(r),t}getCDArrowhead(){let e=this.opts.arrow.headSize,t=e*(7/4.5),r=document.createElementNS("http://www.w3.org/2000/svg","marker"),i=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttributeNS(null,"id","arrowhead"),r.setAttributeNS(null,"viewBox",`0 0 ${t} ${e}`),r.setAttributeNS(null,"markerUnits","userSpaceOnUse"),r.setAttributeNS(null,"markerWidth",t*2),r.setAttributeNS(null,"markerHeight",e*2),r.setAttributeNS(null,"refX",2.2),r.setAttributeNS(null,"refY",2.2),r.setAttributeNS(null,"orient","auto"),r.setAttributeNS(null,"fill",this.themeManager.getColor("C")),i.setAttributeNS(null,"style","fill-rule:nonzero;"),i.setAttributeNS(null,"d","m 0 0 l 7 2.25 l -7 2.25 c 0 0 0.735 -1.084 0.735 -2.28 c 0 -1.196 -0.735 -2.22 -0.735 -2.22 z"),r.appendChild(i),r}getArrow(){let e=this.opts.arrow.headSize,t=this.opts.arrow.length,r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","defs"),a=document.createElementNS("http://www.w3.org/2000/svg","line");return i.appendChild(this.getCDArrowhead()),r.appendChild(i),r.setAttributeNS(null,"id","arrow"),a.setAttributeNS(null,"x1",0),a.setAttributeNS(null,"y1",-this.opts.arrow.thickness/2),a.setAttributeNS(null,"x2",t),a.setAttributeNS(null,"y2",-this.opts.arrow.thickness/2),a.setAttributeNS(null,"stroke-width",this.opts.arrow.thickness),a.setAttributeNS(null,"stroke",this.themeManager.getColor("C")),a.setAttributeNS(null,"marker-end","url(#arrowhead)"),r.appendChild(a),r.setAttributeNS(null,"viewBox",`0 ${-e/2} ${t+e*(7/4.5)} ${e}`),r}};Rn.exports=Mi});var dr=me((Ta,En)=>{var Ps=fr(),Bi=class{static parse(e){return new Ps(e)}};En.exports=Bi});var Tr=me((Ma,Ln)=>{var La=pr(),ks=Vt(),Is=dr(),Os=Bt(),Ds=cr(),Tn=Mt(),Hs=Lt(),Pi=class M{constructor(e={},t={}){this.drawer=new Os(e),this.reactionDrawer=new Ds(t,JSON.parse(JSON.stringify(this.drawer.opts)))}static apply(e={},t={},r="data-smiles",i="light",a=null,l=null){new M(e,t).apply(r,i,a,l)}apply(e="data-smiles",t="light",r=null,i=null){document.querySelectorAll(`[${e}]`).forEach(l=>{let n=l.getAttribute(e);if(n===null)throw Error("No SMILES provided.");let f=t,h=null;if(l.hasAttribute("data-smiles-theme")&&(f=l.getAttribute("data-smiles-theme")),l.hasAttribute("data-smiles-weights")&&(h=l.getAttribute("data-smiles-weights").split(",").map(parseFloat)),(l.hasAttribute("data-smiles-reactant-weights")||l.hasAttribute("data-smiles-reagent-weights")||l.hasAttribute("data-smiles-product-weights"))&&(h={reactants:[],reagents:[],products:[]},l.hasAttribute("data-smiles-reactant-weights")&&(h.reactants=l.getAttribute("data-smiles-reactant-weights").split(";").map(d=>d.split(",").map(parseFloat))),l.hasAttribute("data-smiles-reagent-weights")&&(h.reagents=l.getAttribute("data-smiles-reagent-weights").split(";").map(d=>d.split(",").map(parseFloat))),l.hasAttribute("data-smiles-product-weights")&&(h.products=l.getAttribute("data-smiles-product-weights").split(";").map(d=>d.split(",").map(parseFloat)))),l.hasAttribute("data-smiles-options")||l.hasAttribute("data-smiles-reaction-options")){let d={};l.hasAttribute("data-smiles-options")&&(d=JSON.parse(l.getAttribute("data-smiles-options").replaceAll("'",'"')));let u={};l.hasAttribute("data-smiles-reaction-options")&&(u=JSON.parse(l.getAttribute("data-smiles-reaction-options").replaceAll("'",'"'))),new M(d,u).draw(n,l,f,r,i,h)}else this.draw(n,l,f,r,i,h)})}draw(e,t,r="light",i=null,a=null,l=null){let n=[];[e,...n]=e.split(" ");let f=n.join(" "),h={};if(f.includes("__")){let u=f.substring(f.indexOf("__")+2,f.lastIndexOf("__"));h=JSON.parse(u.replaceAll("'",'"'))}let d={textAboveArrow:"{reagents}",textBelowArrow:""};if(h=Hs.extend(!0,d,h),e.includes(">"))try{this.drawReaction(e,t,r,h,l,i)}catch(u){a?a(u):console.error(u)}else try{this.drawMolecule(e,t,r,l,i)}catch(u){a?a(u):console.error(u)}}drawMolecule(e,t,r,i,a){let l=ks.parse(e);if(t===null||t==="svg"){let n=this.drawer.draw(l,null,r,i),f=this.getDimensions(n);n.setAttributeNS(null,"width",""+f.w),n.setAttributeNS(null,"height",""+f.h),a&&a(n)}else if(t==="canvas"){let n=this.svgToCanvas(this.drawer.draw(l,null,r,i));a&&a(n)}else if(t==="img"){let n=this.svgToImg(this.drawer.draw(l,null,r,i));a&&a(n)}else t instanceof HTMLImageElement?(this.svgToImg(this.drawer.draw(l,null,r,i),t),a&&a(t)):t instanceof SVGElement?(this.drawer.draw(l,t,r,i),a&&a(t)):document.querySelectorAll(t).forEach(f=>{let h=f.nodeName.toLowerCase();h==="svg"?(this.drawer.draw(l,f,r,i),a&&a(f)):h==="canvas"?(this.svgToCanvas(this.drawer.draw(l,null,r,i),f),a&&a(f)):h==="img"&&(this.svgToImg(this.drawer.draw(l,null,r,i),f),a&&a(f))})}drawReaction(e,t,r,i,a,l){let n=Is.parse(e);if(t===null||t==="svg"){let f=this.reactionDrawer.draw(n,null,r),h=this.getDimensions(f);f.setAttributeNS(null,"width",""+h.w),f.setAttributeNS(null,"height",""+h.h),l&&l(f)}else if(t==="canvas"){let f=this.svgToCanvas(this.reactionDrawer.draw(n,null,r,a,i.textAboveArrow,i.textBelowArrow));l&&l(f)}else if(t==="img"){let f=this.svgToImg(this.reactionDrawer.draw(n,null,r,a,i.textAboveArrow,i.textBelowArrow));l&&l(f)}else t instanceof HTMLImageElement?(this.svgToImg(this.reactionDrawer.draw(n,null,r,a,i.textAboveArrow,i.textBelowArrow),t),l&&l(t)):t instanceof SVGElement?(this.reactionDrawer.draw(n,t,r,a,i.textAboveArrow,i.textBelowArrow),l&&l(t)):document.querySelectorAll(t).forEach(h=>{let d=h.nodeName.toLowerCase();d==="svg"?(this.reactionDrawer.draw(n,h,r,a,i.textAboveArrow,i.textBelowArrow),this.reactionDrawer.opts.scale<=0&&(h.style.width=null,h.style.height=null),l&&l(h)):d==="canvas"?(this.svgToCanvas(this.reactionDrawer.draw(n,null,r,a,i.textAboveArrow,i.textBelowArrow),h),l&&l(h)):d==="img"&&(this.svgToImg(this.reactionDrawer.draw(n,null,r,a,i.textAboveArrow,i.textBelowArrow),h),l&&l(h))})}svgToCanvas(e,t=null){t===null&&(t=document.createElement("canvas"));let r=this.getDimensions(t,e);return Tn.svgToCanvas(e,t,r.w,r.h),t}svgToImg(e,t=null){t===null&&(t=document.createElement("img"));let r=this.getDimensions(t,e);return Tn.svgToImg(e,t,r.w,r.h),t}getDimensions(e,t=null){let r=this.drawer.opts.width,i=this.drawer.opts.height;return this.drawer.opts.scale<=0?(r===null&&(r=e.width),i===null&&(i=e.height),e.style.width!==""&&(r=parseInt(e.style.width)),e.style.height!==""&&(i=parseInt(e.style.height))):t&&(r=parseFloat(t.style.width),i=parseFloat(t.style.height)),{w:r,h:i}}};Ln.exports=Pi});var Mn=me((ki,Ii)=>{var Ba=I(lt()),Pa=I(wt()),ka=I(lr()),Ia=I(pr()),Oa=I(hr()),Da=I(Yt()),Ha=I(ur()),$a=I(vr()),za=I(Et()),Fa=I(yt()),qa=I(ot()),Wa=I(Lt()),Xa=I(Vt()),_a=I(gr()),Ya=I(fr()),Va=I(cr()),Ua=I(dr()),Ga=I(ht()),Za=I(Xt()),Ka=I(Tr()),Ja=I(or()),Qa=I(Bt()),ja=I(Mt()),el=I(Tt()),tl=I(_t()),rl=I(Ge()),il=I(st());(function(M,e){typeof ki=="object"&&typeof Ii<"u"?Ii.exports=e():typeof define=="function"&&define.amd?define(e):(M=typeof globalThis<"u"?globalThis:M||self,M.chroma=e())})(ki,function(){"use strict";function M(s,o,g){return o===void 0&&(o=0),g===void 0&&(g=1),d(u(o,s),g)}function e(s){s._clipped=!1,s._unclipped=s.slice(0);for(var o=0;o<=3;o++)o<3?((s[o]<0||s[o]>255)&&(s._clipped=!0),s[o]=M(s[o],0,255)):o===3&&(s[o]=M(s[o],0,1));return s}for(var t={},r=0,i=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];r<i.length;r+=1){var a=i[r];t["[object "+a+"]"]=a.toLowerCase()}function l(s){return t[Object.prototype.toString.call(s)]||"object"}function n(s,o){return o===void 0&&(o=null),s.length>=3?Array.prototype.slice.call(s):l(s[0])=="object"&&o?o.split("").filter(function(g){return s[0][g]!==void 0}).map(function(g){return s[0][g]}):s[0]}function f(s){if(s.length<2)return null;var o=s.length-1;return l(s[o])=="string"?s[o].toLowerCase():null}var h=Math.PI,d=Math.min,u=Math.max,c=h*2,b=h/3,x=h/180,y=180/h,L={format:{},autodetect:[]},A=function(){for(var o=[],g=arguments.length;g--;)o[g]=arguments[g];var p=this;if(l(o[0])==="object"&&o[0].constructor&&o[0].constructor===this.constructor)return o[0];var S=f(o),C=!1;if(!S){C=!0,L.sorted||(L.autodetect=L.autodetect.sort(function(H,X){return X.p-H.p}),L.sorted=!0);for(var w=0,E=L.autodetect;w<E.length;w+=1){var T=E[w];if(S=T.test.apply(T,o),S)break}}if(L.format[S]){var P=L.format[S].apply(null,C?o:o.slice(0,-1));p._rgb=e(P)}else throw new Error("unknown format: "+o);p._rgb.length===3&&p._rgb.push(1)};A.prototype.toString=function(){return l(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var $="2.6.0",B=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(B.Color,[null].concat(s)))};B.Color=A,B.version=$;var O=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];s=n(s,"cmyk");var g=s[0],p=s[1],S=s[2],C=s[3],w=s.length>4?s[4]:1;return C===1?[0,0,0,w]:[g>=1?0:255*(1-g)*(1-C),p>=1?0:255*(1-p)*(1-C),S>=1?0:255*(1-S)*(1-C),w]},F=Math.max,Q=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgb"),p=g[0],S=g[1],C=g[2];p=p/255,S=S/255,C=C/255;var w=1-F(p,F(S,C)),E=w<1?1/(1-w):0,T=(1-p-w)*E,P=(1-S-w)*E,H=(1-C-w)*E;return[T,P,H,w]};A.prototype.cmyk=function(){return Q(this._rgb)},B.cmyk=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["cmyk"])))},L.format.cmyk=O,L.autodetect.push({p:2,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s=n(s,"cmyk"),l(s)==="array"&&s.length===4)return"cmyk"}});var j=function(s){return Math.round(s*100)/100},ue=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"hsla"),p=f(s)||"lsa";return g[0]=j(g[0]||0),g[1]=j(g[1]*100)+"%",g[2]=j(g[2]*100)+"%",p==="hsla"||g.length>3&&g[3]<1?(g[3]=g.length>3?g[3]:1,p="hsla"):g.length=3,p+"("+g.join(",")+")"},se=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];s=n(s,"rgba");var g=s[0],p=s[1],S=s[2];g/=255,p/=255,S/=255;var C=d(g,p,S),w=u(g,p,S),E=(w+C)/2,T,P;return w===C?(T=0,P=Number.NaN):T=E<.5?(w-C)/(w+C):(w-C)/(2-w-C),g==w?P=(p-S)/(w-C):p==w?P=2+(S-g)/(w-C):S==w&&(P=4+(g-p)/(w-C)),P*=60,P<0&&(P+=360),s.length>3&&s[3]!==void 0?[P,T,E,s[3]]:[P,T,E]},ee=Math.round,te=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgba"),p=f(s)||"rgb";return p.substr(0,3)=="hsl"?ue(se(g),p):(g[0]=ee(g[0]),g[1]=ee(g[1]),g[2]=ee(g[2]),(p==="rgba"||g.length>3&&g[3]<1)&&(g[3]=g.length>3?g[3]:1,p="rgba"),p+"("+g.slice(0,p==="rgb"?3:4).join(",")+")")},be=Math.round,ce=function(){for(var s,o=[],g=arguments.length;g--;)o[g]=arguments[g];o=n(o,"hsl");var p=o[0],S=o[1],C=o[2],w,E,T;if(S===0)w=E=T=C*255;else{var P=[0,0,0],H=[0,0,0],X=C<.5?C*(1+S):C+S-C*S,z=2*C-X,Y=p/360;P[0]=Y+1/3,P[1]=Y,P[2]=Y-1/3;for(var _=0;_<3;_++)P[_]<0&&(P[_]+=1),P[_]>1&&(P[_]-=1),6*P[_]<1?H[_]=z+(X-z)*6*P[_]:2*P[_]<1?H[_]=X:3*P[_]<2?H[_]=z+(X-z)*(2/3-P[_])*6:H[_]=z;s=[be(H[0]*255),be(H[1]*255),be(H[2]*255)],w=s[0],E=s[1],T=s[2]}return o.length>3?[w,E,T,o[3]]:[w,E,T,1]},Ne=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,Xe=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,ze=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Je=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Qe=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,ut=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Ce=Math.round,Ae=function(s){s=s.toLowerCase().trim();var o;if(L.format.named)try{return L.format.named(s)}catch{}if(o=s.match(Ne)){for(var g=o.slice(1,4),p=0;p<3;p++)g[p]=+g[p];return g[3]=1,g}if(o=s.match(Xe)){for(var S=o.slice(1,5),C=0;C<4;C++)S[C]=+S[C];return S}if(o=s.match(ze)){for(var w=o.slice(1,4),E=0;E<3;E++)w[E]=Ce(w[E]*2.55);return w[3]=1,w}if(o=s.match(Je)){for(var T=o.slice(1,5),P=0;P<3;P++)T[P]=Ce(T[P]*2.55);return T[3]=+T[3],T}if(o=s.match(Qe)){var H=o.slice(1,4);H[1]*=.01,H[2]*=.01;var X=ce(H);return X[3]=1,X}if(o=s.match(ut)){var z=o.slice(1,4);z[1]*=.01,z[2]*=.01;var Y=ce(z);return Y[3]=+o[4],Y}};Ae.test=function(s){return Ne.test(s)||Xe.test(s)||ze.test(s)||Je.test(s)||Qe.test(s)||ut.test(s)},A.prototype.css=function(s){return te(this._rgb,s)},B.css=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["css"])))},L.format.css=Ae,L.autodetect.push({p:5,test:function(s){for(var o=[],g=arguments.length-1;g-- >0;)o[g]=arguments[g+1];if(!o.length&&l(s)==="string"&&Ae.test(s))return"css"}}),L.format.gl=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgba");return g[0]*=255,g[1]*=255,g[2]*=255,g},B.gl=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["gl"])))},A.prototype.gl=function(){var s=this._rgb;return[s[0]/255,s[1]/255,s[2]/255,s[3]]};var Pt=Math.floor,kt=function(){for(var s,o,g,p,S,C,w=[],E=arguments.length;E--;)w[E]=arguments[E];w=n(w,"hcg");var T=w[0],P=w[1],H=w[2],X,z,Y;H=H*255;var _=P*255;if(P===0)X=z=Y=H;else{T===360&&(T=0),T>360&&(T-=360),T<0&&(T+=360),T/=60;var ie=Pt(T),le=T-ie,he=H*(1-P),fe=he+_*(1-le),De=he+_*le,ke=he+_;switch(ie){case 0:s=[ke,De,he],X=s[0],z=s[1],Y=s[2];break;case 1:o=[fe,ke,he],X=o[0],z=o[1],Y=o[2];break;case 2:g=[he,ke,De],X=g[0],z=g[1],Y=g[2];break;case 3:p=[he,fe,ke],X=p[0],z=p[1],Y=p[2];break;case 4:S=[De,he,ke],X=S[0],z=S[1],Y=S[2];break;case 5:C=[ke,he,fe],X=C[0],z=C[1],Y=C[2];break}}return[X,z,Y,w.length>3?w[3]:1]},It=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgb"),p=g[0],S=g[1],C=g[2],w=d(p,S,C),E=u(p,S,C),T=E-w,P=T*100/255,H=w/(255-T)*100,X;return T===0?X=Number.NaN:(p===E&&(X=(S-C)/T),S===E&&(X=2+(C-p)/T),C===E&&(X=4+(p-S)/T),X*=60,X<0&&(X+=360)),[X,P,H]};A.prototype.hcg=function(){return It(this._rgb)},B.hcg=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["hcg"])))},L.format.hcg=kt,L.autodetect.push({p:1,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s=n(s,"hcg"),l(s)==="array"&&s.length===3)return"hcg"}});var Ut=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,Ot=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,G=function(s){if(s.match(Ut)){(s.length===4||s.length===7)&&(s=s.substr(1)),s.length===3&&(s=s.split(""),s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]);var o=parseInt(s,16),g=o>>16,p=o>>8&255,S=o&255;return[g,p,S,1]}if(s.match(Ot)){(s.length===5||s.length===9)&&(s=s.substr(1)),s.length===4&&(s=s.split(""),s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]+s[3]+s[3]);var C=parseInt(s,16),w=C>>24&255,E=C>>16&255,T=C>>8&255,P=Math.round((C&255)/255*100)/100;return[w,E,T,P]}throw new Error("unknown hex color: "+s)},Re=Math.round,je=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgba"),p=g[0],S=g[1],C=g[2],w=g[3],E=f(s)||"auto";w===void 0&&(w=1),E==="auto"&&(E=w<1?"rgba":"rgb"),p=Re(p),S=Re(S),C=Re(C);var T=p<<16|S<<8|C,P="000000"+T.toString(16);P=P.substr(P.length-6);var H="0"+Re(w*255).toString(16);switch(H=H.substr(H.length-2),E.toLowerCase()){case"rgba":return"#"+P+H;case"argb":return"#"+H+P;default:return"#"+P}};A.prototype.hex=function(s){return je(this._rgb,s)},B.hex=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["hex"])))},L.format.hex=G,L.autodetect.push({p:4,test:function(s){for(var o=[],g=arguments.length-1;g-- >0;)o[g]=arguments[g+1];if(!o.length&&l(s)==="string"&&[3,4,5,6,7,8,9].indexOf(s.length)>=0)return"hex"}});var Pe=Math.cos,tt=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];s=n(s,"hsi");var g=s[0],p=s[1],S=s[2],C,w,E;return isNaN(g)&&(g=0),isNaN(p)&&(p=0),g>360&&(g-=360),g<0&&(g+=360),g/=360,g<1/3?(E=(1-p)/3,C=(1+p*Pe(c*g)/Pe(b-c*g))/3,w=1-(E+C)):g<2/3?(g-=1/3,C=(1-p)/3,w=(1+p*Pe(c*g)/Pe(b-c*g))/3,E=1-(C+w)):(g-=2/3,w=(1-p)/3,E=(1+p*Pe(c*g)/Pe(b-c*g))/3,C=1-(w+E)),C=M(S*C*3),w=M(S*w*3),E=M(S*E*3),[C*255,w*255,E*255,s.length>3?s[3]:1]},Ze=Math.min,_e=Math.sqrt,Ye=Math.acos,Dt=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgb"),p=g[0],S=g[1],C=g[2];p/=255,S/=255,C/=255;var w,E=Ze(p,S,C),T=(p+S+C)/3,P=T>0?1-E/T:0;return P===0?w=NaN:(w=(p-S+(p-C))/2,w/=_e((p-S)*(p-S)+(p-C)*(S-C)),w=Ye(w),C>S&&(w=c-w),w/=c),[w*360,P,T]};A.prototype.hsi=function(){return Dt(this._rgb)},B.hsi=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["hsi"])))},L.format.hsi=tt,L.autodetect.push({p:2,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s=n(s,"hsi"),l(s)==="array"&&s.length===3)return"hsi"}}),A.prototype.hsl=function(){return se(this._rgb)},B.hsl=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["hsl"])))},L.format.hsl=ce,L.autodetect.push({p:2,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s=n(s,"hsl"),l(s)==="array"&&s.length===3)return"hsl"}});var Ke=Math.floor,Ie=function(){for(var s,o,g,p,S,C,w=[],E=arguments.length;E--;)w[E]=arguments[E];w=n(w,"hsv");var T=w[0],P=w[1],H=w[2],X,z,Y;if(H*=255,P===0)X=z=Y=H;else{T===360&&(T=0),T>360&&(T-=360),T<0&&(T+=360),T/=60;var _=Ke(T),ie=T-_,le=H*(1-P),he=H*(1-P*ie),fe=H*(1-P*(1-ie));switch(_){case 0:s=[H,fe,le],X=s[0],z=s[1],Y=s[2];break;case 1:o=[he,H,le],X=o[0],z=o[1],Y=o[2];break;case 2:g=[le,H,fe],X=g[0],z=g[1],Y=g[2];break;case 3:p=[le,he,H],X=p[0],z=p[1],Y=p[2];break;case 4:S=[fe,le,H],X=S[0],z=S[1],Y=S[2];break;case 5:C=[H,le,he],X=C[0],z=C[1],Y=C[2];break}}return[X,z,Y,w.length>3?w[3]:1]},Me=Math.min,Oe=Math.max,ft=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];s=n(s,"rgb");var g=s[0],p=s[1],S=s[2],C=Me(g,p,S),w=Oe(g,p,S),E=w-C,T,P,H;return H=w/255,w===0?(T=Number.NaN,P=0):(P=E/w,g===w&&(T=(p-S)/E),p===w&&(T=2+(S-g)/E),S===w&&(T=4+(g-p)/E),T*=60,T<0&&(T+=360)),[T,P,H]};A.prototype.hsv=function(){return ft(this._rgb)},B.hsv=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["hsv"])))},L.format.hsv=Ie,L.autodetect.push({p:2,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s=n(s,"hsv"),l(s)==="array"&&s.length===3)return"hsv"}});var Se={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Ht=Math.pow,St=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];s=n(s,"lab");var g=s[0],p=s[1],S=s[2],C,w,E,T,P,H;return w=(g+16)/116,C=isNaN(p)?w:w+p/500,E=isNaN(S)?w:w-S/200,w=Se.Yn*at(w),C=Se.Xn*at(C),E=Se.Zn*at(E),T=ct(3.2404542*C-1.5371385*w-.4985314*E),P=ct(-.969266*C+1.8760108*w+.041556*E),H=ct(.0556434*C-.2040259*w+1.0572252*E),[T,P,H,s.length>3?s[3]:1]},ct=function(s){return 255*(s<=.00304?12.92*s:1.055*Ht(s,1/2.4)-.055)},at=function(s){return s>Se.t1?s*s*s:Se.t2*(s-Se.t0)},rt=Math.pow,dt=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgb"),p=g[0],S=g[1],C=g[2],w=$t(p,S,C),E=w[0],T=w[1],P=w[2],H=116*T-16;return[H<0?0:H,500*(E-T),200*(T-P)]},pt=function(s){return(s/=255)<=.04045?s/12.92:rt((s+.055)/1.055,2.4)},vt=function(s){return s>Se.t3?rt(s,1/3):s/Se.t2+Se.t0},$t=function(s,o,g){s=pt(s),o=pt(o),g=pt(g);var p=vt((.4124564*s+.3575761*o+.1804375*g)/Se.Xn),S=vt((.2126729*s+.7151522*o+.072175*g)/Se.Yn),C=vt((.0193339*s+.119192*o+.9503041*g)/Se.Zn);return[p,S,C]};A.prototype.lab=function(){return dt(this._rgb)},B.lab=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["lab"])))},L.format.lab=St,L.autodetect.push({p:2,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s=n(s,"lab"),l(s)==="array"&&s.length===3)return"lab"}});var Yr=Math.sin,Vr=Math.cos,mr=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"lch"),p=g[0],S=g[1],C=g[2];return isNaN(C)&&(C=0),C=C*x,[p,Vr(C)*S,Yr(C)*S]},Lr=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];s=n(s,"lch");var g=s[0],p=s[1],S=s[2],C=mr(g,p,S),w=C[0],E=C[1],T=C[2],P=St(w,E,T),H=P[0],X=P[1],z=P[2];return[H,X,z,s.length>3?s[3]:1]},Mr=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"hcl").reverse();return Lr.apply(void 0,g)},Ur=Math.sqrt,Gr=Math.atan2,Zr=Math.round,br=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"lab"),p=g[0],S=g[1],C=g[2],w=Ur(S*S+C*C),E=(Gr(C,S)*y+360)%360;return Zr(w*1e4)===0&&(E=Number.NaN),[p,w,E]},wr=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgb"),p=g[0],S=g[1],C=g[2],w=dt(p,S,C),E=w[0],T=w[1],P=w[2];return br(E,T,P)};A.prototype.lch=function(){return wr(this._rgb)},A.prototype.hcl=function(){return wr(this._rgb).reverse()},B.lch=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["lch"])))},B.hcl=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["hcl"])))},L.format.lch=Lr,L.format.hcl=Mr,["lch","hcl"].forEach(function(s){return L.autodetect.push({p:2,test:function(){for(var o=[],g=arguments.length;g--;)o[g]=arguments[g];if(o=n(o,s),l(o)==="array"&&o.length===3)return s}})});var At={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};A.prototype.name=function(){for(var s=je(this._rgb,"rgb"),o=0,g=Object.keys(At);o<g.length;o+=1){var p=g[o];if(At[p]===s)return p.toLowerCase()}return s},L.format.named=function(s){if(s=s.toLowerCase(),At[s])return G(At[s]);throw new Error("unknown color name: "+s)},L.autodetect.push({p:5,test:function(s){for(var o=[],g=arguments.length-1;g-- >0;)o[g]=arguments[g+1];if(!o.length&&l(s)==="string"&&At[s.toLowerCase()])return"named"}});var Br=function(s){if(l(s)=="number"&&s>=0&&s<=16777215){var o=s>>16,g=s>>8&255,p=s&255;return[o,g,p,1]}throw new Error("unknown num color: "+s)},Pr=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgb"),p=g[0],S=g[1],C=g[2];return(p<<16)+(S<<8)+C};A.prototype.num=function(){return Pr(this._rgb)},B.num=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["num"])))},L.format.num=Br,L.autodetect.push({p:5,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s.length===1&&l(s[0])==="number"&&s[0]>=0&&s[0]<=16777215)return"num"}});var kr=Math.round;A.prototype.rgb=function(s){return s===void 0&&(s=!0),s===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(kr)},A.prototype.rgba=function(s){return s===void 0&&(s=!0),this._rgb.slice(0,4).map(function(o,g){return g<3?s===!1?o:kr(o):o})},B.rgb=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["rgb"])))},L.format.rgb=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgba");return g[3]===void 0&&(g[3]=1),g},L.autodetect.push({p:3,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s=n(s,"rgba"),l(s)==="array"&&(s.length===3||s.length===4&&l(s[3])=="number"&&s[3]>=0&&s[3]<=1))return"rgb"}});var Gt=Math.log,Ir=function(s){var o=s/100,g,p,S;return o<66?(g=255,p=o<6?0:-155.25485562709179-.44596950469579133*(p=o-2)+104.49216199393888*Gt(p),S=o<20?0:-254.76935184120902+.8274096064007395*(S=o-10)+115.67994401066147*Gt(S)):(g=351.97690566805693+.114206453784165*(g=o-55)-40.25366309332127*Gt(g),p=325.4494125711974+.07943456536662342*(p=o-50)-28.0852963507957*Gt(p),S=255),[g,p,S,1]},Kr=Math.round,Jr=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];for(var g=n(s,"rgb"),p=g[0],S=g[2],C=1e3,w=4e4,E=.4,T;w-C>E;){T=(w+C)*.5;var P=Ir(T);P[2]/P[0]>=S/p?w=T:C=T}return Kr(T)};A.prototype.temp=A.prototype.kelvin=A.prototype.temperature=function(){return Jr(this._rgb)},B.temp=B.kelvin=B.temperature=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["temp"])))},L.format.temp=L.format.kelvin=L.format.temperature=Ir;var Zt=Math.pow,Qr=Math.sign,Or=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];s=n(s,"lab");var g=s[0],p=s[1],S=s[2],C=Zt(g+.3963377774*p+.2158037573*S,3),w=Zt(g-.1055613458*p-.0638541728*S,3),E=Zt(g-.0894841775*p-1.291485548*S,3);return[255*yr(4.0767416621*C-3.3077115913*w+.2309699292*E),255*yr(-1.2684380046*C+2.6097574011*w-.3413193965*E),255*yr(-.0041960863*C-.7034186147*w+1.707614701*E),s.length>3?s[3]:1]};function yr(s){var o=Math.abs(s);return o>.0031308?(Qr(s)||1)*(1.055*Zt(o,1/2.4)-.055):s*12.92}var Sr=Math.cbrt,m=Math.pow,ye=Math.sign,zt=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgb"),p=g[0],S=g[1],C=g[2],w=[Ve(p/255),Ve(S/255),Ve(C/255)],E=w[0],T=w[1],P=w[2],H=Sr(.4122214708*E+.5363325363*T+.0514459929*P),X=Sr(.2119034982*E+.6806995451*T+.1073969566*P),z=Sr(.0883024619*E+.2817188376*T+.6299787005*P);return[.2104542553*H+.793617785*X-.0040720468*z,1.9779984951*H-2.428592205*X+.4505937099*z,.0259040371*H+.7827717662*X-.808675766*z]};function Ve(s){var o=Math.abs(s);return o<.04045?s/12.92:(ye(s)||1)*m((o+.055)/1.055,2.4)}A.prototype.oklab=function(){return zt(this._rgb)},B.oklab=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["oklab"])))},L.format.oklab=Or,L.autodetect.push({p:3,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s=n(s,"oklab"),l(s)==="array"&&s.length===3)return"oklab"}});var Ar=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];s=n(s,"lch");var g=s[0],p=s[1],S=s[2],C=mr(g,p,S),w=C[0],E=C[1],T=C[2],P=Or(w,E,T),H=P[0],X=P[1],z=P[2];return[H,X,z,s.length>3?s[3]:1]},U=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];var g=n(s,"rgb"),p=g[0],S=g[1],C=g[2],w=zt(p,S,C),E=w[0],T=w[1],P=w[2];return br(E,T,P)};A.prototype.oklch=function(){return U(this._rgb)},B.oklch=function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];return new(Function.prototype.bind.apply(A,[null].concat(s,["oklch"])))},L.format.oklch=Ar,L.autodetect.push({p:3,test:function(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];if(s=n(s,"oklch"),l(s)==="array"&&s.length===3)return"oklch"}}),A.prototype.alpha=function(s,o){return o===void 0&&(o=!1),s!==void 0&&l(s)==="number"?o?(this._rgb[3]=s,this):new A([this._rgb[0],this._rgb[1],this._rgb[2],s],"rgb"):this._rgb[3]},A.prototype.clipped=function(){return this._rgb._clipped||!1},A.prototype.darken=function(s){s===void 0&&(s=1);var o=this,g=o.lab();return g[0]-=Se.Kn*s,new A(g,"lab").alpha(o.alpha(),!0)},A.prototype.brighten=function(s){return s===void 0&&(s=1),this.darken(-s)},A.prototype.darker=A.prototype.darken,A.prototype.brighter=A.prototype.brighten,A.prototype.get=function(s){var o=s.split("."),g=o[0],p=o[1],S=this[g]();if(p){var C=g.indexOf(p)-(g.substr(0,2)==="ok"?2:0);if(C>-1)return S[C];throw new Error("unknown channel "+p+" in mode "+g)}else return S};var Kt=Math.pow,$i=1e-7,zi=20;A.prototype.luminance=function(s,o){if(o===void 0&&(o="rgb"),s!==void 0&&l(s)==="number"){if(s===0)return new A([0,0,0,this._rgb[3]],"rgb");if(s===1)return new A([255,255,255,this._rgb[3]],"rgb");var g=this.luminance(),p=zi,S=function(w,E){var T=w.interpolate(E,.5,o),P=T.luminance();return Math.abs(s-P)<$i||!p--?T:P>s?S(w,T):S(T,E)},C=(g>s?S(new A([0,0,0]),this):S(this,new A([255,255,255]))).rgb();return new A(C.concat([this._rgb[3]]))}return Fi.apply(void 0,this._rgb.slice(0,3))};var Fi=function(s,o,g){return s=Dr(s),o=Dr(o),g=Dr(g),.2126*s+.7152*o+.0722*g},Dr=function(s){return s/=255,s<=.03928?s/12.92:Kt((s+.055)/1.055,2.4)},re={};function $e(s,o,g){g===void 0&&(g=.5);for(var p=[],S=arguments.length-3;S-- >0;)p[S]=arguments[S+3];var C=p[0]||"lrgb";if(!re[C]&&!p.length&&(C=Object.keys(re)[0]),!re[C])throw new Error("interpolation mode "+C+" is not defined");return l(s)!=="object"&&(s=new A(s)),l(o)!=="object"&&(o=new A(o)),re[C](s,o,g).alpha(s.alpha()+g*(o.alpha()-s.alpha()))}A.prototype.mix=A.prototype.interpolate=function(s,o){o===void 0&&(o=.5);for(var g=[],p=arguments.length-2;p-- >0;)g[p]=arguments[p+2];return $e.apply(void 0,[this,s,o].concat(g))},A.prototype.premultiply=function(s){s===void 0&&(s=!1);var o=this._rgb,g=o[3];return s?(this._rgb=[o[0]*g,o[1]*g,o[2]*g,g],this):new A([o[0]*g,o[1]*g,o[2]*g,g],"rgb")},A.prototype.saturate=function(s){s===void 0&&(s=1);var o=this,g=o.lch();return g[1]+=Se.Kn*s,g[1]<0&&(g[1]=0),new A(g,"lch").alpha(o.alpha(),!0)},A.prototype.desaturate=function(s){return s===void 0&&(s=1),this.saturate(-s)},A.prototype.set=function(s,o,g){g===void 0&&(g=!1);var p=s.split("."),S=p[0],C=p[1],w=this[S]();if(C){var E=S.indexOf(C)-(S.substr(0,2)==="ok"?2:0);if(E>-1){if(l(o)=="string")switch(o.charAt(0)){case"+":w[E]+=+o;break;case"-":w[E]+=+o;break;case"*":w[E]*=+o.substr(1);break;case"/":w[E]/=+o.substr(1);break;default:w[E]=+o}else if(l(o)==="number")w[E]=o;else throw new Error("unsupported value for Color.set");var T=new A(w,S);return g?(this._rgb=T._rgb,this):T}throw new Error("unknown channel "+C+" in mode "+S)}else return w},A.prototype.tint=function(s){s===void 0&&(s=.5);for(var o=[],g=arguments.length-1;g-- >0;)o[g]=arguments[g+1];return $e.apply(void 0,[this,"white",s].concat(o))},A.prototype.shade=function(s){s===void 0&&(s=.5);for(var o=[],g=arguments.length-1;g-- >0;)o[g]=arguments[g+1];return $e.apply(void 0,[this,"black",s].concat(o))};var qi=function(s,o,g){var p=s._rgb,S=o._rgb;return new A(p[0]+g*(S[0]-p[0]),p[1]+g*(S[1]-p[1]),p[2]+g*(S[2]-p[2]),"rgb")};re.rgb=qi;var Cr=Math.sqrt,Ct=Math.pow,Hr=function(s,o,g){var p=s._rgb,S=p[0],C=p[1],w=p[2],E=o._rgb,T=E[0],P=E[1],H=E[2];return new A(Cr(Ct(S,2)*(1-g)+Ct(T,2)*g),Cr(Ct(C,2)*(1-g)+Ct(P,2)*g),Cr(Ct(w,2)*(1-g)+Ct(H,2)*g),"rgb")};re.lrgb=Hr;var Ft=function(s,o,g){var p=s.lab(),S=o.lab();return new A(p[0]+g*(S[0]-p[0]),p[1]+g*(S[1]-p[1]),p[2]+g*(S[2]-p[2]),"lab")};re.lab=Ft;function V(s,o,g,p){var S,C,w,E;p==="hsl"?(w=s.hsl(),E=o.hsl()):p==="hsv"?(w=s.hsv(),E=o.hsv()):p==="hcg"?(w=s.hcg(),E=o.hcg()):p==="hsi"?(w=s.hsi(),E=o.hsi()):p==="lch"||p==="hcl"?(p="hcl",w=s.hcl(),E=o.hcl()):p==="oklch"&&(w=s.oklch().reverse(),E=o.oklch().reverse());var T,P,H,X,z,Y;(p.substr(0,1)==="h"||p==="oklch")&&(S=w,T=S[0],H=S[1],z=S[2],C=E,P=C[0],X=C[1],Y=C[2]);var _,ie,le,he;return!isNaN(T)&&!isNaN(P)?(P>T&&P-T>180?he=P-(T+360):P<T&&T-P>180?he=P+360-T:he=P-T,ie=T+g*he):isNaN(T)?isNaN(P)?ie=Number.NaN:(ie=P,(z==1||z==0)&&p!="hsv"&&(_=X)):(ie=T,(Y==1||Y==0)&&p!="hsv"&&(_=H)),_===void 0&&(_=H+g*(X-H)),le=z+g*(Y-z),p==="oklch"?new A([le,_,ie],p):new A([ie,_,le],p)}var Jt=function(s,o,g){return V(s,o,g,"lch")};re.lch=Jt,re.hcl=Jt;var $r=function(s,o,g){var p=s.num(),S=o.num();return new A(p+g*(S-p),"num")};re.num=$r;var Qt=function(s,o,g){return V(s,o,g,"hcg")};re.hcg=Qt;var xt=function(s,o,g){return V(s,o,g,"hsi")};re.hsi=xt;var jr=function(s,o,g){return V(s,o,g,"hsl")};re.hsl=jr;var jt=function(s,o,g){return V(s,o,g,"hsv")};re.hsv=jt;var ei=function(s,o,g){var p=s.oklab(),S=o.oklab();return new A(p[0]+g*(S[0]-p[0]),p[1]+g*(S[1]-p[1]),p[2]+g*(S[2]-p[2]),"oklab")};re.oklab=ei;var ti=function(s,o,g){return V(s,o,g,"oklch")};re.oklch=ti;var er=Math.pow,tr=Math.sqrt,xr=Math.PI,Nr=Math.cos,zr=Math.sin,ri=Math.atan2;function ii(s,o,g){o===void 0&&(o="lrgb"),g===void 0&&(g=null);var p=s.length;g||(g=Array.from(new Array(p)).map(function(){return 1}));var S=p/g.reduce(function(ie,le){return ie+le});if(g.forEach(function(ie,le){g[le]*=S}),s=s.map(function(ie){return new A(ie)}),o==="lrgb")return ni(s,g);for(var C=s.shift(),w=C.get(o),E=[],T=0,P=0,H=0;H<w.length;H++)if(w[H]=(w[H]||0)*g[0],E.push(isNaN(w[H])?0:g[0]),o.charAt(H)==="h"&&!isNaN(w[H])){var X=w[H]/180*xr;T+=Nr(X)*g[0],P+=zr(X)*g[0]}var z=C.alpha()*g[0];s.forEach(function(ie,le){var he=ie.get(o);z+=ie.alpha()*g[le+1];for(var fe=0;fe<w.length;fe++)if(!isNaN(he[fe]))if(E[fe]+=g[le+1],o.charAt(fe)==="h"){var De=he[fe]/180*xr;T+=Nr(De)*g[le+1],P+=zr(De)*g[le+1]}else w[fe]+=he[fe]*g[le+1]});for(var Y=0;Y<w.length;Y++)if(o.charAt(Y)==="h"){for(var _=ri(P/E[Y],T/E[Y])/xr*180;_<0;)_+=360;for(;_>=360;)_-=360;w[Y]=_}else w[Y]=w[Y]/E[Y];return z/=p,new A(w,o).alpha(z>.99999?1:z,!0)}var ni=function(s,o){for(var g=s.length,p=[0,0,0,0],S=0;S<s.length;S++){var C=s[S],w=o[S]/g,E=C._rgb;p[0]+=er(E[0],2)*w,p[1]+=er(E[1],2)*w,p[2]+=er(E[2],2)*w,p[3]+=E[3]*w}return p[0]=tr(p[0]),p[1]=tr(p[1]),p[2]=tr(p[2]),p[3]>.9999999&&(p[3]=1),new A(e(p))},si=Math.pow;function rr(s){var o="rgb",g=B("#ccc"),p=0,S=[0,1],C=[],w=[0,0],E=!1,T=[],P=!1,H=0,X=1,z=!1,Y={},_=!0,ie=1,le=function(q){if(q=q||["#fff","#000"],q&&l(q)==="string"&&B.brewer&&B.brewer[q.toLowerCase()]&&(q=B.brewer[q.toLowerCase()]),l(q)==="array"){q.length===1&&(q=[q[0],q[0]]),q=q.slice(0);for(var K=0;K<q.length;K++)q[K]=B(q[K]);C.length=0;for(var ae=0;ae<q.length;ae++)C.push(ae/(q.length-1))}return Ue(),T=q},he=function(q){if(E!=null){for(var K=E.length-1,ae=0;ae<K&&q>=E[ae];)ae++;return ae-1}return 0},fe=function(q){return q},De=function(q){return q},ke=function(q,K){var ae,ne;if(K==null&&(K=!1),isNaN(q)||q===null)return g;if(K)ne=q;else if(E&&E.length>2){var He=he(q);ne=He/(E.length-2)}else X!==H?ne=(q-H)/(X-H):ne=1;ne=De(ne),K||(ne=fe(ne)),ie!==1&&(ne=si(ne,ie)),ne=w[0]+ne*(1-w[0]-w[1]),ne=M(ne,0,1);var we=Math.floor(ne*1e4);if(_&&Y[we])ae=Y[we];else{if(l(T)==="array")for(var ge=0;ge<C.length;ge++){var de=C[ge];if(ne<=de){ae=T[ge];break}if(ne>=de&&ge===C.length-1){ae=T[ge];break}if(ne>de&&ne<C[ge+1]){ne=(ne-de)/(C[ge+1]-de),ae=B.interpolate(T[ge],T[ge+1],ne,o);break}}else l(T)==="function"&&(ae=T(ne));_&&(Y[we]=ae)}return ae},Ue=function(){return Y={}};le(s);var oe=function(q){var K=B(ke(q));return P&&K[P]?K[P]():K};return oe.classes=function(q){if(q!=null){if(l(q)==="array")E=q,S=[q[0],q[q.length-1]];else{var K=B.analyze(S);q===0?E=[K.min,K.max]:E=B.limits(K,"e",q)}return oe}return E},oe.domain=function(q){if(!arguments.length)return S;H=q[0],X=q[q.length-1],C=[];var K=T.length;if(q.length===K&&H!==X)for(var ae=0,ne=Array.from(q);ae<ne.length;ae+=1){var He=ne[ae];C.push((He-H)/(X-H))}else{for(var we=0;we<K;we++)C.push(we/(K-1));if(q.length>2){var ge=q.map(function(pe,ve){return ve/(q.length-1)}),de=q.map(function(pe){return(pe-H)/(X-H)});de.every(function(pe,ve){return ge[ve]===pe})||(De=function(pe){if(pe<=0||pe>=1)return pe;for(var ve=0;pe>=de[ve+1];)ve++;var nt=(pe-de[ve])/(de[ve+1]-de[ve]),Nt=ge[ve]+nt*(ge[ve+1]-ge[ve]);return Nt})}}return S=[H,X],oe},oe.mode=function(q){return arguments.length?(o=q,Ue(),oe):o},oe.range=function(q,K){return le(q),oe},oe.out=function(q){return P=q,oe},oe.spread=function(q){return arguments.length?(p=q,oe):p},oe.correctLightness=function(q){return q==null&&(q=!0),z=q,Ue(),z?fe=function(K){for(var ae=ke(0,!0).lab()[0],ne=ke(1,!0).lab()[0],He=ae>ne,we=ke(K,!0).lab()[0],ge=ae+(ne-ae)*K,de=we-ge,pe=0,ve=1,nt=20;Math.abs(de)>.01&&nt-- >0;)(function(){return He&&(de*=-1),de<0?(pe=K,K+=(ve-K)*.5):(ve=K,K+=(pe-K)*.5),we=ke(K,!0).lab()[0],de=we-ge})();return K}:fe=function(K){return K},oe},oe.padding=function(q){return q!=null?(l(q)==="number"&&(q=[q,q]),w=q,oe):w},oe.colors=function(q,K){arguments.length<2&&(K="hex");var ae=[];if(arguments.length===0)ae=T.slice(0);else if(q===1)ae=[oe(.5)];else if(q>1){var ne=S[0],He=S[1]-ne;ae=ai(0,q).map(function(ve){return oe(ne+ve/(q-1)*He)})}else{s=[];var we=[];if(E&&E.length>2)for(var ge=1,de=E.length,pe=1<=de;pe?ge<de:ge>de;pe?ge++:ge--)we.push((E[ge-1]+E[ge])*.5);else we=S;ae=we.map(function(ve){return oe(ve)})}return B[K]&&(ae=ae.map(function(ve){return ve[K]()})),ae},oe.cache=function(q){return q!=null?(_=q,oe):_},oe.gamma=function(q){return q!=null?(ie=q,oe):ie},oe.nodata=function(q){return q!=null?(g=B(q),oe):g},oe}function ai(s,o,g){for(var p=[],S=s<o,C=o,w=s;S?w<C:w>C;S?w++:w--)p.push(w);return p}var N=function(s){for(var o=[1,1],g=1;g<s;g++){for(var p=[1],S=1;S<=o.length;S++)p[S]=(o[S]||0)+o[S-1];o=p}return o},v=function(s){var o,g,p,S,C,w,E;if(s=s.map(function(z){return new A(z)}),s.length===2)o=s.map(function(z){return z.lab()}),C=o[0],w=o[1],S=function(z){var Y=[0,1,2].map(function(_){return C[_]+z*(w[_]-C[_])});return new A(Y,"lab")};else if(s.length===3)g=s.map(function(z){return z.lab()}),C=g[0],w=g[1],E=g[2],S=function(z){var Y=[0,1,2].map(function(_){return(1-z)*(1-z)*C[_]+2*(1-z)*z*w[_]+z*z*E[_]});return new A(Y,"lab")};else if(s.length===4){var T;p=s.map(function(z){return z.lab()}),C=p[0],w=p[1],E=p[2],T=p[3],S=function(z){var Y=[0,1,2].map(function(_){return(1-z)*(1-z)*(1-z)*C[_]+3*(1-z)*(1-z)*z*w[_]+3*(1-z)*z*z*E[_]+z*z*z*T[_]});return new A(Y,"lab")}}else if(s.length>=5){var P,H,X;P=s.map(function(z){return z.lab()}),X=s.length-1,H=N(X),S=function(z){var Y=1-z,_=[0,1,2].map(function(ie){return P.reduce(function(le,he,fe){return le+H[fe]*Math.pow(Y,X-fe)*Math.pow(z,fe)*he[ie]},0)});return new A(_,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return S};function k(s){var o=v(s);return o.scale=function(){return rr(o)},o}var R=function(s,o,g){if(!R[g])throw new Error("unknown blend mode "+g);return R[g](s,o)},D=function(s){return function(o,g){var p=B(g).rgb(),S=B(o).rgb();return B.rgb(s(p,S))}},W=function(s){return function(o,g){var p=[];return p[0]=s(o[0],g[0]),p[1]=s(o[1],g[1]),p[2]=s(o[2],g[2]),p}},Z=function(s){return s},Be=function(s,o){return s*o/255},et=function(s,o){return s>o?o:s},it=function(s,o){return s>o?s:o},Dn=function(s,o){return 255*(1-(1-s/255)*(1-o/255))},Hn=function(s,o){return o<128?2*s*o/255:255*(1-2*(1-s/255)*(1-o/255))},$n=function(s,o){return 255*(1-(1-o/255)/(s/255))},zn=function(s,o){return s===255?255:(s=255*(o/255)/(1-s/255),s>255?255:s)};R.normal=D(W(Z)),R.multiply=D(W(Be)),R.screen=D(W(Dn)),R.overlay=D(W(Hn)),R.darken=D(W(et)),R.lighten=D(W(it)),R.dodge=D(W(zn)),R.burn=D(W($n));var Fn=Math.pow,qn=Math.sin,Wn=Math.cos;function Xn(s,o,g,p,S){s===void 0&&(s=300),o===void 0&&(o=-1.5),g===void 0&&(g=1),p===void 0&&(p=1),S===void 0&&(S=[0,1]);var C=0,w;l(S)==="array"?w=S[1]-S[0]:(w=0,S=[S,S]);var E=function(T){var P=c*((s+120)/360+o*T),H=Fn(S[0]+w*T,p),X=C!==0?g[0]+T*C:g,z=X*H*(1-H)/2,Y=Wn(P),_=qn(P),ie=H+z*(-.14861*Y+1.78277*_),le=H+z*(-.29227*Y-.90649*_),he=H+z*(1.97294*Y);return B(e([ie*255,le*255,he*255,1]))};return E.start=function(T){return T==null?s:(s=T,E)},E.rotations=function(T){return T==null?o:(o=T,E)},E.gamma=function(T){return T==null?p:(p=T,E)},E.hue=function(T){return T==null?g:(g=T,l(g)==="array"?(C=g[1]-g[0],C===0&&(g=g[1])):C=0,E)},E.lightness=function(T){return T==null?S:(l(T)==="array"?(S=T,w=T[1]-T[0]):(S=[T,T],w=0),E)},E.scale=function(){return B.scale(E)},E.hue(g),E}var _n="0123456789abcdef",Yn=Math.floor,Vn=Math.random;function Un(){for(var s="#",o=0;o<6;o++)s+=_n.charAt(Yn(Vn()*16));return new A(s,"hex")}var Wi=Math.log,Gn=Math.pow,Zn=Math.floor,Kn=Math.abs;function Xi(s,o){o===void 0&&(o=null);var g={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return l(s)==="object"&&(s=Object.values(s)),s.forEach(function(p){o&&l(p)==="object"&&(p=p[o]),p!=null&&!isNaN(p)&&(g.values.push(p),g.sum+=p,p<g.min&&(g.min=p),p>g.max&&(g.max=p),g.count+=1)}),g.domain=[g.min,g.max],g.limits=function(p,S){return _i(g,p,S)},g}function _i(s,o,g){o===void 0&&(o="equal"),g===void 0&&(g=7),l(s)=="array"&&(s=Xi(s));var p=s.min,S=s.max,C=s.values.sort(function(oi,hi){return oi-hi});if(g===1)return[p,S];var w=[];if(o.substr(0,1)==="c"&&(w.push(p),w.push(S)),o.substr(0,1)==="e"){w.push(p);for(var E=1;E<g;E++)w.push(p+E/g*(S-p));w.push(S)}else if(o.substr(0,1)==="l"){if(p<=0)throw new Error("Logarithmic scales are only possible for values > 0");var T=Math.LOG10E*Wi(p),P=Math.LOG10E*Wi(S);w.push(p);for(var H=1;H<g;H++)w.push(Gn(10,T+H/g*(P-T)));w.push(S)}else if(o.substr(0,1)==="q"){w.push(p);for(var X=1;X<g;X++){var z=(C.length-1)*X/g,Y=Zn(z);if(Y===z)w.push(C[Y]);else{var _=z-Y;w.push(C[Y]*(1-_)+C[Y+1]*_)}}w.push(S)}else if(o.substr(0,1)==="k"){var ie,le=C.length,he=new Array(le),fe=new Array(g),De=!0,ke=0,Ue=null;Ue=[],Ue.push(p);for(var oe=1;oe<g;oe++)Ue.push(p+oe/g*(S-p));for(Ue.push(S);De;){for(var q=0;q<g;q++)fe[q]=0;for(var K=0;K<le;K++)for(var ae=C[K],ne=Number.MAX_VALUE,He=void 0,we=0;we<g;we++){var ge=Kn(Ue[we]-ae);ge<ne&&(ne=ge,He=we),fe[He]++,he[K]=He}for(var de=new Array(g),pe=0;pe<g;pe++)de[pe]=null;for(var ve=0;ve<le;ve++)ie=he[ve],de[ie]===null?de[ie]=C[ve]:de[ie]+=C[ve];for(var nt=0;nt<g;nt++)de[nt]*=1/fe[nt];De=!1;for(var Nt=0;Nt<g;Nt++)if(de[Nt]!==Ue[Nt]){De=!0;break}Ue=de,ke++,ke>200&&(De=!1)}for(var Rt={},ir=0;ir<g;ir++)Rt[ir]=[];for(var nr=0;nr<le;nr++)ie=he[nr],Rt[ie].push(C[nr]);for(var bt=[],qt=0;qt<g;qt++)bt.push(Rt[qt][0]),bt.push(Rt[qt][Rt[qt].length-1]);bt=bt.sort(function(oi,hi){return oi-hi}),w.push(bt[0]);for(var Rr=1;Rr<bt.length;Rr+=2){var Wt=bt[Rr];!isNaN(Wt)&&w.indexOf(Wt)===-1&&w.push(Wt)}}return w}function Jn(s,o){s=new A(s),o=new A(o);var g=s.luminance(),p=o.luminance();return g>p?(g+.05)/(p+.05):(p+.05)/(g+.05)}var mt=Math.sqrt,Ee=Math.pow,Qn=Math.min,jn=Math.max,Yi=Math.atan2,Vi=Math.abs,Fr=Math.cos,Ui=Math.sin,es=Math.exp,Gi=Math.PI;function ts(s,o,g,p,S){g===void 0&&(g=1),p===void 0&&(p=1),S===void 0&&(S=1);var C=function(Wt){return 360*Wt/(2*Gi)},w=function(Wt){return 2*Gi*Wt/360};s=new A(s),o=new A(o);var E=Array.from(s.lab()),T=E[0],P=E[1],H=E[2],X=Array.from(o.lab()),z=X[0],Y=X[1],_=X[2],ie=(T+z)/2,le=mt(Ee(P,2)+Ee(H,2)),he=mt(Ee(Y,2)+Ee(_,2)),fe=(le+he)/2,De=.5*(1-mt(Ee(fe,7)/(Ee(fe,7)+Ee(25,7)))),ke=P*(1+De),Ue=Y*(1+De),oe=mt(Ee(ke,2)+Ee(H,2)),q=mt(Ee(Ue,2)+Ee(_,2)),K=(oe+q)/2,ae=C(Yi(H,ke)),ne=C(Yi(_,Ue)),He=ae>=0?ae:ae+360,we=ne>=0?ne:ne+360,ge=Vi(He-we)>180?(He+we+360)/2:(He+we)/2,de=1-.17*Fr(w(ge-30))+.24*Fr(w(2*ge))+.32*Fr(w(3*ge+6))-.2*Fr(w(4*ge-63)),pe=we-He;pe=Vi(pe)<=180?pe:we<=He?pe+360:pe-360,pe=2*mt(oe*q)*Ui(w(pe)/2);var ve=z-T,nt=q-oe,Nt=1+.015*Ee(ie-50,2)/mt(20+Ee(ie-50,2)),Rt=1+.045*K,ir=1+.015*K*de,nr=30*es(-Ee((ge-275)/25,2)),bt=2*mt(Ee(K,7)/(Ee(K,7)+Ee(25,7))),qt=-bt*Ui(2*w(nr)),Rr=mt(Ee(ve/(g*Nt),2)+Ee(nt/(p*Rt),2)+Ee(pe/(S*ir),2)+qt*(nt/(p*Rt))*(pe/(S*ir)));return jn(0,Qn(100,Rr))}function rs(s,o,g){g===void 0&&(g="lab"),s=new A(s),o=new A(o);var p=s.get(g),S=o.get(g),C=0;for(var w in p){var E=(p[w]||0)-(S[w]||0);C+=E*E}return Math.sqrt(C)}function is(){for(var s=[],o=arguments.length;o--;)s[o]=arguments[o];try{return new(Function.prototype.bind.apply(A,[null].concat(s))),!0}catch{return!1}}for(var ns={cool:function(){return rr([B.hsl(180,1,.9),B.hsl(250,.7,.4)])},hot:function(){return rr(["#000","#f00","#ff0","#fff"]).mode("rgb")}},qr={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},li=0,Zi=Object.keys(qr);li<Zi.length;li+=1){var Ki=Zi[li];qr[Ki.toLowerCase()]=qr[Ki]}return Object.assign(B,{average:ii,bezier:k,blend:R,cubehelix:Xn,mix:$e,interpolate:$e,random:Un,scale:rr,analyze:Xi,contrast:Jn,deltaE:ts,distance:rs,limits:_i,valid:is,scales:ns,input:L,colors:At,brewer:qr}),B})});var vr=me((nl,Pn)=>{var Bn=Ge(),$s=gr(),zs=Mn(),Oi=class{constructor(e,t,r,i,a=.3,l=0,n=null,f=1,h=!1){this.points=e,this.weights=t,this.width=r,this.height=i,this.sigma=a,this.interval=l,this.opacity=f,this.normalized=h,n===null&&(n=["#c51b7d","#de77ae","#f1b6da","#fde0ef","#ffffff","#e6f5d0","#b8e186","#7fbc41","#4d9221"]),this.colormap=n,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=this.width,this.canvas.height=this.height}setFromArray(e,t){this.points=[],e.forEach(r=>{this.points.push(new Bn(r[0],r[1]))}),this.weights=[],t.forEach(r=>{this.weights.push(r)})}draw(){let e=[];for(let a=0;a<this.width;a++){let l=[];for(let n=0;n<this.height;n++)l.push(0);e.push(l)}let t=1/(2*this.sigma**2);for(let a=0;a<this.points.length;a++){let l=this.points[a],n=this.weights[a];for(let f=0;f<this.width;f++)for(let h=0;h<this.height;h++){let d=((f-l.x)**2+(h-l.y)**2)*t,u=n*Math.exp(-d);e[f][h]+=u}}let r=1;if(!this.normalized){let a=-Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;for(let n=0;n<this.width;n++)for(let f=0;f<this.height;f++)e[n][f]<l&&(l=e[n][f]),e[n][f]>a&&(a=e[n][f]);r=Math.max(Math.abs(l),Math.abs(a))}let i=zs.scale(this.colormap).domain([-1,1]);for(let a=0;a<this.width;a++)for(let l=0;l<this.height;l++){this.normalized||(e[a][l]=e[a][l]/r),this.interval!==0&&(e[a][l]=Math.round(e[a][l]/this.interval)*this.interval);let[n,f,h]=i(e[a][l]).rgb();this.setPixel(new Bn(a,l),n,f,h)}}getImage(e){let t=new Image;t.onload=()=>{this.context.imageSmoothingEnabled=!1,this.context.drawImage(t,0,0,this.width,this.height),e&&e(t)},t.onerror=function(r){console.log(r)},t.src=this.canvas.toDataURL()}getSVG(){return $s(this.context.getImageData(0,0,this.width,this.height))}setPixel(e,t,r,i){this.context.fillStyle="rgba("+t+","+r+","+i+","+this.opacity+")",this.context.fillRect(e.x,e.y,1,1)}};Pn.exports=Oi});var Bt=me((al,In)=>{var kn=lt(),Fs=wt(),qs=hr(),sl=Et(),We=yt(),Ws=Mt(),Xs=Tt(),Le=Ge(),_s=vr(),Di=class{constructor(e,t=!0){this.preprocessor=new qs(e),this.opts=this.preprocessor.opts,this.clear=t,this.svgWrapper=null}draw(e,t,r="light",i=null,a=!1,l=[],n=!1){t===null||t==="svg"?(t=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),t.setAttributeNS(null,"width",this.opts.width),t.setAttributeNS(null,"height",this.opts.height)):t instanceof String&&(t=document.getElementById(t));let f={padding:this.opts.padding,compactDrawing:this.opts.compactDrawing};i!==null&&(this.opts.padding+=this.opts.weights.additionalPadding,this.opts.compactDrawing=!1);let h=this.preprocessor;return h.initDraw(e,r,a,l),a||(this.themeManager=new Xs(this.opts.themes,r),(this.svgWrapper===null||this.clear)&&(this.svgWrapper=new Ws(this.themeManager,t,this.opts,this.clear))),h.processGraph(),this.svgWrapper.determineDimensions(h.graph.vertices),this.drawAtomHighlights(h.opts.debug),this.drawEdges(h.opts.debug),this.drawVertices(h.opts.debug),i!==null&&this.drawWeights(i,n),h.opts.debug&&(console.log(h.graph),console.log(h.rings),console.log(h.ringConnections)),this.svgWrapper.constructSvg(),i!==null&&(this.opts.padding=f.padding,this.opts.compactDrawing=f.padding),t}drawCanvas(e,t,r="light",i=!1){let a=null;typeof t=="string"||t instanceof String?a=document.getElementById(t):a=t;let l=document.createElementNS("http://www.w3.org/2000/svg","svg");return l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttributeNS(null,"viewBox","0 0 500 500"),l.setAttributeNS(null,"width","500"),l.setAttributeNS(null,"height","500"),l.setAttributeNS(null,"style","visibility: hidden: position: absolute; left: -1000px"),document.body.appendChild(l),this.svgDrawer.draw(e,l,r,i),this.svgDrawer.svgWrapper.toCanvas(a,this.svgDrawer.opts.width,this.svgDrawer.opts.height),document.body.removeChild(l),t}drawAromaticityRing(e){this.svgWrapper.drawRing(e.center.x,e.center.y,e.getSize())}drawEdges(e){let t=this.preprocessor,r=t.graph,i=t.rings,a=Array(this.preprocessor.graph.edges.length);if(a.fill(!1),r.traverseBF(0,n=>{let f=r.getEdges(n.id);for(var h=0;h<f.length;h++){let d=f[h];a[d]||(a[d]=!0,this.drawEdge(d,e))}}),!this.bridgedRing)for(var l=0;l<i.length;l++){let n=i[l];t.isRingAromatic(n)&&this.drawAromaticityRing(n)}}drawEdge(e,t){let r=this.preprocessor,i=r.opts,a=this.svgWrapper,l=r.graph.edges[e],n=r.graph.vertices[l.sourceId],f=r.graph.vertices[l.targetId],h=n.value.element,d=f.value.element;if((!n.value.isDrawn||!f.value.isDrawn)&&r.opts.atomVisualization==="default")return;let u=n.position,c=f.position,b=r.getEdgeNormals(l),x=kn.clone(b);if(x[0].multiplyScalar(10).add(u),x[1].multiplyScalar(10).add(u),l.bondType==="="||r.getRingbondType(n,f)==="="||l.isPartOfAromaticRing&&r.bridgedRing){let y=r.areVerticesInSameRing(n,f),L=r.chooseSide(n,f,x);if(y){let $=r.getLargestOrAromaticCommonRing(n,f).center;b[0].multiplyScalar(i.bondSpacing),b[1].multiplyScalar(i.bondSpacing);let B=null;$.sameSideAs(n.position,f.position,Le.add(u,b[0]))?B=new We(Le.add(u,b[0]),Le.add(c,b[0]),h,d):B=new We(Le.add(u,b[1]),Le.add(c,b[1]),h,d),B.shorten(i.bondLength-i.shortBondLength*i.bondLength),l.isPartOfAromaticRing?a.drawLine(B,!0):a.drawLine(B),a.drawLine(new We(u,c,h,d))}else if(l.center||n.isTerminal()&&f.isTerminal()||L.anCount==0&&L.bnCount>1||L.bnCount==0&&L.anCount>1){this.multiplyNormals(b,i.halfBondSpacing);let A=new We(Le.add(u,b[0]),Le.add(c,b[0]),h,d),$=new We(Le.add(u,b[1]),Le.add(c,b[1]),h,d);a.drawLine(A),a.drawLine($)}else if(L.sideCount[0]>L.sideCount[1]||L.totalSideCount[0]>L.totalSideCount[1]){this.multiplyNormals(b,i.bondSpacing);let A=new We(Le.add(u,b[0]),Le.add(c,b[0]),h,d);A.shorten(i.bondLength-i.shortBondLength*i.bondLength),a.drawLine(A),a.drawLine(new We(u,c,h,d))}else if(L.sideCount[0]<L.sideCount[1]||L.totalSideCount[0]<=L.totalSideCount[1]){this.multiplyNormals(b,i.bondSpacing);let A=new We(Le.add(u,b[1]),Le.add(c,b[1]),h,d);A.shorten(i.bondLength-i.shortBondLength*i.bondLength),a.drawLine(A),a.drawLine(new We(u,c,h,d))}}else if(l.bondType==="#"){b[0].multiplyScalar(i.bondSpacing/1.5),b[1].multiplyScalar(i.bondSpacing/1.5);let y=new We(Le.add(u,b[0]),Le.add(c,b[0]),h,d),L=new We(Le.add(u,b[1]),Le.add(c,b[1]),h,d);a.drawLine(y),a.drawLine(L),a.drawLine(new We(u,c,h,d))}else if(l.bondType!=="."){let y=n.value.isStereoCenter,L=f.value.isStereoCenter;l.wedge==="up"?a.drawWedge(new We(u,c,h,d,y,L)):l.wedge==="down"?a.drawDashedWedge(new We(u,c,h,d,y,L)):a.drawLine(new We(u,c,h,d,y,L))}if(t){let y=Le.midpoint(u,c);a.drawDebugText(y.x,y.y,"e: "+e)}}drawAtomHighlights(e){let t=this.preprocessor,r=t.opts,i=t.graph,a=t.rings,l=this.svgWrapper;for(var n=0;n<i.vertices.length;n++){let h=i.vertices[n],d=h.value;for(var f=0;f<t.highlight_atoms.length;f++){let u=t.highlight_atoms[f];d.class===u[0]&&l.drawAtomHighlight(h.position.x,h.position.y,u[1])}}}drawVertices(e){let t=this.preprocessor,r=t.opts,i=t.graph,a=t.rings,l=this.svgWrapper;for(var n=i.vertices.length,n=0;n<i.vertices.length;n++){let h=i.vertices[n],d=h.value,u=0,c=0,b=h.value.bondCount,x=d.element,y=Fs.maxBonds[x]-b,L=h.getTextDirection(i.vertices,d.hasAttachedPseudoElements),A=r.terminalCarbons||x!=="C"||d.hasAttachedPseudoElements?h.isTerminal():!1,$=d.element==="C";if(d.element==="N"&&d.isPartOfAromaticRing&&(y=0),d.bracket&&(y=d.bracket.hcount,u=d.bracket.charge,c=d.bracket.isotope),(u||c||i.vertices.length<3)&&($=!1),r.atomVisualization==="allballs")l.drawBall(h.position.x,h.position.y,x);else if(d.isDrawn&&(!$||d.drawExplicit||A||d.hasAttachedPseudoElements)||i.vertices.length===1)if(r.atomVisualization==="default"){let B=d.getAttachedPseudoElements();d.hasAttachedPseudoElements&&i.vertices.length===Object.keys(B).length+1&&(L="right"),l.drawText(h.position.x,h.position.y,x,y,L,A,u,c,i.vertices.length,B)}else r.atomVisualization==="balls"&&l.drawBall(h.position.x,h.position.y,x);else if(h.getNeighbourCount()===2&&h.forcePositioned==!0){let B=i.vertices[h.neighbours[0]].position,O=i.vertices[h.neighbours[1]].position,F=Le.threePointangle(h.position,B,O);Math.abs(Math.PI-F)<.1&&l.drawPoint(h.position.x,h.position.y,x)}if(e){let B="v: "+h.id+" "+kn.print(d.ringbonds);l.drawDebugText(h.position.x,h.position.y,B)}}if(r.debug)for(var n=0;n<a.length;n++){let h=a[n].center;l.drawDebugPoint(h.x,h.y,"r: "+a[n].id)}}drawWeights(e,t){if(!e||e.every(a=>a===0))return;if(e.length!==this.preprocessor.graph.atomIdxToVertexId.length)throw new Error("The number of weights supplied must be equal to the number of (heavy) atoms in the molecule.");let r=[];for(let a of this.preprocessor.graph.atomIdxToVertexId){let l=this.preprocessor.graph.vertices[a];r.push(new Le(l.position.x-this.svgWrapper.minX,l.position.y-this.svgWrapper.minY))}let i=new _s(r,e,this.svgWrapper.drawingWidth,this.svgWrapper.drawingHeight,this.opts.weights.sigma,this.opts.weights.interval,this.opts.weights.colormap,this.opts.weights.opacity,t);i.draw(),this.svgWrapper.addLayer(i.getSVG())}getTotalOverlapScore(){return this.preprocessor.getTotalOverlapScore()}getMolecularFormula(e=null){return this.preprocessor.getMolecularFormula(e)}multiplyNormals(e,t){e[0].multiplyScalar(t),e[1].multiplyScalar(t)}};In.exports=Di});var pr=me((ll,On)=>{var Ys=Bt(),Hi=class{constructor(e){this.svgDrawer=new Ys(e)}draw(e,t,r="light",i=!1,a=[]){let l=null;typeof t=="string"||t instanceof String?l=document.getElementById(t):l=t;let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttributeNS(null,"viewBox","0 0 "+this.svgDrawer.opts.width+" "+this.svgDrawer.opts.height),n.setAttributeNS(null,"width",this.svgDrawer.opts.width+""),n.setAttributeNS(null,"height",this.svgDrawer.opts.height+""),this.svgDrawer.draw(e,n,r,null,i,a),this.svgDrawer.svgWrapper.toCanvas(l,this.svgDrawer.opts.width,this.svgDrawer.opts.height)}getTotalOverlapScore(){return this.svgDrawer.getTotalOverlapScore()}getMolecularFormula(){this.svgDrawer.getMolecularFormula()}};On.exports=Hi});var ol=I(lt()),hl=I(wt()),gl=I(lr()),ul=I(pr()),fl=I(hr()),cl=I(Yt()),dl=I(ur()),pl=I(vr()),vl=I(Et()),ml=I(yt()),bl=I(ot()),wl=I(Lt()),yl=I(Vt()),Sl=I(gr()),Al=I(fr()),Cl=I(cr()),xl=I(dr()),Nl=I(ht()),Rl=I(Xt()),El=I(Tr()),Tl=I(or()),Ll=I(Bt()),Ml=I(Mt()),Bl=I(Tt()),Pl=I(_t()),kl=I(Ge()),Il=I(st());})();
/*! Bundled license information:

chroma-js/dist/chroma.cjs:
  (**
   * chroma.js - JavaScript library for color conversions
   *
   * Copyright (c) 2011-2024, Gregor Aisch
   * All rights reserved.
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions are met:
   *
   * 1. Redistributions of source code must retain the above copyright notice, this
   * list of conditions and the following disclaimer.
   *
   * 2. Redistributions in binary form must reproduce the above copyright notice,
   * this list of conditions and the following disclaimer in the documentation
   * and/or other materials provided with the distribution.
   *
   * 3. The name Gregor Aisch may not be used to endorse or promote products
   * derived from this software without specific prior written permission.
   *
   * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
   * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
   * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
   * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
   * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
   * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   *
   * -------------------------------------------------------
   *
   * chroma.js includes colors from colorbrewer2.org, which are released under
   * the following license:
   *
   * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
   * and The Pennsylvania State University.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   * http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing,
   * software distributed under the License is distributed on an
   * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
   * either express or implied. See the License for the specific
   * language governing permissions and limitations under the License.
   *
   * ------------------------------------------------------
   *
   * Named colors are taken from X11 Color Names.
   * http://www.w3.org/TR/css3-color/#svg-color
   *
   * @preserve
   *)
*/
//# sourceMappingURL=bundle.js.map
